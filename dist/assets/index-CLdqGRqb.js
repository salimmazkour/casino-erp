(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))l(c);new MutationObserver(c=>{for(const d of c)if(d.type==="childList")for(const f of d.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&l(f)}).observe(document,{childList:!0,subtree:!0});function r(c){const d={};return c.integrity&&(d.integrity=c.integrity),c.referrerPolicy&&(d.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?d.credentials="include":c.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function l(c){if(c.ep)return;c.ep=!0;const d=r(c);fetch(c.href,d)}})();function ed(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}function C_(o){if(Object.prototype.hasOwnProperty.call(o,"__esModule"))return o;var i=o.default;if(typeof i=="function"){var r=function l(){var c=!1;try{c=this instanceof l}catch{}return c?Reflect.construct(i,arguments,this.constructor):i.apply(this,arguments)};r.prototype=i.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(o).forEach(function(l){var c=Object.getOwnPropertyDescriptor(o,l);Object.defineProperty(r,l,c.get?c:{enumerable:!0,get:function(){return o[l]}})}),r}var Nu={exports:{}},Lr={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Vm;function E_(){if(Vm)return Lr;Vm=1;var o=Symbol.for("react.transitional.element"),i=Symbol.for("react.fragment");function r(l,c,d){var f=null;if(d!==void 0&&(f=""+d),c.key!==void 0&&(f=""+c.key),"key"in c){d={};for(var g in c)g!=="key"&&(d[g]=c[g])}else d=c;return c=d.ref,{$$typeof:o,type:l,key:f,ref:c!==void 0?c:null,props:d}}return Lr.Fragment=i,Lr.jsx=r,Lr.jsxs=r,Lr}var Gm;function T_(){return Gm||(Gm=1,Nu.exports=E_()),Nu.exports}var n=T_(),Cu={exports:{}},Ke={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ym;function A_(){if(Ym)return Ke;Ym=1;var o=Symbol.for("react.transitional.element"),i=Symbol.for("react.portal"),r=Symbol.for("react.fragment"),l=Symbol.for("react.strict_mode"),c=Symbol.for("react.profiler"),d=Symbol.for("react.consumer"),f=Symbol.for("react.context"),g=Symbol.for("react.forward_ref"),m=Symbol.for("react.suspense"),p=Symbol.for("react.memo"),_=Symbol.for("react.lazy"),j=Symbol.for("react.activity"),C=Symbol.iterator;function N(R){return R===null||typeof R!="object"?null:(R=C&&R[C]||R["@@iterator"],typeof R=="function"?R:null)}var k={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},P=Object.assign,E={};function V(R,X,fe){this.props=R,this.context=X,this.refs=E,this.updater=fe||k}V.prototype.isReactComponent={},V.prototype.setState=function(R,X){if(typeof R!="object"&&typeof R!="function"&&R!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,R,X,"setState")},V.prototype.forceUpdate=function(R){this.updater.enqueueForceUpdate(this,R,"forceUpdate")};function L(){}L.prototype=V.prototype;function U(R,X,fe){this.props=R,this.context=X,this.refs=E,this.updater=fe||k}var O=U.prototype=new L;O.constructor=U,P(O,V.prototype),O.isPureReactComponent=!0;var M=Array.isArray;function G(){}var q={H:null,A:null,T:null,S:null},Y=Object.prototype.hasOwnProperty;function T(R,X,fe){var be=fe.ref;return{$$typeof:o,type:R,key:X,ref:be!==void 0?be:null,props:fe}}function ce(R,X){return T(R.type,X,R.props)}function se(R){return typeof R=="object"&&R!==null&&R.$$typeof===o}function ee(R){var X={"=":"=0",":":"=2"};return"$"+R.replace(/[=:]/g,function(fe){return X[fe]})}var _e=/\/+/g;function ue(R,X){return typeof R=="object"&&R!==null&&R.key!=null?ee(""+R.key):X.toString(36)}function Ce(R){switch(R.status){case"fulfilled":return R.value;case"rejected":throw R.reason;default:switch(typeof R.status=="string"?R.then(G,G):(R.status="pending",R.then(function(X){R.status==="pending"&&(R.status="fulfilled",R.value=X)},function(X){R.status==="pending"&&(R.status="rejected",R.reason=X)})),R.status){case"fulfilled":return R.value;case"rejected":throw R.reason}}throw R}function F(R,X,fe,be,$){var D=typeof R;(D==="undefined"||D==="boolean")&&(R=null);var re=!1;if(R===null)re=!0;else switch(D){case"bigint":case"string":case"number":re=!0;break;case"object":switch(R.$$typeof){case o:case i:re=!0;break;case _:return re=R._init,F(re(R._payload),X,fe,be,$)}}if(re)return $=$(R),re=be===""?"."+ue(R,0):be,M($)?(fe="",re!=null&&(fe=re.replace(_e,"$&/")+"/"),F($,X,fe,"",function(nt){return nt})):$!=null&&(se($)&&($=ce($,fe+($.key==null||R&&R.key===$.key?"":(""+$.key).replace(_e,"$&/")+"/")+re)),X.push($)),1;re=0;var we=be===""?".":be+":";if(M(R))for(var Ne=0;Ne<R.length;Ne++)be=R[Ne],D=we+ue(be,Ne),re+=F(be,X,fe,D,$);else if(Ne=N(R),typeof Ne=="function")for(R=Ne.call(R),Ne=0;!(be=R.next()).done;)be=be.value,D=we+ue(be,Ne++),re+=F(be,X,fe,D,$);else if(D==="object"){if(typeof R.then=="function")return F(Ce(R),X,fe,be,$);throw X=String(R),Error("Objects are not valid as a React child (found: "+(X==="[object Object]"?"object with keys {"+Object.keys(R).join(", ")+"}":X)+"). If you meant to render a collection of children, use an array instead.")}return re}function ne(R,X,fe){if(R==null)return R;var be=[],$=0;return F(R,be,"","",function(D){return X.call(fe,D,$++)}),be}function K(R){if(R._status===-1){var X=R._result;X=X(),X.then(function(fe){(R._status===0||R._status===-1)&&(R._status=1,R._result=fe)},function(fe){(R._status===0||R._status===-1)&&(R._status=2,R._result=fe)}),R._status===-1&&(R._status=0,R._result=X)}if(R._status===1)return R._result.default;throw R._result}var le=typeof reportError=="function"?reportError:function(R){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var X=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof R=="object"&&R!==null&&typeof R.message=="string"?String(R.message):String(R),error:R});if(!window.dispatchEvent(X))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",R);return}console.error(R)},Ee={map:ne,forEach:function(R,X,fe){ne(R,function(){X.apply(this,arguments)},fe)},count:function(R){var X=0;return ne(R,function(){X++}),X},toArray:function(R){return ne(R,function(X){return X})||[]},only:function(R){if(!se(R))throw Error("React.Children.only expected to receive a single React element child.");return R}};return Ke.Activity=j,Ke.Children=Ee,Ke.Component=V,Ke.Fragment=r,Ke.Profiler=c,Ke.PureComponent=U,Ke.StrictMode=l,Ke.Suspense=m,Ke.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=q,Ke.__COMPILER_RUNTIME={__proto__:null,c:function(R){return q.H.useMemoCache(R)}},Ke.cache=function(R){return function(){return R.apply(null,arguments)}},Ke.cacheSignal=function(){return null},Ke.cloneElement=function(R,X,fe){if(R==null)throw Error("The argument must be a React element, but you passed "+R+".");var be=P({},R.props),$=R.key;if(X!=null)for(D in X.key!==void 0&&($=""+X.key),X)!Y.call(X,D)||D==="key"||D==="__self"||D==="__source"||D==="ref"&&X.ref===void 0||(be[D]=X[D]);var D=arguments.length-2;if(D===1)be.children=fe;else if(1<D){for(var re=Array(D),we=0;we<D;we++)re[we]=arguments[we+2];be.children=re}return T(R.type,$,be)},Ke.createContext=function(R){return R={$$typeof:f,_currentValue:R,_currentValue2:R,_threadCount:0,Provider:null,Consumer:null},R.Provider=R,R.Consumer={$$typeof:d,_context:R},R},Ke.createElement=function(R,X,fe){var be,$={},D=null;if(X!=null)for(be in X.key!==void 0&&(D=""+X.key),X)Y.call(X,be)&&be!=="key"&&be!=="__self"&&be!=="__source"&&($[be]=X[be]);var re=arguments.length-2;if(re===1)$.children=fe;else if(1<re){for(var we=Array(re),Ne=0;Ne<re;Ne++)we[Ne]=arguments[Ne+2];$.children=we}if(R&&R.defaultProps)for(be in re=R.defaultProps,re)$[be]===void 0&&($[be]=re[be]);return T(R,D,$)},Ke.createRef=function(){return{current:null}},Ke.forwardRef=function(R){return{$$typeof:g,render:R}},Ke.isValidElement=se,Ke.lazy=function(R){return{$$typeof:_,_payload:{_status:-1,_result:R},_init:K}},Ke.memo=function(R,X){return{$$typeof:p,type:R,compare:X===void 0?null:X}},Ke.startTransition=function(R){var X=q.T,fe={};q.T=fe;try{var be=R(),$=q.S;$!==null&&$(fe,be),typeof be=="object"&&be!==null&&typeof be.then=="function"&&be.then(G,le)}catch(D){le(D)}finally{X!==null&&fe.types!==null&&(X.types=fe.types),q.T=X}},Ke.unstable_useCacheRefresh=function(){return q.H.useCacheRefresh()},Ke.use=function(R){return q.H.use(R)},Ke.useActionState=function(R,X,fe){return q.H.useActionState(R,X,fe)},Ke.useCallback=function(R,X){return q.H.useCallback(R,X)},Ke.useContext=function(R){return q.H.useContext(R)},Ke.useDebugValue=function(){},Ke.useDeferredValue=function(R,X){return q.H.useDeferredValue(R,X)},Ke.useEffect=function(R,X){return q.H.useEffect(R,X)},Ke.useEffectEvent=function(R){return q.H.useEffectEvent(R)},Ke.useId=function(){return q.H.useId()},Ke.useImperativeHandle=function(R,X,fe){return q.H.useImperativeHandle(R,X,fe)},Ke.useInsertionEffect=function(R,X){return q.H.useInsertionEffect(R,X)},Ke.useLayoutEffect=function(R,X){return q.H.useLayoutEffect(R,X)},Ke.useMemo=function(R,X){return q.H.useMemo(R,X)},Ke.useOptimistic=function(R,X){return q.H.useOptimistic(R,X)},Ke.useReducer=function(R,X,fe){return q.H.useReducer(R,X,fe)},Ke.useRef=function(R){return q.H.useRef(R)},Ke.useState=function(R){return q.H.useState(R)},Ke.useSyncExternalStore=function(R,X,fe){return q.H.useSyncExternalStore(R,X,fe)},Ke.useTransition=function(){return q.H.useTransition()},Ke.version="19.2.0",Ke}var Qm;function td(){return Qm||(Qm=1,Cu.exports=A_()),Cu.exports}var y=td();const Dp=ed(y);var Eu={exports:{}},Ur={},Tu={exports:{}},Au={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Km;function k_(){return Km||(Km=1,(function(o){function i(F,ne){var K=F.length;F.push(ne);e:for(;0<K;){var le=K-1>>>1,Ee=F[le];if(0<c(Ee,ne))F[le]=ne,F[K]=Ee,K=le;else break e}}function r(F){return F.length===0?null:F[0]}function l(F){if(F.length===0)return null;var ne=F[0],K=F.pop();if(K!==ne){F[0]=K;e:for(var le=0,Ee=F.length,R=Ee>>>1;le<R;){var X=2*(le+1)-1,fe=F[X],be=X+1,$=F[be];if(0>c(fe,K))be<Ee&&0>c($,fe)?(F[le]=$,F[be]=K,le=be):(F[le]=fe,F[X]=K,le=X);else if(be<Ee&&0>c($,K))F[le]=$,F[be]=K,le=be;else break e}}return ne}function c(F,ne){var K=F.sortIndex-ne.sortIndex;return K!==0?K:F.id-ne.id}if(o.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var d=performance;o.unstable_now=function(){return d.now()}}else{var f=Date,g=f.now();o.unstable_now=function(){return f.now()-g}}var m=[],p=[],_=1,j=null,C=3,N=!1,k=!1,P=!1,E=!1,V=typeof setTimeout=="function"?setTimeout:null,L=typeof clearTimeout=="function"?clearTimeout:null,U=typeof setImmediate<"u"?setImmediate:null;function O(F){for(var ne=r(p);ne!==null;){if(ne.callback===null)l(p);else if(ne.startTime<=F)l(p),ne.sortIndex=ne.expirationTime,i(m,ne);else break;ne=r(p)}}function M(F){if(P=!1,O(F),!k)if(r(m)!==null)k=!0,G||(G=!0,ee());else{var ne=r(p);ne!==null&&Ce(M,ne.startTime-F)}}var G=!1,q=-1,Y=5,T=-1;function ce(){return E?!0:!(o.unstable_now()-T<Y)}function se(){if(E=!1,G){var F=o.unstable_now();T=F;var ne=!0;try{e:{k=!1,P&&(P=!1,L(q),q=-1),N=!0;var K=C;try{t:{for(O(F),j=r(m);j!==null&&!(j.expirationTime>F&&ce());){var le=j.callback;if(typeof le=="function"){j.callback=null,C=j.priorityLevel;var Ee=le(j.expirationTime<=F);if(F=o.unstable_now(),typeof Ee=="function"){j.callback=Ee,O(F),ne=!0;break t}j===r(m)&&l(m),O(F)}else l(m);j=r(m)}if(j!==null)ne=!0;else{var R=r(p);R!==null&&Ce(M,R.startTime-F),ne=!1}}break e}finally{j=null,C=K,N=!1}ne=void 0}}finally{ne?ee():G=!1}}}var ee;if(typeof U=="function")ee=function(){U(se)};else if(typeof MessageChannel<"u"){var _e=new MessageChannel,ue=_e.port2;_e.port1.onmessage=se,ee=function(){ue.postMessage(null)}}else ee=function(){V(se,0)};function Ce(F,ne){q=V(function(){F(o.unstable_now())},ne)}o.unstable_IdlePriority=5,o.unstable_ImmediatePriority=1,o.unstable_LowPriority=4,o.unstable_NormalPriority=3,o.unstable_Profiling=null,o.unstable_UserBlockingPriority=2,o.unstable_cancelCallback=function(F){F.callback=null},o.unstable_forceFrameRate=function(F){0>F||125<F?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Y=0<F?Math.floor(1e3/F):5},o.unstable_getCurrentPriorityLevel=function(){return C},o.unstable_next=function(F){switch(C){case 1:case 2:case 3:var ne=3;break;default:ne=C}var K=C;C=ne;try{return F()}finally{C=K}},o.unstable_requestPaint=function(){E=!0},o.unstable_runWithPriority=function(F,ne){switch(F){case 1:case 2:case 3:case 4:case 5:break;default:F=3}var K=C;C=F;try{return ne()}finally{C=K}},o.unstable_scheduleCallback=function(F,ne,K){var le=o.unstable_now();switch(typeof K=="object"&&K!==null?(K=K.delay,K=typeof K=="number"&&0<K?le+K:le):K=le,F){case 1:var Ee=-1;break;case 2:Ee=250;break;case 5:Ee=1073741823;break;case 4:Ee=1e4;break;default:Ee=5e3}return Ee=K+Ee,F={id:_++,callback:ne,priorityLevel:F,startTime:K,expirationTime:Ee,sortIndex:-1},K>le?(F.sortIndex=K,i(p,F),r(m)===null&&F===r(p)&&(P?(L(q),q=-1):P=!0,Ce(M,K-le))):(F.sortIndex=Ee,i(m,F),k||N||(k=!0,G||(G=!0,ee()))),F},o.unstable_shouldYield=ce,o.unstable_wrapCallback=function(F){var ne=C;return function(){var K=C;C=ne;try{return F.apply(this,arguments)}finally{C=K}}}})(Au)),Au}var Jm;function O_(){return Jm||(Jm=1,Tu.exports=k_()),Tu.exports}var ku={exports:{}},bn={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Xm;function R_(){if(Xm)return bn;Xm=1;var o=td();function i(m){var p="https://react.dev/errors/"+m;if(1<arguments.length){p+="?args[]="+encodeURIComponent(arguments[1]);for(var _=2;_<arguments.length;_++)p+="&args[]="+encodeURIComponent(arguments[_])}return"Minified React error #"+m+"; visit "+p+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function r(){}var l={d:{f:r,r:function(){throw Error(i(522))},D:r,C:r,L:r,m:r,X:r,S:r,M:r},p:0,findDOMNode:null},c=Symbol.for("react.portal");function d(m,p,_){var j=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:c,key:j==null?null:""+j,children:m,containerInfo:p,implementation:_}}var f=o.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function g(m,p){if(m==="font")return"";if(typeof p=="string")return p==="use-credentials"?p:""}return bn.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=l,bn.createPortal=function(m,p){var _=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!p||p.nodeType!==1&&p.nodeType!==9&&p.nodeType!==11)throw Error(i(299));return d(m,p,null,_)},bn.flushSync=function(m){var p=f.T,_=l.p;try{if(f.T=null,l.p=2,m)return m()}finally{f.T=p,l.p=_,l.d.f()}},bn.preconnect=function(m,p){typeof m=="string"&&(p?(p=p.crossOrigin,p=typeof p=="string"?p==="use-credentials"?p:"":void 0):p=null,l.d.C(m,p))},bn.prefetchDNS=function(m){typeof m=="string"&&l.d.D(m)},bn.preinit=function(m,p){if(typeof m=="string"&&p&&typeof p.as=="string"){var _=p.as,j=g(_,p.crossOrigin),C=typeof p.integrity=="string"?p.integrity:void 0,N=typeof p.fetchPriority=="string"?p.fetchPriority:void 0;_==="style"?l.d.S(m,typeof p.precedence=="string"?p.precedence:void 0,{crossOrigin:j,integrity:C,fetchPriority:N}):_==="script"&&l.d.X(m,{crossOrigin:j,integrity:C,fetchPriority:N,nonce:typeof p.nonce=="string"?p.nonce:void 0})}},bn.preinitModule=function(m,p){if(typeof m=="string")if(typeof p=="object"&&p!==null){if(p.as==null||p.as==="script"){var _=g(p.as,p.crossOrigin);l.d.M(m,{crossOrigin:_,integrity:typeof p.integrity=="string"?p.integrity:void 0,nonce:typeof p.nonce=="string"?p.nonce:void 0})}}else p==null&&l.d.M(m)},bn.preload=function(m,p){if(typeof m=="string"&&typeof p=="object"&&p!==null&&typeof p.as=="string"){var _=p.as,j=g(_,p.crossOrigin);l.d.L(m,_,{crossOrigin:j,integrity:typeof p.integrity=="string"?p.integrity:void 0,nonce:typeof p.nonce=="string"?p.nonce:void 0,type:typeof p.type=="string"?p.type:void 0,fetchPriority:typeof p.fetchPriority=="string"?p.fetchPriority:void 0,referrerPolicy:typeof p.referrerPolicy=="string"?p.referrerPolicy:void 0,imageSrcSet:typeof p.imageSrcSet=="string"?p.imageSrcSet:void 0,imageSizes:typeof p.imageSizes=="string"?p.imageSizes:void 0,media:typeof p.media=="string"?p.media:void 0})}},bn.preloadModule=function(m,p){if(typeof m=="string")if(p){var _=g(p.as,p.crossOrigin);l.d.m(m,{as:typeof p.as=="string"&&p.as!=="script"?p.as:void 0,crossOrigin:_,integrity:typeof p.integrity=="string"?p.integrity:void 0})}else l.d.m(m)},bn.requestFormReset=function(m){l.d.r(m)},bn.unstable_batchedUpdates=function(m,p){return m(p)},bn.useFormState=function(m,p,_){return f.H.useFormState(m,p,_)},bn.useFormStatus=function(){return f.H.useHostTransitionStatus()},bn.version="19.2.0",bn}var Zm;function q_(){if(Zm)return ku.exports;Zm=1;function o(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(o)}catch(i){console.error(i)}}return o(),ku.exports=R_(),ku.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Wm;function D_(){if(Wm)return Ur;Wm=1;var o=O_(),i=td(),r=q_();function l(e){var t="https://react.dev/errors/"+e;if(1<arguments.length){t+="?args[]="+encodeURIComponent(arguments[1]);for(var a=2;a<arguments.length;a++)t+="&args[]="+encodeURIComponent(arguments[a])}return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function c(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function d(e){var t=e,a=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,(t.flags&4098)!==0&&(a=t.return),e=t.return;while(e)}return t.tag===3?a:null}function f(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function g(e){if(e.tag===31){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function m(e){if(d(e)!==e)throw Error(l(188))}function p(e){var t=e.alternate;if(!t){if(t=d(e),t===null)throw Error(l(188));return t!==e?null:e}for(var a=e,s=t;;){var u=a.return;if(u===null)break;var h=u.alternate;if(h===null){if(s=u.return,s!==null){a=s;continue}break}if(u.child===h.child){for(h=u.child;h;){if(h===a)return m(u),e;if(h===s)return m(u),t;h=h.sibling}throw Error(l(188))}if(a.return!==s.return)a=u,s=h;else{for(var v=!1,b=u.child;b;){if(b===a){v=!0,a=u,s=h;break}if(b===s){v=!0,s=u,a=h;break}b=b.sibling}if(!v){for(b=h.child;b;){if(b===a){v=!0,a=h,s=u;break}if(b===s){v=!0,s=h,a=u;break}b=b.sibling}if(!v)throw Error(l(189))}}if(a.alternate!==s)throw Error(l(190))}if(a.tag!==3)throw Error(l(188));return a.stateNode.current===a?e:t}function _(e){var t=e.tag;if(t===5||t===26||t===27||t===6)return e;for(e=e.child;e!==null;){if(t=_(e),t!==null)return t;e=e.sibling}return null}var j=Object.assign,C=Symbol.for("react.element"),N=Symbol.for("react.transitional.element"),k=Symbol.for("react.portal"),P=Symbol.for("react.fragment"),E=Symbol.for("react.strict_mode"),V=Symbol.for("react.profiler"),L=Symbol.for("react.consumer"),U=Symbol.for("react.context"),O=Symbol.for("react.forward_ref"),M=Symbol.for("react.suspense"),G=Symbol.for("react.suspense_list"),q=Symbol.for("react.memo"),Y=Symbol.for("react.lazy"),T=Symbol.for("react.activity"),ce=Symbol.for("react.memo_cache_sentinel"),se=Symbol.iterator;function ee(e){return e===null||typeof e!="object"?null:(e=se&&e[se]||e["@@iterator"],typeof e=="function"?e:null)}var _e=Symbol.for("react.client.reference");function ue(e){if(e==null)return null;if(typeof e=="function")return e.$$typeof===_e?null:e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case P:return"Fragment";case V:return"Profiler";case E:return"StrictMode";case M:return"Suspense";case G:return"SuspenseList";case T:return"Activity"}if(typeof e=="object")switch(e.$$typeof){case k:return"Portal";case U:return e.displayName||"Context";case L:return(e._context.displayName||"Context")+".Consumer";case O:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case q:return t=e.displayName||null,t!==null?t:ue(e.type)||"Memo";case Y:t=e._payload,e=e._init;try{return ue(e(t))}catch{}}return null}var Ce=Array.isArray,F=i.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,ne=r.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,K={pending:!1,data:null,method:null,action:null},le=[],Ee=-1;function R(e){return{current:e}}function X(e){0>Ee||(e.current=le[Ee],le[Ee]=null,Ee--)}function fe(e,t){Ee++,le[Ee]=e.current,e.current=t}var be=R(null),$=R(null),D=R(null),re=R(null);function we(e,t){switch(fe(D,t),fe($,e),fe(be,null),t.nodeType){case 9:case 11:e=(e=t.documentElement)&&(e=e.namespaceURI)?mm(e):0;break;default:if(e=t.tagName,t=t.namespaceURI)t=mm(t),e=pm(t,e);else switch(e){case"svg":e=1;break;case"math":e=2;break;default:e=0}}X(be),fe(be,e)}function Ne(){X(be),X($),X(D)}function nt(e){e.memoizedState!==null&&fe(re,e);var t=be.current,a=pm(t,e.type);t!==a&&(fe($,e),fe(be,a))}function Le(e){$.current===e&&(X(be),X($)),re.current===e&&(X(re),qr._currentValue=K)}var Ue,lt;function We(e){if(Ue===void 0)try{throw Error()}catch(a){var t=a.stack.trim().match(/\n( *(at )?)/);Ue=t&&t[1]||"",lt=-1<a.stack.indexOf(`
    at`)?" (<anonymous>)":-1<a.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Ue+e+lt}var qt=!1;function Dt(e,t){if(!e||qt)return"";qt=!0;var a=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var s={DetermineComponentFrameRoot:function(){try{if(t){var me=function(){throw Error()};if(Object.defineProperty(me.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(me,[])}catch(ie){var te=ie}Reflect.construct(e,[],me)}else{try{me.call()}catch(ie){te=ie}e.call(me.prototype)}}else{try{throw Error()}catch(ie){te=ie}(me=e())&&typeof me.catch=="function"&&me.catch(function(){})}}catch(ie){if(ie&&te&&typeof ie.stack=="string")return[ie.stack,te.stack]}return[null,null]}};s.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var u=Object.getOwnPropertyDescriptor(s.DetermineComponentFrameRoot,"name");u&&u.configurable&&Object.defineProperty(s.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var h=s.DetermineComponentFrameRoot(),v=h[0],b=h[1];if(v&&b){var z=v.split(`
`),W=b.split(`
`);for(u=s=0;s<z.length&&!z[s].includes("DetermineComponentFrameRoot");)s++;for(;u<W.length&&!W[u].includes("DetermineComponentFrameRoot");)u++;if(s===z.length||u===W.length)for(s=z.length-1,u=W.length-1;1<=s&&0<=u&&z[s]!==W[u];)u--;for(;1<=s&&0<=u;s--,u--)if(z[s]!==W[u]){if(s!==1||u!==1)do if(s--,u--,0>u||z[s]!==W[u]){var oe=`
`+z[s].replace(" at new "," at ");return e.displayName&&oe.includes("<anonymous>")&&(oe=oe.replace("<anonymous>",e.displayName)),oe}while(1<=s&&0<=u);break}}}finally{qt=!1,Error.prepareStackTrace=a}return(a=e?e.displayName||e.name:"")?We(a):""}function yn(e,t){switch(e.tag){case 26:case 27:case 5:return We(e.type);case 16:return We("Lazy");case 13:return e.child!==t&&t!==null?We("Suspense Fallback"):We("Suspense");case 19:return We("SuspenseList");case 0:case 15:return Dt(e.type,!1);case 11:return Dt(e.type.render,!1);case 1:return Dt(e.type,!0);case 31:return We("Activity");default:return""}}function ln(e){try{var t="",a=null;do t+=yn(e,a),a=e,e=e.return;while(e);return t}catch(s){return`
Error generating stack: `+s.message+`
`+s.stack}}var Vt=Object.prototype.hasOwnProperty,en=o.unstable_scheduleCallback,gt=o.unstable_cancelCallback,on=o.unstable_shouldYield,$n=o.unstable_requestPaint,St=o.unstable_now,Ht=o.unstable_getCurrentPriorityLevel,mn=o.unstable_ImmediatePriority,tn=o.unstable_UserBlockingPriority,B=o.unstable_NormalPriority,w=o.unstable_LowPriority,ae=o.unstable_IdlePriority,S=o.log,he=o.unstable_setDisableYieldValue,ge=null,Te=null;function Ye(e){if(typeof S=="function"&&he(e),Te&&typeof Te.setStrictMode=="function")try{Te.setStrictMode(ge,e)}catch{}}var Pe=Math.clz32?Math.clz32:Ut,dt=Math.log,ht=Math.LN2;function Ut(e){return e>>>=0,e===0?32:31-(dt(e)/ht|0)|0}var Lt=256,Et=262144,Tt=4194304;function Bt(e){var t=e&42;if(t!==0)return t;switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return e&261888;case 262144:case 524288:case 1048576:case 2097152:return e&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return e&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return e}}function Gt(e,t,a){var s=e.pendingLanes;if(s===0)return 0;var u=0,h=e.suspendedLanes,v=e.pingedLanes;e=e.warmLanes;var b=s&134217727;return b!==0?(s=b&~h,s!==0?u=Bt(s):(v&=b,v!==0?u=Bt(v):a||(a=b&~e,a!==0&&(u=Bt(a))))):(b=s&~h,b!==0?u=Bt(b):v!==0?u=Bt(v):a||(a=s&~e,a!==0&&(u=Bt(a)))),u===0?0:t!==0&&t!==u&&(t&h)===0&&(h=u&-u,a=t&-t,h>=a||h===32&&(a&4194048)!==0)?t:u}function jn(e,t){return(e.pendingLanes&~(e.suspendedLanes&~e.pingedLanes)&t)===0}function wn(e,t){switch(e){case 1:case 2:case 4:case 8:case 64:return t+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function gs(){var e=Tt;return Tt<<=1,(Tt&62914560)===0&&(Tt=4194304),e}function Pa(e){for(var t=[],a=0;31>a;a++)t.push(e);return t}function ca(e,t){e.pendingLanes|=t,t!==268435456&&(e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0)}function Ii(e,t,a,s,u,h){var v=e.pendingLanes;e.pendingLanes=a,e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0,e.expiredLanes&=a,e.entangledLanes&=a,e.errorRecoveryDisabledLanes&=a,e.shellSuspendCounter=0;var b=e.entanglements,z=e.expirationTimes,W=e.hiddenUpdates;for(a=v&~a;0<a;){var oe=31-Pe(a),me=1<<oe;b[oe]=0,z[oe]=-1;var te=W[oe];if(te!==null)for(W[oe]=null,oe=0;oe<te.length;oe++){var ie=te[oe];ie!==null&&(ie.lane&=-536870913)}a&=~me}s!==0&&ea(e,s,0),h!==0&&u===0&&e.tag!==0&&(e.suspendedLanes|=h&~(v&~t))}function ea(e,t,a){e.pendingLanes|=t,e.suspendedLanes&=~t;var s=31-Pe(t);e.entangledLanes|=t,e.entanglements[s]=e.entanglements[s]|1073741824|a&261930}function ua(e,t){var a=e.entangledLanes|=t;for(e=e.entanglements;a;){var s=31-Pe(a),u=1<<s;u&t|e[s]&t&&(e[s]|=t),a&=~u}}function nn(e,t){var a=t&-t;return a=(a&42)!==0?1:vs(a),(a&(e.suspendedLanes|t))!==0?0:a}function vs(e){switch(e){case 2:e=1;break;case 8:e=4;break;case 32:e=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:e=128;break;case 268435456:e=134217728;break;default:e=0}return e}function Nn(e){return e&=-e,2<e?8<e?(e&134217727)!==0?32:268435456:8:2}function Is(){var e=ne.p;return e!==0?e:(e=window.event,e===void 0?32:Um(e.type))}function Vs(e,t){var a=ne.p;try{return ne.p=e,t()}finally{ne.p=a}}var In=Math.random().toString(36).slice(2),wt="__reactFiber$"+In,Yt="__reactProps$"+In,I="__reactContainer$"+In,ve="__reactEvents$"+In,Me="__reactListeners$"+In,Ae="__reactHandles$"+In,Re="__reactResources$"+In,pe="__reactMarker$"+In;function ye(e){delete e[wt],delete e[Yt],delete e[ve],delete e[Me],delete e[Ae]}function ke(e){var t=e[wt];if(t)return t;for(var a=e.parentNode;a;){if(t=a[I]||a[wt]){if(a=t.alternate,t.child!==null||a!==null&&a.child!==null)for(e=jm(e);e!==null;){if(a=e[wt])return a;e=jm(e)}return t}e=a,a=e.parentNode}return null}function Fe(e){if(e=e[wt]||e[I]){var t=e.tag;if(t===5||t===6||t===13||t===31||t===26||t===27||t===3)return e}return null}function qe(e){var t=e.tag;if(t===5||t===26||t===27||t===6)return e.stateNode;throw Error(l(33))}function Oe(e){var t=e[Re];return t||(t=e[Re]={hoistableStyles:new Map,hoistableScripts:new Map}),t}function Qe(e){e[pe]=!0}var ot=new Set,Nt={};function ft(e,t){ut(e,t),ut(e+"Capture",t)}function ut(e,t){for(Nt[e]=t,e=0;e<t.length;e++)ot.add(t[e])}var xn=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),ta={},Fa={};function Gs(e){return Vt.call(Fa,e)?!0:Vt.call(ta,e)?!1:xn.test(e)?Fa[e]=!0:(ta[e]=!0,!1)}function Vn(e,t,a){if(Gs(t))if(a===null)e.removeAttribute(t);else{switch(typeof a){case"undefined":case"function":case"symbol":e.removeAttribute(t);return;case"boolean":var s=t.toLowerCase().slice(0,5);if(s!=="data-"&&s!=="aria-"){e.removeAttribute(t);return}}e.setAttribute(t,""+a)}}function _a(e,t,a){if(a===null)e.removeAttribute(t);else{switch(typeof a){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(t);return}e.setAttribute(t,""+a)}}function Cn(e,t,a,s){if(s===null)e.removeAttribute(a);else{switch(typeof s){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(a);return}e.setAttributeNS(t,a,""+s)}}function cn(e){switch(typeof e){case"bigint":case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function Vi(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function Ys(e,t,a){var s=Object.getOwnPropertyDescriptor(e.constructor.prototype,t);if(!e.hasOwnProperty(t)&&typeof s<"u"&&typeof s.get=="function"&&typeof s.set=="function"){var u=s.get,h=s.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return u.call(this)},set:function(v){a=""+v,h.call(this,v)}}),Object.defineProperty(e,t,{enumerable:s.enumerable}),{getValue:function(){return a},setValue:function(v){a=""+v},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function Gi(e){if(!e._valueTracker){var t=Vi(e)?"checked":"value";e._valueTracker=Ys(e,t,""+e[t])}}function Yi(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var a=t.getValue(),s="";return e&&(s=Vi(e)?e.checked?"true":"false":e.value),e=s,e!==a?(t.setValue(e),!0):!1}function Qs(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}var So=/[\n"\\]/g;function En(e){return e.replace(So,function(t){return"\\"+t.charCodeAt(0).toString(16)+" "})}function Qi(e,t,a,s,u,h,v,b){e.name="",v!=null&&typeof v!="function"&&typeof v!="symbol"&&typeof v!="boolean"?e.type=v:e.removeAttribute("type"),t!=null?v==="number"?(t===0&&e.value===""||e.value!=t)&&(e.value=""+cn(t)):e.value!==""+cn(t)&&(e.value=""+cn(t)):v!=="submit"&&v!=="reset"||e.removeAttribute("value"),t!=null?x(e,v,cn(t)):a!=null?x(e,v,cn(a)):s!=null&&e.removeAttribute("value"),u==null&&h!=null&&(e.defaultChecked=!!h),u!=null&&(e.checked=u&&typeof u!="function"&&typeof u!="symbol"),b!=null&&typeof b!="function"&&typeof b!="symbol"&&typeof b!="boolean"?e.name=""+cn(b):e.removeAttribute("name")}function an(e,t,a,s,u,h,v,b){if(h!=null&&typeof h!="function"&&typeof h!="symbol"&&typeof h!="boolean"&&(e.type=h),t!=null||a!=null){if(!(h!=="submit"&&h!=="reset"||t!=null)){Gi(e);return}a=a!=null?""+cn(a):"",t=t!=null?""+cn(t):a,b||t===e.value||(e.value=t),e.defaultValue=t}s=s??u,s=typeof s!="function"&&typeof s!="symbol"&&!!s,e.checked=b?e.checked:!!s,e.defaultChecked=!!s,v!=null&&typeof v!="function"&&typeof v!="symbol"&&typeof v!="boolean"&&(e.name=v),Gi(e)}function x(e,t,a){t==="number"&&Qs(e.ownerDocument)===e||e.defaultValue===""+a||(e.defaultValue=""+a)}function J(e,t,a,s){if(e=e.options,t){t={};for(var u=0;u<a.length;u++)t["$"+a[u]]=!0;for(a=0;a<e.length;a++)u=t.hasOwnProperty("$"+e[a].value),e[a].selected!==u&&(e[a].selected=u),u&&s&&(e[a].defaultSelected=!0)}else{for(a=""+cn(a),t=null,u=0;u<e.length;u++){if(e[u].value===a){e[u].selected=!0,s&&(e[u].defaultSelected=!0);return}t!==null||e[u].disabled||(t=e[u])}t!==null&&(t.selected=!0)}}function xe(e,t,a){if(t!=null&&(t=""+cn(t),t!==e.value&&(e.value=t),a==null)){e.defaultValue!==t&&(e.defaultValue=t);return}e.defaultValue=a!=null?""+cn(a):""}function je(e,t,a,s){if(t==null){if(s!=null){if(a!=null)throw Error(l(92));if(Ce(s)){if(1<s.length)throw Error(l(93));s=s[0]}a=s}a==null&&(a=""),t=a}a=cn(t),e.defaultValue=a,s=e.textContent,s===a&&s!==""&&s!==null&&(e.value=s),Gi(e)}function Se(e,t){if(t){var a=e.firstChild;if(a&&a===e.lastChild&&a.nodeType===3){a.nodeValue=t;return}}e.textContent=t}var Ie=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function $e(e,t,a){var s=t.indexOf("--")===0;a==null||typeof a=="boolean"||a===""?s?e.setProperty(t,""):t==="float"?e.cssFloat="":e[t]="":s?e.setProperty(t,a):typeof a!="number"||a===0||Ie.has(t)?t==="float"?e.cssFloat=a:e[t]=(""+a).trim():e[t]=a+"px"}function De(e,t,a){if(t!=null&&typeof t!="object")throw Error(l(62));if(e=e.style,a!=null){for(var s in a)!a.hasOwnProperty(s)||t!=null&&t.hasOwnProperty(s)||(s.indexOf("--")===0?e.setProperty(s,""):s==="float"?e.cssFloat="":e[s]="");for(var u in t)s=t[u],t.hasOwnProperty(u)&&a[u]!==s&&$e(e,u,s)}else for(var h in t)t.hasOwnProperty(h)&&$e(e,h,t[h])}function et(e){if(e.indexOf("-")===-1)return!1;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var tt=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),kt=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function un(e){return kt.test(""+e)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":e}function dn(){}var _s=null;function Ks(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var ya=null,Ha=null;function Ki(e){var t=Fe(e);if(t&&(e=t.stateNode)){var a=e[Yt]||null;e:switch(e=t.stateNode,t.type){case"input":if(Qi(e,a.value,a.defaultValue,a.defaultValue,a.checked,a.defaultChecked,a.type,a.name),t=a.name,a.type==="radio"&&t!=null){for(a=e;a.parentNode;)a=a.parentNode;for(a=a.querySelectorAll('input[name="'+En(""+t)+'"][type="radio"]'),t=0;t<a.length;t++){var s=a[t];if(s!==e&&s.form===e.form){var u=s[Yt]||null;if(!u)throw Error(l(90));Qi(s,u.value,u.defaultValue,u.defaultValue,u.checked,u.defaultChecked,u.type,u.name)}}for(t=0;t<a.length;t++)s=a[t],s.form===e.form&&Yi(s)}break e;case"textarea":xe(e,a.value,a.defaultValue);break e;case"select":t=a.value,t!=null&&J(e,!!a.multiple,t,!1)}}}var wo=!1;function fd(e,t,a){if(wo)return e(t,a);wo=!0;try{var s=e(t);return s}finally{if(wo=!1,(ya!==null||Ha!==null)&&(Bl(),ya&&(t=ya,e=Ha,Ha=ya=null,Ki(t),e)))for(t=0;t<e.length;t++)Ki(e[t])}}function Ji(e,t){var a=e.stateNode;if(a===null)return null;var s=a[Yt]||null;if(s===null)return null;a=s[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(s=!s.disabled)||(e=e.type,s=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!s;break e;default:e=!1}if(e)return null;if(a&&typeof a!="function")throw Error(l(231,t,typeof a));return a}var xa=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),No=!1;if(xa)try{var Xi={};Object.defineProperty(Xi,"passive",{get:function(){No=!0}}),window.addEventListener("test",Xi,Xi),window.removeEventListener("test",Xi,Xi)}catch{No=!1}var $a=null,Co=null,Wr=null;function md(){if(Wr)return Wr;var e,t=Co,a=t.length,s,u="value"in $a?$a.value:$a.textContent,h=u.length;for(e=0;e<a&&t[e]===u[e];e++);var v=a-e;for(s=1;s<=v&&t[a-s]===u[h-s];s++);return Wr=u.slice(e,1<s?1-s:void 0)}function el(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function tl(){return!0}function pd(){return!1}function Tn(e){function t(a,s,u,h,v){this._reactName=a,this._targetInst=u,this.type=s,this.nativeEvent=h,this.target=v,this.currentTarget=null;for(var b in e)e.hasOwnProperty(b)&&(a=e[b],this[b]=a?a(h):h[b]);return this.isDefaultPrevented=(h.defaultPrevented!=null?h.defaultPrevented:h.returnValue===!1)?tl:pd,this.isPropagationStopped=pd,this}return j(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var a=this.nativeEvent;a&&(a.preventDefault?a.preventDefault():typeof a.returnValue!="unknown"&&(a.returnValue=!1),this.isDefaultPrevented=tl)},stopPropagation:function(){var a=this.nativeEvent;a&&(a.stopPropagation?a.stopPropagation():typeof a.cancelBubble!="unknown"&&(a.cancelBubble=!0),this.isPropagationStopped=tl)},persist:function(){},isPersistent:tl}),t}var ys={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},nl=Tn(ys),Zi=j({},ys,{view:0,detail:0}),wg=Tn(Zi),Eo,To,Wi,al=j({},Zi,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:ko,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==Wi&&(Wi&&e.type==="mousemove"?(Eo=e.screenX-Wi.screenX,To=e.screenY-Wi.screenY):To=Eo=0,Wi=e),Eo)},movementY:function(e){return"movementY"in e?e.movementY:To}}),gd=Tn(al),Ng=j({},al,{dataTransfer:0}),Cg=Tn(Ng),Eg=j({},Zi,{relatedTarget:0}),Ao=Tn(Eg),Tg=j({},ys,{animationName:0,elapsedTime:0,pseudoElement:0}),Ag=Tn(Tg),kg=j({},ys,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),Og=Tn(kg),Rg=j({},ys,{data:0}),vd=Tn(Rg),qg={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Dg={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Mg={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function zg(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=Mg[e])?!!t[e]:!1}function ko(){return zg}var Lg=j({},Zi,{key:function(e){if(e.key){var t=qg[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=el(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?Dg[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:ko,charCode:function(e){return e.type==="keypress"?el(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?el(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),Ug=Tn(Lg),Bg=j({},al,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),_d=Tn(Bg),Pg=j({},Zi,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:ko}),Fg=Tn(Pg),Hg=j({},ys,{propertyName:0,elapsedTime:0,pseudoElement:0}),$g=Tn(Hg),Ig=j({},al,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Vg=Tn(Ig),Gg=j({},ys,{newState:0,oldState:0}),Yg=Tn(Gg),Qg=[9,13,27,32],Oo=xa&&"CompositionEvent"in window,er=null;xa&&"documentMode"in document&&(er=document.documentMode);var Kg=xa&&"TextEvent"in window&&!er,yd=xa&&(!Oo||er&&8<er&&11>=er),xd=" ",bd=!1;function jd(e,t){switch(e){case"keyup":return Qg.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Sd(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var Js=!1;function Jg(e,t){switch(e){case"compositionend":return Sd(t);case"keypress":return t.which!==32?null:(bd=!0,xd);case"textInput":return e=t.data,e===xd&&bd?null:e;default:return null}}function Xg(e,t){if(Js)return e==="compositionend"||!Oo&&jd(e,t)?(e=md(),Wr=Co=$a=null,Js=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return yd&&t.locale!=="ko"?null:t.data;default:return null}}var Zg={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function wd(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!Zg[e.type]:t==="textarea"}function Nd(e,t,a,s){ya?Ha?Ha.push(s):Ha=[s]:ya=s,t=Gl(t,"onChange"),0<t.length&&(a=new nl("onChange","change",null,a,s),e.push({event:a,listeners:t}))}var tr=null,nr=null;function Wg(e){om(e,0)}function sl(e){var t=qe(e);if(Yi(t))return e}function Cd(e,t){if(e==="change")return t}var Ed=!1;if(xa){var Ro;if(xa){var qo="oninput"in document;if(!qo){var Td=document.createElement("div");Td.setAttribute("oninput","return;"),qo=typeof Td.oninput=="function"}Ro=qo}else Ro=!1;Ed=Ro&&(!document.documentMode||9<document.documentMode)}function Ad(){tr&&(tr.detachEvent("onpropertychange",kd),nr=tr=null)}function kd(e){if(e.propertyName==="value"&&sl(nr)){var t=[];Nd(t,nr,e,Ks(e)),fd(Wg,t)}}function ev(e,t,a){e==="focusin"?(Ad(),tr=t,nr=a,tr.attachEvent("onpropertychange",kd)):e==="focusout"&&Ad()}function tv(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return sl(nr)}function nv(e,t){if(e==="click")return sl(t)}function av(e,t){if(e==="input"||e==="change")return sl(t)}function sv(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var Mn=typeof Object.is=="function"?Object.is:sv;function ar(e,t){if(Mn(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var a=Object.keys(e),s=Object.keys(t);if(a.length!==s.length)return!1;for(s=0;s<a.length;s++){var u=a[s];if(!Vt.call(t,u)||!Mn(e[u],t[u]))return!1}return!0}function Od(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function Rd(e,t){var a=Od(e);e=0;for(var s;a;){if(a.nodeType===3){if(s=e+a.textContent.length,e<=t&&s>=t)return{node:a,offset:t-e};e=s}e:{for(;a;){if(a.nextSibling){a=a.nextSibling;break e}a=a.parentNode}a=void 0}a=Od(a)}}function qd(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?qd(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function Dd(e){e=e!=null&&e.ownerDocument!=null&&e.ownerDocument.defaultView!=null?e.ownerDocument.defaultView:window;for(var t=Qs(e.document);t instanceof e.HTMLIFrameElement;){try{var a=typeof t.contentWindow.location.href=="string"}catch{a=!1}if(a)e=t.contentWindow;else break;t=Qs(e.document)}return t}function Do(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}var iv=xa&&"documentMode"in document&&11>=document.documentMode,Xs=null,Mo=null,sr=null,zo=!1;function Md(e,t,a){var s=a.window===a?a.document:a.nodeType===9?a:a.ownerDocument;zo||Xs==null||Xs!==Qs(s)||(s=Xs,"selectionStart"in s&&Do(s)?s={start:s.selectionStart,end:s.selectionEnd}:(s=(s.ownerDocument&&s.ownerDocument.defaultView||window).getSelection(),s={anchorNode:s.anchorNode,anchorOffset:s.anchorOffset,focusNode:s.focusNode,focusOffset:s.focusOffset}),sr&&ar(sr,s)||(sr=s,s=Gl(Mo,"onSelect"),0<s.length&&(t=new nl("onSelect","select",null,t,a),e.push({event:t,listeners:s}),t.target=Xs)))}function xs(e,t){var a={};return a[e.toLowerCase()]=t.toLowerCase(),a["Webkit"+e]="webkit"+t,a["Moz"+e]="moz"+t,a}var Zs={animationend:xs("Animation","AnimationEnd"),animationiteration:xs("Animation","AnimationIteration"),animationstart:xs("Animation","AnimationStart"),transitionrun:xs("Transition","TransitionRun"),transitionstart:xs("Transition","TransitionStart"),transitioncancel:xs("Transition","TransitionCancel"),transitionend:xs("Transition","TransitionEnd")},Lo={},zd={};xa&&(zd=document.createElement("div").style,"AnimationEvent"in window||(delete Zs.animationend.animation,delete Zs.animationiteration.animation,delete Zs.animationstart.animation),"TransitionEvent"in window||delete Zs.transitionend.transition);function bs(e){if(Lo[e])return Lo[e];if(!Zs[e])return e;var t=Zs[e],a;for(a in t)if(t.hasOwnProperty(a)&&a in zd)return Lo[e]=t[a];return e}var Ld=bs("animationend"),Ud=bs("animationiteration"),Bd=bs("animationstart"),rv=bs("transitionrun"),lv=bs("transitionstart"),ov=bs("transitioncancel"),Pd=bs("transitionend"),Fd=new Map,Uo="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Uo.push("scrollEnd");function na(e,t){Fd.set(e,t),ft(t,[e])}var il=typeof reportError=="function"?reportError:function(e){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof e=="object"&&e!==null&&typeof e.message=="string"?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",e);return}console.error(e)},Gn=[],Ws=0,Bo=0;function rl(){for(var e=Ws,t=Bo=Ws=0;t<e;){var a=Gn[t];Gn[t++]=null;var s=Gn[t];Gn[t++]=null;var u=Gn[t];Gn[t++]=null;var h=Gn[t];if(Gn[t++]=null,s!==null&&u!==null){var v=s.pending;v===null?u.next=u:(u.next=v.next,v.next=u),s.pending=u}h!==0&&Hd(a,u,h)}}function ll(e,t,a,s){Gn[Ws++]=e,Gn[Ws++]=t,Gn[Ws++]=a,Gn[Ws++]=s,Bo|=s,e.lanes|=s,e=e.alternate,e!==null&&(e.lanes|=s)}function Po(e,t,a,s){return ll(e,t,a,s),ol(e)}function js(e,t){return ll(e,null,null,t),ol(e)}function Hd(e,t,a){e.lanes|=a;var s=e.alternate;s!==null&&(s.lanes|=a);for(var u=!1,h=e.return;h!==null;)h.childLanes|=a,s=h.alternate,s!==null&&(s.childLanes|=a),h.tag===22&&(e=h.stateNode,e===null||e._visibility&1||(u=!0)),e=h,h=h.return;return e.tag===3?(h=e.stateNode,u&&t!==null&&(u=31-Pe(a),e=h.hiddenUpdates,s=e[u],s===null?e[u]=[t]:s.push(t),t.lane=a|536870912),h):null}function ol(e){if(50<Cr)throw Cr=0,Kc=null,Error(l(185));for(var t=e.return;t!==null;)e=t,t=e.return;return e.tag===3?e.stateNode:null}var ei={};function cv(e,t,a,s){this.tag=e,this.key=a,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=s,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function zn(e,t,a,s){return new cv(e,t,a,s)}function Fo(e){return e=e.prototype,!(!e||!e.isReactComponent)}function ba(e,t){var a=e.alternate;return a===null?(a=zn(e.tag,t,e.key,e.mode),a.elementType=e.elementType,a.type=e.type,a.stateNode=e.stateNode,a.alternate=e,e.alternate=a):(a.pendingProps=t,a.type=e.type,a.flags=0,a.subtreeFlags=0,a.deletions=null),a.flags=e.flags&65011712,a.childLanes=e.childLanes,a.lanes=e.lanes,a.child=e.child,a.memoizedProps=e.memoizedProps,a.memoizedState=e.memoizedState,a.updateQueue=e.updateQueue,t=e.dependencies,a.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},a.sibling=e.sibling,a.index=e.index,a.ref=e.ref,a.refCleanup=e.refCleanup,a}function $d(e,t){e.flags&=65011714;var a=e.alternate;return a===null?(e.childLanes=0,e.lanes=t,e.child=null,e.subtreeFlags=0,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.stateNode=null):(e.childLanes=a.childLanes,e.lanes=a.lanes,e.child=a.child,e.subtreeFlags=0,e.deletions=null,e.memoizedProps=a.memoizedProps,e.memoizedState=a.memoizedState,e.updateQueue=a.updateQueue,e.type=a.type,t=a.dependencies,e.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),e}function cl(e,t,a,s,u,h){var v=0;if(s=e,typeof e=="function")Fo(e)&&(v=1);else if(typeof e=="string")v=m_(e,a,be.current)?26:e==="html"||e==="head"||e==="body"?27:5;else e:switch(e){case T:return e=zn(31,a,t,u),e.elementType=T,e.lanes=h,e;case P:return Ss(a.children,u,h,t);case E:v=8,u|=24;break;case V:return e=zn(12,a,t,u|2),e.elementType=V,e.lanes=h,e;case M:return e=zn(13,a,t,u),e.elementType=M,e.lanes=h,e;case G:return e=zn(19,a,t,u),e.elementType=G,e.lanes=h,e;default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case U:v=10;break e;case L:v=9;break e;case O:v=11;break e;case q:v=14;break e;case Y:v=16,s=null;break e}v=29,a=Error(l(130,e===null?"null":typeof e,"")),s=null}return t=zn(v,a,t,u),t.elementType=e,t.type=s,t.lanes=h,t}function Ss(e,t,a,s){return e=zn(7,e,s,t),e.lanes=a,e}function Ho(e,t,a){return e=zn(6,e,null,t),e.lanes=a,e}function Id(e){var t=zn(18,null,null,0);return t.stateNode=e,t}function $o(e,t,a){return t=zn(4,e.children!==null?e.children:[],e.key,t),t.lanes=a,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}var Vd=new WeakMap;function Yn(e,t){if(typeof e=="object"&&e!==null){var a=Vd.get(e);return a!==void 0?a:(t={value:e,source:t,stack:ln(t)},Vd.set(e,t),t)}return{value:e,source:t,stack:ln(t)}}var ti=[],ni=0,ul=null,ir=0,Qn=[],Kn=0,Ia=null,da=1,ha="";function ja(e,t){ti[ni++]=ir,ti[ni++]=ul,ul=e,ir=t}function Gd(e,t,a){Qn[Kn++]=da,Qn[Kn++]=ha,Qn[Kn++]=Ia,Ia=e;var s=da;e=ha;var u=32-Pe(s)-1;s&=~(1<<u),a+=1;var h=32-Pe(t)+u;if(30<h){var v=u-u%5;h=(s&(1<<v)-1).toString(32),s>>=v,u-=v,da=1<<32-Pe(t)+u|a<<u|s,ha=h+e}else da=1<<h|a<<u|s,ha=e}function Io(e){e.return!==null&&(ja(e,1),Gd(e,1,0))}function Vo(e){for(;e===ul;)ul=ti[--ni],ti[ni]=null,ir=ti[--ni],ti[ni]=null;for(;e===Ia;)Ia=Qn[--Kn],Qn[Kn]=null,ha=Qn[--Kn],Qn[Kn]=null,da=Qn[--Kn],Qn[Kn]=null}function Yd(e,t){Qn[Kn++]=da,Qn[Kn++]=ha,Qn[Kn++]=Ia,da=t.id,ha=t.overflow,Ia=e}var pn=null,Ot=null,ct=!1,Va=null,Jn=!1,Go=Error(l(519));function Ga(e){var t=Error(l(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw rr(Yn(t,e)),Go}function Qd(e){var t=e.stateNode,a=e.type,s=e.memoizedProps;switch(t[wt]=e,t[Yt]=s,a){case"dialog":st("cancel",t),st("close",t);break;case"iframe":case"object":case"embed":st("load",t);break;case"video":case"audio":for(a=0;a<Tr.length;a++)st(Tr[a],t);break;case"source":st("error",t);break;case"img":case"image":case"link":st("error",t),st("load",t);break;case"details":st("toggle",t);break;case"input":st("invalid",t),an(t,s.value,s.defaultValue,s.checked,s.defaultChecked,s.type,s.name,!0);break;case"select":st("invalid",t);break;case"textarea":st("invalid",t),je(t,s.value,s.defaultValue,s.children)}a=s.children,typeof a!="string"&&typeof a!="number"&&typeof a!="bigint"||t.textContent===""+a||s.suppressHydrationWarning===!0||hm(t.textContent,a)?(s.popover!=null&&(st("beforetoggle",t),st("toggle",t)),s.onScroll!=null&&st("scroll",t),s.onScrollEnd!=null&&st("scrollend",t),s.onClick!=null&&(t.onclick=dn),t=!0):t=!1,t||Ga(e,!0)}function Kd(e){for(pn=e.return;pn;)switch(pn.tag){case 5:case 31:case 13:Jn=!1;return;case 27:case 3:Jn=!0;return;default:pn=pn.return}}function ai(e){if(e!==pn)return!1;if(!ct)return Kd(e),ct=!0,!1;var t=e.tag,a;if((a=t!==3&&t!==27)&&((a=t===5)&&(a=e.type,a=!(a!=="form"&&a!=="button")||uu(e.type,e.memoizedProps)),a=!a),a&&Ot&&Ga(e),Kd(e),t===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(l(317));Ot=bm(e)}else if(t===31){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(l(317));Ot=bm(e)}else t===27?(t=Ot,rs(e.type)?(e=pu,pu=null,Ot=e):Ot=t):Ot=pn?Zn(e.stateNode.nextSibling):null;return!0}function ws(){Ot=pn=null,ct=!1}function Yo(){var e=Va;return e!==null&&(Rn===null?Rn=e:Rn.push.apply(Rn,e),Va=null),e}function rr(e){Va===null?Va=[e]:Va.push(e)}var Qo=R(null),Ns=null,Sa=null;function Ya(e,t,a){fe(Qo,t._currentValue),t._currentValue=a}function wa(e){e._currentValue=Qo.current,X(Qo)}function Ko(e,t,a){for(;e!==null;){var s=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,s!==null&&(s.childLanes|=t)):s!==null&&(s.childLanes&t)!==t&&(s.childLanes|=t),e===a)break;e=e.return}}function Jo(e,t,a,s){var u=e.child;for(u!==null&&(u.return=e);u!==null;){var h=u.dependencies;if(h!==null){var v=u.child;h=h.firstContext;e:for(;h!==null;){var b=h;h=u;for(var z=0;z<t.length;z++)if(b.context===t[z]){h.lanes|=a,b=h.alternate,b!==null&&(b.lanes|=a),Ko(h.return,a,e),s||(v=null);break e}h=b.next}}else if(u.tag===18){if(v=u.return,v===null)throw Error(l(341));v.lanes|=a,h=v.alternate,h!==null&&(h.lanes|=a),Ko(v,a,e),v=null}else v=u.child;if(v!==null)v.return=u;else for(v=u;v!==null;){if(v===e){v=null;break}if(u=v.sibling,u!==null){u.return=v.return,v=u;break}v=v.return}u=v}}function si(e,t,a,s){e=null;for(var u=t,h=!1;u!==null;){if(!h){if((u.flags&524288)!==0)h=!0;else if((u.flags&262144)!==0)break}if(u.tag===10){var v=u.alternate;if(v===null)throw Error(l(387));if(v=v.memoizedProps,v!==null){var b=u.type;Mn(u.pendingProps.value,v.value)||(e!==null?e.push(b):e=[b])}}else if(u===re.current){if(v=u.alternate,v===null)throw Error(l(387));v.memoizedState.memoizedState!==u.memoizedState.memoizedState&&(e!==null?e.push(qr):e=[qr])}u=u.return}e!==null&&Jo(t,e,a,s),t.flags|=262144}function dl(e){for(e=e.firstContext;e!==null;){if(!Mn(e.context._currentValue,e.memoizedValue))return!0;e=e.next}return!1}function Cs(e){Ns=e,Sa=null,e=e.dependencies,e!==null&&(e.firstContext=null)}function gn(e){return Jd(Ns,e)}function hl(e,t){return Ns===null&&Cs(e),Jd(e,t)}function Jd(e,t){var a=t._currentValue;if(t={context:t,memoizedValue:a,next:null},Sa===null){if(e===null)throw Error(l(308));Sa=t,e.dependencies={lanes:0,firstContext:t},e.flags|=524288}else Sa=Sa.next=t;return a}var uv=typeof AbortController<"u"?AbortController:function(){var e=[],t=this.signal={aborted:!1,addEventListener:function(a,s){e.push(s)}};this.abort=function(){t.aborted=!0,e.forEach(function(a){return a()})}},dv=o.unstable_scheduleCallback,hv=o.unstable_NormalPriority,Qt={$$typeof:U,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Xo(){return{controller:new uv,data:new Map,refCount:0}}function lr(e){e.refCount--,e.refCount===0&&dv(hv,function(){e.controller.abort()})}var or=null,Zo=0,ii=0,ri=null;function fv(e,t){if(or===null){var a=or=[];Zo=0,ii=tu(),ri={status:"pending",value:void 0,then:function(s){a.push(s)}}}return Zo++,t.then(Xd,Xd),t}function Xd(){if(--Zo===0&&or!==null){ri!==null&&(ri.status="fulfilled");var e=or;or=null,ii=0,ri=null;for(var t=0;t<e.length;t++)(0,e[t])()}}function mv(e,t){var a=[],s={status:"pending",value:null,reason:null,then:function(u){a.push(u)}};return e.then(function(){s.status="fulfilled",s.value=t;for(var u=0;u<a.length;u++)(0,a[u])(t)},function(u){for(s.status="rejected",s.reason=u,u=0;u<a.length;u++)(0,a[u])(void 0)}),s}var Zd=F.S;F.S=function(e,t){zf=St(),typeof t=="object"&&t!==null&&typeof t.then=="function"&&fv(e,t),Zd!==null&&Zd(e,t)};var Es=R(null);function Wo(){var e=Es.current;return e!==null?e:Ct.pooledCache}function fl(e,t){t===null?fe(Es,Es.current):fe(Es,t.pool)}function Wd(){var e=Wo();return e===null?null:{parent:Qt._currentValue,pool:e}}var li=Error(l(460)),ec=Error(l(474)),ml=Error(l(542)),pl={then:function(){}};function eh(e){return e=e.status,e==="fulfilled"||e==="rejected"}function th(e,t,a){switch(a=e[a],a===void 0?e.push(t):a!==t&&(t.then(dn,dn),t=a),t.status){case"fulfilled":return t.value;case"rejected":throw e=t.reason,ah(e),e;default:if(typeof t.status=="string")t.then(dn,dn);else{if(e=Ct,e!==null&&100<e.shellSuspendCounter)throw Error(l(482));e=t,e.status="pending",e.then(function(s){if(t.status==="pending"){var u=t;u.status="fulfilled",u.value=s}},function(s){if(t.status==="pending"){var u=t;u.status="rejected",u.reason=s}})}switch(t.status){case"fulfilled":return t.value;case"rejected":throw e=t.reason,ah(e),e}throw As=t,li}}function Ts(e){try{var t=e._init;return t(e._payload)}catch(a){throw a!==null&&typeof a=="object"&&typeof a.then=="function"?(As=a,li):a}}var As=null;function nh(){if(As===null)throw Error(l(459));var e=As;return As=null,e}function ah(e){if(e===li||e===ml)throw Error(l(483))}var oi=null,cr=0;function gl(e){var t=cr;return cr+=1,oi===null&&(oi=[]),th(oi,e,t)}function ur(e,t){t=t.props.ref,e.ref=t!==void 0?t:null}function vl(e,t){throw t.$$typeof===C?Error(l(525)):(e=Object.prototype.toString.call(t),Error(l(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)))}function sh(e){function t(Q,H){if(e){var Z=Q.deletions;Z===null?(Q.deletions=[H],Q.flags|=16):Z.push(H)}}function a(Q,H){if(!e)return null;for(;H!==null;)t(Q,H),H=H.sibling;return null}function s(Q){for(var H=new Map;Q!==null;)Q.key!==null?H.set(Q.key,Q):H.set(Q.index,Q),Q=Q.sibling;return H}function u(Q,H){return Q=ba(Q,H),Q.index=0,Q.sibling=null,Q}function h(Q,H,Z){return Q.index=Z,e?(Z=Q.alternate,Z!==null?(Z=Z.index,Z<H?(Q.flags|=67108866,H):Z):(Q.flags|=67108866,H)):(Q.flags|=1048576,H)}function v(Q){return e&&Q.alternate===null&&(Q.flags|=67108866),Q}function b(Q,H,Z,de){return H===null||H.tag!==6?(H=Ho(Z,Q.mode,de),H.return=Q,H):(H=u(H,Z),H.return=Q,H)}function z(Q,H,Z,de){var He=Z.type;return He===P?oe(Q,H,Z.props.children,de,Z.key):H!==null&&(H.elementType===He||typeof He=="object"&&He!==null&&He.$$typeof===Y&&Ts(He)===H.type)?(H=u(H,Z.props),ur(H,Z),H.return=Q,H):(H=cl(Z.type,Z.key,Z.props,null,Q.mode,de),ur(H,Z),H.return=Q,H)}function W(Q,H,Z,de){return H===null||H.tag!==4||H.stateNode.containerInfo!==Z.containerInfo||H.stateNode.implementation!==Z.implementation?(H=$o(Z,Q.mode,de),H.return=Q,H):(H=u(H,Z.children||[]),H.return=Q,H)}function oe(Q,H,Z,de,He){return H===null||H.tag!==7?(H=Ss(Z,Q.mode,de,He),H.return=Q,H):(H=u(H,Z),H.return=Q,H)}function me(Q,H,Z){if(typeof H=="string"&&H!==""||typeof H=="number"||typeof H=="bigint")return H=Ho(""+H,Q.mode,Z),H.return=Q,H;if(typeof H=="object"&&H!==null){switch(H.$$typeof){case N:return Z=cl(H.type,H.key,H.props,null,Q.mode,Z),ur(Z,H),Z.return=Q,Z;case k:return H=$o(H,Q.mode,Z),H.return=Q,H;case Y:return H=Ts(H),me(Q,H,Z)}if(Ce(H)||ee(H))return H=Ss(H,Q.mode,Z,null),H.return=Q,H;if(typeof H.then=="function")return me(Q,gl(H),Z);if(H.$$typeof===U)return me(Q,hl(Q,H),Z);vl(Q,H)}return null}function te(Q,H,Z,de){var He=H!==null?H.key:null;if(typeof Z=="string"&&Z!==""||typeof Z=="number"||typeof Z=="bigint")return He!==null?null:b(Q,H,""+Z,de);if(typeof Z=="object"&&Z!==null){switch(Z.$$typeof){case N:return Z.key===He?z(Q,H,Z,de):null;case k:return Z.key===He?W(Q,H,Z,de):null;case Y:return Z=Ts(Z),te(Q,H,Z,de)}if(Ce(Z)||ee(Z))return He!==null?null:oe(Q,H,Z,de,null);if(typeof Z.then=="function")return te(Q,H,gl(Z),de);if(Z.$$typeof===U)return te(Q,H,hl(Q,Z),de);vl(Q,Z)}return null}function ie(Q,H,Z,de,He){if(typeof de=="string"&&de!==""||typeof de=="number"||typeof de=="bigint")return Q=Q.get(Z)||null,b(H,Q,""+de,He);if(typeof de=="object"&&de!==null){switch(de.$$typeof){case N:return Q=Q.get(de.key===null?Z:de.key)||null,z(H,Q,de,He);case k:return Q=Q.get(de.key===null?Z:de.key)||null,W(H,Q,de,He);case Y:return de=Ts(de),ie(Q,H,Z,de,He)}if(Ce(de)||ee(de))return Q=Q.get(Z)||null,oe(H,Q,de,He,null);if(typeof de.then=="function")return ie(Q,H,Z,gl(de),He);if(de.$$typeof===U)return ie(Q,H,Z,hl(H,de),He);vl(H,de)}return null}function ze(Q,H,Z,de){for(var He=null,mt=null,Be=H,Ze=H=0,rt=null;Be!==null&&Ze<Z.length;Ze++){Be.index>Ze?(rt=Be,Be=null):rt=Be.sibling;var pt=te(Q,Be,Z[Ze],de);if(pt===null){Be===null&&(Be=rt);break}e&&Be&&pt.alternate===null&&t(Q,Be),H=h(pt,H,Ze),mt===null?He=pt:mt.sibling=pt,mt=pt,Be=rt}if(Ze===Z.length)return a(Q,Be),ct&&ja(Q,Ze),He;if(Be===null){for(;Ze<Z.length;Ze++)Be=me(Q,Z[Ze],de),Be!==null&&(H=h(Be,H,Ze),mt===null?He=Be:mt.sibling=Be,mt=Be);return ct&&ja(Q,Ze),He}for(Be=s(Be);Ze<Z.length;Ze++)rt=ie(Be,Q,Ze,Z[Ze],de),rt!==null&&(e&&rt.alternate!==null&&Be.delete(rt.key===null?Ze:rt.key),H=h(rt,H,Ze),mt===null?He=rt:mt.sibling=rt,mt=rt);return e&&Be.forEach(function(ds){return t(Q,ds)}),ct&&ja(Q,Ze),He}function Ge(Q,H,Z,de){if(Z==null)throw Error(l(151));for(var He=null,mt=null,Be=H,Ze=H=0,rt=null,pt=Z.next();Be!==null&&!pt.done;Ze++,pt=Z.next()){Be.index>Ze?(rt=Be,Be=null):rt=Be.sibling;var ds=te(Q,Be,pt.value,de);if(ds===null){Be===null&&(Be=rt);break}e&&Be&&ds.alternate===null&&t(Q,Be),H=h(ds,H,Ze),mt===null?He=ds:mt.sibling=ds,mt=ds,Be=rt}if(pt.done)return a(Q,Be),ct&&ja(Q,Ze),He;if(Be===null){for(;!pt.done;Ze++,pt=Z.next())pt=me(Q,pt.value,de),pt!==null&&(H=h(pt,H,Ze),mt===null?He=pt:mt.sibling=pt,mt=pt);return ct&&ja(Q,Ze),He}for(Be=s(Be);!pt.done;Ze++,pt=Z.next())pt=ie(Be,Q,Ze,pt.value,de),pt!==null&&(e&&pt.alternate!==null&&Be.delete(pt.key===null?Ze:pt.key),H=h(pt,H,Ze),mt===null?He=pt:mt.sibling=pt,mt=pt);return e&&Be.forEach(function(N_){return t(Q,N_)}),ct&&ja(Q,Ze),He}function jt(Q,H,Z,de){if(typeof Z=="object"&&Z!==null&&Z.type===P&&Z.key===null&&(Z=Z.props.children),typeof Z=="object"&&Z!==null){switch(Z.$$typeof){case N:e:{for(var He=Z.key;H!==null;){if(H.key===He){if(He=Z.type,He===P){if(H.tag===7){a(Q,H.sibling),de=u(H,Z.props.children),de.return=Q,Q=de;break e}}else if(H.elementType===He||typeof He=="object"&&He!==null&&He.$$typeof===Y&&Ts(He)===H.type){a(Q,H.sibling),de=u(H,Z.props),ur(de,Z),de.return=Q,Q=de;break e}a(Q,H);break}else t(Q,H);H=H.sibling}Z.type===P?(de=Ss(Z.props.children,Q.mode,de,Z.key),de.return=Q,Q=de):(de=cl(Z.type,Z.key,Z.props,null,Q.mode,de),ur(de,Z),de.return=Q,Q=de)}return v(Q);case k:e:{for(He=Z.key;H!==null;){if(H.key===He)if(H.tag===4&&H.stateNode.containerInfo===Z.containerInfo&&H.stateNode.implementation===Z.implementation){a(Q,H.sibling),de=u(H,Z.children||[]),de.return=Q,Q=de;break e}else{a(Q,H);break}else t(Q,H);H=H.sibling}de=$o(Z,Q.mode,de),de.return=Q,Q=de}return v(Q);case Y:return Z=Ts(Z),jt(Q,H,Z,de)}if(Ce(Z))return ze(Q,H,Z,de);if(ee(Z)){if(He=ee(Z),typeof He!="function")throw Error(l(150));return Z=He.call(Z),Ge(Q,H,Z,de)}if(typeof Z.then=="function")return jt(Q,H,gl(Z),de);if(Z.$$typeof===U)return jt(Q,H,hl(Q,Z),de);vl(Q,Z)}return typeof Z=="string"&&Z!==""||typeof Z=="number"||typeof Z=="bigint"?(Z=""+Z,H!==null&&H.tag===6?(a(Q,H.sibling),de=u(H,Z),de.return=Q,Q=de):(a(Q,H),de=Ho(Z,Q.mode,de),de.return=Q,Q=de),v(Q)):a(Q,H)}return function(Q,H,Z,de){try{cr=0;var He=jt(Q,H,Z,de);return oi=null,He}catch(Be){if(Be===li||Be===ml)throw Be;var mt=zn(29,Be,null,Q.mode);return mt.lanes=de,mt.return=Q,mt}finally{}}}var ks=sh(!0),ih=sh(!1),Qa=!1;function tc(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function nc(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,callbacks:null})}function Ka(e){return{lane:e,tag:0,payload:null,callback:null,next:null}}function Ja(e,t,a){var s=e.updateQueue;if(s===null)return null;if(s=s.shared,(vt&2)!==0){var u=s.pending;return u===null?t.next=t:(t.next=u.next,u.next=t),s.pending=t,t=ol(e),Hd(e,null,a),t}return ll(e,s,t,a),ol(e)}function dr(e,t,a){if(t=t.updateQueue,t!==null&&(t=t.shared,(a&4194048)!==0)){var s=t.lanes;s&=e.pendingLanes,a|=s,t.lanes=a,ua(e,a)}}function ac(e,t){var a=e.updateQueue,s=e.alternate;if(s!==null&&(s=s.updateQueue,a===s)){var u=null,h=null;if(a=a.firstBaseUpdate,a!==null){do{var v={lane:a.lane,tag:a.tag,payload:a.payload,callback:null,next:null};h===null?u=h=v:h=h.next=v,a=a.next}while(a!==null);h===null?u=h=t:h=h.next=t}else u=h=t;a={baseState:s.baseState,firstBaseUpdate:u,lastBaseUpdate:h,shared:s.shared,callbacks:s.callbacks},e.updateQueue=a;return}e=a.lastBaseUpdate,e===null?a.firstBaseUpdate=t:e.next=t,a.lastBaseUpdate=t}var sc=!1;function hr(){if(sc){var e=ri;if(e!==null)throw e}}function fr(e,t,a,s){sc=!1;var u=e.updateQueue;Qa=!1;var h=u.firstBaseUpdate,v=u.lastBaseUpdate,b=u.shared.pending;if(b!==null){u.shared.pending=null;var z=b,W=z.next;z.next=null,v===null?h=W:v.next=W,v=z;var oe=e.alternate;oe!==null&&(oe=oe.updateQueue,b=oe.lastBaseUpdate,b!==v&&(b===null?oe.firstBaseUpdate=W:b.next=W,oe.lastBaseUpdate=z))}if(h!==null){var me=u.baseState;v=0,oe=W=z=null,b=h;do{var te=b.lane&-536870913,ie=te!==b.lane;if(ie?(it&te)===te:(s&te)===te){te!==0&&te===ii&&(sc=!0),oe!==null&&(oe=oe.next={lane:0,tag:b.tag,payload:b.payload,callback:null,next:null});e:{var ze=e,Ge=b;te=t;var jt=a;switch(Ge.tag){case 1:if(ze=Ge.payload,typeof ze=="function"){me=ze.call(jt,me,te);break e}me=ze;break e;case 3:ze.flags=ze.flags&-65537|128;case 0:if(ze=Ge.payload,te=typeof ze=="function"?ze.call(jt,me,te):ze,te==null)break e;me=j({},me,te);break e;case 2:Qa=!0}}te=b.callback,te!==null&&(e.flags|=64,ie&&(e.flags|=8192),ie=u.callbacks,ie===null?u.callbacks=[te]:ie.push(te))}else ie={lane:te,tag:b.tag,payload:b.payload,callback:b.callback,next:null},oe===null?(W=oe=ie,z=me):oe=oe.next=ie,v|=te;if(b=b.next,b===null){if(b=u.shared.pending,b===null)break;ie=b,b=ie.next,ie.next=null,u.lastBaseUpdate=ie,u.shared.pending=null}}while(!0);oe===null&&(z=me),u.baseState=z,u.firstBaseUpdate=W,u.lastBaseUpdate=oe,h===null&&(u.shared.lanes=0),ts|=v,e.lanes=v,e.memoizedState=me}}function rh(e,t){if(typeof e!="function")throw Error(l(191,e));e.call(t)}function lh(e,t){var a=e.callbacks;if(a!==null)for(e.callbacks=null,e=0;e<a.length;e++)rh(a[e],t)}var ci=R(null),_l=R(0);function oh(e,t){e=qa,fe(_l,e),fe(ci,t),qa=e|t.baseLanes}function ic(){fe(_l,qa),fe(ci,ci.current)}function rc(){qa=_l.current,X(ci),X(_l)}var Ln=R(null),Xn=null;function Xa(e){var t=e.alternate;fe($t,$t.current&1),fe(Ln,e),Xn===null&&(t===null||ci.current!==null||t.memoizedState!==null)&&(Xn=e)}function lc(e){fe($t,$t.current),fe(Ln,e),Xn===null&&(Xn=e)}function ch(e){e.tag===22?(fe($t,$t.current),fe(Ln,e),Xn===null&&(Xn=e)):Za()}function Za(){fe($t,$t.current),fe(Ln,Ln.current)}function Un(e){X(Ln),Xn===e&&(Xn=null),X($t)}var $t=R(0);function yl(e){for(var t=e;t!==null;){if(t.tag===13){var a=t.memoizedState;if(a!==null&&(a=a.dehydrated,a===null||fu(a)||mu(a)))return t}else if(t.tag===19&&(t.memoizedProps.revealOrder==="forwards"||t.memoizedProps.revealOrder==="backwards"||t.memoizedProps.revealOrder==="unstable_legacy-backwards"||t.memoizedProps.revealOrder==="together")){if((t.flags&128)!==0)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var Na=0,Xe=null,xt=null,Kt=null,xl=!1,ui=!1,Os=!1,bl=0,mr=0,di=null,pv=0;function Pt(){throw Error(l(321))}function oc(e,t){if(t===null)return!1;for(var a=0;a<t.length&&a<e.length;a++)if(!Mn(e[a],t[a]))return!1;return!0}function cc(e,t,a,s,u,h){return Na=h,Xe=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,F.H=e===null||e.memoizedState===null?Gh:wc,Os=!1,h=a(s,u),Os=!1,ui&&(h=dh(t,a,s,u)),uh(e),h}function uh(e){F.H=vr;var t=xt!==null&&xt.next!==null;if(Na=0,Kt=xt=Xe=null,xl=!1,mr=0,di=null,t)throw Error(l(300));e===null||Jt||(e=e.dependencies,e!==null&&dl(e)&&(Jt=!0))}function dh(e,t,a,s){Xe=e;var u=0;do{if(ui&&(di=null),mr=0,ui=!1,25<=u)throw Error(l(301));if(u+=1,Kt=xt=null,e.updateQueue!=null){var h=e.updateQueue;h.lastEffect=null,h.events=null,h.stores=null,h.memoCache!=null&&(h.memoCache.index=0)}F.H=Yh,h=t(a,s)}while(ui);return h}function gv(){var e=F.H,t=e.useState()[0];return t=typeof t.then=="function"?pr(t):t,e=e.useState()[0],(xt!==null?xt.memoizedState:null)!==e&&(Xe.flags|=1024),t}function uc(){var e=bl!==0;return bl=0,e}function dc(e,t,a){t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~a}function hc(e){if(xl){for(e=e.memoizedState;e!==null;){var t=e.queue;t!==null&&(t.pending=null),e=e.next}xl=!1}Na=0,Kt=xt=Xe=null,ui=!1,mr=bl=0,di=null}function Sn(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Kt===null?Xe.memoizedState=Kt=e:Kt=Kt.next=e,Kt}function It(){if(xt===null){var e=Xe.alternate;e=e!==null?e.memoizedState:null}else e=xt.next;var t=Kt===null?Xe.memoizedState:Kt.next;if(t!==null)Kt=t,xt=e;else{if(e===null)throw Xe.alternate===null?Error(l(467)):Error(l(310));xt=e,e={memoizedState:xt.memoizedState,baseState:xt.baseState,baseQueue:xt.baseQueue,queue:xt.queue,next:null},Kt===null?Xe.memoizedState=Kt=e:Kt=Kt.next=e}return Kt}function jl(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function pr(e){var t=mr;return mr+=1,di===null&&(di=[]),e=th(di,e,t),t=Xe,(Kt===null?t.memoizedState:Kt.next)===null&&(t=t.alternate,F.H=t===null||t.memoizedState===null?Gh:wc),e}function Sl(e){if(e!==null&&typeof e=="object"){if(typeof e.then=="function")return pr(e);if(e.$$typeof===U)return gn(e)}throw Error(l(438,String(e)))}function fc(e){var t=null,a=Xe.updateQueue;if(a!==null&&(t=a.memoCache),t==null){var s=Xe.alternate;s!==null&&(s=s.updateQueue,s!==null&&(s=s.memoCache,s!=null&&(t={data:s.data.map(function(u){return u.slice()}),index:0})))}if(t==null&&(t={data:[],index:0}),a===null&&(a=jl(),Xe.updateQueue=a),a.memoCache=t,a=t.data[t.index],a===void 0)for(a=t.data[t.index]=Array(e),s=0;s<e;s++)a[s]=ce;return t.index++,a}function Ca(e,t){return typeof t=="function"?t(e):t}function wl(e){var t=It();return mc(t,xt,e)}function mc(e,t,a){var s=e.queue;if(s===null)throw Error(l(311));s.lastRenderedReducer=a;var u=e.baseQueue,h=s.pending;if(h!==null){if(u!==null){var v=u.next;u.next=h.next,h.next=v}t.baseQueue=u=h,s.pending=null}if(h=e.baseState,u===null)e.memoizedState=h;else{t=u.next;var b=v=null,z=null,W=t,oe=!1;do{var me=W.lane&-536870913;if(me!==W.lane?(it&me)===me:(Na&me)===me){var te=W.revertLane;if(te===0)z!==null&&(z=z.next={lane:0,revertLane:0,gesture:null,action:W.action,hasEagerState:W.hasEagerState,eagerState:W.eagerState,next:null}),me===ii&&(oe=!0);else if((Na&te)===te){W=W.next,te===ii&&(oe=!0);continue}else me={lane:0,revertLane:W.revertLane,gesture:null,action:W.action,hasEagerState:W.hasEagerState,eagerState:W.eagerState,next:null},z===null?(b=z=me,v=h):z=z.next=me,Xe.lanes|=te,ts|=te;me=W.action,Os&&a(h,me),h=W.hasEagerState?W.eagerState:a(h,me)}else te={lane:me,revertLane:W.revertLane,gesture:W.gesture,action:W.action,hasEagerState:W.hasEagerState,eagerState:W.eagerState,next:null},z===null?(b=z=te,v=h):z=z.next=te,Xe.lanes|=me,ts|=me;W=W.next}while(W!==null&&W!==t);if(z===null?v=h:z.next=b,!Mn(h,e.memoizedState)&&(Jt=!0,oe&&(a=ri,a!==null)))throw a;e.memoizedState=h,e.baseState=v,e.baseQueue=z,s.lastRenderedState=h}return u===null&&(s.lanes=0),[e.memoizedState,s.dispatch]}function pc(e){var t=It(),a=t.queue;if(a===null)throw Error(l(311));a.lastRenderedReducer=e;var s=a.dispatch,u=a.pending,h=t.memoizedState;if(u!==null){a.pending=null;var v=u=u.next;do h=e(h,v.action),v=v.next;while(v!==u);Mn(h,t.memoizedState)||(Jt=!0),t.memoizedState=h,t.baseQueue===null&&(t.baseState=h),a.lastRenderedState=h}return[h,s]}function hh(e,t,a){var s=Xe,u=It(),h=ct;if(h){if(a===void 0)throw Error(l(407));a=a()}else a=t();var v=!Mn((xt||u).memoizedState,a);if(v&&(u.memoizedState=a,Jt=!0),u=u.queue,_c(ph.bind(null,s,u,e),[e]),u.getSnapshot!==t||v||Kt!==null&&Kt.memoizedState.tag&1){if(s.flags|=2048,hi(9,{destroy:void 0},mh.bind(null,s,u,a,t),null),Ct===null)throw Error(l(349));h||(Na&127)!==0||fh(s,t,a)}return a}function fh(e,t,a){e.flags|=16384,e={getSnapshot:t,value:a},t=Xe.updateQueue,t===null?(t=jl(),Xe.updateQueue=t,t.stores=[e]):(a=t.stores,a===null?t.stores=[e]:a.push(e))}function mh(e,t,a,s){t.value=a,t.getSnapshot=s,gh(t)&&vh(e)}function ph(e,t,a){return a(function(){gh(t)&&vh(e)})}function gh(e){var t=e.getSnapshot;e=e.value;try{var a=t();return!Mn(e,a)}catch{return!0}}function vh(e){var t=js(e,2);t!==null&&qn(t,e,2)}function gc(e){var t=Sn();if(typeof e=="function"){var a=e;if(e=a(),Os){Ye(!0);try{a()}finally{Ye(!1)}}}return t.memoizedState=t.baseState=e,t.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ca,lastRenderedState:e},t}function _h(e,t,a,s){return e.baseState=a,mc(e,xt,typeof s=="function"?s:Ca)}function vv(e,t,a,s,u){if(El(e))throw Error(l(485));if(e=t.action,e!==null){var h={payload:u,action:e,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(v){h.listeners.push(v)}};F.T!==null?a(!0):h.isTransition=!1,s(h),a=t.pending,a===null?(h.next=t.pending=h,yh(t,h)):(h.next=a.next,t.pending=a.next=h)}}function yh(e,t){var a=t.action,s=t.payload,u=e.state;if(t.isTransition){var h=F.T,v={};F.T=v;try{var b=a(u,s),z=F.S;z!==null&&z(v,b),xh(e,t,b)}catch(W){vc(e,t,W)}finally{h!==null&&v.types!==null&&(h.types=v.types),F.T=h}}else try{h=a(u,s),xh(e,t,h)}catch(W){vc(e,t,W)}}function xh(e,t,a){a!==null&&typeof a=="object"&&typeof a.then=="function"?a.then(function(s){bh(e,t,s)},function(s){return vc(e,t,s)}):bh(e,t,a)}function bh(e,t,a){t.status="fulfilled",t.value=a,jh(t),e.state=a,t=e.pending,t!==null&&(a=t.next,a===t?e.pending=null:(a=a.next,t.next=a,yh(e,a)))}function vc(e,t,a){var s=e.pending;if(e.pending=null,s!==null){s=s.next;do t.status="rejected",t.reason=a,jh(t),t=t.next;while(t!==s)}e.action=null}function jh(e){e=e.listeners;for(var t=0;t<e.length;t++)(0,e[t])()}function Sh(e,t){return t}function wh(e,t){if(ct){var a=Ct.formState;if(a!==null){e:{var s=Xe;if(ct){if(Ot){t:{for(var u=Ot,h=Jn;u.nodeType!==8;){if(!h){u=null;break t}if(u=Zn(u.nextSibling),u===null){u=null;break t}}h=u.data,u=h==="F!"||h==="F"?u:null}if(u){Ot=Zn(u.nextSibling),s=u.data==="F!";break e}}Ga(s)}s=!1}s&&(t=a[0])}}return a=Sn(),a.memoizedState=a.baseState=t,s={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Sh,lastRenderedState:t},a.queue=s,a=$h.bind(null,Xe,s),s.dispatch=a,s=gc(!1),h=Sc.bind(null,Xe,!1,s.queue),s=Sn(),u={state:t,dispatch:null,action:e,pending:null},s.queue=u,a=vv.bind(null,Xe,u,h,a),u.dispatch=a,s.memoizedState=e,[t,a,!1]}function Nh(e){var t=It();return Ch(t,xt,e)}function Ch(e,t,a){if(t=mc(e,t,Sh)[0],e=wl(Ca)[0],typeof t=="object"&&t!==null&&typeof t.then=="function")try{var s=pr(t)}catch(v){throw v===li?ml:v}else s=t;t=It();var u=t.queue,h=u.dispatch;return a!==t.memoizedState&&(Xe.flags|=2048,hi(9,{destroy:void 0},_v.bind(null,u,a),null)),[s,h,e]}function _v(e,t){e.action=t}function Eh(e){var t=It(),a=xt;if(a!==null)return Ch(t,a,e);It(),t=t.memoizedState,a=It();var s=a.queue.dispatch;return a.memoizedState=e,[t,s,!1]}function hi(e,t,a,s){return e={tag:e,create:a,deps:s,inst:t,next:null},t=Xe.updateQueue,t===null&&(t=jl(),Xe.updateQueue=t),a=t.lastEffect,a===null?t.lastEffect=e.next=e:(s=a.next,a.next=e,e.next=s,t.lastEffect=e),e}function Th(){return It().memoizedState}function Nl(e,t,a,s){var u=Sn();Xe.flags|=e,u.memoizedState=hi(1|t,{destroy:void 0},a,s===void 0?null:s)}function Cl(e,t,a,s){var u=It();s=s===void 0?null:s;var h=u.memoizedState.inst;xt!==null&&s!==null&&oc(s,xt.memoizedState.deps)?u.memoizedState=hi(t,h,a,s):(Xe.flags|=e,u.memoizedState=hi(1|t,h,a,s))}function Ah(e,t){Nl(8390656,8,e,t)}function _c(e,t){Cl(2048,8,e,t)}function yv(e){Xe.flags|=4;var t=Xe.updateQueue;if(t===null)t=jl(),Xe.updateQueue=t,t.events=[e];else{var a=t.events;a===null?t.events=[e]:a.push(e)}}function kh(e){var t=It().memoizedState;return yv({ref:t,nextImpl:e}),function(){if((vt&2)!==0)throw Error(l(440));return t.impl.apply(void 0,arguments)}}function Oh(e,t){return Cl(4,2,e,t)}function Rh(e,t){return Cl(4,4,e,t)}function qh(e,t){if(typeof t=="function"){e=e();var a=t(e);return function(){typeof a=="function"?a():t(null)}}if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function Dh(e,t,a){a=a!=null?a.concat([e]):null,Cl(4,4,qh.bind(null,t,e),a)}function yc(){}function Mh(e,t){var a=It();t=t===void 0?null:t;var s=a.memoizedState;return t!==null&&oc(t,s[1])?s[0]:(a.memoizedState=[e,t],e)}function zh(e,t){var a=It();t=t===void 0?null:t;var s=a.memoizedState;if(t!==null&&oc(t,s[1]))return s[0];if(s=e(),Os){Ye(!0);try{e()}finally{Ye(!1)}}return a.memoizedState=[s,t],s}function xc(e,t,a){return a===void 0||(Na&1073741824)!==0&&(it&261930)===0?e.memoizedState=t:(e.memoizedState=a,e=Uf(),Xe.lanes|=e,ts|=e,a)}function Lh(e,t,a,s){return Mn(a,t)?a:ci.current!==null?(e=xc(e,a,s),Mn(e,t)||(Jt=!0),e):(Na&42)===0||(Na&1073741824)!==0&&(it&261930)===0?(Jt=!0,e.memoizedState=a):(e=Uf(),Xe.lanes|=e,ts|=e,t)}function Uh(e,t,a,s,u){var h=ne.p;ne.p=h!==0&&8>h?h:8;var v=F.T,b={};F.T=b,Sc(e,!1,t,a);try{var z=u(),W=F.S;if(W!==null&&W(b,z),z!==null&&typeof z=="object"&&typeof z.then=="function"){var oe=mv(z,s);gr(e,t,oe,Fn(e))}else gr(e,t,s,Fn(e))}catch(me){gr(e,t,{then:function(){},status:"rejected",reason:me},Fn())}finally{ne.p=h,v!==null&&b.types!==null&&(v.types=b.types),F.T=v}}function xv(){}function bc(e,t,a,s){if(e.tag!==5)throw Error(l(476));var u=Bh(e).queue;Uh(e,u,t,K,a===null?xv:function(){return Ph(e),a(s)})}function Bh(e){var t=e.memoizedState;if(t!==null)return t;t={memoizedState:K,baseState:K,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ca,lastRenderedState:K},next:null};var a={};return t.next={memoizedState:a,baseState:a,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ca,lastRenderedState:a},next:null},e.memoizedState=t,e=e.alternate,e!==null&&(e.memoizedState=t),t}function Ph(e){var t=Bh(e);t.next===null&&(t=e.alternate.memoizedState),gr(e,t.next.queue,{},Fn())}function jc(){return gn(qr)}function Fh(){return It().memoizedState}function Hh(){return It().memoizedState}function bv(e){for(var t=e.return;t!==null;){switch(t.tag){case 24:case 3:var a=Fn();e=Ka(a);var s=Ja(t,e,a);s!==null&&(qn(s,t,a),dr(s,t,a)),t={cache:Xo()},e.payload=t;return}t=t.return}}function jv(e,t,a){var s=Fn();a={lane:s,revertLane:0,gesture:null,action:a,hasEagerState:!1,eagerState:null,next:null},El(e)?Ih(t,a):(a=Po(e,t,a,s),a!==null&&(qn(a,e,s),Vh(a,t,s)))}function $h(e,t,a){var s=Fn();gr(e,t,a,s)}function gr(e,t,a,s){var u={lane:s,revertLane:0,gesture:null,action:a,hasEagerState:!1,eagerState:null,next:null};if(El(e))Ih(t,u);else{var h=e.alternate;if(e.lanes===0&&(h===null||h.lanes===0)&&(h=t.lastRenderedReducer,h!==null))try{var v=t.lastRenderedState,b=h(v,a);if(u.hasEagerState=!0,u.eagerState=b,Mn(b,v))return ll(e,t,u,0),Ct===null&&rl(),!1}catch{}finally{}if(a=Po(e,t,u,s),a!==null)return qn(a,e,s),Vh(a,t,s),!0}return!1}function Sc(e,t,a,s){if(s={lane:2,revertLane:tu(),gesture:null,action:s,hasEagerState:!1,eagerState:null,next:null},El(e)){if(t)throw Error(l(479))}else t=Po(e,a,s,2),t!==null&&qn(t,e,2)}function El(e){var t=e.alternate;return e===Xe||t!==null&&t===Xe}function Ih(e,t){ui=xl=!0;var a=e.pending;a===null?t.next=t:(t.next=a.next,a.next=t),e.pending=t}function Vh(e,t,a){if((a&4194048)!==0){var s=t.lanes;s&=e.pendingLanes,a|=s,t.lanes=a,ua(e,a)}}var vr={readContext:gn,use:Sl,useCallback:Pt,useContext:Pt,useEffect:Pt,useImperativeHandle:Pt,useLayoutEffect:Pt,useInsertionEffect:Pt,useMemo:Pt,useReducer:Pt,useRef:Pt,useState:Pt,useDebugValue:Pt,useDeferredValue:Pt,useTransition:Pt,useSyncExternalStore:Pt,useId:Pt,useHostTransitionStatus:Pt,useFormState:Pt,useActionState:Pt,useOptimistic:Pt,useMemoCache:Pt,useCacheRefresh:Pt};vr.useEffectEvent=Pt;var Gh={readContext:gn,use:Sl,useCallback:function(e,t){return Sn().memoizedState=[e,t===void 0?null:t],e},useContext:gn,useEffect:Ah,useImperativeHandle:function(e,t,a){a=a!=null?a.concat([e]):null,Nl(4194308,4,qh.bind(null,t,e),a)},useLayoutEffect:function(e,t){return Nl(4194308,4,e,t)},useInsertionEffect:function(e,t){Nl(4,2,e,t)},useMemo:function(e,t){var a=Sn();t=t===void 0?null:t;var s=e();if(Os){Ye(!0);try{e()}finally{Ye(!1)}}return a.memoizedState=[s,t],s},useReducer:function(e,t,a){var s=Sn();if(a!==void 0){var u=a(t);if(Os){Ye(!0);try{a(t)}finally{Ye(!1)}}}else u=t;return s.memoizedState=s.baseState=u,e={pending:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:u},s.queue=e,e=e.dispatch=jv.bind(null,Xe,e),[s.memoizedState,e]},useRef:function(e){var t=Sn();return e={current:e},t.memoizedState=e},useState:function(e){e=gc(e);var t=e.queue,a=$h.bind(null,Xe,t);return t.dispatch=a,[e.memoizedState,a]},useDebugValue:yc,useDeferredValue:function(e,t){var a=Sn();return xc(a,e,t)},useTransition:function(){var e=gc(!1);return e=Uh.bind(null,Xe,e.queue,!0,!1),Sn().memoizedState=e,[!1,e]},useSyncExternalStore:function(e,t,a){var s=Xe,u=Sn();if(ct){if(a===void 0)throw Error(l(407));a=a()}else{if(a=t(),Ct===null)throw Error(l(349));(it&127)!==0||fh(s,t,a)}u.memoizedState=a;var h={value:a,getSnapshot:t};return u.queue=h,Ah(ph.bind(null,s,h,e),[e]),s.flags|=2048,hi(9,{destroy:void 0},mh.bind(null,s,h,a,t),null),a},useId:function(){var e=Sn(),t=Ct.identifierPrefix;if(ct){var a=ha,s=da;a=(s&~(1<<32-Pe(s)-1)).toString(32)+a,t="_"+t+"R_"+a,a=bl++,0<a&&(t+="H"+a.toString(32)),t+="_"}else a=pv++,t="_"+t+"r_"+a.toString(32)+"_";return e.memoizedState=t},useHostTransitionStatus:jc,useFormState:wh,useActionState:wh,useOptimistic:function(e){var t=Sn();t.memoizedState=t.baseState=e;var a={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return t.queue=a,t=Sc.bind(null,Xe,!0,a),a.dispatch=t,[e,t]},useMemoCache:fc,useCacheRefresh:function(){return Sn().memoizedState=bv.bind(null,Xe)},useEffectEvent:function(e){var t=Sn(),a={impl:e};return t.memoizedState=a,function(){if((vt&2)!==0)throw Error(l(440));return a.impl.apply(void 0,arguments)}}},wc={readContext:gn,use:Sl,useCallback:Mh,useContext:gn,useEffect:_c,useImperativeHandle:Dh,useInsertionEffect:Oh,useLayoutEffect:Rh,useMemo:zh,useReducer:wl,useRef:Th,useState:function(){return wl(Ca)},useDebugValue:yc,useDeferredValue:function(e,t){var a=It();return Lh(a,xt.memoizedState,e,t)},useTransition:function(){var e=wl(Ca)[0],t=It().memoizedState;return[typeof e=="boolean"?e:pr(e),t]},useSyncExternalStore:hh,useId:Fh,useHostTransitionStatus:jc,useFormState:Nh,useActionState:Nh,useOptimistic:function(e,t){var a=It();return _h(a,xt,e,t)},useMemoCache:fc,useCacheRefresh:Hh};wc.useEffectEvent=kh;var Yh={readContext:gn,use:Sl,useCallback:Mh,useContext:gn,useEffect:_c,useImperativeHandle:Dh,useInsertionEffect:Oh,useLayoutEffect:Rh,useMemo:zh,useReducer:pc,useRef:Th,useState:function(){return pc(Ca)},useDebugValue:yc,useDeferredValue:function(e,t){var a=It();return xt===null?xc(a,e,t):Lh(a,xt.memoizedState,e,t)},useTransition:function(){var e=pc(Ca)[0],t=It().memoizedState;return[typeof e=="boolean"?e:pr(e),t]},useSyncExternalStore:hh,useId:Fh,useHostTransitionStatus:jc,useFormState:Eh,useActionState:Eh,useOptimistic:function(e,t){var a=It();return xt!==null?_h(a,xt,e,t):(a.baseState=e,[e,a.queue.dispatch])},useMemoCache:fc,useCacheRefresh:Hh};Yh.useEffectEvent=kh;function Nc(e,t,a,s){t=e.memoizedState,a=a(s,t),a=a==null?t:j({},t,a),e.memoizedState=a,e.lanes===0&&(e.updateQueue.baseState=a)}var Cc={enqueueSetState:function(e,t,a){e=e._reactInternals;var s=Fn(),u=Ka(s);u.payload=t,a!=null&&(u.callback=a),t=Ja(e,u,s),t!==null&&(qn(t,e,s),dr(t,e,s))},enqueueReplaceState:function(e,t,a){e=e._reactInternals;var s=Fn(),u=Ka(s);u.tag=1,u.payload=t,a!=null&&(u.callback=a),t=Ja(e,u,s),t!==null&&(qn(t,e,s),dr(t,e,s))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var a=Fn(),s=Ka(a);s.tag=2,t!=null&&(s.callback=t),t=Ja(e,s,a),t!==null&&(qn(t,e,a),dr(t,e,a))}};function Qh(e,t,a,s,u,h,v){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(s,h,v):t.prototype&&t.prototype.isPureReactComponent?!ar(a,s)||!ar(u,h):!0}function Kh(e,t,a,s){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(a,s),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(a,s),t.state!==e&&Cc.enqueueReplaceState(t,t.state,null)}function Rs(e,t){var a=t;if("ref"in t){a={};for(var s in t)s!=="ref"&&(a[s]=t[s])}if(e=e.defaultProps){a===t&&(a=j({},a));for(var u in e)a[u]===void 0&&(a[u]=e[u])}return a}function Jh(e){il(e)}function Xh(e){console.error(e)}function Zh(e){il(e)}function Tl(e,t){try{var a=e.onUncaughtError;a(t.value,{componentStack:t.stack})}catch(s){setTimeout(function(){throw s})}}function Wh(e,t,a){try{var s=e.onCaughtError;s(a.value,{componentStack:a.stack,errorBoundary:t.tag===1?t.stateNode:null})}catch(u){setTimeout(function(){throw u})}}function Ec(e,t,a){return a=Ka(a),a.tag=3,a.payload={element:null},a.callback=function(){Tl(e,t)},a}function ef(e){return e=Ka(e),e.tag=3,e}function tf(e,t,a,s){var u=a.type.getDerivedStateFromError;if(typeof u=="function"){var h=s.value;e.payload=function(){return u(h)},e.callback=function(){Wh(t,a,s)}}var v=a.stateNode;v!==null&&typeof v.componentDidCatch=="function"&&(e.callback=function(){Wh(t,a,s),typeof u!="function"&&(ns===null?ns=new Set([this]):ns.add(this));var b=s.stack;this.componentDidCatch(s.value,{componentStack:b!==null?b:""})})}function Sv(e,t,a,s,u){if(a.flags|=32768,s!==null&&typeof s=="object"&&typeof s.then=="function"){if(t=a.alternate,t!==null&&si(t,a,u,!0),a=Ln.current,a!==null){switch(a.tag){case 31:case 13:return Xn===null?Pl():a.alternate===null&&Ft===0&&(Ft=3),a.flags&=-257,a.flags|=65536,a.lanes=u,s===pl?a.flags|=16384:(t=a.updateQueue,t===null?a.updateQueue=new Set([s]):t.add(s),Zc(e,s,u)),!1;case 22:return a.flags|=65536,s===pl?a.flags|=16384:(t=a.updateQueue,t===null?(t={transitions:null,markerInstances:null,retryQueue:new Set([s])},a.updateQueue=t):(a=t.retryQueue,a===null?t.retryQueue=new Set([s]):a.add(s)),Zc(e,s,u)),!1}throw Error(l(435,a.tag))}return Zc(e,s,u),Pl(),!1}if(ct)return t=Ln.current,t!==null?((t.flags&65536)===0&&(t.flags|=256),t.flags|=65536,t.lanes=u,s!==Go&&(e=Error(l(422),{cause:s}),rr(Yn(e,a)))):(s!==Go&&(t=Error(l(423),{cause:s}),rr(Yn(t,a))),e=e.current.alternate,e.flags|=65536,u&=-u,e.lanes|=u,s=Yn(s,a),u=Ec(e.stateNode,s,u),ac(e,u),Ft!==4&&(Ft=2)),!1;var h=Error(l(520),{cause:s});if(h=Yn(h,a),Nr===null?Nr=[h]:Nr.push(h),Ft!==4&&(Ft=2),t===null)return!0;s=Yn(s,a),a=t;do{switch(a.tag){case 3:return a.flags|=65536,e=u&-u,a.lanes|=e,e=Ec(a.stateNode,s,e),ac(a,e),!1;case 1:if(t=a.type,h=a.stateNode,(a.flags&128)===0&&(typeof t.getDerivedStateFromError=="function"||h!==null&&typeof h.componentDidCatch=="function"&&(ns===null||!ns.has(h))))return a.flags|=65536,u&=-u,a.lanes|=u,u=ef(u),tf(u,e,a,s),ac(a,u),!1}a=a.return}while(a!==null);return!1}var Tc=Error(l(461)),Jt=!1;function vn(e,t,a,s){t.child=e===null?ih(t,null,a,s):ks(t,e.child,a,s)}function nf(e,t,a,s,u){a=a.render;var h=t.ref;if("ref"in s){var v={};for(var b in s)b!=="ref"&&(v[b]=s[b])}else v=s;return Cs(t),s=cc(e,t,a,v,h,u),b=uc(),e!==null&&!Jt?(dc(e,t,u),Ea(e,t,u)):(ct&&b&&Io(t),t.flags|=1,vn(e,t,s,u),t.child)}function af(e,t,a,s,u){if(e===null){var h=a.type;return typeof h=="function"&&!Fo(h)&&h.defaultProps===void 0&&a.compare===null?(t.tag=15,t.type=h,sf(e,t,h,s,u)):(e=cl(a.type,null,s,t,t.mode,u),e.ref=t.ref,e.return=t,t.child=e)}if(h=e.child,!zc(e,u)){var v=h.memoizedProps;if(a=a.compare,a=a!==null?a:ar,a(v,s)&&e.ref===t.ref)return Ea(e,t,u)}return t.flags|=1,e=ba(h,s),e.ref=t.ref,e.return=t,t.child=e}function sf(e,t,a,s,u){if(e!==null){var h=e.memoizedProps;if(ar(h,s)&&e.ref===t.ref)if(Jt=!1,t.pendingProps=s=h,zc(e,u))(e.flags&131072)!==0&&(Jt=!0);else return t.lanes=e.lanes,Ea(e,t,u)}return Ac(e,t,a,s,u)}function rf(e,t,a,s){var u=s.children,h=e!==null?e.memoizedState:null;if(e===null&&t.stateNode===null&&(t.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),s.mode==="hidden"){if((t.flags&128)!==0){if(h=h!==null?h.baseLanes|a:a,e!==null){for(s=t.child=e.child,u=0;s!==null;)u=u|s.lanes|s.childLanes,s=s.sibling;s=u&~h}else s=0,t.child=null;return lf(e,t,h,a,s)}if((a&536870912)!==0)t.memoizedState={baseLanes:0,cachePool:null},e!==null&&fl(t,h!==null?h.cachePool:null),h!==null?oh(t,h):ic(),ch(t);else return s=t.lanes=536870912,lf(e,t,h!==null?h.baseLanes|a:a,a,s)}else h!==null?(fl(t,h.cachePool),oh(t,h),Za(),t.memoizedState=null):(e!==null&&fl(t,null),ic(),Za());return vn(e,t,u,a),t.child}function _r(e,t){return e!==null&&e.tag===22||t.stateNode!==null||(t.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),t.sibling}function lf(e,t,a,s,u){var h=Wo();return h=h===null?null:{parent:Qt._currentValue,pool:h},t.memoizedState={baseLanes:a,cachePool:h},e!==null&&fl(t,null),ic(),ch(t),e!==null&&si(e,t,s,!0),t.childLanes=u,null}function Al(e,t){return t=Ol({mode:t.mode,children:t.children},e.mode),t.ref=e.ref,e.child=t,t.return=e,t}function of(e,t,a){return ks(t,e.child,null,a),e=Al(t,t.pendingProps),e.flags|=2,Un(t),t.memoizedState=null,e}function wv(e,t,a){var s=t.pendingProps,u=(t.flags&128)!==0;if(t.flags&=-129,e===null){if(ct){if(s.mode==="hidden")return e=Al(t,s),t.lanes=536870912,_r(null,e);if(lc(t),(e=Ot)?(e=xm(e,Jn),e=e!==null&&e.data==="&"?e:null,e!==null&&(t.memoizedState={dehydrated:e,treeContext:Ia!==null?{id:da,overflow:ha}:null,retryLane:536870912,hydrationErrors:null},a=Id(e),a.return=t,t.child=a,pn=t,Ot=null)):e=null,e===null)throw Ga(t);return t.lanes=536870912,null}return Al(t,s)}var h=e.memoizedState;if(h!==null){var v=h.dehydrated;if(lc(t),u)if(t.flags&256)t.flags&=-257,t=of(e,t,a);else if(t.memoizedState!==null)t.child=e.child,t.flags|=128,t=null;else throw Error(l(558));else if(Jt||si(e,t,a,!1),u=(a&e.childLanes)!==0,Jt||u){if(s=Ct,s!==null&&(v=nn(s,a),v!==0&&v!==h.retryLane))throw h.retryLane=v,js(e,v),qn(s,e,v),Tc;Pl(),t=of(e,t,a)}else e=h.treeContext,Ot=Zn(v.nextSibling),pn=t,ct=!0,Va=null,Jn=!1,e!==null&&Yd(t,e),t=Al(t,s),t.flags|=4096;return t}return e=ba(e.child,{mode:s.mode,children:s.children}),e.ref=t.ref,t.child=e,e.return=t,e}function kl(e,t){var a=t.ref;if(a===null)e!==null&&e.ref!==null&&(t.flags|=4194816);else{if(typeof a!="function"&&typeof a!="object")throw Error(l(284));(e===null||e.ref!==a)&&(t.flags|=4194816)}}function Ac(e,t,a,s,u){return Cs(t),a=cc(e,t,a,s,void 0,u),s=uc(),e!==null&&!Jt?(dc(e,t,u),Ea(e,t,u)):(ct&&s&&Io(t),t.flags|=1,vn(e,t,a,u),t.child)}function cf(e,t,a,s,u,h){return Cs(t),t.updateQueue=null,a=dh(t,s,a,u),uh(e),s=uc(),e!==null&&!Jt?(dc(e,t,h),Ea(e,t,h)):(ct&&s&&Io(t),t.flags|=1,vn(e,t,a,h),t.child)}function uf(e,t,a,s,u){if(Cs(t),t.stateNode===null){var h=ei,v=a.contextType;typeof v=="object"&&v!==null&&(h=gn(v)),h=new a(s,h),t.memoizedState=h.state!==null&&h.state!==void 0?h.state:null,h.updater=Cc,t.stateNode=h,h._reactInternals=t,h=t.stateNode,h.props=s,h.state=t.memoizedState,h.refs={},tc(t),v=a.contextType,h.context=typeof v=="object"&&v!==null?gn(v):ei,h.state=t.memoizedState,v=a.getDerivedStateFromProps,typeof v=="function"&&(Nc(t,a,v,s),h.state=t.memoizedState),typeof a.getDerivedStateFromProps=="function"||typeof h.getSnapshotBeforeUpdate=="function"||typeof h.UNSAFE_componentWillMount!="function"&&typeof h.componentWillMount!="function"||(v=h.state,typeof h.componentWillMount=="function"&&h.componentWillMount(),typeof h.UNSAFE_componentWillMount=="function"&&h.UNSAFE_componentWillMount(),v!==h.state&&Cc.enqueueReplaceState(h,h.state,null),fr(t,s,h,u),hr(),h.state=t.memoizedState),typeof h.componentDidMount=="function"&&(t.flags|=4194308),s=!0}else if(e===null){h=t.stateNode;var b=t.memoizedProps,z=Rs(a,b);h.props=z;var W=h.context,oe=a.contextType;v=ei,typeof oe=="object"&&oe!==null&&(v=gn(oe));var me=a.getDerivedStateFromProps;oe=typeof me=="function"||typeof h.getSnapshotBeforeUpdate=="function",b=t.pendingProps!==b,oe||typeof h.UNSAFE_componentWillReceiveProps!="function"&&typeof h.componentWillReceiveProps!="function"||(b||W!==v)&&Kh(t,h,s,v),Qa=!1;var te=t.memoizedState;h.state=te,fr(t,s,h,u),hr(),W=t.memoizedState,b||te!==W||Qa?(typeof me=="function"&&(Nc(t,a,me,s),W=t.memoizedState),(z=Qa||Qh(t,a,z,s,te,W,v))?(oe||typeof h.UNSAFE_componentWillMount!="function"&&typeof h.componentWillMount!="function"||(typeof h.componentWillMount=="function"&&h.componentWillMount(),typeof h.UNSAFE_componentWillMount=="function"&&h.UNSAFE_componentWillMount()),typeof h.componentDidMount=="function"&&(t.flags|=4194308)):(typeof h.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=s,t.memoizedState=W),h.props=s,h.state=W,h.context=v,s=z):(typeof h.componentDidMount=="function"&&(t.flags|=4194308),s=!1)}else{h=t.stateNode,nc(e,t),v=t.memoizedProps,oe=Rs(a,v),h.props=oe,me=t.pendingProps,te=h.context,W=a.contextType,z=ei,typeof W=="object"&&W!==null&&(z=gn(W)),b=a.getDerivedStateFromProps,(W=typeof b=="function"||typeof h.getSnapshotBeforeUpdate=="function")||typeof h.UNSAFE_componentWillReceiveProps!="function"&&typeof h.componentWillReceiveProps!="function"||(v!==me||te!==z)&&Kh(t,h,s,z),Qa=!1,te=t.memoizedState,h.state=te,fr(t,s,h,u),hr();var ie=t.memoizedState;v!==me||te!==ie||Qa||e!==null&&e.dependencies!==null&&dl(e.dependencies)?(typeof b=="function"&&(Nc(t,a,b,s),ie=t.memoizedState),(oe=Qa||Qh(t,a,oe,s,te,ie,z)||e!==null&&e.dependencies!==null&&dl(e.dependencies))?(W||typeof h.UNSAFE_componentWillUpdate!="function"&&typeof h.componentWillUpdate!="function"||(typeof h.componentWillUpdate=="function"&&h.componentWillUpdate(s,ie,z),typeof h.UNSAFE_componentWillUpdate=="function"&&h.UNSAFE_componentWillUpdate(s,ie,z)),typeof h.componentDidUpdate=="function"&&(t.flags|=4),typeof h.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof h.componentDidUpdate!="function"||v===e.memoizedProps&&te===e.memoizedState||(t.flags|=4),typeof h.getSnapshotBeforeUpdate!="function"||v===e.memoizedProps&&te===e.memoizedState||(t.flags|=1024),t.memoizedProps=s,t.memoizedState=ie),h.props=s,h.state=ie,h.context=z,s=oe):(typeof h.componentDidUpdate!="function"||v===e.memoizedProps&&te===e.memoizedState||(t.flags|=4),typeof h.getSnapshotBeforeUpdate!="function"||v===e.memoizedProps&&te===e.memoizedState||(t.flags|=1024),s=!1)}return h=s,kl(e,t),s=(t.flags&128)!==0,h||s?(h=t.stateNode,a=s&&typeof a.getDerivedStateFromError!="function"?null:h.render(),t.flags|=1,e!==null&&s?(t.child=ks(t,e.child,null,u),t.child=ks(t,null,a,u)):vn(e,t,a,u),t.memoizedState=h.state,e=t.child):e=Ea(e,t,u),e}function df(e,t,a,s){return ws(),t.flags|=256,vn(e,t,a,s),t.child}var kc={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Oc(e){return{baseLanes:e,cachePool:Wd()}}function Rc(e,t,a){return e=e!==null?e.childLanes&~a:0,t&&(e|=Pn),e}function hf(e,t,a){var s=t.pendingProps,u=!1,h=(t.flags&128)!==0,v;if((v=h)||(v=e!==null&&e.memoizedState===null?!1:($t.current&2)!==0),v&&(u=!0,t.flags&=-129),v=(t.flags&32)!==0,t.flags&=-33,e===null){if(ct){if(u?Xa(t):Za(),(e=Ot)?(e=xm(e,Jn),e=e!==null&&e.data!=="&"?e:null,e!==null&&(t.memoizedState={dehydrated:e,treeContext:Ia!==null?{id:da,overflow:ha}:null,retryLane:536870912,hydrationErrors:null},a=Id(e),a.return=t,t.child=a,pn=t,Ot=null)):e=null,e===null)throw Ga(t);return mu(e)?t.lanes=32:t.lanes=536870912,null}var b=s.children;return s=s.fallback,u?(Za(),u=t.mode,b=Ol({mode:"hidden",children:b},u),s=Ss(s,u,a,null),b.return=t,s.return=t,b.sibling=s,t.child=b,s=t.child,s.memoizedState=Oc(a),s.childLanes=Rc(e,v,a),t.memoizedState=kc,_r(null,s)):(Xa(t),qc(t,b))}var z=e.memoizedState;if(z!==null&&(b=z.dehydrated,b!==null)){if(h)t.flags&256?(Xa(t),t.flags&=-257,t=Dc(e,t,a)):t.memoizedState!==null?(Za(),t.child=e.child,t.flags|=128,t=null):(Za(),b=s.fallback,u=t.mode,s=Ol({mode:"visible",children:s.children},u),b=Ss(b,u,a,null),b.flags|=2,s.return=t,b.return=t,s.sibling=b,t.child=s,ks(t,e.child,null,a),s=t.child,s.memoizedState=Oc(a),s.childLanes=Rc(e,v,a),t.memoizedState=kc,t=_r(null,s));else if(Xa(t),mu(b)){if(v=b.nextSibling&&b.nextSibling.dataset,v)var W=v.dgst;v=W,s=Error(l(419)),s.stack="",s.digest=v,rr({value:s,source:null,stack:null}),t=Dc(e,t,a)}else if(Jt||si(e,t,a,!1),v=(a&e.childLanes)!==0,Jt||v){if(v=Ct,v!==null&&(s=nn(v,a),s!==0&&s!==z.retryLane))throw z.retryLane=s,js(e,s),qn(v,e,s),Tc;fu(b)||Pl(),t=Dc(e,t,a)}else fu(b)?(t.flags|=192,t.child=e.child,t=null):(e=z.treeContext,Ot=Zn(b.nextSibling),pn=t,ct=!0,Va=null,Jn=!1,e!==null&&Yd(t,e),t=qc(t,s.children),t.flags|=4096);return t}return u?(Za(),b=s.fallback,u=t.mode,z=e.child,W=z.sibling,s=ba(z,{mode:"hidden",children:s.children}),s.subtreeFlags=z.subtreeFlags&65011712,W!==null?b=ba(W,b):(b=Ss(b,u,a,null),b.flags|=2),b.return=t,s.return=t,s.sibling=b,t.child=s,_r(null,s),s=t.child,b=e.child.memoizedState,b===null?b=Oc(a):(u=b.cachePool,u!==null?(z=Qt._currentValue,u=u.parent!==z?{parent:z,pool:z}:u):u=Wd(),b={baseLanes:b.baseLanes|a,cachePool:u}),s.memoizedState=b,s.childLanes=Rc(e,v,a),t.memoizedState=kc,_r(e.child,s)):(Xa(t),a=e.child,e=a.sibling,a=ba(a,{mode:"visible",children:s.children}),a.return=t,a.sibling=null,e!==null&&(v=t.deletions,v===null?(t.deletions=[e],t.flags|=16):v.push(e)),t.child=a,t.memoizedState=null,a)}function qc(e,t){return t=Ol({mode:"visible",children:t},e.mode),t.return=e,e.child=t}function Ol(e,t){return e=zn(22,e,null,t),e.lanes=0,e}function Dc(e,t,a){return ks(t,e.child,null,a),e=qc(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function ff(e,t,a){e.lanes|=t;var s=e.alternate;s!==null&&(s.lanes|=t),Ko(e.return,t,a)}function Mc(e,t,a,s,u,h){var v=e.memoizedState;v===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:s,tail:a,tailMode:u,treeForkCount:h}:(v.isBackwards=t,v.rendering=null,v.renderingStartTime=0,v.last=s,v.tail=a,v.tailMode=u,v.treeForkCount=h)}function mf(e,t,a){var s=t.pendingProps,u=s.revealOrder,h=s.tail;s=s.children;var v=$t.current,b=(v&2)!==0;if(b?(v=v&1|2,t.flags|=128):v&=1,fe($t,v),vn(e,t,s,a),s=ct?ir:0,!b&&e!==null&&(e.flags&128)!==0)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&ff(e,a,t);else if(e.tag===19)ff(e,a,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}switch(u){case"forwards":for(a=t.child,u=null;a!==null;)e=a.alternate,e!==null&&yl(e)===null&&(u=a),a=a.sibling;a=u,a===null?(u=t.child,t.child=null):(u=a.sibling,a.sibling=null),Mc(t,!1,u,a,h,s);break;case"backwards":case"unstable_legacy-backwards":for(a=null,u=t.child,t.child=null;u!==null;){if(e=u.alternate,e!==null&&yl(e)===null){t.child=u;break}e=u.sibling,u.sibling=a,a=u,u=e}Mc(t,!0,a,null,h,s);break;case"together":Mc(t,!1,null,null,void 0,s);break;default:t.memoizedState=null}return t.child}function Ea(e,t,a){if(e!==null&&(t.dependencies=e.dependencies),ts|=t.lanes,(a&t.childLanes)===0)if(e!==null){if(si(e,t,a,!1),(a&t.childLanes)===0)return null}else return null;if(e!==null&&t.child!==e.child)throw Error(l(153));if(t.child!==null){for(e=t.child,a=ba(e,e.pendingProps),t.child=a,a.return=t;e.sibling!==null;)e=e.sibling,a=a.sibling=ba(e,e.pendingProps),a.return=t;a.sibling=null}return t.child}function zc(e,t){return(e.lanes&t)!==0?!0:(e=e.dependencies,!!(e!==null&&dl(e)))}function Nv(e,t,a){switch(t.tag){case 3:we(t,t.stateNode.containerInfo),Ya(t,Qt,e.memoizedState.cache),ws();break;case 27:case 5:nt(t);break;case 4:we(t,t.stateNode.containerInfo);break;case 10:Ya(t,t.type,t.memoizedProps.value);break;case 31:if(t.memoizedState!==null)return t.flags|=128,lc(t),null;break;case 13:var s=t.memoizedState;if(s!==null)return s.dehydrated!==null?(Xa(t),t.flags|=128,null):(a&t.child.childLanes)!==0?hf(e,t,a):(Xa(t),e=Ea(e,t,a),e!==null?e.sibling:null);Xa(t);break;case 19:var u=(e.flags&128)!==0;if(s=(a&t.childLanes)!==0,s||(si(e,t,a,!1),s=(a&t.childLanes)!==0),u){if(s)return mf(e,t,a);t.flags|=128}if(u=t.memoizedState,u!==null&&(u.rendering=null,u.tail=null,u.lastEffect=null),fe($t,$t.current),s)break;return null;case 22:return t.lanes=0,rf(e,t,a,t.pendingProps);case 24:Ya(t,Qt,e.memoizedState.cache)}return Ea(e,t,a)}function pf(e,t,a){if(e!==null)if(e.memoizedProps!==t.pendingProps)Jt=!0;else{if(!zc(e,a)&&(t.flags&128)===0)return Jt=!1,Nv(e,t,a);Jt=(e.flags&131072)!==0}else Jt=!1,ct&&(t.flags&1048576)!==0&&Gd(t,ir,t.index);switch(t.lanes=0,t.tag){case 16:e:{var s=t.pendingProps;if(e=Ts(t.elementType),t.type=e,typeof e=="function")Fo(e)?(s=Rs(e,s),t.tag=1,t=uf(null,t,e,s,a)):(t.tag=0,t=Ac(null,t,e,s,a));else{if(e!=null){var u=e.$$typeof;if(u===O){t.tag=11,t=nf(null,t,e,s,a);break e}else if(u===q){t.tag=14,t=af(null,t,e,s,a);break e}}throw t=ue(e)||e,Error(l(306,t,""))}}return t;case 0:return Ac(e,t,t.type,t.pendingProps,a);case 1:return s=t.type,u=Rs(s,t.pendingProps),uf(e,t,s,u,a);case 3:e:{if(we(t,t.stateNode.containerInfo),e===null)throw Error(l(387));s=t.pendingProps;var h=t.memoizedState;u=h.element,nc(e,t),fr(t,s,null,a);var v=t.memoizedState;if(s=v.cache,Ya(t,Qt,s),s!==h.cache&&Jo(t,[Qt],a,!0),hr(),s=v.element,h.isDehydrated)if(h={element:s,isDehydrated:!1,cache:v.cache},t.updateQueue.baseState=h,t.memoizedState=h,t.flags&256){t=df(e,t,s,a);break e}else if(s!==u){u=Yn(Error(l(424)),t),rr(u),t=df(e,t,s,a);break e}else{switch(e=t.stateNode.containerInfo,e.nodeType){case 9:e=e.body;break;default:e=e.nodeName==="HTML"?e.ownerDocument.body:e}for(Ot=Zn(e.firstChild),pn=t,ct=!0,Va=null,Jn=!0,a=ih(t,null,s,a),t.child=a;a;)a.flags=a.flags&-3|4096,a=a.sibling}else{if(ws(),s===u){t=Ea(e,t,a);break e}vn(e,t,s,a)}t=t.child}return t;case 26:return kl(e,t),e===null?(a=Cm(t.type,null,t.pendingProps,null))?t.memoizedState=a:ct||(a=t.type,e=t.pendingProps,s=Yl(D.current).createElement(a),s[wt]=t,s[Yt]=e,_n(s,a,e),Qe(s),t.stateNode=s):t.memoizedState=Cm(t.type,e.memoizedProps,t.pendingProps,e.memoizedState),null;case 27:return nt(t),e===null&&ct&&(s=t.stateNode=Sm(t.type,t.pendingProps,D.current),pn=t,Jn=!0,u=Ot,rs(t.type)?(pu=u,Ot=Zn(s.firstChild)):Ot=u),vn(e,t,t.pendingProps.children,a),kl(e,t),e===null&&(t.flags|=4194304),t.child;case 5:return e===null&&ct&&((u=s=Ot)&&(s=t_(s,t.type,t.pendingProps,Jn),s!==null?(t.stateNode=s,pn=t,Ot=Zn(s.firstChild),Jn=!1,u=!0):u=!1),u||Ga(t)),nt(t),u=t.type,h=t.pendingProps,v=e!==null?e.memoizedProps:null,s=h.children,uu(u,h)?s=null:v!==null&&uu(u,v)&&(t.flags|=32),t.memoizedState!==null&&(u=cc(e,t,gv,null,null,a),qr._currentValue=u),kl(e,t),vn(e,t,s,a),t.child;case 6:return e===null&&ct&&((e=a=Ot)&&(a=n_(a,t.pendingProps,Jn),a!==null?(t.stateNode=a,pn=t,Ot=null,e=!0):e=!1),e||Ga(t)),null;case 13:return hf(e,t,a);case 4:return we(t,t.stateNode.containerInfo),s=t.pendingProps,e===null?t.child=ks(t,null,s,a):vn(e,t,s,a),t.child;case 11:return nf(e,t,t.type,t.pendingProps,a);case 7:return vn(e,t,t.pendingProps,a),t.child;case 8:return vn(e,t,t.pendingProps.children,a),t.child;case 12:return vn(e,t,t.pendingProps.children,a),t.child;case 10:return s=t.pendingProps,Ya(t,t.type,s.value),vn(e,t,s.children,a),t.child;case 9:return u=t.type._context,s=t.pendingProps.children,Cs(t),u=gn(u),s=s(u),t.flags|=1,vn(e,t,s,a),t.child;case 14:return af(e,t,t.type,t.pendingProps,a);case 15:return sf(e,t,t.type,t.pendingProps,a);case 19:return mf(e,t,a);case 31:return wv(e,t,a);case 22:return rf(e,t,a,t.pendingProps);case 24:return Cs(t),s=gn(Qt),e===null?(u=Wo(),u===null&&(u=Ct,h=Xo(),u.pooledCache=h,h.refCount++,h!==null&&(u.pooledCacheLanes|=a),u=h),t.memoizedState={parent:s,cache:u},tc(t),Ya(t,Qt,u)):((e.lanes&a)!==0&&(nc(e,t),fr(t,null,null,a),hr()),u=e.memoizedState,h=t.memoizedState,u.parent!==s?(u={parent:s,cache:s},t.memoizedState=u,t.lanes===0&&(t.memoizedState=t.updateQueue.baseState=u),Ya(t,Qt,s)):(s=h.cache,Ya(t,Qt,s),s!==u.cache&&Jo(t,[Qt],a,!0))),vn(e,t,t.pendingProps.children,a),t.child;case 29:throw t.pendingProps}throw Error(l(156,t.tag))}function Ta(e){e.flags|=4}function Lc(e,t,a,s,u){if((t=(e.mode&32)!==0)&&(t=!1),t){if(e.flags|=16777216,(u&335544128)===u)if(e.stateNode.complete)e.flags|=8192;else if(Hf())e.flags|=8192;else throw As=pl,ec}else e.flags&=-16777217}function gf(e,t){if(t.type!=="stylesheet"||(t.state.loading&4)!==0)e.flags&=-16777217;else if(e.flags|=16777216,!Om(t))if(Hf())e.flags|=8192;else throw As=pl,ec}function Rl(e,t){t!==null&&(e.flags|=4),e.flags&16384&&(t=e.tag!==22?gs():536870912,e.lanes|=t,gi|=t)}function yr(e,t){if(!ct)switch(e.tailMode){case"hidden":t=e.tail;for(var a=null;t!==null;)t.alternate!==null&&(a=t),t=t.sibling;a===null?e.tail=null:a.sibling=null;break;case"collapsed":a=e.tail;for(var s=null;a!==null;)a.alternate!==null&&(s=a),a=a.sibling;s===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:s.sibling=null}}function Rt(e){var t=e.alternate!==null&&e.alternate.child===e.child,a=0,s=0;if(t)for(var u=e.child;u!==null;)a|=u.lanes|u.childLanes,s|=u.subtreeFlags&65011712,s|=u.flags&65011712,u.return=e,u=u.sibling;else for(u=e.child;u!==null;)a|=u.lanes|u.childLanes,s|=u.subtreeFlags,s|=u.flags,u.return=e,u=u.sibling;return e.subtreeFlags|=s,e.childLanes=a,t}function Cv(e,t,a){var s=t.pendingProps;switch(Vo(t),t.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Rt(t),null;case 1:return Rt(t),null;case 3:return a=t.stateNode,s=null,e!==null&&(s=e.memoizedState.cache),t.memoizedState.cache!==s&&(t.flags|=2048),wa(Qt),Ne(),a.pendingContext&&(a.context=a.pendingContext,a.pendingContext=null),(e===null||e.child===null)&&(ai(t)?Ta(t):e===null||e.memoizedState.isDehydrated&&(t.flags&256)===0||(t.flags|=1024,Yo())),Rt(t),null;case 26:var u=t.type,h=t.memoizedState;return e===null?(Ta(t),h!==null?(Rt(t),gf(t,h)):(Rt(t),Lc(t,u,null,s,a))):h?h!==e.memoizedState?(Ta(t),Rt(t),gf(t,h)):(Rt(t),t.flags&=-16777217):(e=e.memoizedProps,e!==s&&Ta(t),Rt(t),Lc(t,u,e,s,a)),null;case 27:if(Le(t),a=D.current,u=t.type,e!==null&&t.stateNode!=null)e.memoizedProps!==s&&Ta(t);else{if(!s){if(t.stateNode===null)throw Error(l(166));return Rt(t),null}e=be.current,ai(t)?Qd(t):(e=Sm(u,s,a),t.stateNode=e,Ta(t))}return Rt(t),null;case 5:if(Le(t),u=t.type,e!==null&&t.stateNode!=null)e.memoizedProps!==s&&Ta(t);else{if(!s){if(t.stateNode===null)throw Error(l(166));return Rt(t),null}if(h=be.current,ai(t))Qd(t);else{var v=Yl(D.current);switch(h){case 1:h=v.createElementNS("http://www.w3.org/2000/svg",u);break;case 2:h=v.createElementNS("http://www.w3.org/1998/Math/MathML",u);break;default:switch(u){case"svg":h=v.createElementNS("http://www.w3.org/2000/svg",u);break;case"math":h=v.createElementNS("http://www.w3.org/1998/Math/MathML",u);break;case"script":h=v.createElement("div"),h.innerHTML="<script><\/script>",h=h.removeChild(h.firstChild);break;case"select":h=typeof s.is=="string"?v.createElement("select",{is:s.is}):v.createElement("select"),s.multiple?h.multiple=!0:s.size&&(h.size=s.size);break;default:h=typeof s.is=="string"?v.createElement(u,{is:s.is}):v.createElement(u)}}h[wt]=t,h[Yt]=s;e:for(v=t.child;v!==null;){if(v.tag===5||v.tag===6)h.appendChild(v.stateNode);else if(v.tag!==4&&v.tag!==27&&v.child!==null){v.child.return=v,v=v.child;continue}if(v===t)break e;for(;v.sibling===null;){if(v.return===null||v.return===t)break e;v=v.return}v.sibling.return=v.return,v=v.sibling}t.stateNode=h;e:switch(_n(h,u,s),u){case"button":case"input":case"select":case"textarea":s=!!s.autoFocus;break e;case"img":s=!0;break e;default:s=!1}s&&Ta(t)}}return Rt(t),Lc(t,t.type,e===null?null:e.memoizedProps,t.pendingProps,a),null;case 6:if(e&&t.stateNode!=null)e.memoizedProps!==s&&Ta(t);else{if(typeof s!="string"&&t.stateNode===null)throw Error(l(166));if(e=D.current,ai(t)){if(e=t.stateNode,a=t.memoizedProps,s=null,u=pn,u!==null)switch(u.tag){case 27:case 5:s=u.memoizedProps}e[wt]=t,e=!!(e.nodeValue===a||s!==null&&s.suppressHydrationWarning===!0||hm(e.nodeValue,a)),e||Ga(t,!0)}else e=Yl(e).createTextNode(s),e[wt]=t,t.stateNode=e}return Rt(t),null;case 31:if(a=t.memoizedState,e===null||e.memoizedState!==null){if(s=ai(t),a!==null){if(e===null){if(!s)throw Error(l(318));if(e=t.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(l(557));e[wt]=t}else ws(),(t.flags&128)===0&&(t.memoizedState=null),t.flags|=4;Rt(t),e=!1}else a=Yo(),e!==null&&e.memoizedState!==null&&(e.memoizedState.hydrationErrors=a),e=!0;if(!e)return t.flags&256?(Un(t),t):(Un(t),null);if((t.flags&128)!==0)throw Error(l(558))}return Rt(t),null;case 13:if(s=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(u=ai(t),s!==null&&s.dehydrated!==null){if(e===null){if(!u)throw Error(l(318));if(u=t.memoizedState,u=u!==null?u.dehydrated:null,!u)throw Error(l(317));u[wt]=t}else ws(),(t.flags&128)===0&&(t.memoizedState=null),t.flags|=4;Rt(t),u=!1}else u=Yo(),e!==null&&e.memoizedState!==null&&(e.memoizedState.hydrationErrors=u),u=!0;if(!u)return t.flags&256?(Un(t),t):(Un(t),null)}return Un(t),(t.flags&128)!==0?(t.lanes=a,t):(a=s!==null,e=e!==null&&e.memoizedState!==null,a&&(s=t.child,u=null,s.alternate!==null&&s.alternate.memoizedState!==null&&s.alternate.memoizedState.cachePool!==null&&(u=s.alternate.memoizedState.cachePool.pool),h=null,s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(h=s.memoizedState.cachePool.pool),h!==u&&(s.flags|=2048)),a!==e&&a&&(t.child.flags|=8192),Rl(t,t.updateQueue),Rt(t),null);case 4:return Ne(),e===null&&iu(t.stateNode.containerInfo),Rt(t),null;case 10:return wa(t.type),Rt(t),null;case 19:if(X($t),s=t.memoizedState,s===null)return Rt(t),null;if(u=(t.flags&128)!==0,h=s.rendering,h===null)if(u)yr(s,!1);else{if(Ft!==0||e!==null&&(e.flags&128)!==0)for(e=t.child;e!==null;){if(h=yl(e),h!==null){for(t.flags|=128,yr(s,!1),e=h.updateQueue,t.updateQueue=e,Rl(t,e),t.subtreeFlags=0,e=a,a=t.child;a!==null;)$d(a,e),a=a.sibling;return fe($t,$t.current&1|2),ct&&ja(t,s.treeForkCount),t.child}e=e.sibling}s.tail!==null&&St()>Ll&&(t.flags|=128,u=!0,yr(s,!1),t.lanes=4194304)}else{if(!u)if(e=yl(h),e!==null){if(t.flags|=128,u=!0,e=e.updateQueue,t.updateQueue=e,Rl(t,e),yr(s,!0),s.tail===null&&s.tailMode==="hidden"&&!h.alternate&&!ct)return Rt(t),null}else 2*St()-s.renderingStartTime>Ll&&a!==536870912&&(t.flags|=128,u=!0,yr(s,!1),t.lanes=4194304);s.isBackwards?(h.sibling=t.child,t.child=h):(e=s.last,e!==null?e.sibling=h:t.child=h,s.last=h)}return s.tail!==null?(e=s.tail,s.rendering=e,s.tail=e.sibling,s.renderingStartTime=St(),e.sibling=null,a=$t.current,fe($t,u?a&1|2:a&1),ct&&ja(t,s.treeForkCount),e):(Rt(t),null);case 22:case 23:return Un(t),rc(),s=t.memoizedState!==null,e!==null?e.memoizedState!==null!==s&&(t.flags|=8192):s&&(t.flags|=8192),s?(a&536870912)!==0&&(t.flags&128)===0&&(Rt(t),t.subtreeFlags&6&&(t.flags|=8192)):Rt(t),a=t.updateQueue,a!==null&&Rl(t,a.retryQueue),a=null,e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(a=e.memoizedState.cachePool.pool),s=null,t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(s=t.memoizedState.cachePool.pool),s!==a&&(t.flags|=2048),e!==null&&X(Es),null;case 24:return a=null,e!==null&&(a=e.memoizedState.cache),t.memoizedState.cache!==a&&(t.flags|=2048),wa(Qt),Rt(t),null;case 25:return null;case 30:return null}throw Error(l(156,t.tag))}function Ev(e,t){switch(Vo(t),t.tag){case 1:return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return wa(Qt),Ne(),e=t.flags,(e&65536)!==0&&(e&128)===0?(t.flags=e&-65537|128,t):null;case 26:case 27:case 5:return Le(t),null;case 31:if(t.memoizedState!==null){if(Un(t),t.alternate===null)throw Error(l(340));ws()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 13:if(Un(t),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(l(340));ws()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return X($t),null;case 4:return Ne(),null;case 10:return wa(t.type),null;case 22:case 23:return Un(t),rc(),e!==null&&X(Es),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 24:return wa(Qt),null;case 25:return null;default:return null}}function vf(e,t){switch(Vo(t),t.tag){case 3:wa(Qt),Ne();break;case 26:case 27:case 5:Le(t);break;case 4:Ne();break;case 31:t.memoizedState!==null&&Un(t);break;case 13:Un(t);break;case 19:X($t);break;case 10:wa(t.type);break;case 22:case 23:Un(t),rc(),e!==null&&X(Es);break;case 24:wa(Qt)}}function xr(e,t){try{var a=t.updateQueue,s=a!==null?a.lastEffect:null;if(s!==null){var u=s.next;a=u;do{if((a.tag&e)===e){s=void 0;var h=a.create,v=a.inst;s=h(),v.destroy=s}a=a.next}while(a!==u)}}catch(b){yt(t,t.return,b)}}function Wa(e,t,a){try{var s=t.updateQueue,u=s!==null?s.lastEffect:null;if(u!==null){var h=u.next;s=h;do{if((s.tag&e)===e){var v=s.inst,b=v.destroy;if(b!==void 0){v.destroy=void 0,u=t;var z=a,W=b;try{W()}catch(oe){yt(u,z,oe)}}}s=s.next}while(s!==h)}}catch(oe){yt(t,t.return,oe)}}function _f(e){var t=e.updateQueue;if(t!==null){var a=e.stateNode;try{lh(t,a)}catch(s){yt(e,e.return,s)}}}function yf(e,t,a){a.props=Rs(e.type,e.memoizedProps),a.state=e.memoizedState;try{a.componentWillUnmount()}catch(s){yt(e,t,s)}}function br(e,t){try{var a=e.ref;if(a!==null){switch(e.tag){case 26:case 27:case 5:var s=e.stateNode;break;case 30:s=e.stateNode;break;default:s=e.stateNode}typeof a=="function"?e.refCleanup=a(s):a.current=s}}catch(u){yt(e,t,u)}}function fa(e,t){var a=e.ref,s=e.refCleanup;if(a!==null)if(typeof s=="function")try{s()}catch(u){yt(e,t,u)}finally{e.refCleanup=null,e=e.alternate,e!=null&&(e.refCleanup=null)}else if(typeof a=="function")try{a(null)}catch(u){yt(e,t,u)}else a.current=null}function xf(e){var t=e.type,a=e.memoizedProps,s=e.stateNode;try{e:switch(t){case"button":case"input":case"select":case"textarea":a.autoFocus&&s.focus();break e;case"img":a.src?s.src=a.src:a.srcSet&&(s.srcset=a.srcSet)}}catch(u){yt(e,e.return,u)}}function Uc(e,t,a){try{var s=e.stateNode;Kv(s,e.type,a,t),s[Yt]=t}catch(u){yt(e,e.return,u)}}function bf(e){return e.tag===5||e.tag===3||e.tag===26||e.tag===27&&rs(e.type)||e.tag===4}function Bc(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||bf(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.tag===27&&rs(e.type)||e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function Pc(e,t,a){var s=e.tag;if(s===5||s===6)e=e.stateNode,t?(a.nodeType===9?a.body:a.nodeName==="HTML"?a.ownerDocument.body:a).insertBefore(e,t):(t=a.nodeType===9?a.body:a.nodeName==="HTML"?a.ownerDocument.body:a,t.appendChild(e),a=a._reactRootContainer,a!=null||t.onclick!==null||(t.onclick=dn));else if(s!==4&&(s===27&&rs(e.type)&&(a=e.stateNode,t=null),e=e.child,e!==null))for(Pc(e,t,a),e=e.sibling;e!==null;)Pc(e,t,a),e=e.sibling}function ql(e,t,a){var s=e.tag;if(s===5||s===6)e=e.stateNode,t?a.insertBefore(e,t):a.appendChild(e);else if(s!==4&&(s===27&&rs(e.type)&&(a=e.stateNode),e=e.child,e!==null))for(ql(e,t,a),e=e.sibling;e!==null;)ql(e,t,a),e=e.sibling}function jf(e){var t=e.stateNode,a=e.memoizedProps;try{for(var s=e.type,u=t.attributes;u.length;)t.removeAttributeNode(u[0]);_n(t,s,a),t[wt]=e,t[Yt]=a}catch(h){yt(e,e.return,h)}}var Aa=!1,Xt=!1,Fc=!1,Sf=typeof WeakSet=="function"?WeakSet:Set,hn=null;function Tv(e,t){if(e=e.containerInfo,ou=eo,e=Dd(e),Do(e)){if("selectionStart"in e)var a={start:e.selectionStart,end:e.selectionEnd};else e:{a=(a=e.ownerDocument)&&a.defaultView||window;var s=a.getSelection&&a.getSelection();if(s&&s.rangeCount!==0){a=s.anchorNode;var u=s.anchorOffset,h=s.focusNode;s=s.focusOffset;try{a.nodeType,h.nodeType}catch{a=null;break e}var v=0,b=-1,z=-1,W=0,oe=0,me=e,te=null;t:for(;;){for(var ie;me!==a||u!==0&&me.nodeType!==3||(b=v+u),me!==h||s!==0&&me.nodeType!==3||(z=v+s),me.nodeType===3&&(v+=me.nodeValue.length),(ie=me.firstChild)!==null;)te=me,me=ie;for(;;){if(me===e)break t;if(te===a&&++W===u&&(b=v),te===h&&++oe===s&&(z=v),(ie=me.nextSibling)!==null)break;me=te,te=me.parentNode}me=ie}a=b===-1||z===-1?null:{start:b,end:z}}else a=null}a=a||{start:0,end:0}}else a=null;for(cu={focusedElem:e,selectionRange:a},eo=!1,hn=t;hn!==null;)if(t=hn,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,hn=e;else for(;hn!==null;){switch(t=hn,h=t.alternate,e=t.flags,t.tag){case 0:if((e&4)!==0&&(e=t.updateQueue,e=e!==null?e.events:null,e!==null))for(a=0;a<e.length;a++)u=e[a],u.ref.impl=u.nextImpl;break;case 11:case 15:break;case 1:if((e&1024)!==0&&h!==null){e=void 0,a=t,u=h.memoizedProps,h=h.memoizedState,s=a.stateNode;try{var ze=Rs(a.type,u);e=s.getSnapshotBeforeUpdate(ze,h),s.__reactInternalSnapshotBeforeUpdate=e}catch(Ge){yt(a,a.return,Ge)}}break;case 3:if((e&1024)!==0){if(e=t.stateNode.containerInfo,a=e.nodeType,a===9)hu(e);else if(a===1)switch(e.nodeName){case"HEAD":case"HTML":case"BODY":hu(e);break;default:e.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((e&1024)!==0)throw Error(l(163))}if(e=t.sibling,e!==null){e.return=t.return,hn=e;break}hn=t.return}}function wf(e,t,a){var s=a.flags;switch(a.tag){case 0:case 11:case 15:Oa(e,a),s&4&&xr(5,a);break;case 1:if(Oa(e,a),s&4)if(e=a.stateNode,t===null)try{e.componentDidMount()}catch(v){yt(a,a.return,v)}else{var u=Rs(a.type,t.memoizedProps);t=t.memoizedState;try{e.componentDidUpdate(u,t,e.__reactInternalSnapshotBeforeUpdate)}catch(v){yt(a,a.return,v)}}s&64&&_f(a),s&512&&br(a,a.return);break;case 3:if(Oa(e,a),s&64&&(e=a.updateQueue,e!==null)){if(t=null,a.child!==null)switch(a.child.tag){case 27:case 5:t=a.child.stateNode;break;case 1:t=a.child.stateNode}try{lh(e,t)}catch(v){yt(a,a.return,v)}}break;case 27:t===null&&s&4&&jf(a);case 26:case 5:Oa(e,a),t===null&&s&4&&xf(a),s&512&&br(a,a.return);break;case 12:Oa(e,a);break;case 31:Oa(e,a),s&4&&Ef(e,a);break;case 13:Oa(e,a),s&4&&Tf(e,a),s&64&&(e=a.memoizedState,e!==null&&(e=e.dehydrated,e!==null&&(a=Lv.bind(null,a),a_(e,a))));break;case 22:if(s=a.memoizedState!==null||Aa,!s){t=t!==null&&t.memoizedState!==null||Xt,u=Aa;var h=Xt;Aa=s,(Xt=t)&&!h?Ra(e,a,(a.subtreeFlags&8772)!==0):Oa(e,a),Aa=u,Xt=h}break;case 30:break;default:Oa(e,a)}}function Nf(e){var t=e.alternate;t!==null&&(e.alternate=null,Nf(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&ye(t)),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}var Mt=null,An=!1;function ka(e,t,a){for(a=a.child;a!==null;)Cf(e,t,a),a=a.sibling}function Cf(e,t,a){if(Te&&typeof Te.onCommitFiberUnmount=="function")try{Te.onCommitFiberUnmount(ge,a)}catch{}switch(a.tag){case 26:Xt||fa(a,t),ka(e,t,a),a.memoizedState?a.memoizedState.count--:a.stateNode&&(a=a.stateNode,a.parentNode.removeChild(a));break;case 27:Xt||fa(a,t);var s=Mt,u=An;rs(a.type)&&(Mt=a.stateNode,An=!1),ka(e,t,a),kr(a.stateNode),Mt=s,An=u;break;case 5:Xt||fa(a,t);case 6:if(s=Mt,u=An,Mt=null,ka(e,t,a),Mt=s,An=u,Mt!==null)if(An)try{(Mt.nodeType===9?Mt.body:Mt.nodeName==="HTML"?Mt.ownerDocument.body:Mt).removeChild(a.stateNode)}catch(h){yt(a,t,h)}else try{Mt.removeChild(a.stateNode)}catch(h){yt(a,t,h)}break;case 18:Mt!==null&&(An?(e=Mt,_m(e.nodeType===9?e.body:e.nodeName==="HTML"?e.ownerDocument.body:e,a.stateNode),wi(e)):_m(Mt,a.stateNode));break;case 4:s=Mt,u=An,Mt=a.stateNode.containerInfo,An=!0,ka(e,t,a),Mt=s,An=u;break;case 0:case 11:case 14:case 15:Wa(2,a,t),Xt||Wa(4,a,t),ka(e,t,a);break;case 1:Xt||(fa(a,t),s=a.stateNode,typeof s.componentWillUnmount=="function"&&yf(a,t,s)),ka(e,t,a);break;case 21:ka(e,t,a);break;case 22:Xt=(s=Xt)||a.memoizedState!==null,ka(e,t,a),Xt=s;break;default:ka(e,t,a)}}function Ef(e,t){if(t.memoizedState===null&&(e=t.alternate,e!==null&&(e=e.memoizedState,e!==null))){e=e.dehydrated;try{wi(e)}catch(a){yt(t,t.return,a)}}}function Tf(e,t){if(t.memoizedState===null&&(e=t.alternate,e!==null&&(e=e.memoizedState,e!==null&&(e=e.dehydrated,e!==null))))try{wi(e)}catch(a){yt(t,t.return,a)}}function Av(e){switch(e.tag){case 31:case 13:case 19:var t=e.stateNode;return t===null&&(t=e.stateNode=new Sf),t;case 22:return e=e.stateNode,t=e._retryCache,t===null&&(t=e._retryCache=new Sf),t;default:throw Error(l(435,e.tag))}}function Dl(e,t){var a=Av(e);t.forEach(function(s){if(!a.has(s)){a.add(s);var u=Uv.bind(null,e,s);s.then(u,u)}})}function kn(e,t){var a=t.deletions;if(a!==null)for(var s=0;s<a.length;s++){var u=a[s],h=e,v=t,b=v;e:for(;b!==null;){switch(b.tag){case 27:if(rs(b.type)){Mt=b.stateNode,An=!1;break e}break;case 5:Mt=b.stateNode,An=!1;break e;case 3:case 4:Mt=b.stateNode.containerInfo,An=!0;break e}b=b.return}if(Mt===null)throw Error(l(160));Cf(h,v,u),Mt=null,An=!1,h=u.alternate,h!==null&&(h.return=null),u.return=null}if(t.subtreeFlags&13886)for(t=t.child;t!==null;)Af(t,e),t=t.sibling}var aa=null;function Af(e,t){var a=e.alternate,s=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:kn(t,e),On(e),s&4&&(Wa(3,e,e.return),xr(3,e),Wa(5,e,e.return));break;case 1:kn(t,e),On(e),s&512&&(Xt||a===null||fa(a,a.return)),s&64&&Aa&&(e=e.updateQueue,e!==null&&(s=e.callbacks,s!==null&&(a=e.shared.hiddenCallbacks,e.shared.hiddenCallbacks=a===null?s:a.concat(s))));break;case 26:var u=aa;if(kn(t,e),On(e),s&512&&(Xt||a===null||fa(a,a.return)),s&4){var h=a!==null?a.memoizedState:null;if(s=e.memoizedState,a===null)if(s===null)if(e.stateNode===null){e:{s=e.type,a=e.memoizedProps,u=u.ownerDocument||u;t:switch(s){case"title":h=u.getElementsByTagName("title")[0],(!h||h[pe]||h[wt]||h.namespaceURI==="http://www.w3.org/2000/svg"||h.hasAttribute("itemprop"))&&(h=u.createElement(s),u.head.insertBefore(h,u.querySelector("head > title"))),_n(h,s,a),h[wt]=e,Qe(h),s=h;break e;case"link":var v=Am("link","href",u).get(s+(a.href||""));if(v){for(var b=0;b<v.length;b++)if(h=v[b],h.getAttribute("href")===(a.href==null||a.href===""?null:a.href)&&h.getAttribute("rel")===(a.rel==null?null:a.rel)&&h.getAttribute("title")===(a.title==null?null:a.title)&&h.getAttribute("crossorigin")===(a.crossOrigin==null?null:a.crossOrigin)){v.splice(b,1);break t}}h=u.createElement(s),_n(h,s,a),u.head.appendChild(h);break;case"meta":if(v=Am("meta","content",u).get(s+(a.content||""))){for(b=0;b<v.length;b++)if(h=v[b],h.getAttribute("content")===(a.content==null?null:""+a.content)&&h.getAttribute("name")===(a.name==null?null:a.name)&&h.getAttribute("property")===(a.property==null?null:a.property)&&h.getAttribute("http-equiv")===(a.httpEquiv==null?null:a.httpEquiv)&&h.getAttribute("charset")===(a.charSet==null?null:a.charSet)){v.splice(b,1);break t}}h=u.createElement(s),_n(h,s,a),u.head.appendChild(h);break;default:throw Error(l(468,s))}h[wt]=e,Qe(h),s=h}e.stateNode=s}else km(u,e.type,e.stateNode);else e.stateNode=Tm(u,s,e.memoizedProps);else h!==s?(h===null?a.stateNode!==null&&(a=a.stateNode,a.parentNode.removeChild(a)):h.count--,s===null?km(u,e.type,e.stateNode):Tm(u,s,e.memoizedProps)):s===null&&e.stateNode!==null&&Uc(e,e.memoizedProps,a.memoizedProps)}break;case 27:kn(t,e),On(e),s&512&&(Xt||a===null||fa(a,a.return)),a!==null&&s&4&&Uc(e,e.memoizedProps,a.memoizedProps);break;case 5:if(kn(t,e),On(e),s&512&&(Xt||a===null||fa(a,a.return)),e.flags&32){u=e.stateNode;try{Se(u,"")}catch(ze){yt(e,e.return,ze)}}s&4&&e.stateNode!=null&&(u=e.memoizedProps,Uc(e,u,a!==null?a.memoizedProps:u)),s&1024&&(Fc=!0);break;case 6:if(kn(t,e),On(e),s&4){if(e.stateNode===null)throw Error(l(162));s=e.memoizedProps,a=e.stateNode;try{a.nodeValue=s}catch(ze){yt(e,e.return,ze)}}break;case 3:if(Jl=null,u=aa,aa=Ql(t.containerInfo),kn(t,e),aa=u,On(e),s&4&&a!==null&&a.memoizedState.isDehydrated)try{wi(t.containerInfo)}catch(ze){yt(e,e.return,ze)}Fc&&(Fc=!1,kf(e));break;case 4:s=aa,aa=Ql(e.stateNode.containerInfo),kn(t,e),On(e),aa=s;break;case 12:kn(t,e),On(e);break;case 31:kn(t,e),On(e),s&4&&(s=e.updateQueue,s!==null&&(e.updateQueue=null,Dl(e,s)));break;case 13:kn(t,e),On(e),e.child.flags&8192&&e.memoizedState!==null!=(a!==null&&a.memoizedState!==null)&&(zl=St()),s&4&&(s=e.updateQueue,s!==null&&(e.updateQueue=null,Dl(e,s)));break;case 22:u=e.memoizedState!==null;var z=a!==null&&a.memoizedState!==null,W=Aa,oe=Xt;if(Aa=W||u,Xt=oe||z,kn(t,e),Xt=oe,Aa=W,On(e),s&8192)e:for(t=e.stateNode,t._visibility=u?t._visibility&-2:t._visibility|1,u&&(a===null||z||Aa||Xt||qs(e)),a=null,t=e;;){if(t.tag===5||t.tag===26){if(a===null){z=a=t;try{if(h=z.stateNode,u)v=h.style,typeof v.setProperty=="function"?v.setProperty("display","none","important"):v.display="none";else{b=z.stateNode;var me=z.memoizedProps.style,te=me!=null&&me.hasOwnProperty("display")?me.display:null;b.style.display=te==null||typeof te=="boolean"?"":(""+te).trim()}}catch(ze){yt(z,z.return,ze)}}}else if(t.tag===6){if(a===null){z=t;try{z.stateNode.nodeValue=u?"":z.memoizedProps}catch(ze){yt(z,z.return,ze)}}}else if(t.tag===18){if(a===null){z=t;try{var ie=z.stateNode;u?ym(ie,!0):ym(z.stateNode,!1)}catch(ze){yt(z,z.return,ze)}}}else if((t.tag!==22&&t.tag!==23||t.memoizedState===null||t===e)&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;a===t&&(a=null),t=t.return}a===t&&(a=null),t.sibling.return=t.return,t=t.sibling}s&4&&(s=e.updateQueue,s!==null&&(a=s.retryQueue,a!==null&&(s.retryQueue=null,Dl(e,a))));break;case 19:kn(t,e),On(e),s&4&&(s=e.updateQueue,s!==null&&(e.updateQueue=null,Dl(e,s)));break;case 30:break;case 21:break;default:kn(t,e),On(e)}}function On(e){var t=e.flags;if(t&2){try{for(var a,s=e.return;s!==null;){if(bf(s)){a=s;break}s=s.return}if(a==null)throw Error(l(160));switch(a.tag){case 27:var u=a.stateNode,h=Bc(e);ql(e,h,u);break;case 5:var v=a.stateNode;a.flags&32&&(Se(v,""),a.flags&=-33);var b=Bc(e);ql(e,b,v);break;case 3:case 4:var z=a.stateNode.containerInfo,W=Bc(e);Pc(e,W,z);break;default:throw Error(l(161))}}catch(oe){yt(e,e.return,oe)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function kf(e){if(e.subtreeFlags&1024)for(e=e.child;e!==null;){var t=e;kf(t),t.tag===5&&t.flags&1024&&t.stateNode.reset(),e=e.sibling}}function Oa(e,t){if(t.subtreeFlags&8772)for(t=t.child;t!==null;)wf(e,t.alternate,t),t=t.sibling}function qs(e){for(e=e.child;e!==null;){var t=e;switch(t.tag){case 0:case 11:case 14:case 15:Wa(4,t,t.return),qs(t);break;case 1:fa(t,t.return);var a=t.stateNode;typeof a.componentWillUnmount=="function"&&yf(t,t.return,a),qs(t);break;case 27:kr(t.stateNode);case 26:case 5:fa(t,t.return),qs(t);break;case 22:t.memoizedState===null&&qs(t);break;case 30:qs(t);break;default:qs(t)}e=e.sibling}}function Ra(e,t,a){for(a=a&&(t.subtreeFlags&8772)!==0,t=t.child;t!==null;){var s=t.alternate,u=e,h=t,v=h.flags;switch(h.tag){case 0:case 11:case 15:Ra(u,h,a),xr(4,h);break;case 1:if(Ra(u,h,a),s=h,u=s.stateNode,typeof u.componentDidMount=="function")try{u.componentDidMount()}catch(W){yt(s,s.return,W)}if(s=h,u=s.updateQueue,u!==null){var b=s.stateNode;try{var z=u.shared.hiddenCallbacks;if(z!==null)for(u.shared.hiddenCallbacks=null,u=0;u<z.length;u++)rh(z[u],b)}catch(W){yt(s,s.return,W)}}a&&v&64&&_f(h),br(h,h.return);break;case 27:jf(h);case 26:case 5:Ra(u,h,a),a&&s===null&&v&4&&xf(h),br(h,h.return);break;case 12:Ra(u,h,a);break;case 31:Ra(u,h,a),a&&v&4&&Ef(u,h);break;case 13:Ra(u,h,a),a&&v&4&&Tf(u,h);break;case 22:h.memoizedState===null&&Ra(u,h,a),br(h,h.return);break;case 30:break;default:Ra(u,h,a)}t=t.sibling}}function Hc(e,t){var a=null;e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(a=e.memoizedState.cachePool.pool),e=null,t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(e=t.memoizedState.cachePool.pool),e!==a&&(e!=null&&e.refCount++,a!=null&&lr(a))}function $c(e,t){e=null,t.alternate!==null&&(e=t.alternate.memoizedState.cache),t=t.memoizedState.cache,t!==e&&(t.refCount++,e!=null&&lr(e))}function sa(e,t,a,s){if(t.subtreeFlags&10256)for(t=t.child;t!==null;)Of(e,t,a,s),t=t.sibling}function Of(e,t,a,s){var u=t.flags;switch(t.tag){case 0:case 11:case 15:sa(e,t,a,s),u&2048&&xr(9,t);break;case 1:sa(e,t,a,s);break;case 3:sa(e,t,a,s),u&2048&&(e=null,t.alternate!==null&&(e=t.alternate.memoizedState.cache),t=t.memoizedState.cache,t!==e&&(t.refCount++,e!=null&&lr(e)));break;case 12:if(u&2048){sa(e,t,a,s),e=t.stateNode;try{var h=t.memoizedProps,v=h.id,b=h.onPostCommit;typeof b=="function"&&b(v,t.alternate===null?"mount":"update",e.passiveEffectDuration,-0)}catch(z){yt(t,t.return,z)}}else sa(e,t,a,s);break;case 31:sa(e,t,a,s);break;case 13:sa(e,t,a,s);break;case 23:break;case 22:h=t.stateNode,v=t.alternate,t.memoizedState!==null?h._visibility&2?sa(e,t,a,s):jr(e,t):h._visibility&2?sa(e,t,a,s):(h._visibility|=2,fi(e,t,a,s,(t.subtreeFlags&10256)!==0||!1)),u&2048&&Hc(v,t);break;case 24:sa(e,t,a,s),u&2048&&$c(t.alternate,t);break;default:sa(e,t,a,s)}}function fi(e,t,a,s,u){for(u=u&&((t.subtreeFlags&10256)!==0||!1),t=t.child;t!==null;){var h=e,v=t,b=a,z=s,W=v.flags;switch(v.tag){case 0:case 11:case 15:fi(h,v,b,z,u),xr(8,v);break;case 23:break;case 22:var oe=v.stateNode;v.memoizedState!==null?oe._visibility&2?fi(h,v,b,z,u):jr(h,v):(oe._visibility|=2,fi(h,v,b,z,u)),u&&W&2048&&Hc(v.alternate,v);break;case 24:fi(h,v,b,z,u),u&&W&2048&&$c(v.alternate,v);break;default:fi(h,v,b,z,u)}t=t.sibling}}function jr(e,t){if(t.subtreeFlags&10256)for(t=t.child;t!==null;){var a=e,s=t,u=s.flags;switch(s.tag){case 22:jr(a,s),u&2048&&Hc(s.alternate,s);break;case 24:jr(a,s),u&2048&&$c(s.alternate,s);break;default:jr(a,s)}t=t.sibling}}var Sr=8192;function mi(e,t,a){if(e.subtreeFlags&Sr)for(e=e.child;e!==null;)Rf(e,t,a),e=e.sibling}function Rf(e,t,a){switch(e.tag){case 26:mi(e,t,a),e.flags&Sr&&e.memoizedState!==null&&p_(a,aa,e.memoizedState,e.memoizedProps);break;case 5:mi(e,t,a);break;case 3:case 4:var s=aa;aa=Ql(e.stateNode.containerInfo),mi(e,t,a),aa=s;break;case 22:e.memoizedState===null&&(s=e.alternate,s!==null&&s.memoizedState!==null?(s=Sr,Sr=16777216,mi(e,t,a),Sr=s):mi(e,t,a));break;default:mi(e,t,a)}}function qf(e){var t=e.alternate;if(t!==null&&(e=t.child,e!==null)){t.child=null;do t=e.sibling,e.sibling=null,e=t;while(e!==null)}}function wr(e){var t=e.deletions;if((e.flags&16)!==0){if(t!==null)for(var a=0;a<t.length;a++){var s=t[a];hn=s,Mf(s,e)}qf(e)}if(e.subtreeFlags&10256)for(e=e.child;e!==null;)Df(e),e=e.sibling}function Df(e){switch(e.tag){case 0:case 11:case 15:wr(e),e.flags&2048&&Wa(9,e,e.return);break;case 3:wr(e);break;case 12:wr(e);break;case 22:var t=e.stateNode;e.memoizedState!==null&&t._visibility&2&&(e.return===null||e.return.tag!==13)?(t._visibility&=-3,Ml(e)):wr(e);break;default:wr(e)}}function Ml(e){var t=e.deletions;if((e.flags&16)!==0){if(t!==null)for(var a=0;a<t.length;a++){var s=t[a];hn=s,Mf(s,e)}qf(e)}for(e=e.child;e!==null;){switch(t=e,t.tag){case 0:case 11:case 15:Wa(8,t,t.return),Ml(t);break;case 22:a=t.stateNode,a._visibility&2&&(a._visibility&=-3,Ml(t));break;default:Ml(t)}e=e.sibling}}function Mf(e,t){for(;hn!==null;){var a=hn;switch(a.tag){case 0:case 11:case 15:Wa(8,a,t);break;case 23:case 22:if(a.memoizedState!==null&&a.memoizedState.cachePool!==null){var s=a.memoizedState.cachePool.pool;s!=null&&s.refCount++}break;case 24:lr(a.memoizedState.cache)}if(s=a.child,s!==null)s.return=a,hn=s;else e:for(a=e;hn!==null;){s=hn;var u=s.sibling,h=s.return;if(Nf(s),s===a){hn=null;break e}if(u!==null){u.return=h,hn=u;break e}hn=h}}}var kv={getCacheForType:function(e){var t=gn(Qt),a=t.data.get(e);return a===void 0&&(a=e(),t.data.set(e,a)),a},cacheSignal:function(){return gn(Qt).controller.signal}},Ov=typeof WeakMap=="function"?WeakMap:Map,vt=0,Ct=null,at=null,it=0,_t=0,Bn=null,es=!1,pi=!1,Ic=!1,qa=0,Ft=0,ts=0,Ds=0,Vc=0,Pn=0,gi=0,Nr=null,Rn=null,Gc=!1,zl=0,zf=0,Ll=1/0,Ul=null,ns=null,sn=0,as=null,vi=null,Da=0,Yc=0,Qc=null,Lf=null,Cr=0,Kc=null;function Fn(){return(vt&2)!==0&&it!==0?it&-it:F.T!==null?tu():Is()}function Uf(){if(Pn===0)if((it&536870912)===0||ct){var e=Et;Et<<=1,(Et&3932160)===0&&(Et=262144),Pn=e}else Pn=536870912;return e=Ln.current,e!==null&&(e.flags|=32),Pn}function qn(e,t,a){(e===Ct&&(_t===2||_t===9)||e.cancelPendingCommit!==null)&&(_i(e,0),ss(e,it,Pn,!1)),ca(e,a),((vt&2)===0||e!==Ct)&&(e===Ct&&((vt&2)===0&&(Ds|=a),Ft===4&&ss(e,it,Pn,!1)),ma(e))}function Bf(e,t,a){if((vt&6)!==0)throw Error(l(327));var s=!a&&(t&127)===0&&(t&e.expiredLanes)===0||jn(e,t),u=s?Dv(e,t):Xc(e,t,!0),h=s;do{if(u===0){pi&&!s&&ss(e,t,0,!1);break}else{if(a=e.current.alternate,h&&!Rv(a)){u=Xc(e,t,!1),h=!1;continue}if(u===2){if(h=t,e.errorRecoveryDisabledLanes&h)var v=0;else v=e.pendingLanes&-536870913,v=v!==0?v:v&536870912?536870912:0;if(v!==0){t=v;e:{var b=e;u=Nr;var z=b.current.memoizedState.isDehydrated;if(z&&(_i(b,v).flags|=256),v=Xc(b,v,!1),v!==2){if(Ic&&!z){b.errorRecoveryDisabledLanes|=h,Ds|=h,u=4;break e}h=Rn,Rn=u,h!==null&&(Rn===null?Rn=h:Rn.push.apply(Rn,h))}u=v}if(h=!1,u!==2)continue}}if(u===1){_i(e,0),ss(e,t,0,!0);break}e:{switch(s=e,h=u,h){case 0:case 1:throw Error(l(345));case 4:if((t&4194048)!==t)break;case 6:ss(s,t,Pn,!es);break e;case 2:Rn=null;break;case 3:case 5:break;default:throw Error(l(329))}if((t&62914560)===t&&(u=zl+300-St(),10<u)){if(ss(s,t,Pn,!es),Gt(s,0,!0)!==0)break e;Da=t,s.timeoutHandle=gm(Pf.bind(null,s,a,Rn,Ul,Gc,t,Pn,Ds,gi,es,h,"Throttled",-0,0),u);break e}Pf(s,a,Rn,Ul,Gc,t,Pn,Ds,gi,es,h,null,-0,0)}}break}while(!0);ma(e)}function Pf(e,t,a,s,u,h,v,b,z,W,oe,me,te,ie){if(e.timeoutHandle=-1,me=t.subtreeFlags,me&8192||(me&16785408)===16785408){me={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:dn},Rf(t,h,me);var ze=(h&62914560)===h?zl-St():(h&4194048)===h?zf-St():0;if(ze=g_(me,ze),ze!==null){Da=h,e.cancelPendingCommit=ze(Qf.bind(null,e,t,h,a,s,u,v,b,z,oe,me,null,te,ie)),ss(e,h,v,!W);return}}Qf(e,t,h,a,s,u,v,b,z)}function Rv(e){for(var t=e;;){var a=t.tag;if((a===0||a===11||a===15)&&t.flags&16384&&(a=t.updateQueue,a!==null&&(a=a.stores,a!==null)))for(var s=0;s<a.length;s++){var u=a[s],h=u.getSnapshot;u=u.value;try{if(!Mn(h(),u))return!1}catch{return!1}}if(a=t.child,t.subtreeFlags&16384&&a!==null)a.return=t,t=a;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function ss(e,t,a,s){t&=~Vc,t&=~Ds,e.suspendedLanes|=t,e.pingedLanes&=~t,s&&(e.warmLanes|=t),s=e.expirationTimes;for(var u=t;0<u;){var h=31-Pe(u),v=1<<h;s[h]=-1,u&=~v}a!==0&&ea(e,a,t)}function Bl(){return(vt&6)===0?(Er(0),!1):!0}function Jc(){if(at!==null){if(_t===0)var e=at.return;else e=at,Sa=Ns=null,hc(e),oi=null,cr=0,e=at;for(;e!==null;)vf(e.alternate,e),e=e.return;at=null}}function _i(e,t){var a=e.timeoutHandle;a!==-1&&(e.timeoutHandle=-1,Zv(a)),a=e.cancelPendingCommit,a!==null&&(e.cancelPendingCommit=null,a()),Da=0,Jc(),Ct=e,at=a=ba(e.current,null),it=t,_t=0,Bn=null,es=!1,pi=jn(e,t),Ic=!1,gi=Pn=Vc=Ds=ts=Ft=0,Rn=Nr=null,Gc=!1,(t&8)!==0&&(t|=t&32);var s=e.entangledLanes;if(s!==0)for(e=e.entanglements,s&=t;0<s;){var u=31-Pe(s),h=1<<u;t|=e[u],s&=~h}return qa=t,rl(),a}function Ff(e,t){Xe=null,F.H=vr,t===li||t===ml?(t=nh(),_t=3):t===ec?(t=nh(),_t=4):_t=t===Tc?8:t!==null&&typeof t=="object"&&typeof t.then=="function"?6:1,Bn=t,at===null&&(Ft=1,Tl(e,Yn(t,e.current)))}function Hf(){var e=Ln.current;return e===null?!0:(it&4194048)===it?Xn===null:(it&62914560)===it||(it&536870912)!==0?e===Xn:!1}function $f(){var e=F.H;return F.H=vr,e===null?vr:e}function If(){var e=F.A;return F.A=kv,e}function Pl(){Ft=4,es||(it&4194048)!==it&&Ln.current!==null||(pi=!0),(ts&134217727)===0&&(Ds&134217727)===0||Ct===null||ss(Ct,it,Pn,!1)}function Xc(e,t,a){var s=vt;vt|=2;var u=$f(),h=If();(Ct!==e||it!==t)&&(Ul=null,_i(e,t)),t=!1;var v=Ft;e:do try{if(_t!==0&&at!==null){var b=at,z=Bn;switch(_t){case 8:Jc(),v=6;break e;case 3:case 2:case 9:case 6:Ln.current===null&&(t=!0);var W=_t;if(_t=0,Bn=null,yi(e,b,z,W),a&&pi){v=0;break e}break;default:W=_t,_t=0,Bn=null,yi(e,b,z,W)}}qv(),v=Ft;break}catch(oe){Ff(e,oe)}while(!0);return t&&e.shellSuspendCounter++,Sa=Ns=null,vt=s,F.H=u,F.A=h,at===null&&(Ct=null,it=0,rl()),v}function qv(){for(;at!==null;)Vf(at)}function Dv(e,t){var a=vt;vt|=2;var s=$f(),u=If();Ct!==e||it!==t?(Ul=null,Ll=St()+500,_i(e,t)):pi=jn(e,t);e:do try{if(_t!==0&&at!==null){t=at;var h=Bn;t:switch(_t){case 1:_t=0,Bn=null,yi(e,t,h,1);break;case 2:case 9:if(eh(h)){_t=0,Bn=null,Gf(t);break}t=function(){_t!==2&&_t!==9||Ct!==e||(_t=7),ma(e)},h.then(t,t);break e;case 3:_t=7;break e;case 4:_t=5;break e;case 7:eh(h)?(_t=0,Bn=null,Gf(t)):(_t=0,Bn=null,yi(e,t,h,7));break;case 5:var v=null;switch(at.tag){case 26:v=at.memoizedState;case 5:case 27:var b=at;if(v?Om(v):b.stateNode.complete){_t=0,Bn=null;var z=b.sibling;if(z!==null)at=z;else{var W=b.return;W!==null?(at=W,Fl(W)):at=null}break t}}_t=0,Bn=null,yi(e,t,h,5);break;case 6:_t=0,Bn=null,yi(e,t,h,6);break;case 8:Jc(),Ft=6;break e;default:throw Error(l(462))}}Mv();break}catch(oe){Ff(e,oe)}while(!0);return Sa=Ns=null,F.H=s,F.A=u,vt=a,at!==null?0:(Ct=null,it=0,rl(),Ft)}function Mv(){for(;at!==null&&!on();)Vf(at)}function Vf(e){var t=pf(e.alternate,e,qa);e.memoizedProps=e.pendingProps,t===null?Fl(e):at=t}function Gf(e){var t=e,a=t.alternate;switch(t.tag){case 15:case 0:t=cf(a,t,t.pendingProps,t.type,void 0,it);break;case 11:t=cf(a,t,t.pendingProps,t.type.render,t.ref,it);break;case 5:hc(t);default:vf(a,t),t=at=$d(t,qa),t=pf(a,t,qa)}e.memoizedProps=e.pendingProps,t===null?Fl(e):at=t}function yi(e,t,a,s){Sa=Ns=null,hc(t),oi=null,cr=0;var u=t.return;try{if(Sv(e,u,t,a,it)){Ft=1,Tl(e,Yn(a,e.current)),at=null;return}}catch(h){if(u!==null)throw at=u,h;Ft=1,Tl(e,Yn(a,e.current)),at=null;return}t.flags&32768?(ct||s===1?e=!0:pi||(it&536870912)!==0?e=!1:(es=e=!0,(s===2||s===9||s===3||s===6)&&(s=Ln.current,s!==null&&s.tag===13&&(s.flags|=16384))),Yf(t,e)):Fl(t)}function Fl(e){var t=e;do{if((t.flags&32768)!==0){Yf(t,es);return}e=t.return;var a=Cv(t.alternate,t,qa);if(a!==null){at=a;return}if(t=t.sibling,t!==null){at=t;return}at=t=e}while(t!==null);Ft===0&&(Ft=5)}function Yf(e,t){do{var a=Ev(e.alternate,e);if(a!==null){a.flags&=32767,at=a;return}if(a=e.return,a!==null&&(a.flags|=32768,a.subtreeFlags=0,a.deletions=null),!t&&(e=e.sibling,e!==null)){at=e;return}at=e=a}while(e!==null);Ft=6,at=null}function Qf(e,t,a,s,u,h,v,b,z){e.cancelPendingCommit=null;do Hl();while(sn!==0);if((vt&6)!==0)throw Error(l(327));if(t!==null){if(t===e.current)throw Error(l(177));if(h=t.lanes|t.childLanes,h|=Bo,Ii(e,a,h,v,b,z),e===Ct&&(at=Ct=null,it=0),vi=t,as=e,Da=a,Yc=h,Qc=u,Lf=s,(t.subtreeFlags&10256)!==0||(t.flags&10256)!==0?(e.callbackNode=null,e.callbackPriority=0,Bv(B,function(){return Wf(),null})):(e.callbackNode=null,e.callbackPriority=0),s=(t.flags&13878)!==0,(t.subtreeFlags&13878)!==0||s){s=F.T,F.T=null,u=ne.p,ne.p=2,v=vt,vt|=4;try{Tv(e,t,a)}finally{vt=v,ne.p=u,F.T=s}}sn=1,Kf(),Jf(),Xf()}}function Kf(){if(sn===1){sn=0;var e=as,t=vi,a=(t.flags&13878)!==0;if((t.subtreeFlags&13878)!==0||a){a=F.T,F.T=null;var s=ne.p;ne.p=2;var u=vt;vt|=4;try{Af(t,e);var h=cu,v=Dd(e.containerInfo),b=h.focusedElem,z=h.selectionRange;if(v!==b&&b&&b.ownerDocument&&qd(b.ownerDocument.documentElement,b)){if(z!==null&&Do(b)){var W=z.start,oe=z.end;if(oe===void 0&&(oe=W),"selectionStart"in b)b.selectionStart=W,b.selectionEnd=Math.min(oe,b.value.length);else{var me=b.ownerDocument||document,te=me&&me.defaultView||window;if(te.getSelection){var ie=te.getSelection(),ze=b.textContent.length,Ge=Math.min(z.start,ze),jt=z.end===void 0?Ge:Math.min(z.end,ze);!ie.extend&&Ge>jt&&(v=jt,jt=Ge,Ge=v);var Q=Rd(b,Ge),H=Rd(b,jt);if(Q&&H&&(ie.rangeCount!==1||ie.anchorNode!==Q.node||ie.anchorOffset!==Q.offset||ie.focusNode!==H.node||ie.focusOffset!==H.offset)){var Z=me.createRange();Z.setStart(Q.node,Q.offset),ie.removeAllRanges(),Ge>jt?(ie.addRange(Z),ie.extend(H.node,H.offset)):(Z.setEnd(H.node,H.offset),ie.addRange(Z))}}}}for(me=[],ie=b;ie=ie.parentNode;)ie.nodeType===1&&me.push({element:ie,left:ie.scrollLeft,top:ie.scrollTop});for(typeof b.focus=="function"&&b.focus(),b=0;b<me.length;b++){var de=me[b];de.element.scrollLeft=de.left,de.element.scrollTop=de.top}}eo=!!ou,cu=ou=null}finally{vt=u,ne.p=s,F.T=a}}e.current=t,sn=2}}function Jf(){if(sn===2){sn=0;var e=as,t=vi,a=(t.flags&8772)!==0;if((t.subtreeFlags&8772)!==0||a){a=F.T,F.T=null;var s=ne.p;ne.p=2;var u=vt;vt|=4;try{wf(e,t.alternate,t)}finally{vt=u,ne.p=s,F.T=a}}sn=3}}function Xf(){if(sn===4||sn===3){sn=0,$n();var e=as,t=vi,a=Da,s=Lf;(t.subtreeFlags&10256)!==0||(t.flags&10256)!==0?sn=5:(sn=0,vi=as=null,Zf(e,e.pendingLanes));var u=e.pendingLanes;if(u===0&&(ns=null),Nn(a),t=t.stateNode,Te&&typeof Te.onCommitFiberRoot=="function")try{Te.onCommitFiberRoot(ge,t,void 0,(t.current.flags&128)===128)}catch{}if(s!==null){t=F.T,u=ne.p,ne.p=2,F.T=null;try{for(var h=e.onRecoverableError,v=0;v<s.length;v++){var b=s[v];h(b.value,{componentStack:b.stack})}}finally{F.T=t,ne.p=u}}(Da&3)!==0&&Hl(),ma(e),u=e.pendingLanes,(a&261930)!==0&&(u&42)!==0?e===Kc?Cr++:(Cr=0,Kc=e):Cr=0,Er(0)}}function Zf(e,t){(e.pooledCacheLanes&=t)===0&&(t=e.pooledCache,t!=null&&(e.pooledCache=null,lr(t)))}function Hl(){return Kf(),Jf(),Xf(),Wf()}function Wf(){if(sn!==5)return!1;var e=as,t=Yc;Yc=0;var a=Nn(Da),s=F.T,u=ne.p;try{ne.p=32>a?32:a,F.T=null,a=Qc,Qc=null;var h=as,v=Da;if(sn=0,vi=as=null,Da=0,(vt&6)!==0)throw Error(l(331));var b=vt;if(vt|=4,Df(h.current),Of(h,h.current,v,a),vt=b,Er(0,!1),Te&&typeof Te.onPostCommitFiberRoot=="function")try{Te.onPostCommitFiberRoot(ge,h)}catch{}return!0}finally{ne.p=u,F.T=s,Zf(e,t)}}function em(e,t,a){t=Yn(a,t),t=Ec(e.stateNode,t,2),e=Ja(e,t,2),e!==null&&(ca(e,2),ma(e))}function yt(e,t,a){if(e.tag===3)em(e,e,a);else for(;t!==null;){if(t.tag===3){em(t,e,a);break}else if(t.tag===1){var s=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof s.componentDidCatch=="function"&&(ns===null||!ns.has(s))){e=Yn(a,e),a=ef(2),s=Ja(t,a,2),s!==null&&(tf(a,s,t,e),ca(s,2),ma(s));break}}t=t.return}}function Zc(e,t,a){var s=e.pingCache;if(s===null){s=e.pingCache=new Ov;var u=new Set;s.set(t,u)}else u=s.get(t),u===void 0&&(u=new Set,s.set(t,u));u.has(a)||(Ic=!0,u.add(a),e=zv.bind(null,e,t,a),t.then(e,e))}function zv(e,t,a){var s=e.pingCache;s!==null&&s.delete(t),e.pingedLanes|=e.suspendedLanes&a,e.warmLanes&=~a,Ct===e&&(it&a)===a&&(Ft===4||Ft===3&&(it&62914560)===it&&300>St()-zl?(vt&2)===0&&_i(e,0):Vc|=a,gi===it&&(gi=0)),ma(e)}function tm(e,t){t===0&&(t=gs()),e=js(e,t),e!==null&&(ca(e,t),ma(e))}function Lv(e){var t=e.memoizedState,a=0;t!==null&&(a=t.retryLane),tm(e,a)}function Uv(e,t){var a=0;switch(e.tag){case 31:case 13:var s=e.stateNode,u=e.memoizedState;u!==null&&(a=u.retryLane);break;case 19:s=e.stateNode;break;case 22:s=e.stateNode._retryCache;break;default:throw Error(l(314))}s!==null&&s.delete(t),tm(e,a)}function Bv(e,t){return en(e,t)}var $l=null,xi=null,Wc=!1,Il=!1,eu=!1,is=0;function ma(e){e!==xi&&e.next===null&&(xi===null?$l=xi=e:xi=xi.next=e),Il=!0,Wc||(Wc=!0,Fv())}function Er(e,t){if(!eu&&Il){eu=!0;do for(var a=!1,s=$l;s!==null;){if(e!==0){var u=s.pendingLanes;if(u===0)var h=0;else{var v=s.suspendedLanes,b=s.pingedLanes;h=(1<<31-Pe(42|e)+1)-1,h&=u&~(v&~b),h=h&201326741?h&201326741|1:h?h|2:0}h!==0&&(a=!0,im(s,h))}else h=it,h=Gt(s,s===Ct?h:0,s.cancelPendingCommit!==null||s.timeoutHandle!==-1),(h&3)===0||jn(s,h)||(a=!0,im(s,h));s=s.next}while(a);eu=!1}}function Pv(){nm()}function nm(){Il=Wc=!1;var e=0;is!==0&&Xv()&&(e=is);for(var t=St(),a=null,s=$l;s!==null;){var u=s.next,h=am(s,t);h===0?(s.next=null,a===null?$l=u:a.next=u,u===null&&(xi=a)):(a=s,(e!==0||(h&3)!==0)&&(Il=!0)),s=u}sn!==0&&sn!==5||Er(e),is!==0&&(is=0)}function am(e,t){for(var a=e.suspendedLanes,s=e.pingedLanes,u=e.expirationTimes,h=e.pendingLanes&-62914561;0<h;){var v=31-Pe(h),b=1<<v,z=u[v];z===-1?((b&a)===0||(b&s)!==0)&&(u[v]=wn(b,t)):z<=t&&(e.expiredLanes|=b),h&=~b}if(t=Ct,a=it,a=Gt(e,e===t?a:0,e.cancelPendingCommit!==null||e.timeoutHandle!==-1),s=e.callbackNode,a===0||e===t&&(_t===2||_t===9)||e.cancelPendingCommit!==null)return s!==null&&s!==null&&gt(s),e.callbackNode=null,e.callbackPriority=0;if((a&3)===0||jn(e,a)){if(t=a&-a,t===e.callbackPriority)return t;switch(s!==null&&gt(s),Nn(a)){case 2:case 8:a=tn;break;case 32:a=B;break;case 268435456:a=ae;break;default:a=B}return s=sm.bind(null,e),a=en(a,s),e.callbackPriority=t,e.callbackNode=a,t}return s!==null&&s!==null&&gt(s),e.callbackPriority=2,e.callbackNode=null,2}function sm(e,t){if(sn!==0&&sn!==5)return e.callbackNode=null,e.callbackPriority=0,null;var a=e.callbackNode;if(Hl()&&e.callbackNode!==a)return null;var s=it;return s=Gt(e,e===Ct?s:0,e.cancelPendingCommit!==null||e.timeoutHandle!==-1),s===0?null:(Bf(e,s,t),am(e,St()),e.callbackNode!=null&&e.callbackNode===a?sm.bind(null,e):null)}function im(e,t){if(Hl())return null;Bf(e,t,!0)}function Fv(){Wv(function(){(vt&6)!==0?en(mn,Pv):nm()})}function tu(){if(is===0){var e=ii;e===0&&(e=Lt,Lt<<=1,(Lt&261888)===0&&(Lt=256)),is=e}return is}function rm(e){return e==null||typeof e=="symbol"||typeof e=="boolean"?null:typeof e=="function"?e:un(""+e)}function lm(e,t){var a=t.ownerDocument.createElement("input");return a.name=t.name,a.value=t.value,e.id&&a.setAttribute("form",e.id),t.parentNode.insertBefore(a,t),e=new FormData(e),a.parentNode.removeChild(a),e}function Hv(e,t,a,s,u){if(t==="submit"&&a&&a.stateNode===u){var h=rm((u[Yt]||null).action),v=s.submitter;v&&(t=(t=v[Yt]||null)?rm(t.formAction):v.getAttribute("formAction"),t!==null&&(h=t,v=null));var b=new nl("action","action",null,s,u);e.push({event:b,listeners:[{instance:null,listener:function(){if(s.defaultPrevented){if(is!==0){var z=v?lm(u,v):new FormData(u);bc(a,{pending:!0,data:z,method:u.method,action:h},null,z)}}else typeof h=="function"&&(b.preventDefault(),z=v?lm(u,v):new FormData(u),bc(a,{pending:!0,data:z,method:u.method,action:h},h,z))},currentTarget:u}]})}}for(var nu=0;nu<Uo.length;nu++){var au=Uo[nu],$v=au.toLowerCase(),Iv=au[0].toUpperCase()+au.slice(1);na($v,"on"+Iv)}na(Ld,"onAnimationEnd"),na(Ud,"onAnimationIteration"),na(Bd,"onAnimationStart"),na("dblclick","onDoubleClick"),na("focusin","onFocus"),na("focusout","onBlur"),na(rv,"onTransitionRun"),na(lv,"onTransitionStart"),na(ov,"onTransitionCancel"),na(Pd,"onTransitionEnd"),ut("onMouseEnter",["mouseout","mouseover"]),ut("onMouseLeave",["mouseout","mouseover"]),ut("onPointerEnter",["pointerout","pointerover"]),ut("onPointerLeave",["pointerout","pointerover"]),ft("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),ft("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),ft("onBeforeInput",["compositionend","keypress","textInput","paste"]),ft("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),ft("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),ft("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Tr="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Vv=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Tr));function om(e,t){t=(t&4)!==0;for(var a=0;a<e.length;a++){var s=e[a],u=s.event;s=s.listeners;e:{var h=void 0;if(t)for(var v=s.length-1;0<=v;v--){var b=s[v],z=b.instance,W=b.currentTarget;if(b=b.listener,z!==h&&u.isPropagationStopped())break e;h=b,u.currentTarget=W;try{h(u)}catch(oe){il(oe)}u.currentTarget=null,h=z}else for(v=0;v<s.length;v++){if(b=s[v],z=b.instance,W=b.currentTarget,b=b.listener,z!==h&&u.isPropagationStopped())break e;h=b,u.currentTarget=W;try{h(u)}catch(oe){il(oe)}u.currentTarget=null,h=z}}}}function st(e,t){var a=t[ve];a===void 0&&(a=t[ve]=new Set);var s=e+"__bubble";a.has(s)||(cm(t,e,2,!1),a.add(s))}function su(e,t,a){var s=0;t&&(s|=4),cm(a,e,s,t)}var Vl="_reactListening"+Math.random().toString(36).slice(2);function iu(e){if(!e[Vl]){e[Vl]=!0,ot.forEach(function(a){a!=="selectionchange"&&(Vv.has(a)||su(a,!1,e),su(a,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[Vl]||(t[Vl]=!0,su("selectionchange",!1,t))}}function cm(e,t,a,s){switch(Um(t)){case 2:var u=y_;break;case 8:u=x_;break;default:u=xu}a=u.bind(null,t,a,e),u=void 0,!No||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(u=!0),s?u!==void 0?e.addEventListener(t,a,{capture:!0,passive:u}):e.addEventListener(t,a,!0):u!==void 0?e.addEventListener(t,a,{passive:u}):e.addEventListener(t,a,!1)}function ru(e,t,a,s,u){var h=s;if((t&1)===0&&(t&2)===0&&s!==null)e:for(;;){if(s===null)return;var v=s.tag;if(v===3||v===4){var b=s.stateNode.containerInfo;if(b===u)break;if(v===4)for(v=s.return;v!==null;){var z=v.tag;if((z===3||z===4)&&v.stateNode.containerInfo===u)return;v=v.return}for(;b!==null;){if(v=ke(b),v===null)return;if(z=v.tag,z===5||z===6||z===26||z===27){s=h=v;continue e}b=b.parentNode}}s=s.return}fd(function(){var W=h,oe=Ks(a),me=[];e:{var te=Fd.get(e);if(te!==void 0){var ie=nl,ze=e;switch(e){case"keypress":if(el(a)===0)break e;case"keydown":case"keyup":ie=Ug;break;case"focusin":ze="focus",ie=Ao;break;case"focusout":ze="blur",ie=Ao;break;case"beforeblur":case"afterblur":ie=Ao;break;case"click":if(a.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":ie=gd;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":ie=Cg;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":ie=Fg;break;case Ld:case Ud:case Bd:ie=Ag;break;case Pd:ie=$g;break;case"scroll":case"scrollend":ie=wg;break;case"wheel":ie=Vg;break;case"copy":case"cut":case"paste":ie=Og;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":ie=_d;break;case"toggle":case"beforetoggle":ie=Yg}var Ge=(t&4)!==0,jt=!Ge&&(e==="scroll"||e==="scrollend"),Q=Ge?te!==null?te+"Capture":null:te;Ge=[];for(var H=W,Z;H!==null;){var de=H;if(Z=de.stateNode,de=de.tag,de!==5&&de!==26&&de!==27||Z===null||Q===null||(de=Ji(H,Q),de!=null&&Ge.push(Ar(H,de,Z))),jt)break;H=H.return}0<Ge.length&&(te=new ie(te,ze,null,a,oe),me.push({event:te,listeners:Ge}))}}if((t&7)===0){e:{if(te=e==="mouseover"||e==="pointerover",ie=e==="mouseout"||e==="pointerout",te&&a!==_s&&(ze=a.relatedTarget||a.fromElement)&&(ke(ze)||ze[I]))break e;if((ie||te)&&(te=oe.window===oe?oe:(te=oe.ownerDocument)?te.defaultView||te.parentWindow:window,ie?(ze=a.relatedTarget||a.toElement,ie=W,ze=ze?ke(ze):null,ze!==null&&(jt=d(ze),Ge=ze.tag,ze!==jt||Ge!==5&&Ge!==27&&Ge!==6)&&(ze=null)):(ie=null,ze=W),ie!==ze)){if(Ge=gd,de="onMouseLeave",Q="onMouseEnter",H="mouse",(e==="pointerout"||e==="pointerover")&&(Ge=_d,de="onPointerLeave",Q="onPointerEnter",H="pointer"),jt=ie==null?te:qe(ie),Z=ze==null?te:qe(ze),te=new Ge(de,H+"leave",ie,a,oe),te.target=jt,te.relatedTarget=Z,de=null,ke(oe)===W&&(Ge=new Ge(Q,H+"enter",ze,a,oe),Ge.target=Z,Ge.relatedTarget=jt,de=Ge),jt=de,ie&&ze)t:{for(Ge=Gv,Q=ie,H=ze,Z=0,de=Q;de;de=Ge(de))Z++;de=0;for(var He=H;He;He=Ge(He))de++;for(;0<Z-de;)Q=Ge(Q),Z--;for(;0<de-Z;)H=Ge(H),de--;for(;Z--;){if(Q===H||H!==null&&Q===H.alternate){Ge=Q;break t}Q=Ge(Q),H=Ge(H)}Ge=null}else Ge=null;ie!==null&&um(me,te,ie,Ge,!1),ze!==null&&jt!==null&&um(me,jt,ze,Ge,!0)}}e:{if(te=W?qe(W):window,ie=te.nodeName&&te.nodeName.toLowerCase(),ie==="select"||ie==="input"&&te.type==="file")var mt=Cd;else if(wd(te))if(Ed)mt=av;else{mt=tv;var Be=ev}else ie=te.nodeName,!ie||ie.toLowerCase()!=="input"||te.type!=="checkbox"&&te.type!=="radio"?W&&et(W.elementType)&&(mt=Cd):mt=nv;if(mt&&(mt=mt(e,W))){Nd(me,mt,a,oe);break e}Be&&Be(e,te,W),e==="focusout"&&W&&te.type==="number"&&W.memoizedProps.value!=null&&x(te,"number",te.value)}switch(Be=W?qe(W):window,e){case"focusin":(wd(Be)||Be.contentEditable==="true")&&(Xs=Be,Mo=W,sr=null);break;case"focusout":sr=Mo=Xs=null;break;case"mousedown":zo=!0;break;case"contextmenu":case"mouseup":case"dragend":zo=!1,Md(me,a,oe);break;case"selectionchange":if(iv)break;case"keydown":case"keyup":Md(me,a,oe)}var Ze;if(Oo)e:{switch(e){case"compositionstart":var rt="onCompositionStart";break e;case"compositionend":rt="onCompositionEnd";break e;case"compositionupdate":rt="onCompositionUpdate";break e}rt=void 0}else Js?jd(e,a)&&(rt="onCompositionEnd"):e==="keydown"&&a.keyCode===229&&(rt="onCompositionStart");rt&&(yd&&a.locale!=="ko"&&(Js||rt!=="onCompositionStart"?rt==="onCompositionEnd"&&Js&&(Ze=md()):($a=oe,Co="value"in $a?$a.value:$a.textContent,Js=!0)),Be=Gl(W,rt),0<Be.length&&(rt=new vd(rt,e,null,a,oe),me.push({event:rt,listeners:Be}),Ze?rt.data=Ze:(Ze=Sd(a),Ze!==null&&(rt.data=Ze)))),(Ze=Kg?Jg(e,a):Xg(e,a))&&(rt=Gl(W,"onBeforeInput"),0<rt.length&&(Be=new vd("onBeforeInput","beforeinput",null,a,oe),me.push({event:Be,listeners:rt}),Be.data=Ze)),Hv(me,e,W,a,oe)}om(me,t)})}function Ar(e,t,a){return{instance:e,listener:t,currentTarget:a}}function Gl(e,t){for(var a=t+"Capture",s=[];e!==null;){var u=e,h=u.stateNode;if(u=u.tag,u!==5&&u!==26&&u!==27||h===null||(u=Ji(e,a),u!=null&&s.unshift(Ar(e,u,h)),u=Ji(e,t),u!=null&&s.push(Ar(e,u,h))),e.tag===3)return s;e=e.return}return[]}function Gv(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5&&e.tag!==27);return e||null}function um(e,t,a,s,u){for(var h=t._reactName,v=[];a!==null&&a!==s;){var b=a,z=b.alternate,W=b.stateNode;if(b=b.tag,z!==null&&z===s)break;b!==5&&b!==26&&b!==27||W===null||(z=W,u?(W=Ji(a,h),W!=null&&v.unshift(Ar(a,W,z))):u||(W=Ji(a,h),W!=null&&v.push(Ar(a,W,z)))),a=a.return}v.length!==0&&e.push({event:t,listeners:v})}var Yv=/\r\n?/g,Qv=/\u0000|\uFFFD/g;function dm(e){return(typeof e=="string"?e:""+e).replace(Yv,`
`).replace(Qv,"")}function hm(e,t){return t=dm(t),dm(e)===t}function bt(e,t,a,s,u,h){switch(a){case"children":typeof s=="string"?t==="body"||t==="textarea"&&s===""||Se(e,s):(typeof s=="number"||typeof s=="bigint")&&t!=="body"&&Se(e,""+s);break;case"className":_a(e,"class",s);break;case"tabIndex":_a(e,"tabindex",s);break;case"dir":case"role":case"viewBox":case"width":case"height":_a(e,a,s);break;case"style":De(e,s,h);break;case"data":if(t!=="object"){_a(e,"data",s);break}case"src":case"href":if(s===""&&(t!=="a"||a!=="href")){e.removeAttribute(a);break}if(s==null||typeof s=="function"||typeof s=="symbol"||typeof s=="boolean"){e.removeAttribute(a);break}s=un(""+s),e.setAttribute(a,s);break;case"action":case"formAction":if(typeof s=="function"){e.setAttribute(a,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof h=="function"&&(a==="formAction"?(t!=="input"&&bt(e,t,"name",u.name,u,null),bt(e,t,"formEncType",u.formEncType,u,null),bt(e,t,"formMethod",u.formMethod,u,null),bt(e,t,"formTarget",u.formTarget,u,null)):(bt(e,t,"encType",u.encType,u,null),bt(e,t,"method",u.method,u,null),bt(e,t,"target",u.target,u,null)));if(s==null||typeof s=="symbol"||typeof s=="boolean"){e.removeAttribute(a);break}s=un(""+s),e.setAttribute(a,s);break;case"onClick":s!=null&&(e.onclick=dn);break;case"onScroll":s!=null&&st("scroll",e);break;case"onScrollEnd":s!=null&&st("scrollend",e);break;case"dangerouslySetInnerHTML":if(s!=null){if(typeof s!="object"||!("__html"in s))throw Error(l(61));if(a=s.__html,a!=null){if(u.children!=null)throw Error(l(60));e.innerHTML=a}}break;case"multiple":e.multiple=s&&typeof s!="function"&&typeof s!="symbol";break;case"muted":e.muted=s&&typeof s!="function"&&typeof s!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(s==null||typeof s=="function"||typeof s=="boolean"||typeof s=="symbol"){e.removeAttribute("xlink:href");break}a=un(""+s),e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",a);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":s!=null&&typeof s!="function"&&typeof s!="symbol"?e.setAttribute(a,""+s):e.removeAttribute(a);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":s&&typeof s!="function"&&typeof s!="symbol"?e.setAttribute(a,""):e.removeAttribute(a);break;case"capture":case"download":s===!0?e.setAttribute(a,""):s!==!1&&s!=null&&typeof s!="function"&&typeof s!="symbol"?e.setAttribute(a,s):e.removeAttribute(a);break;case"cols":case"rows":case"size":case"span":s!=null&&typeof s!="function"&&typeof s!="symbol"&&!isNaN(s)&&1<=s?e.setAttribute(a,s):e.removeAttribute(a);break;case"rowSpan":case"start":s==null||typeof s=="function"||typeof s=="symbol"||isNaN(s)?e.removeAttribute(a):e.setAttribute(a,s);break;case"popover":st("beforetoggle",e),st("toggle",e),Vn(e,"popover",s);break;case"xlinkActuate":Cn(e,"http://www.w3.org/1999/xlink","xlink:actuate",s);break;case"xlinkArcrole":Cn(e,"http://www.w3.org/1999/xlink","xlink:arcrole",s);break;case"xlinkRole":Cn(e,"http://www.w3.org/1999/xlink","xlink:role",s);break;case"xlinkShow":Cn(e,"http://www.w3.org/1999/xlink","xlink:show",s);break;case"xlinkTitle":Cn(e,"http://www.w3.org/1999/xlink","xlink:title",s);break;case"xlinkType":Cn(e,"http://www.w3.org/1999/xlink","xlink:type",s);break;case"xmlBase":Cn(e,"http://www.w3.org/XML/1998/namespace","xml:base",s);break;case"xmlLang":Cn(e,"http://www.w3.org/XML/1998/namespace","xml:lang",s);break;case"xmlSpace":Cn(e,"http://www.w3.org/XML/1998/namespace","xml:space",s);break;case"is":Vn(e,"is",s);break;case"innerText":case"textContent":break;default:(!(2<a.length)||a[0]!=="o"&&a[0]!=="O"||a[1]!=="n"&&a[1]!=="N")&&(a=tt.get(a)||a,Vn(e,a,s))}}function lu(e,t,a,s,u,h){switch(a){case"style":De(e,s,h);break;case"dangerouslySetInnerHTML":if(s!=null){if(typeof s!="object"||!("__html"in s))throw Error(l(61));if(a=s.__html,a!=null){if(u.children!=null)throw Error(l(60));e.innerHTML=a}}break;case"children":typeof s=="string"?Se(e,s):(typeof s=="number"||typeof s=="bigint")&&Se(e,""+s);break;case"onScroll":s!=null&&st("scroll",e);break;case"onScrollEnd":s!=null&&st("scrollend",e);break;case"onClick":s!=null&&(e.onclick=dn);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Nt.hasOwnProperty(a))e:{if(a[0]==="o"&&a[1]==="n"&&(u=a.endsWith("Capture"),t=a.slice(2,u?a.length-7:void 0),h=e[Yt]||null,h=h!=null?h[a]:null,typeof h=="function"&&e.removeEventListener(t,h,u),typeof s=="function")){typeof h!="function"&&h!==null&&(a in e?e[a]=null:e.hasAttribute(a)&&e.removeAttribute(a)),e.addEventListener(t,s,u);break e}a in e?e[a]=s:s===!0?e.setAttribute(a,""):Vn(e,a,s)}}}function _n(e,t,a){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":st("error",e),st("load",e);var s=!1,u=!1,h;for(h in a)if(a.hasOwnProperty(h)){var v=a[h];if(v!=null)switch(h){case"src":s=!0;break;case"srcSet":u=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(l(137,t));default:bt(e,t,h,v,a,null)}}u&&bt(e,t,"srcSet",a.srcSet,a,null),s&&bt(e,t,"src",a.src,a,null);return;case"input":st("invalid",e);var b=h=v=u=null,z=null,W=null;for(s in a)if(a.hasOwnProperty(s)){var oe=a[s];if(oe!=null)switch(s){case"name":u=oe;break;case"type":v=oe;break;case"checked":z=oe;break;case"defaultChecked":W=oe;break;case"value":h=oe;break;case"defaultValue":b=oe;break;case"children":case"dangerouslySetInnerHTML":if(oe!=null)throw Error(l(137,t));break;default:bt(e,t,s,oe,a,null)}}an(e,h,b,z,W,v,u,!1);return;case"select":st("invalid",e),s=v=h=null;for(u in a)if(a.hasOwnProperty(u)&&(b=a[u],b!=null))switch(u){case"value":h=b;break;case"defaultValue":v=b;break;case"multiple":s=b;default:bt(e,t,u,b,a,null)}t=h,a=v,e.multiple=!!s,t!=null?J(e,!!s,t,!1):a!=null&&J(e,!!s,a,!0);return;case"textarea":st("invalid",e),h=u=s=null;for(v in a)if(a.hasOwnProperty(v)&&(b=a[v],b!=null))switch(v){case"value":s=b;break;case"defaultValue":u=b;break;case"children":h=b;break;case"dangerouslySetInnerHTML":if(b!=null)throw Error(l(91));break;default:bt(e,t,v,b,a,null)}je(e,s,u,h);return;case"option":for(z in a)if(a.hasOwnProperty(z)&&(s=a[z],s!=null))switch(z){case"selected":e.selected=s&&typeof s!="function"&&typeof s!="symbol";break;default:bt(e,t,z,s,a,null)}return;case"dialog":st("beforetoggle",e),st("toggle",e),st("cancel",e),st("close",e);break;case"iframe":case"object":st("load",e);break;case"video":case"audio":for(s=0;s<Tr.length;s++)st(Tr[s],e);break;case"image":st("error",e),st("load",e);break;case"details":st("toggle",e);break;case"embed":case"source":case"link":st("error",e),st("load",e);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(W in a)if(a.hasOwnProperty(W)&&(s=a[W],s!=null))switch(W){case"children":case"dangerouslySetInnerHTML":throw Error(l(137,t));default:bt(e,t,W,s,a,null)}return;default:if(et(t)){for(oe in a)a.hasOwnProperty(oe)&&(s=a[oe],s!==void 0&&lu(e,t,oe,s,a,void 0));return}}for(b in a)a.hasOwnProperty(b)&&(s=a[b],s!=null&&bt(e,t,b,s,a,null))}function Kv(e,t,a,s){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var u=null,h=null,v=null,b=null,z=null,W=null,oe=null;for(ie in a){var me=a[ie];if(a.hasOwnProperty(ie)&&me!=null)switch(ie){case"checked":break;case"value":break;case"defaultValue":z=me;default:s.hasOwnProperty(ie)||bt(e,t,ie,null,s,me)}}for(var te in s){var ie=s[te];if(me=a[te],s.hasOwnProperty(te)&&(ie!=null||me!=null))switch(te){case"type":h=ie;break;case"name":u=ie;break;case"checked":W=ie;break;case"defaultChecked":oe=ie;break;case"value":v=ie;break;case"defaultValue":b=ie;break;case"children":case"dangerouslySetInnerHTML":if(ie!=null)throw Error(l(137,t));break;default:ie!==me&&bt(e,t,te,ie,s,me)}}Qi(e,v,b,z,W,oe,h,u);return;case"select":ie=v=b=te=null;for(h in a)if(z=a[h],a.hasOwnProperty(h)&&z!=null)switch(h){case"value":break;case"multiple":ie=z;default:s.hasOwnProperty(h)||bt(e,t,h,null,s,z)}for(u in s)if(h=s[u],z=a[u],s.hasOwnProperty(u)&&(h!=null||z!=null))switch(u){case"value":te=h;break;case"defaultValue":b=h;break;case"multiple":v=h;default:h!==z&&bt(e,t,u,h,s,z)}t=b,a=v,s=ie,te!=null?J(e,!!a,te,!1):!!s!=!!a&&(t!=null?J(e,!!a,t,!0):J(e,!!a,a?[]:"",!1));return;case"textarea":ie=te=null;for(b in a)if(u=a[b],a.hasOwnProperty(b)&&u!=null&&!s.hasOwnProperty(b))switch(b){case"value":break;case"children":break;default:bt(e,t,b,null,s,u)}for(v in s)if(u=s[v],h=a[v],s.hasOwnProperty(v)&&(u!=null||h!=null))switch(v){case"value":te=u;break;case"defaultValue":ie=u;break;case"children":break;case"dangerouslySetInnerHTML":if(u!=null)throw Error(l(91));break;default:u!==h&&bt(e,t,v,u,s,h)}xe(e,te,ie);return;case"option":for(var ze in a)if(te=a[ze],a.hasOwnProperty(ze)&&te!=null&&!s.hasOwnProperty(ze))switch(ze){case"selected":e.selected=!1;break;default:bt(e,t,ze,null,s,te)}for(z in s)if(te=s[z],ie=a[z],s.hasOwnProperty(z)&&te!==ie&&(te!=null||ie!=null))switch(z){case"selected":e.selected=te&&typeof te!="function"&&typeof te!="symbol";break;default:bt(e,t,z,te,s,ie)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Ge in a)te=a[Ge],a.hasOwnProperty(Ge)&&te!=null&&!s.hasOwnProperty(Ge)&&bt(e,t,Ge,null,s,te);for(W in s)if(te=s[W],ie=a[W],s.hasOwnProperty(W)&&te!==ie&&(te!=null||ie!=null))switch(W){case"children":case"dangerouslySetInnerHTML":if(te!=null)throw Error(l(137,t));break;default:bt(e,t,W,te,s,ie)}return;default:if(et(t)){for(var jt in a)te=a[jt],a.hasOwnProperty(jt)&&te!==void 0&&!s.hasOwnProperty(jt)&&lu(e,t,jt,void 0,s,te);for(oe in s)te=s[oe],ie=a[oe],!s.hasOwnProperty(oe)||te===ie||te===void 0&&ie===void 0||lu(e,t,oe,te,s,ie);return}}for(var Q in a)te=a[Q],a.hasOwnProperty(Q)&&te!=null&&!s.hasOwnProperty(Q)&&bt(e,t,Q,null,s,te);for(me in s)te=s[me],ie=a[me],!s.hasOwnProperty(me)||te===ie||te==null&&ie==null||bt(e,t,me,te,s,ie)}function fm(e){switch(e){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function Jv(){if(typeof performance.getEntriesByType=="function"){for(var e=0,t=0,a=performance.getEntriesByType("resource"),s=0;s<a.length;s++){var u=a[s],h=u.transferSize,v=u.initiatorType,b=u.duration;if(h&&b&&fm(v)){for(v=0,b=u.responseEnd,s+=1;s<a.length;s++){var z=a[s],W=z.startTime;if(W>b)break;var oe=z.transferSize,me=z.initiatorType;oe&&fm(me)&&(z=z.responseEnd,v+=oe*(z<b?1:(b-W)/(z-W)))}if(--s,t+=8*(h+v)/(u.duration/1e3),e++,10<e)break}}if(0<e)return t/e/1e6}return navigator.connection&&(e=navigator.connection.downlink,typeof e=="number")?e:5}var ou=null,cu=null;function Yl(e){return e.nodeType===9?e:e.ownerDocument}function mm(e){switch(e){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function pm(e,t){if(e===0)switch(t){case"svg":return 1;case"math":return 2;default:return 0}return e===1&&t==="foreignObject"?0:e}function uu(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.children=="bigint"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var du=null;function Xv(){var e=window.event;return e&&e.type==="popstate"?e===du?!1:(du=e,!0):(du=null,!1)}var gm=typeof setTimeout=="function"?setTimeout:void 0,Zv=typeof clearTimeout=="function"?clearTimeout:void 0,vm=typeof Promise=="function"?Promise:void 0,Wv=typeof queueMicrotask=="function"?queueMicrotask:typeof vm<"u"?function(e){return vm.resolve(null).then(e).catch(e_)}:gm;function e_(e){setTimeout(function(){throw e})}function rs(e){return e==="head"}function _m(e,t){var a=t,s=0;do{var u=a.nextSibling;if(e.removeChild(a),u&&u.nodeType===8)if(a=u.data,a==="/$"||a==="/&"){if(s===0){e.removeChild(u),wi(t);return}s--}else if(a==="$"||a==="$?"||a==="$~"||a==="$!"||a==="&")s++;else if(a==="html")kr(e.ownerDocument.documentElement);else if(a==="head"){a=e.ownerDocument.head,kr(a);for(var h=a.firstChild;h;){var v=h.nextSibling,b=h.nodeName;h[pe]||b==="SCRIPT"||b==="STYLE"||b==="LINK"&&h.rel.toLowerCase()==="stylesheet"||a.removeChild(h),h=v}}else a==="body"&&kr(e.ownerDocument.body);a=u}while(a);wi(t)}function ym(e,t){var a=e;e=0;do{var s=a.nextSibling;if(a.nodeType===1?t?(a._stashedDisplay=a.style.display,a.style.display="none"):(a.style.display=a._stashedDisplay||"",a.getAttribute("style")===""&&a.removeAttribute("style")):a.nodeType===3&&(t?(a._stashedText=a.nodeValue,a.nodeValue=""):a.nodeValue=a._stashedText||""),s&&s.nodeType===8)if(a=s.data,a==="/$"){if(e===0)break;e--}else a!=="$"&&a!=="$?"&&a!=="$~"&&a!=="$!"||e++;a=s}while(a)}function hu(e){var t=e.firstChild;for(t&&t.nodeType===10&&(t=t.nextSibling);t;){var a=t;switch(t=t.nextSibling,a.nodeName){case"HTML":case"HEAD":case"BODY":hu(a),ye(a);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(a.rel.toLowerCase()==="stylesheet")continue}e.removeChild(a)}}function t_(e,t,a,s){for(;e.nodeType===1;){var u=a;if(e.nodeName.toLowerCase()!==t.toLowerCase()){if(!s&&(e.nodeName!=="INPUT"||e.type!=="hidden"))break}else if(s){if(!e[pe])switch(t){case"meta":if(!e.hasAttribute("itemprop"))break;return e;case"link":if(h=e.getAttribute("rel"),h==="stylesheet"&&e.hasAttribute("data-precedence"))break;if(h!==u.rel||e.getAttribute("href")!==(u.href==null||u.href===""?null:u.href)||e.getAttribute("crossorigin")!==(u.crossOrigin==null?null:u.crossOrigin)||e.getAttribute("title")!==(u.title==null?null:u.title))break;return e;case"style":if(e.hasAttribute("data-precedence"))break;return e;case"script":if(h=e.getAttribute("src"),(h!==(u.src==null?null:u.src)||e.getAttribute("type")!==(u.type==null?null:u.type)||e.getAttribute("crossorigin")!==(u.crossOrigin==null?null:u.crossOrigin))&&h&&e.hasAttribute("async")&&!e.hasAttribute("itemprop"))break;return e;default:return e}}else if(t==="input"&&e.type==="hidden"){var h=u.name==null?null:""+u.name;if(u.type==="hidden"&&e.getAttribute("name")===h)return e}else return e;if(e=Zn(e.nextSibling),e===null)break}return null}function n_(e,t,a){if(t==="")return null;for(;e.nodeType!==3;)if((e.nodeType!==1||e.nodeName!=="INPUT"||e.type!=="hidden")&&!a||(e=Zn(e.nextSibling),e===null))return null;return e}function xm(e,t){for(;e.nodeType!==8;)if((e.nodeType!==1||e.nodeName!=="INPUT"||e.type!=="hidden")&&!t||(e=Zn(e.nextSibling),e===null))return null;return e}function fu(e){return e.data==="$?"||e.data==="$~"}function mu(e){return e.data==="$!"||e.data==="$?"&&e.ownerDocument.readyState!=="loading"}function a_(e,t){var a=e.ownerDocument;if(e.data==="$~")e._reactRetry=t;else if(e.data!=="$?"||a.readyState!=="loading")t();else{var s=function(){t(),a.removeEventListener("DOMContentLoaded",s)};a.addEventListener("DOMContentLoaded",s),e._reactRetry=s}}function Zn(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?"||t==="$~"||t==="&"||t==="F!"||t==="F")break;if(t==="/$"||t==="/&")return null}}return e}var pu=null;function bm(e){e=e.nextSibling;for(var t=0;e;){if(e.nodeType===8){var a=e.data;if(a==="/$"||a==="/&"){if(t===0)return Zn(e.nextSibling);t--}else a!=="$"&&a!=="$!"&&a!=="$?"&&a!=="$~"&&a!=="&"||t++}e=e.nextSibling}return null}function jm(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var a=e.data;if(a==="$"||a==="$!"||a==="$?"||a==="$~"||a==="&"){if(t===0)return e;t--}else a!=="/$"&&a!=="/&"||t++}e=e.previousSibling}return null}function Sm(e,t,a){switch(t=Yl(a),e){case"html":if(e=t.documentElement,!e)throw Error(l(452));return e;case"head":if(e=t.head,!e)throw Error(l(453));return e;case"body":if(e=t.body,!e)throw Error(l(454));return e;default:throw Error(l(451))}}function kr(e){for(var t=e.attributes;t.length;)e.removeAttributeNode(t[0]);ye(e)}var Wn=new Map,wm=new Set;function Ql(e){return typeof e.getRootNode=="function"?e.getRootNode():e.nodeType===9?e:e.ownerDocument}var Ma=ne.d;ne.d={f:s_,r:i_,D:r_,C:l_,L:o_,m:c_,X:d_,S:u_,M:h_};function s_(){var e=Ma.f(),t=Bl();return e||t}function i_(e){var t=Fe(e);t!==null&&t.tag===5&&t.type==="form"?Ph(t):Ma.r(e)}var bi=typeof document>"u"?null:document;function Nm(e,t,a){var s=bi;if(s&&typeof t=="string"&&t){var u=En(t);u='link[rel="'+e+'"][href="'+u+'"]',typeof a=="string"&&(u+='[crossorigin="'+a+'"]'),wm.has(u)||(wm.add(u),e={rel:e,crossOrigin:a,href:t},s.querySelector(u)===null&&(t=s.createElement("link"),_n(t,"link",e),Qe(t),s.head.appendChild(t)))}}function r_(e){Ma.D(e),Nm("dns-prefetch",e,null)}function l_(e,t){Ma.C(e,t),Nm("preconnect",e,t)}function o_(e,t,a){Ma.L(e,t,a);var s=bi;if(s&&e&&t){var u='link[rel="preload"][as="'+En(t)+'"]';t==="image"&&a&&a.imageSrcSet?(u+='[imagesrcset="'+En(a.imageSrcSet)+'"]',typeof a.imageSizes=="string"&&(u+='[imagesizes="'+En(a.imageSizes)+'"]')):u+='[href="'+En(e)+'"]';var h=u;switch(t){case"style":h=ji(e);break;case"script":h=Si(e)}Wn.has(h)||(e=j({rel:"preload",href:t==="image"&&a&&a.imageSrcSet?void 0:e,as:t},a),Wn.set(h,e),s.querySelector(u)!==null||t==="style"&&s.querySelector(Or(h))||t==="script"&&s.querySelector(Rr(h))||(t=s.createElement("link"),_n(t,"link",e),Qe(t),s.head.appendChild(t)))}}function c_(e,t){Ma.m(e,t);var a=bi;if(a&&e){var s=t&&typeof t.as=="string"?t.as:"script",u='link[rel="modulepreload"][as="'+En(s)+'"][href="'+En(e)+'"]',h=u;switch(s){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":h=Si(e)}if(!Wn.has(h)&&(e=j({rel:"modulepreload",href:e},t),Wn.set(h,e),a.querySelector(u)===null)){switch(s){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(a.querySelector(Rr(h)))return}s=a.createElement("link"),_n(s,"link",e),Qe(s),a.head.appendChild(s)}}}function u_(e,t,a){Ma.S(e,t,a);var s=bi;if(s&&e){var u=Oe(s).hoistableStyles,h=ji(e);t=t||"default";var v=u.get(h);if(!v){var b={loading:0,preload:null};if(v=s.querySelector(Or(h)))b.loading=5;else{e=j({rel:"stylesheet",href:e,"data-precedence":t},a),(a=Wn.get(h))&&gu(e,a);var z=v=s.createElement("link");Qe(z),_n(z,"link",e),z._p=new Promise(function(W,oe){z.onload=W,z.onerror=oe}),z.addEventListener("load",function(){b.loading|=1}),z.addEventListener("error",function(){b.loading|=2}),b.loading|=4,Kl(v,t,s)}v={type:"stylesheet",instance:v,count:1,state:b},u.set(h,v)}}}function d_(e,t){Ma.X(e,t);var a=bi;if(a&&e){var s=Oe(a).hoistableScripts,u=Si(e),h=s.get(u);h||(h=a.querySelector(Rr(u)),h||(e=j({src:e,async:!0},t),(t=Wn.get(u))&&vu(e,t),h=a.createElement("script"),Qe(h),_n(h,"link",e),a.head.appendChild(h)),h={type:"script",instance:h,count:1,state:null},s.set(u,h))}}function h_(e,t){Ma.M(e,t);var a=bi;if(a&&e){var s=Oe(a).hoistableScripts,u=Si(e),h=s.get(u);h||(h=a.querySelector(Rr(u)),h||(e=j({src:e,async:!0,type:"module"},t),(t=Wn.get(u))&&vu(e,t),h=a.createElement("script"),Qe(h),_n(h,"link",e),a.head.appendChild(h)),h={type:"script",instance:h,count:1,state:null},s.set(u,h))}}function Cm(e,t,a,s){var u=(u=D.current)?Ql(u):null;if(!u)throw Error(l(446));switch(e){case"meta":case"title":return null;case"style":return typeof a.precedence=="string"&&typeof a.href=="string"?(t=ji(a.href),a=Oe(u).hoistableStyles,s=a.get(t),s||(s={type:"style",instance:null,count:0,state:null},a.set(t,s)),s):{type:"void",instance:null,count:0,state:null};case"link":if(a.rel==="stylesheet"&&typeof a.href=="string"&&typeof a.precedence=="string"){e=ji(a.href);var h=Oe(u).hoistableStyles,v=h.get(e);if(v||(u=u.ownerDocument||u,v={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},h.set(e,v),(h=u.querySelector(Or(e)))&&!h._p&&(v.instance=h,v.state.loading=5),Wn.has(e)||(a={rel:"preload",as:"style",href:a.href,crossOrigin:a.crossOrigin,integrity:a.integrity,media:a.media,hrefLang:a.hrefLang,referrerPolicy:a.referrerPolicy},Wn.set(e,a),h||f_(u,e,a,v.state))),t&&s===null)throw Error(l(528,""));return v}if(t&&s!==null)throw Error(l(529,""));return null;case"script":return t=a.async,a=a.src,typeof a=="string"&&t&&typeof t!="function"&&typeof t!="symbol"?(t=Si(a),a=Oe(u).hoistableScripts,s=a.get(t),s||(s={type:"script",instance:null,count:0,state:null},a.set(t,s)),s):{type:"void",instance:null,count:0,state:null};default:throw Error(l(444,e))}}function ji(e){return'href="'+En(e)+'"'}function Or(e){return'link[rel="stylesheet"]['+e+"]"}function Em(e){return j({},e,{"data-precedence":e.precedence,precedence:null})}function f_(e,t,a,s){e.querySelector('link[rel="preload"][as="style"]['+t+"]")?s.loading=1:(t=e.createElement("link"),s.preload=t,t.addEventListener("load",function(){return s.loading|=1}),t.addEventListener("error",function(){return s.loading|=2}),_n(t,"link",a),Qe(t),e.head.appendChild(t))}function Si(e){return'[src="'+En(e)+'"]'}function Rr(e){return"script[async]"+e}function Tm(e,t,a){if(t.count++,t.instance===null)switch(t.type){case"style":var s=e.querySelector('style[data-href~="'+En(a.href)+'"]');if(s)return t.instance=s,Qe(s),s;var u=j({},a,{"data-href":a.href,"data-precedence":a.precedence,href:null,precedence:null});return s=(e.ownerDocument||e).createElement("style"),Qe(s),_n(s,"style",u),Kl(s,a.precedence,e),t.instance=s;case"stylesheet":u=ji(a.href);var h=e.querySelector(Or(u));if(h)return t.state.loading|=4,t.instance=h,Qe(h),h;s=Em(a),(u=Wn.get(u))&&gu(s,u),h=(e.ownerDocument||e).createElement("link"),Qe(h);var v=h;return v._p=new Promise(function(b,z){v.onload=b,v.onerror=z}),_n(h,"link",s),t.state.loading|=4,Kl(h,a.precedence,e),t.instance=h;case"script":return h=Si(a.src),(u=e.querySelector(Rr(h)))?(t.instance=u,Qe(u),u):(s=a,(u=Wn.get(h))&&(s=j({},a),vu(s,u)),e=e.ownerDocument||e,u=e.createElement("script"),Qe(u),_n(u,"link",s),e.head.appendChild(u),t.instance=u);case"void":return null;default:throw Error(l(443,t.type))}else t.type==="stylesheet"&&(t.state.loading&4)===0&&(s=t.instance,t.state.loading|=4,Kl(s,a.precedence,e));return t.instance}function Kl(e,t,a){for(var s=a.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),u=s.length?s[s.length-1]:null,h=u,v=0;v<s.length;v++){var b=s[v];if(b.dataset.precedence===t)h=b;else if(h!==u)break}h?h.parentNode.insertBefore(e,h.nextSibling):(t=a.nodeType===9?a.head:a,t.insertBefore(e,t.firstChild))}function gu(e,t){e.crossOrigin==null&&(e.crossOrigin=t.crossOrigin),e.referrerPolicy==null&&(e.referrerPolicy=t.referrerPolicy),e.title==null&&(e.title=t.title)}function vu(e,t){e.crossOrigin==null&&(e.crossOrigin=t.crossOrigin),e.referrerPolicy==null&&(e.referrerPolicy=t.referrerPolicy),e.integrity==null&&(e.integrity=t.integrity)}var Jl=null;function Am(e,t,a){if(Jl===null){var s=new Map,u=Jl=new Map;u.set(a,s)}else u=Jl,s=u.get(a),s||(s=new Map,u.set(a,s));if(s.has(e))return s;for(s.set(e,null),a=a.getElementsByTagName(e),u=0;u<a.length;u++){var h=a[u];if(!(h[pe]||h[wt]||e==="link"&&h.getAttribute("rel")==="stylesheet")&&h.namespaceURI!=="http://www.w3.org/2000/svg"){var v=h.getAttribute(t)||"";v=e+v;var b=s.get(v);b?b.push(h):s.set(v,[h])}}return s}function km(e,t,a){e=e.ownerDocument||e,e.head.insertBefore(a,t==="title"?e.querySelector("head > title"):null)}function m_(e,t,a){if(a===1||t.itemProp!=null)return!1;switch(e){case"meta":case"title":return!0;case"style":if(typeof t.precedence!="string"||typeof t.href!="string"||t.href==="")break;return!0;case"link":if(typeof t.rel!="string"||typeof t.href!="string"||t.href===""||t.onLoad||t.onError)break;switch(t.rel){case"stylesheet":return e=t.disabled,typeof t.precedence=="string"&&e==null;default:return!0}case"script":if(t.async&&typeof t.async!="function"&&typeof t.async!="symbol"&&!t.onLoad&&!t.onError&&t.src&&typeof t.src=="string")return!0}return!1}function Om(e){return!(e.type==="stylesheet"&&(e.state.loading&3)===0)}function p_(e,t,a,s){if(a.type==="stylesheet"&&(typeof s.media!="string"||matchMedia(s.media).matches!==!1)&&(a.state.loading&4)===0){if(a.instance===null){var u=ji(s.href),h=t.querySelector(Or(u));if(h){t=h._p,t!==null&&typeof t=="object"&&typeof t.then=="function"&&(e.count++,e=Xl.bind(e),t.then(e,e)),a.state.loading|=4,a.instance=h,Qe(h);return}h=t.ownerDocument||t,s=Em(s),(u=Wn.get(u))&&gu(s,u),h=h.createElement("link"),Qe(h);var v=h;v._p=new Promise(function(b,z){v.onload=b,v.onerror=z}),_n(h,"link",s),a.instance=h}e.stylesheets===null&&(e.stylesheets=new Map),e.stylesheets.set(a,t),(t=a.state.preload)&&(a.state.loading&3)===0&&(e.count++,a=Xl.bind(e),t.addEventListener("load",a),t.addEventListener("error",a))}}var _u=0;function g_(e,t){return e.stylesheets&&e.count===0&&Wl(e,e.stylesheets),0<e.count||0<e.imgCount?function(a){var s=setTimeout(function(){if(e.stylesheets&&Wl(e,e.stylesheets),e.unsuspend){var h=e.unsuspend;e.unsuspend=null,h()}},6e4+t);0<e.imgBytes&&_u===0&&(_u=62500*Jv());var u=setTimeout(function(){if(e.waitingForImages=!1,e.count===0&&(e.stylesheets&&Wl(e,e.stylesheets),e.unsuspend)){var h=e.unsuspend;e.unsuspend=null,h()}},(e.imgBytes>_u?50:800)+t);return e.unsuspend=a,function(){e.unsuspend=null,clearTimeout(s),clearTimeout(u)}}:null}function Xl(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)Wl(this,this.stylesheets);else if(this.unsuspend){var e=this.unsuspend;this.unsuspend=null,e()}}}var Zl=null;function Wl(e,t){e.stylesheets=null,e.unsuspend!==null&&(e.count++,Zl=new Map,t.forEach(v_,e),Zl=null,Xl.call(e))}function v_(e,t){if(!(t.state.loading&4)){var a=Zl.get(e);if(a)var s=a.get(null);else{a=new Map,Zl.set(e,a);for(var u=e.querySelectorAll("link[data-precedence],style[data-precedence]"),h=0;h<u.length;h++){var v=u[h];(v.nodeName==="LINK"||v.getAttribute("media")!=="not all")&&(a.set(v.dataset.precedence,v),s=v)}s&&a.set(null,s)}u=t.instance,v=u.getAttribute("data-precedence"),h=a.get(v)||s,h===s&&a.set(null,u),a.set(v,u),this.count++,s=Xl.bind(this),u.addEventListener("load",s),u.addEventListener("error",s),h?h.parentNode.insertBefore(u,h.nextSibling):(e=e.nodeType===9?e.head:e,e.insertBefore(u,e.firstChild)),t.state.loading|=4}}var qr={$$typeof:U,Provider:null,Consumer:null,_currentValue:K,_currentValue2:K,_threadCount:0};function __(e,t,a,s,u,h,v,b,z){this.tag=1,this.containerInfo=e,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Pa(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Pa(0),this.hiddenUpdates=Pa(null),this.identifierPrefix=s,this.onUncaughtError=u,this.onCaughtError=h,this.onRecoverableError=v,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=z,this.incompleteTransitions=new Map}function Rm(e,t,a,s,u,h,v,b,z,W,oe,me){return e=new __(e,t,a,v,z,W,oe,me,b),t=1,h===!0&&(t|=24),h=zn(3,null,null,t),e.current=h,h.stateNode=e,t=Xo(),t.refCount++,e.pooledCache=t,t.refCount++,h.memoizedState={element:s,isDehydrated:a,cache:t},tc(h),e}function qm(e){return e?(e=ei,e):ei}function Dm(e,t,a,s,u,h){u=qm(u),s.context===null?s.context=u:s.pendingContext=u,s=Ka(t),s.payload={element:a},h=h===void 0?null:h,h!==null&&(s.callback=h),a=Ja(e,s,t),a!==null&&(qn(a,e,t),dr(a,e,t))}function Mm(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var a=e.retryLane;e.retryLane=a!==0&&a<t?a:t}}function yu(e,t){Mm(e,t),(e=e.alternate)&&Mm(e,t)}function zm(e){if(e.tag===13||e.tag===31){var t=js(e,67108864);t!==null&&qn(t,e,67108864),yu(e,67108864)}}function Lm(e){if(e.tag===13||e.tag===31){var t=Fn();t=vs(t);var a=js(e,t);a!==null&&qn(a,e,t),yu(e,t)}}var eo=!0;function y_(e,t,a,s){var u=F.T;F.T=null;var h=ne.p;try{ne.p=2,xu(e,t,a,s)}finally{ne.p=h,F.T=u}}function x_(e,t,a,s){var u=F.T;F.T=null;var h=ne.p;try{ne.p=8,xu(e,t,a,s)}finally{ne.p=h,F.T=u}}function xu(e,t,a,s){if(eo){var u=bu(s);if(u===null)ru(e,t,s,to,a),Bm(e,s);else if(j_(u,e,t,a,s))s.stopPropagation();else if(Bm(e,s),t&4&&-1<b_.indexOf(e)){for(;u!==null;){var h=Fe(u);if(h!==null)switch(h.tag){case 3:if(h=h.stateNode,h.current.memoizedState.isDehydrated){var v=Bt(h.pendingLanes);if(v!==0){var b=h;for(b.pendingLanes|=2,b.entangledLanes|=2;v;){var z=1<<31-Pe(v);b.entanglements[1]|=z,v&=~z}ma(h),(vt&6)===0&&(Ll=St()+500,Er(0))}}break;case 31:case 13:b=js(h,2),b!==null&&qn(b,h,2),Bl(),yu(h,2)}if(h=bu(s),h===null&&ru(e,t,s,to,a),h===u)break;u=h}u!==null&&s.stopPropagation()}else ru(e,t,s,null,a)}}function bu(e){return e=Ks(e),ju(e)}var to=null;function ju(e){if(to=null,e=ke(e),e!==null){var t=d(e);if(t===null)e=null;else{var a=t.tag;if(a===13){if(e=f(t),e!==null)return e;e=null}else if(a===31){if(e=g(t),e!==null)return e;e=null}else if(a===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null)}}return to=e,null}function Um(e){switch(e){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Ht()){case mn:return 2;case tn:return 8;case B:case w:return 32;case ae:return 268435456;default:return 32}default:return 32}}var Su=!1,ls=null,os=null,cs=null,Dr=new Map,Mr=new Map,us=[],b_="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Bm(e,t){switch(e){case"focusin":case"focusout":ls=null;break;case"dragenter":case"dragleave":os=null;break;case"mouseover":case"mouseout":cs=null;break;case"pointerover":case"pointerout":Dr.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Mr.delete(t.pointerId)}}function zr(e,t,a,s,u,h){return e===null||e.nativeEvent!==h?(e={blockedOn:t,domEventName:a,eventSystemFlags:s,nativeEvent:h,targetContainers:[u]},t!==null&&(t=Fe(t),t!==null&&zm(t)),e):(e.eventSystemFlags|=s,t=e.targetContainers,u!==null&&t.indexOf(u)===-1&&t.push(u),e)}function j_(e,t,a,s,u){switch(t){case"focusin":return ls=zr(ls,e,t,a,s,u),!0;case"dragenter":return os=zr(os,e,t,a,s,u),!0;case"mouseover":return cs=zr(cs,e,t,a,s,u),!0;case"pointerover":var h=u.pointerId;return Dr.set(h,zr(Dr.get(h)||null,e,t,a,s,u)),!0;case"gotpointercapture":return h=u.pointerId,Mr.set(h,zr(Mr.get(h)||null,e,t,a,s,u)),!0}return!1}function Pm(e){var t=ke(e.target);if(t!==null){var a=d(t);if(a!==null){if(t=a.tag,t===13){if(t=f(a),t!==null){e.blockedOn=t,Vs(e.priority,function(){Lm(a)});return}}else if(t===31){if(t=g(a),t!==null){e.blockedOn=t,Vs(e.priority,function(){Lm(a)});return}}else if(t===3&&a.stateNode.current.memoizedState.isDehydrated){e.blockedOn=a.tag===3?a.stateNode.containerInfo:null;return}}}e.blockedOn=null}function no(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var a=bu(e.nativeEvent);if(a===null){a=e.nativeEvent;var s=new a.constructor(a.type,a);_s=s,a.target.dispatchEvent(s),_s=null}else return t=Fe(a),t!==null&&zm(t),e.blockedOn=a,!1;t.shift()}return!0}function Fm(e,t,a){no(e)&&a.delete(t)}function S_(){Su=!1,ls!==null&&no(ls)&&(ls=null),os!==null&&no(os)&&(os=null),cs!==null&&no(cs)&&(cs=null),Dr.forEach(Fm),Mr.forEach(Fm)}function ao(e,t){e.blockedOn===t&&(e.blockedOn=null,Su||(Su=!0,o.unstable_scheduleCallback(o.unstable_NormalPriority,S_)))}var so=null;function Hm(e){so!==e&&(so=e,o.unstable_scheduleCallback(o.unstable_NormalPriority,function(){so===e&&(so=null);for(var t=0;t<e.length;t+=3){var a=e[t],s=e[t+1],u=e[t+2];if(typeof s!="function"){if(ju(s||a)===null)continue;break}var h=Fe(a);h!==null&&(e.splice(t,3),t-=3,bc(h,{pending:!0,data:u,method:a.method,action:s},s,u))}}))}function wi(e){function t(z){return ao(z,e)}ls!==null&&ao(ls,e),os!==null&&ao(os,e),cs!==null&&ao(cs,e),Dr.forEach(t),Mr.forEach(t);for(var a=0;a<us.length;a++){var s=us[a];s.blockedOn===e&&(s.blockedOn=null)}for(;0<us.length&&(a=us[0],a.blockedOn===null);)Pm(a),a.blockedOn===null&&us.shift();if(a=(e.ownerDocument||e).$$reactFormReplay,a!=null)for(s=0;s<a.length;s+=3){var u=a[s],h=a[s+1],v=u[Yt]||null;if(typeof h=="function")v||Hm(a);else if(v){var b=null;if(h&&h.hasAttribute("formAction")){if(u=h,v=h[Yt]||null)b=v.formAction;else if(ju(u)!==null)continue}else b=v.action;typeof b=="function"?a[s+1]=b:(a.splice(s,3),s-=3),Hm(a)}}}function $m(){function e(h){h.canIntercept&&h.info==="react-transition"&&h.intercept({handler:function(){return new Promise(function(v){return u=v})},focusReset:"manual",scroll:"manual"})}function t(){u!==null&&(u(),u=null),s||setTimeout(a,20)}function a(){if(!s&&!navigation.transition){var h=navigation.currentEntry;h&&h.url!=null&&navigation.navigate(h.url,{state:h.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var s=!1,u=null;return navigation.addEventListener("navigate",e),navigation.addEventListener("navigatesuccess",t),navigation.addEventListener("navigateerror",t),setTimeout(a,100),function(){s=!0,navigation.removeEventListener("navigate",e),navigation.removeEventListener("navigatesuccess",t),navigation.removeEventListener("navigateerror",t),u!==null&&(u(),u=null)}}}function wu(e){this._internalRoot=e}io.prototype.render=wu.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(l(409));var a=t.current,s=Fn();Dm(a,s,e,t,null,null)},io.prototype.unmount=wu.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;Dm(e.current,2,null,e,null,null),Bl(),t[I]=null}};function io(e){this._internalRoot=e}io.prototype.unstable_scheduleHydration=function(e){if(e){var t=Is();e={blockedOn:null,target:e,priority:t};for(var a=0;a<us.length&&t!==0&&t<us[a].priority;a++);us.splice(a,0,e),a===0&&Pm(e)}};var Im=i.version;if(Im!=="19.2.0")throw Error(l(527,Im,"19.2.0"));ne.findDOMNode=function(e){var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(l(188)):(e=Object.keys(e).join(","),Error(l(268,e)));return e=p(t),e=e!==null?_(e):null,e=e===null?null:e.stateNode,e};var w_={bundleType:0,version:"19.2.0",rendererPackageName:"react-dom",currentDispatcherRef:F,reconcilerVersion:"19.2.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var ro=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ro.isDisabled&&ro.supportsFiber)try{ge=ro.inject(w_),Te=ro}catch{}}return Ur.createRoot=function(e,t){if(!c(e))throw Error(l(299));var a=!1,s="",u=Jh,h=Xh,v=Zh;return t!=null&&(t.unstable_strictMode===!0&&(a=!0),t.identifierPrefix!==void 0&&(s=t.identifierPrefix),t.onUncaughtError!==void 0&&(u=t.onUncaughtError),t.onCaughtError!==void 0&&(h=t.onCaughtError),t.onRecoverableError!==void 0&&(v=t.onRecoverableError)),t=Rm(e,1,!1,null,null,a,s,null,u,h,v,$m),e[I]=t.current,iu(e),new wu(t)},Ur.hydrateRoot=function(e,t,a){if(!c(e))throw Error(l(299));var s=!1,u="",h=Jh,v=Xh,b=Zh,z=null;return a!=null&&(a.unstable_strictMode===!0&&(s=!0),a.identifierPrefix!==void 0&&(u=a.identifierPrefix),a.onUncaughtError!==void 0&&(h=a.onUncaughtError),a.onCaughtError!==void 0&&(v=a.onCaughtError),a.onRecoverableError!==void 0&&(b=a.onRecoverableError),a.formState!==void 0&&(z=a.formState)),t=Rm(e,1,!0,t,a??null,s,u,z,h,v,b,$m),t.context=qm(null),a=t.current,s=Fn(),s=vs(s),u=Ka(s),u.callback=null,Ja(a,u,s),a=s,t.current.lanes=a,ca(t,a),ma(t),e[I]=t.current,iu(e),new io(t)},Ur.version="19.2.0",Ur}var ep;function M_(){if(ep)return Eu.exports;ep=1;function o(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(o)}catch(i){console.error(i)}}return o(),Eu.exports=D_(),Eu.exports}var z_=M_();const L_=ed(z_);/**
 * react-router v7.9.4
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var tp="popstate";function U_(o={}){function i(l,c){let{pathname:d,search:f,hash:g}=l.location;return Fu("",{pathname:d,search:f,hash:g},c.state&&c.state.usr||null,c.state&&c.state.key||"default")}function r(l,c){return typeof c=="string"?c:Ir(c)}return P_(i,r,null,o)}function zt(o,i){if(o===!1||o===null||typeof o>"u")throw new Error(i)}function la(o,i){if(!o){typeof console<"u"&&console.warn(i);try{throw new Error(i)}catch{}}}function B_(){return Math.random().toString(36).substring(2,10)}function np(o,i){return{usr:o.state,key:o.key,idx:i}}function Fu(o,i,r=null,l){return{pathname:typeof o=="string"?o:o.pathname,search:"",hash:"",...typeof i=="string"?Pi(i):i,state:r,key:i&&i.key||l||B_()}}function Ir({pathname:o="/",search:i="",hash:r=""}){return i&&i!=="?"&&(o+=i.charAt(0)==="?"?i:"?"+i),r&&r!=="#"&&(o+=r.charAt(0)==="#"?r:"#"+r),o}function Pi(o){let i={};if(o){let r=o.indexOf("#");r>=0&&(i.hash=o.substring(r),o=o.substring(0,r));let l=o.indexOf("?");l>=0&&(i.search=o.substring(l),o=o.substring(0,l)),o&&(i.pathname=o)}return i}function P_(o,i,r,l={}){let{window:c=document.defaultView,v5Compat:d=!1}=l,f=c.history,g="POP",m=null,p=_();p==null&&(p=0,f.replaceState({...f.state,idx:p},""));function _(){return(f.state||{idx:null}).idx}function j(){g="POP";let E=_(),V=E==null?null:E-p;p=E,m&&m({action:g,location:P.location,delta:V})}function C(E,V){g="PUSH";let L=Fu(P.location,E,V);p=_()+1;let U=np(L,p),O=P.createHref(L);try{f.pushState(U,"",O)}catch(M){if(M instanceof DOMException&&M.name==="DataCloneError")throw M;c.location.assign(O)}d&&m&&m({action:g,location:P.location,delta:1})}function N(E,V){g="REPLACE";let L=Fu(P.location,E,V);p=_();let U=np(L,p),O=P.createHref(L);f.replaceState(U,"",O),d&&m&&m({action:g,location:P.location,delta:0})}function k(E){return F_(E)}let P={get action(){return g},get location(){return o(c,f)},listen(E){if(m)throw new Error("A history only accepts one active listener");return c.addEventListener(tp,j),m=E,()=>{c.removeEventListener(tp,j),m=null}},createHref(E){return i(c,E)},createURL:k,encodeLocation(E){let V=k(E);return{pathname:V.pathname,search:V.search,hash:V.hash}},push:C,replace:N,go(E){return f.go(E)}};return P}function F_(o,i=!1){let r="http://localhost";typeof window<"u"&&(r=window.location.origin!=="null"?window.location.origin:window.location.href),zt(r,"No window.location.(origin|href) available to create URL");let l=typeof o=="string"?o:Ir(o);return l=l.replace(/ $/,"%20"),!i&&l.startsWith("//")&&(l=r+l),new URL(l,r)}function Mp(o,i,r="/"){return H_(o,i,r,!1)}function H_(o,i,r,l){let c=typeof i=="string"?Pi(i):i,d=Ua(c.pathname||"/",r);if(d==null)return null;let f=zp(o);$_(f);let g=null;for(let m=0;g==null&&m<f.length;++m){let p=ey(d);g=Z_(f[m],p,l)}return g}function zp(o,i=[],r=[],l="",c=!1){let d=(f,g,m=c,p)=>{let _={relativePath:p===void 0?f.path||"":p,caseSensitive:f.caseSensitive===!0,childrenIndex:g,route:f};if(_.relativePath.startsWith("/")){if(!_.relativePath.startsWith(l)&&m)return;zt(_.relativePath.startsWith(l),`Absolute route path "${_.relativePath}" nested under path "${l}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),_.relativePath=_.relativePath.slice(l.length)}let j=La([l,_.relativePath]),C=r.concat(_);f.children&&f.children.length>0&&(zt(f.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${j}".`),zp(f.children,i,C,j,m)),!(f.path==null&&!f.index)&&i.push({path:j,score:J_(j,f.index),routesMeta:C})};return o.forEach((f,g)=>{if(f.path===""||!f.path?.includes("?"))d(f,g);else for(let m of Lp(f.path))d(f,g,!0,m)}),i}function Lp(o){let i=o.split("/");if(i.length===0)return[];let[r,...l]=i,c=r.endsWith("?"),d=r.replace(/\?$/,"");if(l.length===0)return c?[d,""]:[d];let f=Lp(l.join("/")),g=[];return g.push(...f.map(m=>m===""?d:[d,m].join("/"))),c&&g.push(...f),g.map(m=>o.startsWith("/")&&m===""?"/":m)}function $_(o){o.sort((i,r)=>i.score!==r.score?r.score-i.score:X_(i.routesMeta.map(l=>l.childrenIndex),r.routesMeta.map(l=>l.childrenIndex)))}var I_=/^:[\w-]+$/,V_=3,G_=2,Y_=1,Q_=10,K_=-2,ap=o=>o==="*";function J_(o,i){let r=o.split("/"),l=r.length;return r.some(ap)&&(l+=K_),i&&(l+=G_),r.filter(c=>!ap(c)).reduce((c,d)=>c+(I_.test(d)?V_:d===""?Y_:Q_),l)}function X_(o,i){return o.length===i.length&&o.slice(0,-1).every((l,c)=>l===i[c])?o[o.length-1]-i[i.length-1]:0}function Z_(o,i,r=!1){let{routesMeta:l}=o,c={},d="/",f=[];for(let g=0;g<l.length;++g){let m=l[g],p=g===l.length-1,_=d==="/"?i:i.slice(d.length)||"/",j=po({path:m.relativePath,caseSensitive:m.caseSensitive,end:p},_),C=m.route;if(!j&&p&&r&&!l[l.length-1].route.index&&(j=po({path:m.relativePath,caseSensitive:m.caseSensitive,end:!1},_)),!j)return null;Object.assign(c,j.params),f.push({params:c,pathname:La([d,j.pathname]),pathnameBase:sy(La([d,j.pathnameBase])),route:C}),j.pathnameBase!=="/"&&(d=La([d,j.pathnameBase]))}return f}function po(o,i){typeof o=="string"&&(o={path:o,caseSensitive:!1,end:!0});let[r,l]=W_(o.path,o.caseSensitive,o.end),c=i.match(r);if(!c)return null;let d=c[0],f=d.replace(/(.)\/+$/,"$1"),g=c.slice(1);return{params:l.reduce((p,{paramName:_,isOptional:j},C)=>{if(_==="*"){let k=g[C]||"";f=d.slice(0,d.length-k.length).replace(/(.)\/+$/,"$1")}const N=g[C];return j&&!N?p[_]=void 0:p[_]=(N||"").replace(/%2F/g,"/"),p},{}),pathname:d,pathnameBase:f,pattern:o}}function W_(o,i=!1,r=!0){la(o==="*"||!o.endsWith("*")||o.endsWith("/*"),`Route path "${o}" will be treated as if it were "${o.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${o.replace(/\*$/,"/*")}".`);let l=[],c="^"+o.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(f,g,m)=>(l.push({paramName:g,isOptional:m!=null}),m?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return o.endsWith("*")?(l.push({paramName:"*"}),c+=o==="*"||o==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):r?c+="\\/*$":o!==""&&o!=="/"&&(c+="(?:(?=\\/|$))"),[new RegExp(c,i?void 0:"i"),l]}function ey(o){try{return o.split("/").map(i=>decodeURIComponent(i).replace(/\//g,"%2F")).join("/")}catch(i){return la(!1,`The URL path "${o}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${i}).`),o}}function Ua(o,i){if(i==="/")return o;if(!o.toLowerCase().startsWith(i.toLowerCase()))return null;let r=i.endsWith("/")?i.length-1:i.length,l=o.charAt(r);return l&&l!=="/"?null:o.slice(r)||"/"}function ty(o,i="/"){let{pathname:r,search:l="",hash:c=""}=typeof o=="string"?Pi(o):o;return{pathname:r?r.startsWith("/")?r:ny(r,i):i,search:iy(l),hash:ry(c)}}function ny(o,i){let r=i.replace(/\/+$/,"").split("/");return o.split("/").forEach(c=>{c===".."?r.length>1&&r.pop():c!=="."&&r.push(c)}),r.length>1?r.join("/"):"/"}function Ou(o,i,r,l){return`Cannot include a '${o}' character in a manually specified \`to.${i}\` field [${JSON.stringify(l)}].  Please separate it out to the \`to.${r}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function ay(o){return o.filter((i,r)=>r===0||i.route.path&&i.route.path.length>0)}function nd(o){let i=ay(o);return i.map((r,l)=>l===i.length-1?r.pathname:r.pathnameBase)}function ad(o,i,r,l=!1){let c;typeof o=="string"?c=Pi(o):(c={...o},zt(!c.pathname||!c.pathname.includes("?"),Ou("?","pathname","search",c)),zt(!c.pathname||!c.pathname.includes("#"),Ou("#","pathname","hash",c)),zt(!c.search||!c.search.includes("#"),Ou("#","search","hash",c)));let d=o===""||c.pathname==="",f=d?"/":c.pathname,g;if(f==null)g=r;else{let j=i.length-1;if(!l&&f.startsWith("..")){let C=f.split("/");for(;C[0]==="..";)C.shift(),j-=1;c.pathname=C.join("/")}g=j>=0?i[j]:"/"}let m=ty(c,g),p=f&&f!=="/"&&f.endsWith("/"),_=(d||f===".")&&r.endsWith("/");return!m.pathname.endsWith("/")&&(p||_)&&(m.pathname+="/"),m}var La=o=>o.join("/").replace(/\/\/+/g,"/"),sy=o=>o.replace(/\/+$/,"").replace(/^\/*/,"/"),iy=o=>!o||o==="?"?"":o.startsWith("?")?o:"?"+o,ry=o=>!o||o==="#"?"":o.startsWith("#")?o:"#"+o;function ly(o){return o!=null&&typeof o.status=="number"&&typeof o.statusText=="string"&&typeof o.internal=="boolean"&&"data"in o}var Up=["POST","PUT","PATCH","DELETE"];new Set(Up);var oy=["GET",...Up];new Set(oy);var Fi=y.createContext(null);Fi.displayName="DataRouter";var xo=y.createContext(null);xo.displayName="DataRouterState";y.createContext(!1);var Bp=y.createContext({isTransitioning:!1});Bp.displayName="ViewTransition";var cy=y.createContext(new Map);cy.displayName="Fetchers";var uy=y.createContext(null);uy.displayName="Await";var oa=y.createContext(null);oa.displayName="Navigation";var Yr=y.createContext(null);Yr.displayName="Location";var va=y.createContext({outlet:null,matches:[],isDataRoute:!1});va.displayName="Route";var sd=y.createContext(null);sd.displayName="RouteError";function dy(o,{relative:i}={}){zt(Hi(),"useHref() may be used only in the context of a <Router> component.");let{basename:r,navigator:l}=y.useContext(oa),{hash:c,pathname:d,search:f}=Kr(o,{relative:i}),g=d;return r!=="/"&&(g=d==="/"?r:La([r,d])),l.createHref({pathname:g,search:f,hash:c})}function Hi(){return y.useContext(Yr)!=null}function Ba(){return zt(Hi(),"useLocation() may be used only in the context of a <Router> component."),y.useContext(Yr).location}var Pp="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function Fp(o){y.useContext(oa).static||y.useLayoutEffect(o)}function Qr(){let{isDataRoute:o}=y.useContext(va);return o?wy():hy()}function hy(){zt(Hi(),"useNavigate() may be used only in the context of a <Router> component.");let o=y.useContext(Fi),{basename:i,navigator:r}=y.useContext(oa),{matches:l}=y.useContext(va),{pathname:c}=Ba(),d=JSON.stringify(nd(l)),f=y.useRef(!1);return Fp(()=>{f.current=!0}),y.useCallback((m,p={})=>{if(la(f.current,Pp),!f.current)return;if(typeof m=="number"){r.go(m);return}let _=ad(m,JSON.parse(d),c,p.relative==="path");o==null&&i!=="/"&&(_.pathname=_.pathname==="/"?i:La([i,_.pathname])),(p.replace?r.replace:r.push)(_,p.state,p)},[i,r,d,c,o])}y.createContext(null);function Kr(o,{relative:i}={}){let{matches:r}=y.useContext(va),{pathname:l}=Ba(),c=JSON.stringify(nd(r));return y.useMemo(()=>ad(o,JSON.parse(c),l,i==="path"),[o,c,l,i])}function fy(o,i){return Hp(o,i)}function Hp(o,i,r,l,c){zt(Hi(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:d}=y.useContext(oa),{matches:f}=y.useContext(va),g=f[f.length-1],m=g?g.params:{},p=g?g.pathname:"/",_=g?g.pathnameBase:"/",j=g&&g.route;{let L=j&&j.path||"";$p(p,!j||L.endsWith("*")||L.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${p}" (under <Route path="${L}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${L}"> to <Route path="${L==="/"?"*":`${L}/*`}">.`)}let C=Ba(),N;if(i){let L=typeof i=="string"?Pi(i):i;zt(_==="/"||L.pathname?.startsWith(_),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${_}" but pathname "${L.pathname}" was given in the \`location\` prop.`),N=L}else N=C;let k=N.pathname||"/",P=k;if(_!=="/"){let L=_.replace(/^\//,"").split("/");P="/"+k.replace(/^\//,"").split("/").slice(L.length).join("/")}let E=Mp(o,{pathname:P});la(j||E!=null,`No routes matched location "${N.pathname}${N.search}${N.hash}" `),la(E==null||E[E.length-1].route.element!==void 0||E[E.length-1].route.Component!==void 0||E[E.length-1].route.lazy!==void 0,`Matched leaf route at location "${N.pathname}${N.search}${N.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let V=_y(E&&E.map(L=>Object.assign({},L,{params:Object.assign({},m,L.params),pathname:La([_,d.encodeLocation?d.encodeLocation(L.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:L.pathname]),pathnameBase:L.pathnameBase==="/"?_:La([_,d.encodeLocation?d.encodeLocation(L.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:L.pathnameBase])})),f,r,l,c);return i&&V?y.createElement(Yr.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...N},navigationType:"POP"}},V):V}function my(){let o=Sy(),i=ly(o)?`${o.status} ${o.statusText}`:o instanceof Error?o.message:JSON.stringify(o),r=o instanceof Error?o.stack:null,l="rgba(200,200,200, 0.5)",c={padding:"0.5rem",backgroundColor:l},d={padding:"2px 4px",backgroundColor:l},f=null;return console.error("Error handled by React Router default ErrorBoundary:",o),f=y.createElement(y.Fragment,null,y.createElement("p",null,"💿 Hey developer 👋"),y.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",y.createElement("code",{style:d},"ErrorBoundary")," or"," ",y.createElement("code",{style:d},"errorElement")," prop on your route.")),y.createElement(y.Fragment,null,y.createElement("h2",null,"Unexpected Application Error!"),y.createElement("h3",{style:{fontStyle:"italic"}},i),r?y.createElement("pre",{style:c},r):null,f)}var py=y.createElement(my,null),gy=class extends y.Component{constructor(o){super(o),this.state={location:o.location,revalidation:o.revalidation,error:o.error}}static getDerivedStateFromError(o){return{error:o}}static getDerivedStateFromProps(o,i){return i.location!==o.location||i.revalidation!=="idle"&&o.revalidation==="idle"?{error:o.error,location:o.location,revalidation:o.revalidation}:{error:o.error!==void 0?o.error:i.error,location:i.location,revalidation:o.revalidation||i.revalidation}}componentDidCatch(o,i){this.props.unstable_onError?this.props.unstable_onError(o,i):console.error("React Router caught the following error during render",o)}render(){return this.state.error!==void 0?y.createElement(va.Provider,{value:this.props.routeContext},y.createElement(sd.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function vy({routeContext:o,match:i,children:r}){let l=y.useContext(Fi);return l&&l.static&&l.staticContext&&(i.route.errorElement||i.route.ErrorBoundary)&&(l.staticContext._deepestRenderedBoundaryId=i.route.id),y.createElement(va.Provider,{value:o},r)}function _y(o,i=[],r=null,l=null,c=null){if(o==null){if(!r)return null;if(r.errors)o=r.matches;else if(i.length===0&&!r.initialized&&r.matches.length>0)o=r.matches;else return null}let d=o,f=r?.errors;if(f!=null){let p=d.findIndex(_=>_.route.id&&f?.[_.route.id]!==void 0);zt(p>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(f).join(",")}`),d=d.slice(0,Math.min(d.length,p+1))}let g=!1,m=-1;if(r)for(let p=0;p<d.length;p++){let _=d[p];if((_.route.HydrateFallback||_.route.hydrateFallbackElement)&&(m=p),_.route.id){let{loaderData:j,errors:C}=r,N=_.route.loader&&!j.hasOwnProperty(_.route.id)&&(!C||C[_.route.id]===void 0);if(_.route.lazy||N){g=!0,m>=0?d=d.slice(0,m+1):d=[d[0]];break}}}return d.reduceRight((p,_,j)=>{let C,N=!1,k=null,P=null;r&&(C=f&&_.route.id?f[_.route.id]:void 0,k=_.route.errorElement||py,g&&(m<0&&j===0?($p("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),N=!0,P=null):m===j&&(N=!0,P=_.route.hydrateFallbackElement||null)));let E=i.concat(d.slice(0,j+1)),V=()=>{let L;return C?L=k:N?L=P:_.route.Component?L=y.createElement(_.route.Component,null):_.route.element?L=_.route.element:L=p,y.createElement(vy,{match:_,routeContext:{outlet:p,matches:E,isDataRoute:r!=null},children:L})};return r&&(_.route.ErrorBoundary||_.route.errorElement||j===0)?y.createElement(gy,{location:r.location,revalidation:r.revalidation,component:k,error:C,children:V(),routeContext:{outlet:null,matches:E,isDataRoute:!0},unstable_onError:l}):V()},null)}function id(o){return`${o} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function yy(o){let i=y.useContext(Fi);return zt(i,id(o)),i}function xy(o){let i=y.useContext(xo);return zt(i,id(o)),i}function by(o){let i=y.useContext(va);return zt(i,id(o)),i}function rd(o){let i=by(o),r=i.matches[i.matches.length-1];return zt(r.route.id,`${o} can only be used on routes that contain a unique "id"`),r.route.id}function jy(){return rd("useRouteId")}function Sy(){let o=y.useContext(sd),i=xy("useRouteError"),r=rd("useRouteError");return o!==void 0?o:i.errors?.[r]}function wy(){let{router:o}=yy("useNavigate"),i=rd("useNavigate"),r=y.useRef(!1);return Fp(()=>{r.current=!0}),y.useCallback(async(c,d={})=>{la(r.current,Pp),r.current&&(typeof c=="number"?o.navigate(c):await o.navigate(c,{fromRouteId:i,...d}))},[o,i])}var sp={};function $p(o,i,r){!i&&!sp[o]&&(sp[o]=!0,la(!1,r))}y.memo(Ny);function Ny({routes:o,future:i,state:r,unstable_onError:l}){return Hp(o,void 0,r,l,i)}function Ip({to:o,replace:i,state:r,relative:l}){zt(Hi(),"<Navigate> may be used only in the context of a <Router> component.");let{static:c}=y.useContext(oa);la(!c,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:d}=y.useContext(va),{pathname:f}=Ba(),g=Qr(),m=ad(o,nd(d),f,l==="path"),p=JSON.stringify(m);return y.useEffect(()=>{g(JSON.parse(p),{replace:i,state:r,relative:l})},[g,p,l,i,r]),null}function pa(o){zt(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function Cy({basename:o="/",children:i=null,location:r,navigationType:l="POP",navigator:c,static:d=!1}){zt(!Hi(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let f=o.replace(/^\/*/,"/"),g=y.useMemo(()=>({basename:f,navigator:c,static:d,future:{}}),[f,c,d]);typeof r=="string"&&(r=Pi(r));let{pathname:m="/",search:p="",hash:_="",state:j=null,key:C="default"}=r,N=y.useMemo(()=>{let k=Ua(m,f);return k==null?null:{location:{pathname:k,search:p,hash:_,state:j,key:C},navigationType:l}},[f,m,p,_,j,C,l]);return la(N!=null,`<Router basename="${f}"> is not able to match the URL "${m}${p}${_}" because it does not start with the basename, so the <Router> won't render anything.`),N==null?null:y.createElement(oa.Provider,{value:g},y.createElement(Yr.Provider,{children:i,value:N}))}function Ey({children:o,location:i}){return fy(Hu(o),i)}function Hu(o,i=[]){let r=[];return y.Children.forEach(o,(l,c)=>{if(!y.isValidElement(l))return;let d=[...i,c];if(l.type===y.Fragment){r.push.apply(r,Hu(l.props.children,d));return}zt(l.type===pa,`[${typeof l.type=="string"?l.type:l.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),zt(!l.props.index||!l.props.children,"An index route cannot have child routes.");let f={id:l.props.id||d.join("-"),caseSensitive:l.props.caseSensitive,element:l.props.element,Component:l.props.Component,index:l.props.index,path:l.props.path,middleware:l.props.middleware,loader:l.props.loader,action:l.props.action,hydrateFallbackElement:l.props.hydrateFallbackElement,HydrateFallback:l.props.HydrateFallback,errorElement:l.props.errorElement,ErrorBoundary:l.props.ErrorBoundary,hasErrorBoundary:l.props.hasErrorBoundary===!0||l.props.ErrorBoundary!=null||l.props.errorElement!=null,shouldRevalidate:l.props.shouldRevalidate,handle:l.props.handle,lazy:l.props.lazy};l.props.children&&(f.children=Hu(l.props.children,d)),r.push(f)}),r}var fo="get",mo="application/x-www-form-urlencoded";function bo(o){return o!=null&&typeof o.tagName=="string"}function Ty(o){return bo(o)&&o.tagName.toLowerCase()==="button"}function Ay(o){return bo(o)&&o.tagName.toLowerCase()==="form"}function ky(o){return bo(o)&&o.tagName.toLowerCase()==="input"}function Oy(o){return!!(o.metaKey||o.altKey||o.ctrlKey||o.shiftKey)}function Ry(o,i){return o.button===0&&(!i||i==="_self")&&!Oy(o)}var lo=null;function qy(){if(lo===null)try{new FormData(document.createElement("form"),0),lo=!1}catch{lo=!0}return lo}var Dy=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function Ru(o){return o!=null&&!Dy.has(o)?(la(!1,`"${o}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${mo}"`),null):o}function My(o,i){let r,l,c,d,f;if(Ay(o)){let g=o.getAttribute("action");l=g?Ua(g,i):null,r=o.getAttribute("method")||fo,c=Ru(o.getAttribute("enctype"))||mo,d=new FormData(o)}else if(Ty(o)||ky(o)&&(o.type==="submit"||o.type==="image")){let g=o.form;if(g==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let m=o.getAttribute("formaction")||g.getAttribute("action");if(l=m?Ua(m,i):null,r=o.getAttribute("formmethod")||g.getAttribute("method")||fo,c=Ru(o.getAttribute("formenctype"))||Ru(g.getAttribute("enctype"))||mo,d=new FormData(g,o),!qy()){let{name:p,type:_,value:j}=o;if(_==="image"){let C=p?`${p}.`:"";d.append(`${C}x`,"0"),d.append(`${C}y`,"0")}else p&&d.append(p,j)}}else{if(bo(o))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');r=fo,l=null,c=mo,f=o}return d&&c==="text/plain"&&(f=d,d=void 0),{action:l,method:r.toLowerCase(),encType:c,formData:d,body:f}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function ld(o,i){if(o===!1||o===null||typeof o>"u")throw new Error(i)}function zy(o,i,r){let l=typeof o=="string"?new URL(o,typeof window>"u"?"server://singlefetch/":window.location.origin):o;return l.pathname==="/"?l.pathname=`_root.${r}`:i&&Ua(l.pathname,i)==="/"?l.pathname=`${i.replace(/\/$/,"")}/_root.${r}`:l.pathname=`${l.pathname.replace(/\/$/,"")}.${r}`,l}async function Ly(o,i){if(o.id in i)return i[o.id];try{let r=await import(o.module);return i[o.id]=r,r}catch(r){return console.error(`Error loading route module \`${o.module}\`, reloading page...`),console.error(r),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function Uy(o){return o==null?!1:o.href==null?o.rel==="preload"&&typeof o.imageSrcSet=="string"&&typeof o.imageSizes=="string":typeof o.rel=="string"&&typeof o.href=="string"}async function By(o,i,r){let l=await Promise.all(o.map(async c=>{let d=i.routes[c.route.id];if(d){let f=await Ly(d,r);return f.links?f.links():[]}return[]}));return $y(l.flat(1).filter(Uy).filter(c=>c.rel==="stylesheet"||c.rel==="preload").map(c=>c.rel==="stylesheet"?{...c,rel:"prefetch",as:"style"}:{...c,rel:"prefetch"}))}function ip(o,i,r,l,c,d){let f=(m,p)=>r[p]?m.route.id!==r[p].route.id:!0,g=(m,p)=>r[p].pathname!==m.pathname||r[p].route.path?.endsWith("*")&&r[p].params["*"]!==m.params["*"];return d==="assets"?i.filter((m,p)=>f(m,p)||g(m,p)):d==="data"?i.filter((m,p)=>{let _=l.routes[m.route.id];if(!_||!_.hasLoader)return!1;if(f(m,p)||g(m,p))return!0;if(m.route.shouldRevalidate){let j=m.route.shouldRevalidate({currentUrl:new URL(c.pathname+c.search+c.hash,window.origin),currentParams:r[0]?.params||{},nextUrl:new URL(o,window.origin),nextParams:m.params,defaultShouldRevalidate:!0});if(typeof j=="boolean")return j}return!0}):[]}function Py(o,i,{includeHydrateFallback:r}={}){return Fy(o.map(l=>{let c=i.routes[l.route.id];if(!c)return[];let d=[c.module];return c.clientActionModule&&(d=d.concat(c.clientActionModule)),c.clientLoaderModule&&(d=d.concat(c.clientLoaderModule)),r&&c.hydrateFallbackModule&&(d=d.concat(c.hydrateFallbackModule)),c.imports&&(d=d.concat(c.imports)),d}).flat(1))}function Fy(o){return[...new Set(o)]}function Hy(o){let i={},r=Object.keys(o).sort();for(let l of r)i[l]=o[l];return i}function $y(o,i){let r=new Set;return new Set(i),o.reduce((l,c)=>{let d=JSON.stringify(Hy(c));return r.has(d)||(r.add(d),l.push({key:d,link:c})),l},[])}function Vp(){let o=y.useContext(Fi);return ld(o,"You must render this element inside a <DataRouterContext.Provider> element"),o}function Iy(){let o=y.useContext(xo);return ld(o,"You must render this element inside a <DataRouterStateContext.Provider> element"),o}var od=y.createContext(void 0);od.displayName="FrameworkContext";function Gp(){let o=y.useContext(od);return ld(o,"You must render this element inside a <HydratedRouter> element"),o}function Vy(o,i){let r=y.useContext(od),[l,c]=y.useState(!1),[d,f]=y.useState(!1),{onFocus:g,onBlur:m,onMouseEnter:p,onMouseLeave:_,onTouchStart:j}=i,C=y.useRef(null);y.useEffect(()=>{if(o==="render"&&f(!0),o==="viewport"){let P=V=>{V.forEach(L=>{f(L.isIntersecting)})},E=new IntersectionObserver(P,{threshold:.5});return C.current&&E.observe(C.current),()=>{E.disconnect()}}},[o]),y.useEffect(()=>{if(l){let P=setTimeout(()=>{f(!0)},100);return()=>{clearTimeout(P)}}},[l]);let N=()=>{c(!0)},k=()=>{c(!1),f(!1)};return r?o!=="intent"?[d,C,{}]:[d,C,{onFocus:Br(g,N),onBlur:Br(m,k),onMouseEnter:Br(p,N),onMouseLeave:Br(_,k),onTouchStart:Br(j,N)}]:[!1,C,{}]}function Br(o,i){return r=>{o&&o(r),r.defaultPrevented||i(r)}}function Gy({page:o,...i}){let{router:r}=Vp(),l=y.useMemo(()=>Mp(r.routes,o,r.basename),[r.routes,o,r.basename]);return l?y.createElement(Qy,{page:o,matches:l,...i}):null}function Yy(o){let{manifest:i,routeModules:r}=Gp(),[l,c]=y.useState([]);return y.useEffect(()=>{let d=!1;return By(o,i,r).then(f=>{d||c(f)}),()=>{d=!0}},[o,i,r]),l}function Qy({page:o,matches:i,...r}){let l=Ba(),{manifest:c,routeModules:d}=Gp(),{basename:f}=Vp(),{loaderData:g,matches:m}=Iy(),p=y.useMemo(()=>ip(o,i,m,c,l,"data"),[o,i,m,c,l]),_=y.useMemo(()=>ip(o,i,m,c,l,"assets"),[o,i,m,c,l]),j=y.useMemo(()=>{if(o===l.pathname+l.search+l.hash)return[];let k=new Set,P=!1;if(i.forEach(V=>{let L=c.routes[V.route.id];!L||!L.hasLoader||(!p.some(U=>U.route.id===V.route.id)&&V.route.id in g&&d[V.route.id]?.shouldRevalidate||L.hasClientLoader?P=!0:k.add(V.route.id))}),k.size===0)return[];let E=zy(o,f,"data");return P&&k.size>0&&E.searchParams.set("_routes",i.filter(V=>k.has(V.route.id)).map(V=>V.route.id).join(",")),[E.pathname+E.search]},[f,g,l,c,p,i,o,d]),C=y.useMemo(()=>Py(_,c),[_,c]),N=Yy(_);return y.createElement(y.Fragment,null,j.map(k=>y.createElement("link",{key:k,rel:"prefetch",as:"fetch",href:k,...r})),C.map(k=>y.createElement("link",{key:k,rel:"modulepreload",href:k,...r})),N.map(({key:k,link:P})=>y.createElement("link",{key:k,nonce:r.nonce,...P})))}function Ky(...o){return i=>{o.forEach(r=>{typeof r=="function"?r(i):r!=null&&(r.current=i)})}}var Yp=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{Yp&&(window.__reactRouterVersion="7.9.4")}catch{}function Jy({basename:o,children:i,window:r}){let l=y.useRef();l.current==null&&(l.current=U_({window:r,v5Compat:!0}));let c=l.current,[d,f]=y.useState({action:c.action,location:c.location}),g=y.useCallback(m=>{y.startTransition(()=>f(m))},[f]);return y.useLayoutEffect(()=>c.listen(g),[c,g]),y.createElement(Cy,{basename:o,children:i,location:d.location,navigationType:d.action,navigator:c})}var Qp=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Kp=y.forwardRef(function({onClick:i,discover:r="render",prefetch:l="none",relative:c,reloadDocument:d,replace:f,state:g,target:m,to:p,preventScrollReset:_,viewTransition:j,...C},N){let{basename:k}=y.useContext(oa),P=typeof p=="string"&&Qp.test(p),E,V=!1;if(typeof p=="string"&&P&&(E=p,Yp))try{let T=new URL(window.location.href),ce=p.startsWith("//")?new URL(T.protocol+p):new URL(p),se=Ua(ce.pathname,k);ce.origin===T.origin&&se!=null?p=se+ce.search+ce.hash:V=!0}catch{la(!1,`<Link to="${p}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let L=dy(p,{relative:c}),[U,O,M]=Vy(l,C),G=ex(p,{replace:f,state:g,target:m,preventScrollReset:_,relative:c,viewTransition:j});function q(T){i&&i(T),T.defaultPrevented||G(T)}let Y=y.createElement("a",{...C,...M,href:E||L,onClick:V||d?i:q,ref:Ky(N,O),target:m,"data-discover":!P&&r==="render"?"true":void 0});return U&&!P?y.createElement(y.Fragment,null,Y,y.createElement(Gy,{page:L})):Y});Kp.displayName="Link";var Xy=y.forwardRef(function({"aria-current":i="page",caseSensitive:r=!1,className:l="",end:c=!1,style:d,to:f,viewTransition:g,children:m,...p},_){let j=Kr(f,{relative:p.relative}),C=Ba(),N=y.useContext(xo),{navigator:k,basename:P}=y.useContext(oa),E=N!=null&&ix(j)&&g===!0,V=k.encodeLocation?k.encodeLocation(j).pathname:j.pathname,L=C.pathname,U=N&&N.navigation&&N.navigation.location?N.navigation.location.pathname:null;r||(L=L.toLowerCase(),U=U?U.toLowerCase():null,V=V.toLowerCase()),U&&P&&(U=Ua(U,P)||U);const O=V!=="/"&&V.endsWith("/")?V.length-1:V.length;let M=L===V||!c&&L.startsWith(V)&&L.charAt(O)==="/",G=U!=null&&(U===V||!c&&U.startsWith(V)&&U.charAt(V.length)==="/"),q={isActive:M,isPending:G,isTransitioning:E},Y=M?i:void 0,T;typeof l=="function"?T=l(q):T=[l,M?"active":null,G?"pending":null,E?"transitioning":null].filter(Boolean).join(" ");let ce=typeof d=="function"?d(q):d;return y.createElement(Kp,{...p,"aria-current":Y,className:T,ref:_,style:ce,to:f,viewTransition:g},typeof m=="function"?m(q):m)});Xy.displayName="NavLink";var Zy=y.forwardRef(({discover:o="render",fetcherKey:i,navigate:r,reloadDocument:l,replace:c,state:d,method:f=fo,action:g,onSubmit:m,relative:p,preventScrollReset:_,viewTransition:j,...C},N)=>{let k=ax(),P=sx(g,{relative:p}),E=f.toLowerCase()==="get"?"get":"post",V=typeof g=="string"&&Qp.test(g),L=U=>{if(m&&m(U),U.defaultPrevented)return;U.preventDefault();let O=U.nativeEvent.submitter,M=O?.getAttribute("formmethod")||f;k(O||U.currentTarget,{fetcherKey:i,method:M,navigate:r,replace:c,state:d,relative:p,preventScrollReset:_,viewTransition:j})};return y.createElement("form",{ref:N,method:E,action:P,onSubmit:l?m:L,...C,"data-discover":!V&&o==="render"?"true":void 0})});Zy.displayName="Form";function Wy(o){return`${o} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function Jp(o){let i=y.useContext(Fi);return zt(i,Wy(o)),i}function ex(o,{target:i,replace:r,state:l,preventScrollReset:c,relative:d,viewTransition:f}={}){let g=Qr(),m=Ba(),p=Kr(o,{relative:d});return y.useCallback(_=>{if(Ry(_,i)){_.preventDefault();let j=r!==void 0?r:Ir(m)===Ir(p);g(o,{replace:j,state:l,preventScrollReset:c,relative:d,viewTransition:f})}},[m,g,p,r,l,i,o,c,d,f])}var tx=0,nx=()=>`__${String(++tx)}__`;function ax(){let{router:o}=Jp("useSubmit"),{basename:i}=y.useContext(oa),r=jy();return y.useCallback(async(l,c={})=>{let{action:d,method:f,encType:g,formData:m,body:p}=My(l,i);if(c.navigate===!1){let _=c.fetcherKey||nx();await o.fetch(_,r,c.action||d,{preventScrollReset:c.preventScrollReset,formData:m,body:p,formMethod:c.method||f,formEncType:c.encType||g,flushSync:c.flushSync})}else await o.navigate(c.action||d,{preventScrollReset:c.preventScrollReset,formData:m,body:p,formMethod:c.method||f,formEncType:c.encType||g,replace:c.replace,state:c.state,fromRouteId:r,flushSync:c.flushSync,viewTransition:c.viewTransition})},[o,i,r])}function sx(o,{relative:i}={}){let{basename:r}=y.useContext(oa),l=y.useContext(va);zt(l,"useFormAction must be used inside a RouteContext");let[c]=l.matches.slice(-1),d={...Kr(o||".",{relative:i})},f=Ba();if(o==null){d.search=f.search;let g=new URLSearchParams(d.search),m=g.getAll("index");if(m.some(_=>_==="")){g.delete("index"),m.filter(j=>j).forEach(j=>g.append("index",j));let _=g.toString();d.search=_?`?${_}`:""}}return(!o||o===".")&&c.route.index&&(d.search=d.search?d.search.replace(/^\?/,"?index&"):"?index"),r!=="/"&&(d.pathname=d.pathname==="/"?r:La([r,d.pathname])),Ir(d)}function ix(o,{relative:i}={}){let r=y.useContext(Bp);zt(r!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:l}=Jp("useViewTransitionState"),c=Kr(o,{relative:i});if(!r.isTransitioning)return!1;let d=Ua(r.currentLocation.pathname,l)||r.currentLocation.pathname,f=Ua(r.nextLocation.pathname,l)||r.nextLocation.pathname;return po(c.pathname,f)!=null||po(c.pathname,d)!=null}const rx="modulepreload",lx=function(o){return"/"+o},rp={},Jr=function(i,r,l){let c=Promise.resolve();if(r&&r.length>0){let p=function(_){return Promise.all(_.map(j=>Promise.resolve(j).then(C=>({status:"fulfilled",value:C}),C=>({status:"rejected",reason:C}))))};var f=p;document.getElementsByTagName("link");const g=document.querySelector("meta[property=csp-nonce]"),m=g?.nonce||g?.getAttribute("nonce");c=p(r.map(_=>{if(_=lx(_),_ in rp)return;rp[_]=!0;const j=_.endsWith(".css"),C=j?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${_}"]${C}`))return;const N=document.createElement("link");if(N.rel=j?"stylesheet":rx,j||(N.as="script"),N.crossOrigin="",N.href=_,m&&N.setAttribute("nonce",m),document.head.appendChild(N),j)return new Promise((k,P)=>{N.addEventListener("load",k),N.addEventListener("error",()=>P(new Error(`Unable to preload CSS for ${_}`)))})}))}function d(g){const m=new Event("vite:preloadError",{cancelable:!0});if(m.payload=g,window.dispatchEvent(m),!m.defaultPrevented)throw g}return c.then(g=>{for(const m of g||[])m.status==="rejected"&&d(m.reason);return i().catch(d)})},ox=o=>{let i;return o?i=o:typeof fetch>"u"?i=(...r)=>Jr(async()=>{const{default:l}=await Promise.resolve().then(()=>$i);return{default:l}},[]).then(({default:l})=>l(...r)):i=fetch,(...r)=>i(...r)};class cd extends Error{constructor(i,r="FunctionsError",l){super(i),this.name=r,this.context=l}}class lp extends cd{constructor(i){super("Failed to send a request to the Edge Function","FunctionsFetchError",i)}}class op extends cd{constructor(i){super("Relay Error invoking the Edge Function","FunctionsRelayError",i)}}class cp extends cd{constructor(i){super("Edge Function returned a non-2xx status code","FunctionsHttpError",i)}}var $u;(function(o){o.Any="any",o.ApNortheast1="ap-northeast-1",o.ApNortheast2="ap-northeast-2",o.ApSouth1="ap-south-1",o.ApSoutheast1="ap-southeast-1",o.ApSoutheast2="ap-southeast-2",o.CaCentral1="ca-central-1",o.EuCentral1="eu-central-1",o.EuWest1="eu-west-1",o.EuWest2="eu-west-2",o.EuWest3="eu-west-3",o.SaEast1="sa-east-1",o.UsEast1="us-east-1",o.UsWest1="us-west-1",o.UsWest2="us-west-2"})($u||($u={}));var cx=function(o,i,r,l){function c(d){return d instanceof r?d:new r(function(f){f(d)})}return new(r||(r=Promise))(function(d,f){function g(_){try{p(l.next(_))}catch(j){f(j)}}function m(_){try{p(l.throw(_))}catch(j){f(j)}}function p(_){_.done?d(_.value):c(_.value).then(g,m)}p((l=l.apply(o,i||[])).next())})};class ux{constructor(i,{headers:r={},customFetch:l,region:c=$u.Any}={}){this.url=i,this.headers=r,this.region=c,this.fetch=ox(l)}setAuth(i){this.headers.Authorization=`Bearer ${i}`}invoke(i){return cx(this,arguments,void 0,function*(r,l={}){var c;try{const{headers:d,method:f,body:g,signal:m}=l;let p={},{region:_}=l;_||(_=this.region);const j=new URL(`${this.url}/${r}`);_&&_!=="any"&&(p["x-region"]=_,j.searchParams.set("forceFunctionRegion",_));let C;g&&(d&&!Object.prototype.hasOwnProperty.call(d,"Content-Type")||!d)&&(typeof Blob<"u"&&g instanceof Blob||g instanceof ArrayBuffer?(p["Content-Type"]="application/octet-stream",C=g):typeof g=="string"?(p["Content-Type"]="text/plain",C=g):typeof FormData<"u"&&g instanceof FormData?C=g:(p["Content-Type"]="application/json",C=JSON.stringify(g)));const N=yield this.fetch(j.toString(),{method:f||"POST",headers:Object.assign(Object.assign(Object.assign({},p),this.headers),d),body:C,signal:m}).catch(V=>{throw V.name==="AbortError"?V:new lp(V)}),k=N.headers.get("x-relay-error");if(k&&k==="true")throw new op(N);if(!N.ok)throw new cp(N);let P=((c=N.headers.get("Content-Type"))!==null&&c!==void 0?c:"text/plain").split(";")[0].trim(),E;return P==="application/json"?E=yield N.json():P==="application/octet-stream"?E=yield N.blob():P==="text/event-stream"?E=N:P==="multipart/form-data"?E=yield N.formData():E=yield N.text(),{data:E,error:null,response:N}}catch(d){return d instanceof Error&&d.name==="AbortError"?{data:null,error:new lp(d)}:{data:null,error:d,response:d instanceof cp||d instanceof op?d.context:void 0}}})}}var fn={},Ni={},Ci={},Ei={},Ti={},Ai={},dx=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},Bi=dx();const hx=Bi.fetch,Xp=Bi.fetch.bind(Bi),Zp=Bi.Headers,fx=Bi.Request,mx=Bi.Response,$i=Object.freeze(Object.defineProperty({__proto__:null,Headers:Zp,Request:fx,Response:mx,default:Xp,fetch:hx},Symbol.toStringTag,{value:"Module"})),px=C_($i);var oo={},up;function Wp(){if(up)return oo;up=1,Object.defineProperty(oo,"__esModule",{value:!0});class o extends Error{constructor(r){super(r.message),this.name="PostgrestError",this.details=r.details,this.hint=r.hint,this.code=r.code}}return oo.default=o,oo}var dp;function eg(){if(dp)return Ai;dp=1;var o=Ai&&Ai.__importDefault||function(c){return c&&c.__esModule?c:{default:c}};Object.defineProperty(Ai,"__esModule",{value:!0});const i=o(px),r=o(Wp());class l{constructor(d){var f,g;this.shouldThrowOnError=!1,this.method=d.method,this.url=d.url,this.headers=new Headers(d.headers),this.schema=d.schema,this.body=d.body,this.shouldThrowOnError=(f=d.shouldThrowOnError)!==null&&f!==void 0?f:!1,this.signal=d.signal,this.isMaybeSingle=(g=d.isMaybeSingle)!==null&&g!==void 0?g:!1,d.fetch?this.fetch=d.fetch:typeof fetch>"u"?this.fetch=i.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(d,f){return this.headers=new Headers(this.headers),this.headers.set(d,f),this}then(d,f){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const g=this.fetch;let m=g(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async p=>{var _,j,C,N;let k=null,P=null,E=null,V=p.status,L=p.statusText;if(p.ok){if(this.method!=="HEAD"){const G=await p.text();G===""||(this.headers.get("Accept")==="text/csv"||this.headers.get("Accept")&&(!((_=this.headers.get("Accept"))===null||_===void 0)&&_.includes("application/vnd.pgrst.plan+text"))?P=G:P=JSON.parse(G))}const O=(j=this.headers.get("Prefer"))===null||j===void 0?void 0:j.match(/count=(exact|planned|estimated)/),M=(C=p.headers.get("content-range"))===null||C===void 0?void 0:C.split("/");O&&M&&M.length>1&&(E=parseInt(M[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(P)&&(P.length>1?(k={code:"PGRST116",details:`Results contain ${P.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},P=null,E=null,V=406,L="Not Acceptable"):P.length===1?P=P[0]:P=null)}else{const O=await p.text();try{k=JSON.parse(O),Array.isArray(k)&&p.status===404&&(P=[],k=null,V=200,L="OK")}catch{p.status===404&&O===""?(V=204,L="No Content"):k={message:O}}if(k&&this.isMaybeSingle&&(!((N=k?.details)===null||N===void 0)&&N.includes("0 rows"))&&(k=null,V=200,L="OK"),k&&this.shouldThrowOnError)throw new r.default(k)}return{error:k,data:P,count:E,status:V,statusText:L}});return this.shouldThrowOnError||(m=m.catch(p=>{var _,j,C;return{error:{message:`${(_=p?.name)!==null&&_!==void 0?_:"FetchError"}: ${p?.message}`,details:`${(j=p?.stack)!==null&&j!==void 0?j:""}`,hint:"",code:`${(C=p?.code)!==null&&C!==void 0?C:""}`},data:null,count:null,status:0,statusText:""}})),m.then(d,f)}returns(){return this}overrideTypes(){return this}}return Ai.default=l,Ai}var hp;function tg(){if(hp)return Ti;hp=1;var o=Ti&&Ti.__importDefault||function(l){return l&&l.__esModule?l:{default:l}};Object.defineProperty(Ti,"__esModule",{value:!0});const i=o(eg());class r extends i.default{select(c){let d=!1;const f=(c??"*").split("").map(g=>/\s/.test(g)&&!d?"":(g==='"'&&(d=!d),g)).join("");return this.url.searchParams.set("select",f),this.headers.append("Prefer","return=representation"),this}order(c,{ascending:d=!0,nullsFirst:f,foreignTable:g,referencedTable:m=g}={}){const p=m?`${m}.order`:"order",_=this.url.searchParams.get(p);return this.url.searchParams.set(p,`${_?`${_},`:""}${c}.${d?"asc":"desc"}${f===void 0?"":f?".nullsfirst":".nullslast"}`),this}limit(c,{foreignTable:d,referencedTable:f=d}={}){const g=typeof f>"u"?"limit":`${f}.limit`;return this.url.searchParams.set(g,`${c}`),this}range(c,d,{foreignTable:f,referencedTable:g=f}={}){const m=typeof g>"u"?"offset":`${g}.offset`,p=typeof g>"u"?"limit":`${g}.limit`;return this.url.searchParams.set(m,`${c}`),this.url.searchParams.set(p,`${d-c+1}`),this}abortSignal(c){return this.signal=c,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:c=!1,verbose:d=!1,settings:f=!1,buffers:g=!1,wal:m=!1,format:p="text"}={}){var _;const j=[c?"analyze":null,d?"verbose":null,f?"settings":null,g?"buffers":null,m?"wal":null].filter(Boolean).join("|"),C=(_=this.headers.get("Accept"))!==null&&_!==void 0?_:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${p}; for="${C}"; options=${j};`),p==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(c){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${c}`),this}}return Ti.default=r,Ti}var fp;function ud(){if(fp)return Ei;fp=1;var o=Ei&&Ei.__importDefault||function(l){return l&&l.__esModule?l:{default:l}};Object.defineProperty(Ei,"__esModule",{value:!0});const i=o(tg());class r extends i.default{eq(c,d){return this.url.searchParams.append(c,`eq.${d}`),this}neq(c,d){return this.url.searchParams.append(c,`neq.${d}`),this}gt(c,d){return this.url.searchParams.append(c,`gt.${d}`),this}gte(c,d){return this.url.searchParams.append(c,`gte.${d}`),this}lt(c,d){return this.url.searchParams.append(c,`lt.${d}`),this}lte(c,d){return this.url.searchParams.append(c,`lte.${d}`),this}like(c,d){return this.url.searchParams.append(c,`like.${d}`),this}likeAllOf(c,d){return this.url.searchParams.append(c,`like(all).{${d.join(",")}}`),this}likeAnyOf(c,d){return this.url.searchParams.append(c,`like(any).{${d.join(",")}}`),this}ilike(c,d){return this.url.searchParams.append(c,`ilike.${d}`),this}ilikeAllOf(c,d){return this.url.searchParams.append(c,`ilike(all).{${d.join(",")}}`),this}ilikeAnyOf(c,d){return this.url.searchParams.append(c,`ilike(any).{${d.join(",")}}`),this}is(c,d){return this.url.searchParams.append(c,`is.${d}`),this}in(c,d){const f=Array.from(new Set(d)).map(g=>typeof g=="string"&&new RegExp("[,()]").test(g)?`"${g}"`:`${g}`).join(",");return this.url.searchParams.append(c,`in.(${f})`),this}contains(c,d){return typeof d=="string"?this.url.searchParams.append(c,`cs.${d}`):Array.isArray(d)?this.url.searchParams.append(c,`cs.{${d.join(",")}}`):this.url.searchParams.append(c,`cs.${JSON.stringify(d)}`),this}containedBy(c,d){return typeof d=="string"?this.url.searchParams.append(c,`cd.${d}`):Array.isArray(d)?this.url.searchParams.append(c,`cd.{${d.join(",")}}`):this.url.searchParams.append(c,`cd.${JSON.stringify(d)}`),this}rangeGt(c,d){return this.url.searchParams.append(c,`sr.${d}`),this}rangeGte(c,d){return this.url.searchParams.append(c,`nxl.${d}`),this}rangeLt(c,d){return this.url.searchParams.append(c,`sl.${d}`),this}rangeLte(c,d){return this.url.searchParams.append(c,`nxr.${d}`),this}rangeAdjacent(c,d){return this.url.searchParams.append(c,`adj.${d}`),this}overlaps(c,d){return typeof d=="string"?this.url.searchParams.append(c,`ov.${d}`):this.url.searchParams.append(c,`ov.{${d.join(",")}}`),this}textSearch(c,d,{config:f,type:g}={}){let m="";g==="plain"?m="pl":g==="phrase"?m="ph":g==="websearch"&&(m="w");const p=f===void 0?"":`(${f})`;return this.url.searchParams.append(c,`${m}fts${p}.${d}`),this}match(c){return Object.entries(c).forEach(([d,f])=>{this.url.searchParams.append(d,`eq.${f}`)}),this}not(c,d,f){return this.url.searchParams.append(c,`not.${d}.${f}`),this}or(c,{foreignTable:d,referencedTable:f=d}={}){const g=f?`${f}.or`:"or";return this.url.searchParams.append(g,`(${c})`),this}filter(c,d,f){return this.url.searchParams.append(c,`${d}.${f}`),this}}return Ei.default=r,Ei}var mp;function ng(){if(mp)return Ci;mp=1;var o=Ci&&Ci.__importDefault||function(l){return l&&l.__esModule?l:{default:l}};Object.defineProperty(Ci,"__esModule",{value:!0});const i=o(ud());class r{constructor(c,{headers:d={},schema:f,fetch:g}){this.url=c,this.headers=new Headers(d),this.schema=f,this.fetch=g}select(c,d){const{head:f=!1,count:g}=d??{},m=f?"HEAD":"GET";let p=!1;const _=(c??"*").split("").map(j=>/\s/.test(j)&&!p?"":(j==='"'&&(p=!p),j)).join("");return this.url.searchParams.set("select",_),g&&this.headers.append("Prefer",`count=${g}`),new i.default({method:m,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(c,{count:d,defaultToNull:f=!0}={}){var g;const m="POST";if(d&&this.headers.append("Prefer",`count=${d}`),f||this.headers.append("Prefer","missing=default"),Array.isArray(c)){const p=c.reduce((_,j)=>_.concat(Object.keys(j)),[]);if(p.length>0){const _=[...new Set(p)].map(j=>`"${j}"`);this.url.searchParams.set("columns",_.join(","))}}return new i.default({method:m,url:this.url,headers:this.headers,schema:this.schema,body:c,fetch:(g=this.fetch)!==null&&g!==void 0?g:fetch})}upsert(c,{onConflict:d,ignoreDuplicates:f=!1,count:g,defaultToNull:m=!0}={}){var p;const _="POST";if(this.headers.append("Prefer",`resolution=${f?"ignore":"merge"}-duplicates`),d!==void 0&&this.url.searchParams.set("on_conflict",d),g&&this.headers.append("Prefer",`count=${g}`),m||this.headers.append("Prefer","missing=default"),Array.isArray(c)){const j=c.reduce((C,N)=>C.concat(Object.keys(N)),[]);if(j.length>0){const C=[...new Set(j)].map(N=>`"${N}"`);this.url.searchParams.set("columns",C.join(","))}}return new i.default({method:_,url:this.url,headers:this.headers,schema:this.schema,body:c,fetch:(p=this.fetch)!==null&&p!==void 0?p:fetch})}update(c,{count:d}={}){var f;const g="PATCH";return d&&this.headers.append("Prefer",`count=${d}`),new i.default({method:g,url:this.url,headers:this.headers,schema:this.schema,body:c,fetch:(f=this.fetch)!==null&&f!==void 0?f:fetch})}delete({count:c}={}){var d;const f="DELETE";return c&&this.headers.append("Prefer",`count=${c}`),new i.default({method:f,url:this.url,headers:this.headers,schema:this.schema,fetch:(d=this.fetch)!==null&&d!==void 0?d:fetch})}}return Ci.default=r,Ci}var pp;function gx(){if(pp)return Ni;pp=1;var o=Ni&&Ni.__importDefault||function(c){return c&&c.__esModule?c:{default:c}};Object.defineProperty(Ni,"__esModule",{value:!0});const i=o(ng()),r=o(ud());class l{constructor(d,{headers:f={},schema:g,fetch:m}={}){this.url=d,this.headers=new Headers(f),this.schemaName=g,this.fetch=m}from(d){const f=new URL(`${this.url}/${d}`);return new i.default(f,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(d){return new l(this.url,{headers:this.headers,schema:d,fetch:this.fetch})}rpc(d,f={},{head:g=!1,get:m=!1,count:p}={}){var _;let j;const C=new URL(`${this.url}/rpc/${d}`);let N;g||m?(j=g?"HEAD":"GET",Object.entries(f).filter(([P,E])=>E!==void 0).map(([P,E])=>[P,Array.isArray(E)?`{${E.join(",")}}`:`${E}`]).forEach(([P,E])=>{C.searchParams.append(P,E)})):(j="POST",N=f);const k=new Headers(this.headers);return p&&k.set("Prefer",`count=${p}`),new r.default({method:j,url:C,headers:k,schema:this.schemaName,body:N,fetch:(_=this.fetch)!==null&&_!==void 0?_:fetch})}}return Ni.default=l,Ni}var gp;function vx(){if(gp)return fn;gp=1;var o=fn&&fn.__importDefault||function(g){return g&&g.__esModule?g:{default:g}};Object.defineProperty(fn,"__esModule",{value:!0}),fn.PostgrestError=fn.PostgrestBuilder=fn.PostgrestTransformBuilder=fn.PostgrestFilterBuilder=fn.PostgrestQueryBuilder=fn.PostgrestClient=void 0;const i=o(gx());fn.PostgrestClient=i.default;const r=o(ng());fn.PostgrestQueryBuilder=r.default;const l=o(ud());fn.PostgrestFilterBuilder=l.default;const c=o(tg());fn.PostgrestTransformBuilder=c.default;const d=o(eg());fn.PostgrestBuilder=d.default;const f=o(Wp());return fn.PostgrestError=f.default,fn.default={PostgrestClient:i.default,PostgrestQueryBuilder:r.default,PostgrestFilterBuilder:l.default,PostgrestTransformBuilder:c.default,PostgrestBuilder:d.default,PostgrestError:f.default},fn}var _x=vx();const yx=ed(_x),{PostgrestClient:xx,PostgrestQueryBuilder:Jj,PostgrestFilterBuilder:Xj,PostgrestTransformBuilder:Zj,PostgrestBuilder:Wj,PostgrestError:e0}=yx;class bx{static detectEnvironment(){var i;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((i=navigator.userAgent)===null||i===void 0)&&i.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"){const r=process.versions;if(r&&r.node){const l=r.node,c=parseInt(l.replace(/^v/,"").split(".")[0]);return c>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${c} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${c} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const i=this.detectEnvironment();if(i.constructor)return i.constructor;let r=i.error||"WebSocket not supported in this environment.";throw i.workaround&&(r+=`

Suggested solution: ${i.workaround}`),new Error(r)}static createWebSocket(i,r){const l=this.getWebSocketConstructor();return new l(i,r)}static isWebSocketSupported(){try{const i=this.detectEnvironment();return i.type==="native"||i.type==="ws"}catch{return!1}}}const jx="2.75.0",Sx=`realtime-js/${jx}`,wx="1.0.0",Iu=1e4,Nx=1e3,Cx=100;var Fr;(function(o){o[o.connecting=0]="connecting",o[o.open=1]="open",o[o.closing=2]="closing",o[o.closed=3]="closed"})(Fr||(Fr={}));var rn;(function(o){o.closed="closed",o.errored="errored",o.joined="joined",o.joining="joining",o.leaving="leaving"})(rn||(rn={}));var ra;(function(o){o.close="phx_close",o.error="phx_error",o.join="phx_join",o.reply="phx_reply",o.leave="phx_leave",o.access_token="access_token"})(ra||(ra={}));var Vu;(function(o){o.websocket="websocket"})(Vu||(Vu={}));var Bs;(function(o){o.Connecting="connecting",o.Open="open",o.Closing="closing",o.Closed="closed"})(Bs||(Bs={}));class Ex{constructor(){this.HEADER_LENGTH=1}decode(i,r){return i.constructor===ArrayBuffer?r(this._binaryDecode(i)):r(typeof i=="string"?JSON.parse(i):{})}_binaryDecode(i){const r=new DataView(i),l=new TextDecoder;return this._decodeBroadcast(i,r,l)}_decodeBroadcast(i,r,l){const c=r.getUint8(1),d=r.getUint8(2);let f=this.HEADER_LENGTH+2;const g=l.decode(i.slice(f,f+c));f=f+c;const m=l.decode(i.slice(f,f+d));f=f+d;const p=JSON.parse(l.decode(i.slice(f,i.byteLength)));return{ref:null,topic:g,event:m,payload:p}}}class ag{constructor(i,r){this.callback=i,this.timerCalc=r,this.timer=void 0,this.tries=0,this.callback=i,this.timerCalc=r}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var At;(function(o){o.abstime="abstime",o.bool="bool",o.date="date",o.daterange="daterange",o.float4="float4",o.float8="float8",o.int2="int2",o.int4="int4",o.int4range="int4range",o.int8="int8",o.int8range="int8range",o.json="json",o.jsonb="jsonb",o.money="money",o.numeric="numeric",o.oid="oid",o.reltime="reltime",o.text="text",o.time="time",o.timestamp="timestamp",o.timestamptz="timestamptz",o.timetz="timetz",o.tsrange="tsrange",o.tstzrange="tstzrange"})(At||(At={}));const vp=(o,i,r={})=>{var l;const c=(l=r.skipTypes)!==null&&l!==void 0?l:[];return i?Object.keys(i).reduce((d,f)=>(d[f]=Tx(f,o,i,c),d),{}):{}},Tx=(o,i,r,l)=>{const c=i.find(g=>g.name===o),d=c?.type,f=r[o];return d&&!l.includes(d)?sg(d,f):Gu(f)},sg=(o,i)=>{if(o.charAt(0)==="_"){const r=o.slice(1,o.length);return Rx(i,r)}switch(o){case At.bool:return Ax(i);case At.float4:case At.float8:case At.int2:case At.int4:case At.int8:case At.numeric:case At.oid:return kx(i);case At.json:case At.jsonb:return Ox(i);case At.timestamp:return qx(i);case At.abstime:case At.date:case At.daterange:case At.int4range:case At.int8range:case At.money:case At.reltime:case At.text:case At.time:case At.timestamptz:case At.timetz:case At.tsrange:case At.tstzrange:return Gu(i);default:return Gu(i)}},Gu=o=>o,Ax=o=>{switch(o){case"t":return!0;case"f":return!1;default:return o}},kx=o=>{if(typeof o=="string"){const i=parseFloat(o);if(!Number.isNaN(i))return i}return o},Ox=o=>{if(typeof o=="string")try{return JSON.parse(o)}catch(i){return console.log(`JSON parse error: ${i}`),o}return o},Rx=(o,i)=>{if(typeof o!="string")return o;const r=o.length-1,l=o[r];if(o[0]==="{"&&l==="}"){let d;const f=o.slice(1,r);try{d=JSON.parse("["+f+"]")}catch{d=f?f.split(","):[]}return d.map(g=>sg(i,g))}return o},qx=o=>typeof o=="string"?o.replace(" ","T"):o,ig=o=>{let i=o;return i=i.replace(/^ws/i,"http"),i=i.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),i.replace(/\/+$/,"")+"/api/broadcast"};class qu{constructor(i,r,l={},c=Iu){this.channel=i,this.event=r,this.payload=l,this.timeout=c,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(i){this.timeout=i,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(i){this.payload=Object.assign(Object.assign({},this.payload),i)}receive(i,r){var l;return this._hasReceived(i)&&r((l=this.receivedResp)===null||l===void 0?void 0:l.response),this.recHooks.push({status:i,callback:r}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const i=r=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=r,this._matchReceive(r)};this.channel._on(this.refEvent,{},i),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(i,r){this.refEvent&&this.channel._trigger(this.refEvent,{status:i,response:r})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:i,response:r}){this.recHooks.filter(l=>l.status===i).forEach(l=>l.callback(r))}_hasReceived(i){return this.receivedResp&&this.receivedResp.status===i}}var _p;(function(o){o.SYNC="sync",o.JOIN="join",o.LEAVE="leave"})(_p||(_p={}));class Hr{constructor(i,r){this.channel=i,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const l=r?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(l.state,{},c=>{const{onJoin:d,onLeave:f,onSync:g}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Hr.syncState(this.state,c,d,f),this.pendingDiffs.forEach(m=>{this.state=Hr.syncDiff(this.state,m,d,f)}),this.pendingDiffs=[],g()}),this.channel._on(l.diff,{},c=>{const{onJoin:d,onLeave:f,onSync:g}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(c):(this.state=Hr.syncDiff(this.state,c,d,f),g())}),this.onJoin((c,d,f)=>{this.channel._trigger("presence",{event:"join",key:c,currentPresences:d,newPresences:f})}),this.onLeave((c,d,f)=>{this.channel._trigger("presence",{event:"leave",key:c,currentPresences:d,leftPresences:f})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(i,r,l,c){const d=this.cloneDeep(i),f=this.transformState(r),g={},m={};return this.map(d,(p,_)=>{f[p]||(m[p]=_)}),this.map(f,(p,_)=>{const j=d[p];if(j){const C=_.map(E=>E.presence_ref),N=j.map(E=>E.presence_ref),k=_.filter(E=>N.indexOf(E.presence_ref)<0),P=j.filter(E=>C.indexOf(E.presence_ref)<0);k.length>0&&(g[p]=k),P.length>0&&(m[p]=P)}else g[p]=_}),this.syncDiff(d,{joins:g,leaves:m},l,c)}static syncDiff(i,r,l,c){const{joins:d,leaves:f}={joins:this.transformState(r.joins),leaves:this.transformState(r.leaves)};return l||(l=()=>{}),c||(c=()=>{}),this.map(d,(g,m)=>{var p;const _=(p=i[g])!==null&&p!==void 0?p:[];if(i[g]=this.cloneDeep(m),_.length>0){const j=i[g].map(N=>N.presence_ref),C=_.filter(N=>j.indexOf(N.presence_ref)<0);i[g].unshift(...C)}l(g,_,m)}),this.map(f,(g,m)=>{let p=i[g];if(!p)return;const _=m.map(j=>j.presence_ref);p=p.filter(j=>_.indexOf(j.presence_ref)<0),i[g]=p,c(g,p,m),p.length===0&&delete i[g]}),i}static map(i,r){return Object.getOwnPropertyNames(i).map(l=>r(l,i[l]))}static transformState(i){return i=this.cloneDeep(i),Object.getOwnPropertyNames(i).reduce((r,l)=>{const c=i[l];return"metas"in c?r[l]=c.metas.map(d=>(d.presence_ref=d.phx_ref,delete d.phx_ref,delete d.phx_ref_prev,d)):r[l]=c,r},{})}static cloneDeep(i){return JSON.parse(JSON.stringify(i))}onJoin(i){this.caller.onJoin=i}onLeave(i){this.caller.onLeave=i}onSync(i){this.caller.onSync=i}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var yp;(function(o){o.ALL="*",o.INSERT="INSERT",o.UPDATE="UPDATE",o.DELETE="DELETE"})(yp||(yp={}));var $r;(function(o){o.BROADCAST="broadcast",o.PRESENCE="presence",o.POSTGRES_CHANGES="postgres_changes",o.SYSTEM="system"})($r||($r={}));var za;(function(o){o.SUBSCRIBED="SUBSCRIBED",o.TIMED_OUT="TIMED_OUT",o.CLOSED="CLOSED",o.CHANNEL_ERROR="CHANNEL_ERROR"})(za||(za={}));class dd{constructor(i,r={config:{}},l){var c,d;if(this.topic=i,this.params=r,this.socket=l,this.bindings={},this.state=rn.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=i.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},r.config),this.timeout=this.socket.timeout,this.joinPush=new qu(this,ra.join,this.params,this.timeout),this.rejoinTimer=new ag(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=rn.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(f=>f.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=rn.closed,this.socket._remove(this)}),this._onError(f=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,f),this.state=rn.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=rn.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",f=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,f),this.state=rn.errored,this.rejoinTimer.scheduleTimeout())}),this._on(ra.reply,{},(f,g)=>{this._trigger(this._replyEventName(g),f)}),this.presence=new Hr(this),this.broadcastEndpointURL=ig(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((d=(c=this.params.config)===null||c===void 0?void 0:c.broadcast)===null||d===void 0)&&d.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(i,r=this.timeout){var l,c,d;if(this.socket.isConnected()||this.socket.connect(),this.state==rn.closed){const{config:{broadcast:f,presence:g,private:m}}=this.params,p=(c=(l=this.bindings.postgres_changes)===null||l===void 0?void 0:l.map(N=>N.filter))!==null&&c!==void 0?c:[],_=!!this.bindings[$r.PRESENCE]&&this.bindings[$r.PRESENCE].length>0||((d=this.params.config.presence)===null||d===void 0?void 0:d.enabled)===!0,j={},C={broadcast:f,presence:Object.assign(Object.assign({},g),{enabled:_}),postgres_changes:p,private:m};this.socket.accessTokenValue&&(j.access_token=this.socket.accessTokenValue),this._onError(N=>i?.(za.CHANNEL_ERROR,N)),this._onClose(()=>i?.(za.CLOSED)),this.updateJoinPayload(Object.assign({config:C},j)),this.joinedOnce=!0,this._rejoin(r),this.joinPush.receive("ok",async({postgres_changes:N})=>{var k;if(this.socket.setAuth(),N===void 0){i?.(za.SUBSCRIBED);return}else{const P=this.bindings.postgres_changes,E=(k=P?.length)!==null&&k!==void 0?k:0,V=[];for(let L=0;L<E;L++){const U=P[L],{filter:{event:O,schema:M,table:G,filter:q}}=U,Y=N&&N[L];if(Y&&Y.event===O&&Y.schema===M&&Y.table===G&&Y.filter===q)V.push(Object.assign(Object.assign({},U),{id:Y.id}));else{this.unsubscribe(),this.state=rn.errored,i?.(za.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=V,i&&i(za.SUBSCRIBED);return}}).receive("error",N=>{this.state=rn.errored,i?.(za.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(N).join(", ")||"error")))}).receive("timeout",()=>{i?.(za.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(i,r={}){return await this.send({type:"presence",event:"track",payload:i},r.timeout||this.timeout)}async untrack(i={}){return await this.send({type:"presence",event:"untrack"},i)}on(i,r,l){return this.state===rn.joined&&i===$r.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(i,r,l)}async send(i,r={}){var l,c;if(!this._canPush()&&i.type==="broadcast"){const{event:d,payload:f}=i,m={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:d,payload:f,private:this.private}]})};try{const p=await this._fetchWithTimeout(this.broadcastEndpointURL,m,(l=r.timeout)!==null&&l!==void 0?l:this.timeout);return await((c=p.body)===null||c===void 0?void 0:c.cancel()),p.ok?"ok":"error"}catch(p){return p.name==="AbortError"?"timed out":"error"}}else return new Promise(d=>{var f,g,m;const p=this._push(i.type,i,r.timeout||this.timeout);i.type==="broadcast"&&!(!((m=(g=(f=this.params)===null||f===void 0?void 0:f.config)===null||g===void 0?void 0:g.broadcast)===null||m===void 0)&&m.ack)&&d("ok"),p.receive("ok",()=>d("ok")),p.receive("error",()=>d("error")),p.receive("timeout",()=>d("timed out"))})}updateJoinPayload(i){this.joinPush.updatePayload(i)}unsubscribe(i=this.timeout){this.state=rn.leaving;const r=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(ra.close,"leave",this._joinRef())};this.joinPush.destroy();let l=null;return new Promise(c=>{l=new qu(this,ra.leave,{},i),l.receive("ok",()=>{r(),c("ok")}).receive("timeout",()=>{r(),c("timed out")}).receive("error",()=>{c("error")}),l.send(),this._canPush()||l.trigger("ok",{})}).finally(()=>{l?.destroy()})}teardown(){this.pushBuffer.forEach(i=>i.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=rn.closed,this.bindings={}}async _fetchWithTimeout(i,r,l){const c=new AbortController,d=setTimeout(()=>c.abort(),l),f=await this.socket.fetch(i,Object.assign(Object.assign({},r),{signal:c.signal}));return clearTimeout(d),f}_push(i,r,l=this.timeout){if(!this.joinedOnce)throw`tried to push '${i}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let c=new qu(this,i,r,l);return this._canPush()?c.send():this._addToPushBuffer(c),c}_addToPushBuffer(i){if(i.startTimeout(),this.pushBuffer.push(i),this.pushBuffer.length>Cx){const r=this.pushBuffer.shift();r&&(r.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${r.event}`,r.payload))}}_onMessage(i,r,l){return r}_isMember(i){return this.topic===i}_joinRef(){return this.joinPush.ref}_trigger(i,r,l){var c,d;const f=i.toLocaleLowerCase(),{close:g,error:m,leave:p,join:_}=ra;if(l&&[g,m,p,_].indexOf(f)>=0&&l!==this._joinRef())return;let C=this._onMessage(f,r,l);if(r&&!C)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(f)?(c=this.bindings.postgres_changes)===null||c===void 0||c.filter(N=>{var k,P,E;return((k=N.filter)===null||k===void 0?void 0:k.event)==="*"||((E=(P=N.filter)===null||P===void 0?void 0:P.event)===null||E===void 0?void 0:E.toLocaleLowerCase())===f}).map(N=>N.callback(C,l)):(d=this.bindings[f])===null||d===void 0||d.filter(N=>{var k,P,E,V,L,U;if(["broadcast","presence","postgres_changes"].includes(f))if("id"in N){const O=N.id,M=(k=N.filter)===null||k===void 0?void 0:k.event;return O&&((P=r.ids)===null||P===void 0?void 0:P.includes(O))&&(M==="*"||M?.toLocaleLowerCase()===((E=r.data)===null||E===void 0?void 0:E.type.toLocaleLowerCase()))}else{const O=(L=(V=N?.filter)===null||V===void 0?void 0:V.event)===null||L===void 0?void 0:L.toLocaleLowerCase();return O==="*"||O===((U=r?.event)===null||U===void 0?void 0:U.toLocaleLowerCase())}else return N.type.toLocaleLowerCase()===f}).map(N=>{if(typeof C=="object"&&"ids"in C){const k=C.data,{schema:P,table:E,commit_timestamp:V,type:L,errors:U}=k;C=Object.assign(Object.assign({},{schema:P,table:E,commit_timestamp:V,eventType:L,new:{},old:{},errors:U}),this._getPayloadRecords(k))}N.callback(C,l)})}_isClosed(){return this.state===rn.closed}_isJoined(){return this.state===rn.joined}_isJoining(){return this.state===rn.joining}_isLeaving(){return this.state===rn.leaving}_replyEventName(i){return`chan_reply_${i}`}_on(i,r,l){const c=i.toLocaleLowerCase(),d={type:c,filter:r,callback:l};return this.bindings[c]?this.bindings[c].push(d):this.bindings[c]=[d],this}_off(i,r){const l=i.toLocaleLowerCase();return this.bindings[l]&&(this.bindings[l]=this.bindings[l].filter(c=>{var d;return!(((d=c.type)===null||d===void 0?void 0:d.toLocaleLowerCase())===l&&dd.isEqual(c.filter,r))})),this}static isEqual(i,r){if(Object.keys(i).length!==Object.keys(r).length)return!1;for(const l in i)if(i[l]!==r[l])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(i){this._on(ra.close,{},i)}_onError(i){this._on(ra.error,{},r=>i(r))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(i=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=rn.joining,this.joinPush.resend(i))}_getPayloadRecords(i){const r={new:{},old:{}};return(i.type==="INSERT"||i.type==="UPDATE")&&(r.new=vp(i.columns,i.record)),(i.type==="UPDATE"||i.type==="DELETE")&&(r.old=vp(i.columns,i.old_record)),r}}const Du=()=>{},co={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},Dx=[1e3,2e3,5e3,1e4],Mx=1e4,zx=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class Lx{constructor(i,r){var l;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=Iu,this.transport=null,this.heartbeatIntervalMs=co.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=Du,this.ref=0,this.reconnectTimer=null,this.logger=Du,this.conn=null,this.sendBuffer=[],this.serializer=new Ex,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=c=>{let d;return c?d=c:typeof fetch>"u"?d=(...f)=>Jr(async()=>{const{default:g}=await Promise.resolve().then(()=>$i);return{default:g}},void 0).then(({default:g})=>g(...f)).catch(g=>{throw new Error(`Failed to load @supabase/node-fetch: ${g.message}. This is required for HTTP requests in Node.js environments without native fetch.`)}):d=fetch,(...f)=>d(...f)},!(!((l=r?.params)===null||l===void 0)&&l.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=r.params.apikey,this.endPoint=`${i}/${Vu.websocket}`,this.httpEndpoint=ig(i),this._initializeOptions(r),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(r?.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=bx.createWebSocket(this.endpointURL())}catch(i){this._setConnectionState("disconnected");const r=i.message;throw r.includes("Node.js")?new Error(`${r}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${r}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:wx}))}disconnect(i,r){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const l=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(l),this._setConnectionState("disconnected")},i?this.conn.close(i,r??""):this.conn.close(),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(i){const r=await i.unsubscribe();return this.channels.length===0&&this.disconnect(),r}async removeAllChannels(){const i=await Promise.all(this.channels.map(r=>r.unsubscribe()));return this.channels=[],this.disconnect(),i}log(i,r,l){this.logger(i,r,l)}connectionState(){switch(this.conn&&this.conn.readyState){case Fr.connecting:return Bs.Connecting;case Fr.open:return Bs.Open;case Fr.closing:return Bs.Closing;default:return Bs.Closed}}isConnected(){return this.connectionState()===Bs.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(i,r={config:{}}){const l=`realtime:${i}`,c=this.getChannels().find(d=>d.topic===l);if(c)return c;{const d=new dd(`realtime:${i}`,r,this);return this.channels.push(d),d}}push(i){const{topic:r,event:l,payload:c,ref:d}=i,f=()=>{this.encode(i,g=>{var m;(m=this.conn)===null||m===void 0||m.send(g)})};this.log("push",`${r} ${l} (${d})`,c),this.isConnected()?f():this.sendBuffer.push(f)}async setAuth(i=null){this._authPromise=this._performAuth(i);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var i;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(r){this.log("error","error in heartbeat callback",r)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(r){this.log("error","error in heartbeat callback",r)}this._wasManualDisconnect=!1,(i=this.conn)===null||i===void 0||i.close(Nx,"heartbeat timeout"),setTimeout(()=>{var r;this.isConnected()||(r=this.reconnectTimer)===null||r===void 0||r.scheduleTimeout()},co.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(r){this.log("error","error in heartbeat callback",r)}this._setAuthSafely("heartbeat")}onHeartbeat(i){this.heartbeatCallback=i}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(i=>i()),this.sendBuffer=[])}_makeRef(){let i=this.ref+1;return i===this.ref?this.ref=0:this.ref=i,this.ref.toString()}_leaveOpenTopic(i){let r=this.channels.find(l=>l.topic===i&&(l._isJoined()||l._isJoining()));r&&(this.log("transport",`leaving duplicate topic "${i}"`),r.unsubscribe())}_remove(i){this.channels=this.channels.filter(r=>r.topic!==i.topic)}_onConnMessage(i){this.decode(i.data,r=>{if(r.topic==="phoenix"&&r.event==="phx_reply")try{this.heartbeatCallback(r.payload.status==="ok"?"ok":"error")}catch(p){this.log("error","error in heartbeat callback",p)}r.ref&&r.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:l,event:c,payload:d,ref:f}=r,g=f?`(${f})`:"",m=d.status||"";this.log("receive",`${m} ${l} ${c} ${g}`.trim(),d),this.channels.filter(p=>p._isMember(l)).forEach(p=>p._trigger(c,d,f)),this._triggerStateCallbacks("message",r)})}_clearTimer(i){var r;i==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):i==="reconnect"&&((r=this.reconnectTimer)===null||r===void 0||r.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=i=>this._onConnError(i),this.conn.onmessage=i=>this._onConnMessage(i),this.conn.onclose=i=>this._onConnClose(i))}_teardownConnection(){this.conn&&(this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null),this._clearAllTimers(),this.channels.forEach(i=>i.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const i=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(i),this.workerRef.onerror=r=>{this.log("worker","worker error",r.message),this.workerRef.terminate()},this.workerRef.onmessage=r=>{r.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(i){var r;this._setConnectionState("disconnected"),this.log("transport","close",i),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(r=this.reconnectTimer)===null||r===void 0||r.scheduleTimeout(),this._triggerStateCallbacks("close",i)}_onConnError(i){this._setConnectionState("disconnected"),this.log("transport",`${i}`),this._triggerChanError(),this._triggerStateCallbacks("error",i)}_triggerChanError(){this.channels.forEach(i=>i._trigger(ra.error))}_appendParams(i,r){if(Object.keys(r).length===0)return i;const l=i.match(/\?/)?"&":"?",c=new URLSearchParams(r);return`${i}${l}${c}`}_workerObjectUrl(i){let r;if(i)r=i;else{const l=new Blob([zx],{type:"application/javascript"});r=URL.createObjectURL(l)}return r}_setConnectionState(i,r=!1){this._connectionState=i,i==="connecting"?this._wasManualDisconnect=!1:i==="disconnecting"&&(this._wasManualDisconnect=r)}async _performAuth(i=null){let r;i?r=i:this.accessToken?r=await this.accessToken():r=this.accessTokenValue,this.accessTokenValue!=r&&(this.accessTokenValue=r,this.channels.forEach(l=>{const c={access_token:r,version:Sx};r&&l.updateJoinPayload(c),l.joinedOnce&&l._isJoined()&&l._push(ra.access_token,{access_token:r})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(i="general"){this.setAuth().catch(r=>{this.log("error",`error setting auth in ${i}`,r)})}_triggerStateCallbacks(i,r){try{this.stateChangeCallbacks[i].forEach(l=>{try{l(r)}catch(c){this.log("error",`error in ${i} callback`,c)}})}catch(l){this.log("error",`error triggering ${i} callbacks`,l)}}_setupReconnectionTimer(){this.reconnectTimer=new ag(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},co.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(i){var r,l,c,d,f,g,m,p,_;if(this.transport=(r=i?.transport)!==null&&r!==void 0?r:null,this.timeout=(l=i?.timeout)!==null&&l!==void 0?l:Iu,this.heartbeatIntervalMs=(c=i?.heartbeatIntervalMs)!==null&&c!==void 0?c:co.HEARTBEAT_INTERVAL,this.worker=(d=i?.worker)!==null&&d!==void 0?d:!1,this.accessToken=(f=i?.accessToken)!==null&&f!==void 0?f:null,this.heartbeatCallback=(g=i?.heartbeatCallback)!==null&&g!==void 0?g:Du,i?.params&&(this.params=i.params),i?.logger&&(this.logger=i.logger),(i?.logLevel||i?.log_level)&&(this.logLevel=i.logLevel||i.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(m=i?.reconnectAfterMs)!==null&&m!==void 0?m:(j=>Dx[j-1]||Mx),this.encode=(p=i?.encode)!==null&&p!==void 0?p:((j,C)=>C(JSON.stringify(j))),this.decode=(_=i?.decode)!==null&&_!==void 0?_:this.serializer.decode.bind(this.serializer),this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=i?.workerUrl}}}class hd extends Error{constructor(i){super(i),this.__isStorageError=!0,this.name="StorageError"}}function Wt(o){return typeof o=="object"&&o!==null&&"__isStorageError"in o}class Ux extends hd{constructor(i,r,l){super(i),this.name="StorageApiError",this.status=r,this.statusCode=l}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class Yu extends hd{constructor(i,r){super(i),this.name="StorageUnknownError",this.originalError=r}}var Bx=function(o,i,r,l){function c(d){return d instanceof r?d:new r(function(f){f(d)})}return new(r||(r=Promise))(function(d,f){function g(_){try{p(l.next(_))}catch(j){f(j)}}function m(_){try{p(l.throw(_))}catch(j){f(j)}}function p(_){_.done?d(_.value):c(_.value).then(g,m)}p((l=l.apply(o,i||[])).next())})};const rg=o=>{let i;return o?i=o:typeof fetch>"u"?i=(...r)=>Jr(async()=>{const{default:l}=await Promise.resolve().then(()=>$i);return{default:l}},void 0).then(({default:l})=>l(...r)):i=fetch,(...r)=>i(...r)},Px=()=>Bx(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield Jr(()=>Promise.resolve().then(()=>$i),void 0)).Response:Response}),Qu=o=>{if(Array.isArray(o))return o.map(r=>Qu(r));if(typeof o=="function"||o!==Object(o))return o;const i={};return Object.entries(o).forEach(([r,l])=>{const c=r.replace(/([-_][a-z])/gi,d=>d.toUpperCase().replace(/[-_]/g,""));i[c]=Qu(l)}),i},Fx=o=>{if(typeof o!="object"||o===null)return!1;const i=Object.getPrototypeOf(o);return(i===null||i===Object.prototype||Object.getPrototypeOf(i)===null)&&!(Symbol.toStringTag in o)&&!(Symbol.iterator in o)};var Hs=function(o,i,r,l){function c(d){return d instanceof r?d:new r(function(f){f(d)})}return new(r||(r=Promise))(function(d,f){function g(_){try{p(l.next(_))}catch(j){f(j)}}function m(_){try{p(l.throw(_))}catch(j){f(j)}}function p(_){_.done?d(_.value):c(_.value).then(g,m)}p((l=l.apply(o,i||[])).next())})};const Mu=o=>o.msg||o.message||o.error_description||o.error||JSON.stringify(o),Hx=(o,i,r)=>Hs(void 0,void 0,void 0,function*(){const l=yield Px();o instanceof l&&!r?.noResolveJson?o.json().then(c=>{const d=o.status||500,f=c?.statusCode||d+"";i(new Ux(Mu(c),d,f))}).catch(c=>{i(new Yu(Mu(c),c))}):i(new Yu(Mu(o),o))}),$x=(o,i,r,l)=>{const c={method:o,headers:i?.headers||{}};return o==="GET"||!l?c:(Fx(l)?(c.headers=Object.assign({"Content-Type":"application/json"},i?.headers),c.body=JSON.stringify(l)):c.body=l,i?.duplex&&(c.duplex=i.duplex),Object.assign(Object.assign({},c),r))};function Xr(o,i,r,l,c,d){return Hs(this,void 0,void 0,function*(){return new Promise((f,g)=>{o(r,$x(i,l,c,d)).then(m=>{if(!m.ok)throw m;return l?.noResolveJson?m:m.json()}).then(m=>f(m)).catch(m=>Hx(m,g,l))})})}function go(o,i,r,l){return Hs(this,void 0,void 0,function*(){return Xr(o,"GET",i,r,l)})}function ga(o,i,r,l,c){return Hs(this,void 0,void 0,function*(){return Xr(o,"POST",i,l,c,r)})}function Ku(o,i,r,l,c){return Hs(this,void 0,void 0,function*(){return Xr(o,"PUT",i,l,c,r)})}function Ix(o,i,r,l){return Hs(this,void 0,void 0,function*(){return Xr(o,"HEAD",i,Object.assign(Object.assign({},r),{noResolveJson:!0}),l)})}function lg(o,i,r,l,c){return Hs(this,void 0,void 0,function*(){return Xr(o,"DELETE",i,l,c,r)})}var Vx=function(o,i,r,l){function c(d){return d instanceof r?d:new r(function(f){f(d)})}return new(r||(r=Promise))(function(d,f){function g(_){try{p(l.next(_))}catch(j){f(j)}}function m(_){try{p(l.throw(_))}catch(j){f(j)}}function p(_){_.done?d(_.value):c(_.value).then(g,m)}p((l=l.apply(o,i||[])).next())})};class Gx{constructor(i,r){this.downloadFn=i,this.shouldThrowOnError=r}then(i,r){return this.execute().then(i,r)}execute(){return Vx(this,void 0,void 0,function*(){try{return{data:(yield this.downloadFn()).body,error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(Wt(i))return{data:null,error:i};throw i}})}}var Yx=function(o,i,r,l){function c(d){return d instanceof r?d:new r(function(f){f(d)})}return new(r||(r=Promise))(function(d,f){function g(_){try{p(l.next(_))}catch(j){f(j)}}function m(_){try{p(l.throw(_))}catch(j){f(j)}}function p(_){_.done?d(_.value):c(_.value).then(g,m)}p((l=l.apply(o,i||[])).next())})};class Qx{constructor(i,r){this.downloadFn=i,this.shouldThrowOnError=r}asStream(){return new Gx(this.downloadFn,this.shouldThrowOnError)}then(i,r){return this.execute().then(i,r)}execute(){return Yx(this,void 0,void 0,function*(){try{return{data:yield(yield this.downloadFn()).blob(),error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(Wt(i))return{data:null,error:i};throw i}})}}var Dn=function(o,i,r,l){function c(d){return d instanceof r?d:new r(function(f){f(d)})}return new(r||(r=Promise))(function(d,f){function g(_){try{p(l.next(_))}catch(j){f(j)}}function m(_){try{p(l.throw(_))}catch(j){f(j)}}function p(_){_.done?d(_.value):c(_.value).then(g,m)}p((l=l.apply(o,i||[])).next())})};const Kx={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},xp={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class Jx{constructor(i,r={},l,c){this.shouldThrowOnError=!1,this.url=i,this.headers=r,this.bucketId=l,this.fetch=rg(c)}throwOnError(){return this.shouldThrowOnError=!0,this}uploadOrUpdate(i,r,l,c){return Dn(this,void 0,void 0,function*(){try{let d;const f=Object.assign(Object.assign({},xp),c);let g=Object.assign(Object.assign({},this.headers),i==="POST"&&{"x-upsert":String(f.upsert)});const m=f.metadata;typeof Blob<"u"&&l instanceof Blob?(d=new FormData,d.append("cacheControl",f.cacheControl),m&&d.append("metadata",this.encodeMetadata(m)),d.append("",l)):typeof FormData<"u"&&l instanceof FormData?(d=l,d.append("cacheControl",f.cacheControl),m&&d.append("metadata",this.encodeMetadata(m))):(d=l,g["cache-control"]=`max-age=${f.cacheControl}`,g["content-type"]=f.contentType,m&&(g["x-metadata"]=this.toBase64(this.encodeMetadata(m)))),c?.headers&&(g=Object.assign(Object.assign({},g),c.headers));const p=this._removeEmptyFolders(r),_=this._getFinalPath(p),j=yield(i=="PUT"?Ku:ga)(this.fetch,`${this.url}/object/${_}`,d,Object.assign({headers:g},f?.duplex?{duplex:f.duplex}:{}));return{data:{path:p,id:j.Id,fullPath:j.Key},error:null}}catch(d){if(this.shouldThrowOnError)throw d;if(Wt(d))return{data:null,error:d};throw d}})}upload(i,r,l){return Dn(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",i,r,l)})}uploadToSignedUrl(i,r,l,c){return Dn(this,void 0,void 0,function*(){const d=this._removeEmptyFolders(i),f=this._getFinalPath(d),g=new URL(this.url+`/object/upload/sign/${f}`);g.searchParams.set("token",r);try{let m;const p=Object.assign({upsert:xp.upsert},c),_=Object.assign(Object.assign({},this.headers),{"x-upsert":String(p.upsert)});typeof Blob<"u"&&l instanceof Blob?(m=new FormData,m.append("cacheControl",p.cacheControl),m.append("",l)):typeof FormData<"u"&&l instanceof FormData?(m=l,m.append("cacheControl",p.cacheControl)):(m=l,_["cache-control"]=`max-age=${p.cacheControl}`,_["content-type"]=p.contentType);const j=yield Ku(this.fetch,g.toString(),m,{headers:_});return{data:{path:d,fullPath:j.Key},error:null}}catch(m){if(this.shouldThrowOnError)throw m;if(Wt(m))return{data:null,error:m};throw m}})}createSignedUploadUrl(i,r){return Dn(this,void 0,void 0,function*(){try{let l=this._getFinalPath(i);const c=Object.assign({},this.headers);r?.upsert&&(c["x-upsert"]="true");const d=yield ga(this.fetch,`${this.url}/object/upload/sign/${l}`,{},{headers:c}),f=new URL(this.url+d.url),g=f.searchParams.get("token");if(!g)throw new hd("No token returned by API");return{data:{signedUrl:f.toString(),path:i,token:g},error:null}}catch(l){if(this.shouldThrowOnError)throw l;if(Wt(l))return{data:null,error:l};throw l}})}update(i,r,l){return Dn(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",i,r,l)})}move(i,r,l){return Dn(this,void 0,void 0,function*(){try{return{data:yield ga(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:i,destinationKey:r,destinationBucket:l?.destinationBucket},{headers:this.headers}),error:null}}catch(c){if(this.shouldThrowOnError)throw c;if(Wt(c))return{data:null,error:c};throw c}})}copy(i,r,l){return Dn(this,void 0,void 0,function*(){try{return{data:{path:(yield ga(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:i,destinationKey:r,destinationBucket:l?.destinationBucket},{headers:this.headers})).Key},error:null}}catch(c){if(this.shouldThrowOnError)throw c;if(Wt(c))return{data:null,error:c};throw c}})}createSignedUrl(i,r,l){return Dn(this,void 0,void 0,function*(){try{let c=this._getFinalPath(i),d=yield ga(this.fetch,`${this.url}/object/sign/${c}`,Object.assign({expiresIn:r},l?.transform?{transform:l.transform}:{}),{headers:this.headers});const f=l?.download?`&download=${l.download===!0?"":l.download}`:"";return d={signedUrl:encodeURI(`${this.url}${d.signedURL}${f}`)},{data:d,error:null}}catch(c){if(this.shouldThrowOnError)throw c;if(Wt(c))return{data:null,error:c};throw c}})}createSignedUrls(i,r,l){return Dn(this,void 0,void 0,function*(){try{const c=yield ga(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:r,paths:i},{headers:this.headers}),d=l?.download?`&download=${l.download===!0?"":l.download}`:"";return{data:c.map(f=>Object.assign(Object.assign({},f),{signedUrl:f.signedURL?encodeURI(`${this.url}${f.signedURL}${d}`):null})),error:null}}catch(c){if(this.shouldThrowOnError)throw c;if(Wt(c))return{data:null,error:c};throw c}})}download(i,r){const c=typeof r?.transform<"u"?"render/image/authenticated":"object",d=this.transformOptsToQueryString(r?.transform||{}),f=d?`?${d}`:"",g=this._getFinalPath(i),m=()=>go(this.fetch,`${this.url}/${c}/${g}${f}`,{headers:this.headers,noResolveJson:!0});return new Qx(m,this.shouldThrowOnError)}info(i){return Dn(this,void 0,void 0,function*(){const r=this._getFinalPath(i);try{const l=yield go(this.fetch,`${this.url}/object/info/${r}`,{headers:this.headers});return{data:Qu(l),error:null}}catch(l){if(this.shouldThrowOnError)throw l;if(Wt(l))return{data:null,error:l};throw l}})}exists(i){return Dn(this,void 0,void 0,function*(){const r=this._getFinalPath(i);try{return yield Ix(this.fetch,`${this.url}/object/${r}`,{headers:this.headers}),{data:!0,error:null}}catch(l){if(this.shouldThrowOnError)throw l;if(Wt(l)&&l instanceof Yu){const c=l.originalError;if([400,404].includes(c?.status))return{data:!1,error:l}}throw l}})}getPublicUrl(i,r){const l=this._getFinalPath(i),c=[],d=r?.download?`download=${r.download===!0?"":r.download}`:"";d!==""&&c.push(d);const g=typeof r?.transform<"u"?"render/image":"object",m=this.transformOptsToQueryString(r?.transform||{});m!==""&&c.push(m);let p=c.join("&");return p!==""&&(p=`?${p}`),{data:{publicUrl:encodeURI(`${this.url}/${g}/public/${l}${p}`)}}}remove(i){return Dn(this,void 0,void 0,function*(){try{return{data:yield lg(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:i},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Wt(r))return{data:null,error:r};throw r}})}list(i,r,l){return Dn(this,void 0,void 0,function*(){try{const c=Object.assign(Object.assign(Object.assign({},Kx),r),{prefix:i||""});return{data:yield ga(this.fetch,`${this.url}/object/list/${this.bucketId}`,c,{headers:this.headers},l),error:null}}catch(c){if(this.shouldThrowOnError)throw c;if(Wt(c))return{data:null,error:c};throw c}})}listV2(i,r){return Dn(this,void 0,void 0,function*(){try{const l=Object.assign({},i);return{data:yield ga(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,l,{headers:this.headers},r),error:null}}catch(l){if(this.shouldThrowOnError)throw l;if(Wt(l))return{data:null,error:l};throw l}})}encodeMetadata(i){return JSON.stringify(i)}toBase64(i){return typeof Buffer<"u"?Buffer.from(i).toString("base64"):btoa(i)}_getFinalPath(i){return`${this.bucketId}/${i.replace(/^\/+/,"")}`}_removeEmptyFolders(i){return i.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(i){const r=[];return i.width&&r.push(`width=${i.width}`),i.height&&r.push(`height=${i.height}`),i.resize&&r.push(`resize=${i.resize}`),i.format&&r.push(`format=${i.format}`),i.quality&&r.push(`quality=${i.quality}`),r.join("&")}}const Xx="2.75.0",Zx={"X-Client-Info":`storage-js/${Xx}`};var ki=function(o,i,r,l){function c(d){return d instanceof r?d:new r(function(f){f(d)})}return new(r||(r=Promise))(function(d,f){function g(_){try{p(l.next(_))}catch(j){f(j)}}function m(_){try{p(l.throw(_))}catch(j){f(j)}}function p(_){_.done?d(_.value):c(_.value).then(g,m)}p((l=l.apply(o,i||[])).next())})};class Wx{constructor(i,r={},l,c){this.shouldThrowOnError=!1;const d=new URL(i);c?.useNewHostname&&/supabase\.(co|in|red)$/.test(d.hostname)&&!d.hostname.includes("storage.supabase.")&&(d.hostname=d.hostname.replace("supabase.","storage.supabase.")),this.url=d.href.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},Zx),r),this.fetch=rg(l)}throwOnError(){return this.shouldThrowOnError=!0,this}listBuckets(){return ki(this,void 0,void 0,function*(){try{return{data:yield go(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(Wt(i))return{data:null,error:i};throw i}})}getBucket(i){return ki(this,void 0,void 0,function*(){try{return{data:yield go(this.fetch,`${this.url}/bucket/${i}`,{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Wt(r))return{data:null,error:r};throw r}})}createBucket(i){return ki(this,arguments,void 0,function*(r,l={public:!1}){try{return{data:yield ga(this.fetch,`${this.url}/bucket`,{id:r,name:r,type:l.type,public:l.public,file_size_limit:l.fileSizeLimit,allowed_mime_types:l.allowedMimeTypes},{headers:this.headers}),error:null}}catch(c){if(this.shouldThrowOnError)throw c;if(Wt(c))return{data:null,error:c};throw c}})}updateBucket(i,r){return ki(this,void 0,void 0,function*(){try{return{data:yield Ku(this.fetch,`${this.url}/bucket/${i}`,{id:i,name:i,public:r.public,file_size_limit:r.fileSizeLimit,allowed_mime_types:r.allowedMimeTypes},{headers:this.headers}),error:null}}catch(l){if(this.shouldThrowOnError)throw l;if(Wt(l))return{data:null,error:l};throw l}})}emptyBucket(i){return ki(this,void 0,void 0,function*(){try{return{data:yield ga(this.fetch,`${this.url}/bucket/${i}/empty`,{},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Wt(r))return{data:null,error:r};throw r}})}deleteBucket(i){return ki(this,void 0,void 0,function*(){try{return{data:yield lg(this.fetch,`${this.url}/bucket/${i}`,{},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Wt(r))return{data:null,error:r};throw r}})}}class eb extends Wx{constructor(i,r={},l,c){super(i,r,l,c)}from(i){return new Jx(this.url,this.headers,i,this.fetch)}}const tb="2.75.0";let Pr="";typeof Deno<"u"?Pr="deno":typeof document<"u"?Pr="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Pr="react-native":Pr="node";const nb={"X-Client-Info":`supabase-js-${Pr}/${tb}`},ab={headers:nb},sb={schema:"public"},ib={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},rb={};var lb=function(o,i,r,l){function c(d){return d instanceof r?d:new r(function(f){f(d)})}return new(r||(r=Promise))(function(d,f){function g(_){try{p(l.next(_))}catch(j){f(j)}}function m(_){try{p(l.throw(_))}catch(j){f(j)}}function p(_){_.done?d(_.value):c(_.value).then(g,m)}p((l=l.apply(o,i||[])).next())})};const ob=o=>{let i;return o?i=o:typeof fetch>"u"?i=Xp:i=fetch,(...r)=>i(...r)},cb=()=>typeof Headers>"u"?Zp:Headers,ub=(o,i,r)=>{const l=ob(r),c=cb();return(d,f)=>lb(void 0,void 0,void 0,function*(){var g;const m=(g=yield i())!==null&&g!==void 0?g:o;let p=new c(f?.headers);return p.has("apikey")||p.set("apikey",o),p.has("Authorization")||p.set("Authorization",`Bearer ${m}`),l(d,Object.assign(Object.assign({},f),{headers:p}))})};var db=function(o,i,r,l){function c(d){return d instanceof r?d:new r(function(f){f(d)})}return new(r||(r=Promise))(function(d,f){function g(_){try{p(l.next(_))}catch(j){f(j)}}function m(_){try{p(l.throw(_))}catch(j){f(j)}}function p(_){_.done?d(_.value):c(_.value).then(g,m)}p((l=l.apply(o,i||[])).next())})};function hb(o){return o.endsWith("/")?o:o+"/"}function fb(o,i){var r,l;const{db:c,auth:d,realtime:f,global:g}=o,{db:m,auth:p,realtime:_,global:j}=i,C={db:Object.assign(Object.assign({},m),c),auth:Object.assign(Object.assign({},p),d),realtime:Object.assign(Object.assign({},_),f),storage:{},global:Object.assign(Object.assign(Object.assign({},j),g),{headers:Object.assign(Object.assign({},(r=j?.headers)!==null&&r!==void 0?r:{}),(l=g?.headers)!==null&&l!==void 0?l:{})}),accessToken:()=>db(this,void 0,void 0,function*(){return""})};return o.accessToken?C.accessToken=o.accessToken:delete C.accessToken,C}function mb(o){const i=o?.trim();if(!i)throw new Error("supabaseUrl is required.");if(!i.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(hb(i))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}const og="2.75.0",zi=30*1e3,Ju=3,zu=Ju*zi,pb="http://localhost:9999",gb="supabase.auth.token",vb={"X-Client-Info":`gotrue-js/${og}`},Xu="X-Supabase-Api-Version",cg={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},_b=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,yb=600*1e3;class Vr extends Error{constructor(i,r,l){super(i),this.__isAuthError=!0,this.name="AuthError",this.status=r,this.code=l}}function Ve(o){return typeof o=="object"&&o!==null&&"__isAuthError"in o}class xb extends Vr{constructor(i,r,l){super(i,r,l),this.name="AuthApiError",this.status=r,this.code=l}}function bb(o){return Ve(o)&&o.name==="AuthApiError"}class Ps extends Vr{constructor(i,r){super(i),this.name="AuthUnknownError",this.originalError=r}}class ps extends Vr{constructor(i,r,l,c){super(i,l,c),this.name=r,this.status=l}}class fs extends ps{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function jb(o){return Ve(o)&&o.name==="AuthSessionMissingError"}class Oi extends ps{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class uo extends ps{constructor(i){super(i,"AuthInvalidCredentialsError",400,void 0)}}class ho extends ps{constructor(i,r=null){super(i,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=r}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function Sb(o){return Ve(o)&&o.name==="AuthImplicitGrantRedirectError"}class bp extends ps{constructor(i,r=null){super(i,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=r}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Zu extends ps{constructor(i,r){super(i,"AuthRetryableFetchError",r,void 0)}}function Lu(o){return Ve(o)&&o.name==="AuthRetryableFetchError"}class jp extends ps{constructor(i,r,l){super(i,"AuthWeakPasswordError",r,"weak_password"),this.reasons=l}}class Wu extends ps{constructor(i){super(i,"AuthInvalidJwtError",400,"invalid_jwt")}}const vo="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),Sp=` 	
\r=`.split(""),wb=(()=>{const o=new Array(128);for(let i=0;i<o.length;i+=1)o[i]=-1;for(let i=0;i<Sp.length;i+=1)o[Sp[i].charCodeAt(0)]=-2;for(let i=0;i<vo.length;i+=1)o[vo[i].charCodeAt(0)]=i;return o})();function wp(o,i,r){if(o!==null)for(i.queue=i.queue<<8|o,i.queuedBits+=8;i.queuedBits>=6;){const l=i.queue>>i.queuedBits-6&63;r(vo[l]),i.queuedBits-=6}else if(i.queuedBits>0)for(i.queue=i.queue<<6-i.queuedBits,i.queuedBits=6;i.queuedBits>=6;){const l=i.queue>>i.queuedBits-6&63;r(vo[l]),i.queuedBits-=6}}function ug(o,i,r){const l=wb[o];if(l>-1)for(i.queue=i.queue<<6|l,i.queuedBits+=6;i.queuedBits>=8;)r(i.queue>>i.queuedBits-8&255),i.queuedBits-=8;else{if(l===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(o)}"`)}}function Np(o){const i=[],r=f=>{i.push(String.fromCodePoint(f))},l={utf8seq:0,codepoint:0},c={queue:0,queuedBits:0},d=f=>{Eb(f,l,r)};for(let f=0;f<o.length;f+=1)ug(o.charCodeAt(f),c,d);return i.join("")}function Nb(o,i){if(o<=127){i(o);return}else if(o<=2047){i(192|o>>6),i(128|o&63);return}else if(o<=65535){i(224|o>>12),i(128|o>>6&63),i(128|o&63);return}else if(o<=1114111){i(240|o>>18),i(128|o>>12&63),i(128|o>>6&63),i(128|o&63);return}throw new Error(`Unrecognized Unicode codepoint: ${o.toString(16)}`)}function Cb(o,i){for(let r=0;r<o.length;r+=1){let l=o.charCodeAt(r);if(l>55295&&l<=56319){const c=(l-55296)*1024&65535;l=(o.charCodeAt(r+1)-56320&65535|c)+65536,r+=1}Nb(l,i)}}function Eb(o,i,r){if(i.utf8seq===0){if(o<=127){r(o);return}for(let l=1;l<6;l+=1)if((o>>7-l&1)===0){i.utf8seq=l;break}if(i.utf8seq===2)i.codepoint=o&31;else if(i.utf8seq===3)i.codepoint=o&15;else if(i.utf8seq===4)i.codepoint=o&7;else throw new Error("Invalid UTF-8 sequence");i.utf8seq-=1}else if(i.utf8seq>0){if(o<=127)throw new Error("Invalid UTF-8 sequence");i.codepoint=i.codepoint<<6|o&63,i.utf8seq-=1,i.utf8seq===0&&r(i.codepoint)}}function Ui(o){const i=[],r={queue:0,queuedBits:0},l=c=>{i.push(c)};for(let c=0;c<o.length;c+=1)ug(o.charCodeAt(c),r,l);return new Uint8Array(i)}function Tb(o){const i=[];return Cb(o,r=>i.push(r)),new Uint8Array(i)}function Fs(o){const i=[],r={queue:0,queuedBits:0},l=c=>{i.push(c)};return o.forEach(c=>wp(c,r,l)),wp(null,r,l),i.join("")}function Ab(o){return Math.round(Date.now()/1e3)+o}function kb(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(o){const i=Math.random()*16|0;return(o=="x"?i:i&3|8).toString(16)})}const Hn=()=>typeof window<"u"&&typeof document<"u",Ms={tested:!1,writable:!1},dg=()=>{if(!Hn())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(Ms.tested)return Ms.writable;const o=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(o,o),globalThis.localStorage.removeItem(o),Ms.tested=!0,Ms.writable=!0}catch{Ms.tested=!0,Ms.writable=!1}return Ms.writable};function Ob(o){const i={},r=new URL(o);if(r.hash&&r.hash[0]==="#")try{new URLSearchParams(r.hash.substring(1)).forEach((c,d)=>{i[d]=c})}catch{}return r.searchParams.forEach((l,c)=>{i[c]=l}),i}const hg=o=>{let i;return o?i=o:typeof fetch>"u"?i=(...r)=>Jr(async()=>{const{default:l}=await Promise.resolve().then(()=>$i);return{default:l}},void 0).then(({default:l})=>l(...r)):i=fetch,(...r)=>i(...r)},Rb=o=>typeof o=="object"&&o!==null&&"status"in o&&"ok"in o&&"json"in o&&typeof o.json=="function",Li=async(o,i,r)=>{await o.setItem(i,JSON.stringify(r))},zs=async(o,i)=>{const r=await o.getItem(i);if(!r)return null;try{return JSON.parse(r)}catch{return r}},hs=async(o,i)=>{await o.removeItem(i)};class jo{constructor(){this.promise=new jo.promiseConstructor((i,r)=>{this.resolve=i,this.reject=r})}}jo.promiseConstructor=Promise;function Uu(o){const i=o.split(".");if(i.length!==3)throw new Wu("Invalid JWT structure");for(let l=0;l<i.length;l++)if(!_b.test(i[l]))throw new Wu("JWT not in base64url format");return{header:JSON.parse(Np(i[0])),payload:JSON.parse(Np(i[1])),signature:Ui(i[2]),raw:{header:i[0],payload:i[1]}}}async function qb(o){return await new Promise(i=>{setTimeout(()=>i(null),o)})}function Db(o,i){return new Promise((l,c)=>{(async()=>{for(let d=0;d<1/0;d++)try{const f=await o(d);if(!i(d,null,f)){l(f);return}}catch(f){if(!i(d,f)){c(f);return}}})()})}function Mb(o){return("0"+o.toString(16)).substr(-2)}function zb(){const i=new Uint32Array(56);if(typeof crypto>"u"){const r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",l=r.length;let c="";for(let d=0;d<56;d++)c+=r.charAt(Math.floor(Math.random()*l));return c}return crypto.getRandomValues(i),Array.from(i,Mb).join("")}async function Lb(o){const r=new TextEncoder().encode(o),l=await crypto.subtle.digest("SHA-256",r),c=new Uint8Array(l);return Array.from(c).map(d=>String.fromCharCode(d)).join("")}async function Ub(o){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),o;const r=await Lb(o);return btoa(r).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function Ri(o,i,r=!1){const l=zb();let c=l;r&&(c+="/PASSWORD_RECOVERY"),await Li(o,`${i}-code-verifier`,c);const d=await Ub(l);return[d,l===d?"plain":"s256"]}const Bb=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function Pb(o){const i=o.headers.get(Xu);if(!i||!i.match(Bb))return null;try{return new Date(`${i}T00:00:00.0Z`)}catch{return null}}function Fb(o){if(!o)throw new Error("Missing exp claim");const i=Math.floor(Date.now()/1e3);if(o<=i)throw new Error("JWT has expired")}function Hb(o){switch(o){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const $b=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function qi(o){if(!$b.test(o))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function Bu(){const o={};return new Proxy(o,{get:(i,r)=>{if(r==="__isUserNotAvailableProxy")return!0;if(typeof r=="symbol"){const l=r.toString();if(l==="Symbol(Symbol.toPrimitive)"||l==="Symbol(Symbol.toStringTag)"||l==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${r}" property of the session object is not supported. Please use getUser() instead.`)},set:(i,r)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${r}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(i,r)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${r}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function Cp(o){return JSON.parse(JSON.stringify(o))}var Ib=function(o,i){var r={};for(var l in o)Object.prototype.hasOwnProperty.call(o,l)&&i.indexOf(l)<0&&(r[l]=o[l]);if(o!=null&&typeof Object.getOwnPropertySymbols=="function")for(var c=0,l=Object.getOwnPropertySymbols(o);c<l.length;c++)i.indexOf(l[c])<0&&Object.prototype.propertyIsEnumerable.call(o,l[c])&&(r[l[c]]=o[l[c]]);return r};const Us=o=>o.msg||o.message||o.error_description||o.error||JSON.stringify(o),Vb=[502,503,504];async function Ep(o){var i;if(!Rb(o))throw new Zu(Us(o),0);if(Vb.includes(o.status))throw new Zu(Us(o),o.status);let r;try{r=await o.json()}catch(d){throw new Ps(Us(d),d)}let l;const c=Pb(o);if(c&&c.getTime()>=cg["2024-01-01"].timestamp&&typeof r=="object"&&r&&typeof r.code=="string"?l=r.code:typeof r=="object"&&r&&typeof r.error_code=="string"&&(l=r.error_code),l){if(l==="weak_password")throw new jp(Us(r),o.status,((i=r.weak_password)===null||i===void 0?void 0:i.reasons)||[]);if(l==="session_not_found")throw new fs}else if(typeof r=="object"&&r&&typeof r.weak_password=="object"&&r.weak_password&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.reasons.reduce((d,f)=>d&&typeof f=="string",!0))throw new jp(Us(r),o.status,r.weak_password.reasons);throw new xb(Us(r),o.status||500,l)}const Gb=(o,i,r,l)=>{const c={method:o,headers:i?.headers||{}};return o==="GET"?c:(c.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},i?.headers),c.body=JSON.stringify(l),Object.assign(Object.assign({},c),r))};async function Je(o,i,r,l){var c;const d=Object.assign({},l?.headers);d[Xu]||(d[Xu]=cg["2024-01-01"].name),l?.jwt&&(d.Authorization=`Bearer ${l.jwt}`);const f=(c=l?.query)!==null&&c!==void 0?c:{};l?.redirectTo&&(f.redirect_to=l.redirectTo);const g=Object.keys(f).length?"?"+new URLSearchParams(f).toString():"",m=await Yb(o,i,r+g,{headers:d,noResolveJson:l?.noResolveJson},{},l?.body);return l?.xform?l?.xform(m):{data:Object.assign({},m),error:null}}async function Yb(o,i,r,l,c,d){const f=Gb(i,l,c,d);let g;try{g=await o(r,Object.assign({},f))}catch(m){throw console.error(m),new Zu(Us(m),0)}if(g.ok||await Ep(g),l?.noResolveJson)return g;try{return await g.json()}catch(m){await Ep(m)}}function ia(o){var i;let r=null;Jb(o)&&(r=Object.assign({},o),o.expires_at||(r.expires_at=Ab(o.expires_in)));const l=(i=o.user)!==null&&i!==void 0?i:o;return{data:{session:r,user:l},error:null}}function Tp(o){const i=ia(o);return!i.error&&o.weak_password&&typeof o.weak_password=="object"&&Array.isArray(o.weak_password.reasons)&&o.weak_password.reasons.length&&o.weak_password.message&&typeof o.weak_password.message=="string"&&o.weak_password.reasons.reduce((r,l)=>r&&typeof l=="string",!0)&&(i.data.weak_password=o.weak_password),i}function ms(o){var i;return{data:{user:(i=o.user)!==null&&i!==void 0?i:o},error:null}}function Qb(o){return{data:o,error:null}}function Kb(o){const{action_link:i,email_otp:r,hashed_token:l,redirect_to:c,verification_type:d}=o,f=Ib(o,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),g={action_link:i,email_otp:r,hashed_token:l,redirect_to:c,verification_type:d},m=Object.assign({},f);return{data:{properties:g,user:m},error:null}}function Ap(o){return o}function Jb(o){return o.access_token&&o.refresh_token&&o.expires_in}const Pu=["global","local","others"];var Xb=function(o,i){var r={};for(var l in o)Object.prototype.hasOwnProperty.call(o,l)&&i.indexOf(l)<0&&(r[l]=o[l]);if(o!=null&&typeof Object.getOwnPropertySymbols=="function")for(var c=0,l=Object.getOwnPropertySymbols(o);c<l.length;c++)i.indexOf(l[c])<0&&Object.prototype.propertyIsEnumerable.call(o,l[c])&&(r[l[c]]=o[l[c]]);return r};class Zb{constructor({url:i="",headers:r={},fetch:l}){this.url=i,this.headers=r,this.fetch=hg(l),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(i,r=Pu[0]){if(Pu.indexOf(r)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${Pu.join(", ")}`);try{return await Je(this.fetch,"POST",`${this.url}/logout?scope=${r}`,{headers:this.headers,jwt:i,noResolveJson:!0}),{data:null,error:null}}catch(l){if(Ve(l))return{data:null,error:l};throw l}}async inviteUserByEmail(i,r={}){try{return await Je(this.fetch,"POST",`${this.url}/invite`,{body:{email:i,data:r.data},headers:this.headers,redirectTo:r.redirectTo,xform:ms})}catch(l){if(Ve(l))return{data:{user:null},error:l};throw l}}async generateLink(i){try{const{options:r}=i,l=Xb(i,["options"]),c=Object.assign(Object.assign({},l),r);return"newEmail"in l&&(c.new_email=l?.newEmail,delete c.newEmail),await Je(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:c,headers:this.headers,xform:Kb,redirectTo:r?.redirectTo})}catch(r){if(Ve(r))return{data:{properties:null,user:null},error:r};throw r}}async createUser(i){try{return await Je(this.fetch,"POST",`${this.url}/admin/users`,{body:i,headers:this.headers,xform:ms})}catch(r){if(Ve(r))return{data:{user:null},error:r};throw r}}async listUsers(i){var r,l,c,d,f,g,m;try{const p={nextPage:null,lastPage:0,total:0},_=await Je(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(l=(r=i?.page)===null||r===void 0?void 0:r.toString())!==null&&l!==void 0?l:"",per_page:(d=(c=i?.perPage)===null||c===void 0?void 0:c.toString())!==null&&d!==void 0?d:""},xform:Ap});if(_.error)throw _.error;const j=await _.json(),C=(f=_.headers.get("x-total-count"))!==null&&f!==void 0?f:0,N=(m=(g=_.headers.get("link"))===null||g===void 0?void 0:g.split(","))!==null&&m!==void 0?m:[];return N.length>0&&(N.forEach(k=>{const P=parseInt(k.split(";")[0].split("=")[1].substring(0,1)),E=JSON.parse(k.split(";")[1].split("=")[1]);p[`${E}Page`]=P}),p.total=parseInt(C)),{data:Object.assign(Object.assign({},j),p),error:null}}catch(p){if(Ve(p))return{data:{users:[]},error:p};throw p}}async getUserById(i){qi(i);try{return await Je(this.fetch,"GET",`${this.url}/admin/users/${i}`,{headers:this.headers,xform:ms})}catch(r){if(Ve(r))return{data:{user:null},error:r};throw r}}async updateUserById(i,r){qi(i);try{return await Je(this.fetch,"PUT",`${this.url}/admin/users/${i}`,{body:r,headers:this.headers,xform:ms})}catch(l){if(Ve(l))return{data:{user:null},error:l};throw l}}async deleteUser(i,r=!1){qi(i);try{return await Je(this.fetch,"DELETE",`${this.url}/admin/users/${i}`,{headers:this.headers,body:{should_soft_delete:r},xform:ms})}catch(l){if(Ve(l))return{data:{user:null},error:l};throw l}}async _listFactors(i){qi(i.userId);try{const{data:r,error:l}=await Je(this.fetch,"GET",`${this.url}/admin/users/${i.userId}/factors`,{headers:this.headers,xform:c=>({data:{factors:c},error:null})});return{data:r,error:l}}catch(r){if(Ve(r))return{data:null,error:r};throw r}}async _deleteFactor(i){qi(i.userId),qi(i.id);try{return{data:await Je(this.fetch,"DELETE",`${this.url}/admin/users/${i.userId}/factors/${i.id}`,{headers:this.headers}),error:null}}catch(r){if(Ve(r))return{data:null,error:r};throw r}}async _listOAuthClients(i){var r,l,c,d,f,g,m;try{const p={nextPage:null,lastPage:0,total:0},_=await Je(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(l=(r=i?.page)===null||r===void 0?void 0:r.toString())!==null&&l!==void 0?l:"",per_page:(d=(c=i?.perPage)===null||c===void 0?void 0:c.toString())!==null&&d!==void 0?d:""},xform:Ap});if(_.error)throw _.error;const j=await _.json(),C=(f=_.headers.get("x-total-count"))!==null&&f!==void 0?f:0,N=(m=(g=_.headers.get("link"))===null||g===void 0?void 0:g.split(","))!==null&&m!==void 0?m:[];return N.length>0&&(N.forEach(k=>{const P=parseInt(k.split(";")[0].split("=")[1].substring(0,1)),E=JSON.parse(k.split(";")[1].split("=")[1]);p[`${E}Page`]=P}),p.total=parseInt(C)),{data:Object.assign(Object.assign({},j),p),error:null}}catch(p){if(Ve(p))return{data:{clients:[]},error:p};throw p}}async _createOAuthClient(i){try{return await Je(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:i,headers:this.headers,xform:r=>({data:r,error:null})})}catch(r){if(Ve(r))return{data:null,error:r};throw r}}async _getOAuthClient(i){try{return await Je(this.fetch,"GET",`${this.url}/admin/oauth/clients/${i}`,{headers:this.headers,xform:r=>({data:r,error:null})})}catch(r){if(Ve(r))return{data:null,error:r};throw r}}async _deleteOAuthClient(i){try{return await Je(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${i}`,{headers:this.headers,xform:r=>({data:r,error:null})})}catch(r){if(Ve(r))return{data:null,error:r};throw r}}async _regenerateOAuthClientSecret(i){try{return await Je(this.fetch,"POST",`${this.url}/admin/oauth/clients/${i}/regenerate_secret`,{headers:this.headers,xform:r=>({data:r,error:null})})}catch(r){if(Ve(r))return{data:null,error:r};throw r}}}function kp(o={}){return{getItem:i=>o[i]||null,setItem:(i,r)=>{o[i]=r},removeItem:i=>{delete o[i]}}}const Di={debug:!!(globalThis&&dg()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class fg extends Error{constructor(i){super(i),this.isAcquireTimeout=!0}}class Wb extends fg{}async function ej(o,i,r){Di.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",o,i);const l=new globalThis.AbortController;return i>0&&setTimeout(()=>{l.abort(),Di.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",o)},i),await Promise.resolve().then(()=>globalThis.navigator.locks.request(o,i===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:l.signal},async c=>{if(c){Di.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",o,c.name);try{return await r()}finally{Di.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",o,c.name)}}else{if(i===0)throw Di.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",o),new Wb(`Acquiring an exclusive Navigator LockManager lock "${o}" immediately failed`);if(Di.debug)try{const d=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(d,null,"  "))}catch(d){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",d)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await r()}}))}function tj(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function mg(o){if(!/^0x[a-fA-F0-9]{40}$/.test(o))throw new Error(`@supabase/auth-js: Address "${o}" is invalid.`);return o.toLowerCase()}function nj(o){return parseInt(o,16)}function aj(o){const i=new TextEncoder().encode(o);return"0x"+Array.from(i,l=>l.toString(16).padStart(2,"0")).join("")}function sj(o){var i;const{chainId:r,domain:l,expirationTime:c,issuedAt:d=new Date,nonce:f,notBefore:g,requestId:m,resources:p,scheme:_,uri:j,version:C}=o;{if(!Number.isInteger(r))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${r}`);if(!l)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(f&&f.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${f}`);if(!j)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(C!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${C}`);if(!((i=o.statement)===null||i===void 0)&&i.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${o.statement}`)}const N=mg(o.address),k=_?`${_}://${l}`:l,P=o.statement?`${o.statement}
`:"",E=`${k} wants you to sign in with your Ethereum account:
${N}

${P}`;let V=`URI: ${j}
Version: ${C}
Chain ID: ${r}${f?`
Nonce: ${f}`:""}
Issued At: ${d.toISOString()}`;if(c&&(V+=`
Expiration Time: ${c.toISOString()}`),g&&(V+=`
Not Before: ${g.toISOString()}`),m&&(V+=`
Request ID: ${m}`),p){let L=`
Resources:`;for(const U of p){if(!U||typeof U!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${U}`);L+=`
- ${U}`}V+=L}return`${E}
${V}`}class Zt extends Error{constructor({message:i,code:r,cause:l,name:c}){var d;super(i,{cause:l}),this.__isWebAuthnError=!0,this.name=(d=c??(l instanceof Error?l.name:void 0))!==null&&d!==void 0?d:"Unknown Error",this.code=r}}class _o extends Zt{constructor(i,r){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:r,message:i}),this.name="WebAuthnUnknownError",this.originalError=r}}function ij({error:o,options:i}){var r,l,c;const{publicKey:d}=i;if(!d)throw Error("options was missing required publicKey property");if(o.name==="AbortError"){if(i.signal instanceof AbortSignal)return new Zt({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:o})}else if(o.name==="ConstraintError"){if(((r=d.authenticatorSelection)===null||r===void 0?void 0:r.requireResidentKey)===!0)return new Zt({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:o});if(i.mediation==="conditional"&&((l=d.authenticatorSelection)===null||l===void 0?void 0:l.userVerification)==="required")return new Zt({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:o});if(((c=d.authenticatorSelection)===null||c===void 0?void 0:c.userVerification)==="required")return new Zt({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:o})}else{if(o.name==="InvalidStateError")return new Zt({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:o});if(o.name==="NotAllowedError")return new Zt({message:o.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:o});if(o.name==="NotSupportedError")return d.pubKeyCredParams.filter(g=>g.type==="public-key").length===0?new Zt({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:o}):new Zt({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:o});if(o.name==="SecurityError"){const f=window.location.hostname;if(gg(f)){if(d.rp.id!==f)return new Zt({message:`The RP ID "${d.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:o})}else return new Zt({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:o})}else if(o.name==="TypeError"){if(d.user.id.byteLength<1||d.user.id.byteLength>64)return new Zt({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:o})}else if(o.name==="UnknownError")return new Zt({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:o})}return new Zt({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:o})}function rj({error:o,options:i}){const{publicKey:r}=i;if(!r)throw Error("options was missing required publicKey property");if(o.name==="AbortError"){if(i.signal instanceof AbortSignal)return new Zt({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:o})}else{if(o.name==="NotAllowedError")return new Zt({message:o.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:o});if(o.name==="SecurityError"){const l=window.location.hostname;if(gg(l)){if(r.rpId!==l)return new Zt({message:`The RP ID "${r.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:o})}else return new Zt({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:o})}else if(o.name==="UnknownError")return new Zt({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:o})}return new Zt({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:o})}var pg=function(o,i){var r={};for(var l in o)Object.prototype.hasOwnProperty.call(o,l)&&i.indexOf(l)<0&&(r[l]=o[l]);if(o!=null&&typeof Object.getOwnPropertySymbols=="function")for(var c=0,l=Object.getOwnPropertySymbols(o);c<l.length;c++)i.indexOf(l[c])<0&&Object.prototype.propertyIsEnumerable.call(o,l[c])&&(r[l[c]]=o[l[c]]);return r};class lj{createNewAbortSignal(){if(this.controller){const r=new Error("Cancelling existing WebAuthn API call for new one");r.name="AbortError",this.controller.abort(r)}const i=new AbortController;return this.controller=i,i.signal}cancelCeremony(){if(this.controller){const i=new Error("Manually cancelling existing WebAuthn API call");i.name="AbortError",this.controller.abort(i),this.controller=void 0}}}const oj=new lj;function cj(o){if(!o)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(o);const{challenge:i,user:r,excludeCredentials:l}=o,c=pg(o,["challenge","user","excludeCredentials"]),d=Ui(i).buffer,f=Object.assign(Object.assign({},r),{id:Ui(r.id).buffer}),g=Object.assign(Object.assign({},c),{challenge:d,user:f});if(l&&l.length>0){g.excludeCredentials=new Array(l.length);for(let m=0;m<l.length;m++){const p=l[m];g.excludeCredentials[m]=Object.assign(Object.assign({},p),{id:Ui(p.id).buffer,type:p.type||"public-key",transports:p.transports})}}return g}function uj(o){if(!o)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(o);const{challenge:i,allowCredentials:r}=o,l=pg(o,["challenge","allowCredentials"]),c=Ui(i).buffer,d=Object.assign(Object.assign({},l),{challenge:c});if(r&&r.length>0){d.allowCredentials=new Array(r.length);for(let f=0;f<r.length;f++){const g=r[f];d.allowCredentials[f]=Object.assign(Object.assign({},g),{id:Ui(g.id).buffer,type:g.type||"public-key",transports:g.transports})}}return d}function dj(o){var i;if("toJSON"in o&&typeof o.toJSON=="function")return o.toJSON();const r=o;return{id:o.id,rawId:o.id,response:{attestationObject:Fs(new Uint8Array(o.response.attestationObject)),clientDataJSON:Fs(new Uint8Array(o.response.clientDataJSON))},type:"public-key",clientExtensionResults:o.getClientExtensionResults(),authenticatorAttachment:(i=r.authenticatorAttachment)!==null&&i!==void 0?i:void 0}}function hj(o){var i;if("toJSON"in o&&typeof o.toJSON=="function")return o.toJSON();const r=o,l=o.getClientExtensionResults(),c=o.response;return{id:o.id,rawId:o.id,response:{authenticatorData:Fs(new Uint8Array(c.authenticatorData)),clientDataJSON:Fs(new Uint8Array(c.clientDataJSON)),signature:Fs(new Uint8Array(c.signature)),userHandle:c.userHandle?Fs(new Uint8Array(c.userHandle)):void 0},type:"public-key",clientExtensionResults:l,authenticatorAttachment:(i=r.authenticatorAttachment)!==null&&i!==void 0?i:void 0}}function gg(o){return o==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(o)}function Op(){var o,i;return!!(Hn()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((o=navigator?.credentials)===null||o===void 0?void 0:o.create)=="function"&&typeof((i=navigator?.credentials)===null||i===void 0?void 0:i.get)=="function")}async function fj(o){try{const i=await navigator.credentials.create(o);return i?i instanceof PublicKeyCredential?{data:i,error:null}:{data:null,error:new _o("Browser returned unexpected credential type",i)}:{data:null,error:new _o("Empty credential response",i)}}catch(i){return{data:null,error:ij({error:i,options:o})}}}async function mj(o){try{const i=await navigator.credentials.get(o);return i?i instanceof PublicKeyCredential?{data:i,error:null}:{data:null,error:new _o("Browser returned unexpected credential type",i)}:{data:null,error:new _o("Empty credential response",i)}}catch(i){return{data:null,error:rj({error:i,options:o})}}}const pj={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"none"},gj={userVerification:"preferred",hints:["security-key"]};function yo(...o){const i=c=>c!==null&&typeof c=="object"&&!Array.isArray(c),r=c=>c instanceof ArrayBuffer||ArrayBuffer.isView(c),l={};for(const c of o)if(c)for(const d in c){const f=c[d];if(f!==void 0)if(Array.isArray(f))l[d]=f;else if(r(f))l[d]=f;else if(i(f)){const g=l[d];i(g)?l[d]=yo(g,f):l[d]=yo(f)}else l[d]=f}return l}function vj(o,i){return yo(pj,o,i||{})}function _j(o,i){return yo(gj,o,i||{})}class yj{constructor(i){this.client=i,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(i){return this.client.mfa.enroll(Object.assign(Object.assign({},i),{factorType:"webauthn"}))}async _challenge({factorId:i,webauthn:r,friendlyName:l,signal:c},d){try{const{data:f,error:g}=await this.client.mfa.challenge({factorId:i,webauthn:r});if(!f)return{data:null,error:g};const m=c??oj.createNewAbortSignal();if(f.webauthn.type==="create"){const{user:p}=f.webauthn.credential_options.publicKey;p.name||(p.name=`${p.id}:${l}`),p.displayName||(p.displayName=p.name)}switch(f.webauthn.type){case"create":{const p=vj(f.webauthn.credential_options.publicKey,d?.create),{data:_,error:j}=await fj({publicKey:p,signal:m});return _?{data:{factorId:i,challengeId:f.id,webauthn:{type:f.webauthn.type,credential_response:_}},error:null}:{data:null,error:j}}case"request":{const p=_j(f.webauthn.credential_options.publicKey,d?.request),{data:_,error:j}=await mj(Object.assign(Object.assign({},f.webauthn.credential_options),{publicKey:p,signal:m}));return _?{data:{factorId:i,challengeId:f.id,webauthn:{type:f.webauthn.type,credential_response:_}},error:null}:{data:null,error:j}}}}catch(f){return Ve(f)?{data:null,error:f}:{data:null,error:new Ps("Unexpected error in challenge",f)}}}async _verify({challengeId:i,factorId:r,webauthn:l}){return this.client.mfa.verify({factorId:r,challengeId:i,webauthn:l})}async _authenticate({factorId:i,webauthn:{rpId:r=typeof window<"u"?window.location.hostname:void 0,rpOrigins:l=typeof window<"u"?[window.location.origin]:void 0,signal:c}},d){if(!r)return{data:null,error:new Vr("rpId is required for WebAuthn authentication")};try{if(!Op())return{data:null,error:new Ps("Browser does not support WebAuthn",null)};const{data:f,error:g}=await this.challenge({factorId:i,webauthn:{rpId:r,rpOrigins:l},signal:c},{request:d});if(!f)return{data:null,error:g};const{webauthn:m}=f;return this._verify({factorId:i,challengeId:f.challengeId,webauthn:{type:m.type,rpId:r,rpOrigins:l,credential_response:m.credential_response}})}catch(f){return Ve(f)?{data:null,error:f}:{data:null,error:new Ps("Unexpected error in authenticate",f)}}}async _register({friendlyName:i,rpId:r=typeof window<"u"?window.location.hostname:void 0,rpOrigins:l=typeof window<"u"?[window.location.origin]:void 0,signal:c},d){if(!r)return{data:null,error:new Vr("rpId is required for WebAuthn registration")};try{if(!Op())return{data:null,error:new Ps("Browser does not support WebAuthn",null)};const{data:f,error:g}=await this._enroll({friendlyName:i});if(!f)return await this.client.mfa.listFactors().then(_=>{var j;return(j=_.data)===null||j===void 0?void 0:j.all.find(C=>C.factor_type==="webauthn"&&C.friendly_name===i&&C.status!=="unverified")}).then(_=>_?this.client.mfa.unenroll({factorId:_?.id}):void 0),{data:null,error:g};const{data:m,error:p}=await this._challenge({factorId:f.id,friendlyName:f.friendly_name,webauthn:{rpId:r,rpOrigins:l},signal:c},{create:d});return m?this._verify({factorId:f.id,challengeId:m.challengeId,webauthn:{rpId:r,rpOrigins:l,type:m.webauthn.type,credential_response:m.webauthn.credential_response}}):{data:null,error:p}}catch(f){return Ve(f)?{data:null,error:f}:{data:null,error:new Ps("Unexpected error in register",f)}}}}tj();const xj={url:pb,storageKey:gb,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:vb,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function Rp(o,i,r){return await r()}const Mi={};class Gr{get jwks(){var i,r;return(r=(i=Mi[this.storageKey])===null||i===void 0?void 0:i.jwks)!==null&&r!==void 0?r:{keys:[]}}set jwks(i){Mi[this.storageKey]=Object.assign(Object.assign({},Mi[this.storageKey]),{jwks:i})}get jwks_cached_at(){var i,r;return(r=(i=Mi[this.storageKey])===null||i===void 0?void 0:i.cachedAt)!==null&&r!==void 0?r:Number.MIN_SAFE_INTEGER}set jwks_cached_at(i){Mi[this.storageKey]=Object.assign(Object.assign({},Mi[this.storageKey]),{cachedAt:i})}constructor(i){var r,l;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=Gr.nextInstanceID,Gr.nextInstanceID+=1,this.instanceID>0&&Hn()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const c=Object.assign(Object.assign({},xj),i);if(this.logDebugMessages=!!c.debug,typeof c.debug=="function"&&(this.logger=c.debug),this.persistSession=c.persistSession,this.storageKey=c.storageKey,this.autoRefreshToken=c.autoRefreshToken,this.admin=new Zb({url:c.url,headers:c.headers,fetch:c.fetch}),this.url=c.url,this.headers=c.headers,this.fetch=hg(c.fetch),this.lock=c.lock||Rp,this.detectSessionInUrl=c.detectSessionInUrl,this.flowType=c.flowType,this.hasCustomAuthorizationHeader=c.hasCustomAuthorizationHeader,c.lock?this.lock=c.lock:Hn()&&(!((r=globalThis?.navigator)===null||r===void 0)&&r.locks)?this.lock=ej:this.lock=Rp,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new yj(this)},this.persistSession?(c.storage?this.storage=c.storage:dg()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=kp(this.memoryStorage)),c.userStorage&&(this.userStorage=c.userStorage)):(this.memoryStorage={},this.storage=kp(this.memoryStorage)),Hn()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(d){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",d)}(l=this.broadcastChannel)===null||l===void 0||l.addEventListener("message",async d=>{this._debug("received broadcast notification from other tab or client",d),await this._notifyAllSubscribers(d.data.event,d.data.session,!1)})}this.initialize()}_debug(...i){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${og}) ${new Date().toISOString()}`,...i),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var i;try{const r=Ob(window.location.href);let l="none";if(this._isImplicitGrantCallback(r)?l="implicit":await this._isPKCECallback(r)&&(l="pkce"),Hn()&&this.detectSessionInUrl&&l!=="none"){const{data:c,error:d}=await this._getSessionFromURL(r,l);if(d){if(this._debug("#_initialize()","error detecting session from URL",d),Sb(d)){const m=(i=d.details)===null||i===void 0?void 0:i.code;if(m==="identity_already_exists"||m==="identity_not_found"||m==="single_identity_not_deletable")return{error:d}}return await this._removeSession(),{error:d}}const{session:f,redirectType:g}=c;return this._debug("#_initialize()","detected session in URL",f,"redirect type",g),await this._saveSession(f),setTimeout(async()=>{g==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",f):await this._notifyAllSubscribers("SIGNED_IN",f)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(r){return Ve(r)?{error:r}:{error:new Ps("Unexpected error during initialization",r)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(i){var r,l,c;try{const d=await Je(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(l=(r=i?.options)===null||r===void 0?void 0:r.data)!==null&&l!==void 0?l:{},gotrue_meta_security:{captcha_token:(c=i?.options)===null||c===void 0?void 0:c.captchaToken}},xform:ia}),{data:f,error:g}=d;if(g||!f)return{data:{user:null,session:null},error:g};const m=f.session,p=f.user;return f.session&&(await this._saveSession(f.session),await this._notifyAllSubscribers("SIGNED_IN",m)),{data:{user:p,session:m},error:null}}catch(d){if(Ve(d))return{data:{user:null,session:null},error:d};throw d}}async signUp(i){var r,l,c;try{let d;if("email"in i){const{email:_,password:j,options:C}=i;let N=null,k=null;this.flowType==="pkce"&&([N,k]=await Ri(this.storage,this.storageKey)),d=await Je(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:C?.emailRedirectTo,body:{email:_,password:j,data:(r=C?.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:C?.captchaToken},code_challenge:N,code_challenge_method:k},xform:ia})}else if("phone"in i){const{phone:_,password:j,options:C}=i;d=await Je(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:_,password:j,data:(l=C?.data)!==null&&l!==void 0?l:{},channel:(c=C?.channel)!==null&&c!==void 0?c:"sms",gotrue_meta_security:{captcha_token:C?.captchaToken}},xform:ia})}else throw new uo("You must provide either an email or phone number and a password");const{data:f,error:g}=d;if(g||!f)return{data:{user:null,session:null},error:g};const m=f.session,p=f.user;return f.session&&(await this._saveSession(f.session),await this._notifyAllSubscribers("SIGNED_IN",m)),{data:{user:p,session:m},error:null}}catch(d){if(Ve(d))return{data:{user:null,session:null},error:d};throw d}}async signInWithPassword(i){try{let r;if("email"in i){const{email:d,password:f,options:g}=i;r=await Je(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:d,password:f,gotrue_meta_security:{captcha_token:g?.captchaToken}},xform:Tp})}else if("phone"in i){const{phone:d,password:f,options:g}=i;r=await Je(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:d,password:f,gotrue_meta_security:{captcha_token:g?.captchaToken}},xform:Tp})}else throw new uo("You must provide either an email or phone number and a password");const{data:l,error:c}=r;return c?{data:{user:null,session:null},error:c}:!l||!l.session||!l.user?{data:{user:null,session:null},error:new Oi}:(l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",l.session)),{data:Object.assign({user:l.user,session:l.session},l.weak_password?{weakPassword:l.weak_password}:null),error:c})}catch(r){if(Ve(r))return{data:{user:null,session:null},error:r};throw r}}async signInWithOAuth(i){var r,l,c,d;return await this._handleProviderSignIn(i.provider,{redirectTo:(r=i.options)===null||r===void 0?void 0:r.redirectTo,scopes:(l=i.options)===null||l===void 0?void 0:l.scopes,queryParams:(c=i.options)===null||c===void 0?void 0:c.queryParams,skipBrowserRedirect:(d=i.options)===null||d===void 0?void 0:d.skipBrowserRedirect})}async exchangeCodeForSession(i){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(i))}async signInWithWeb3(i){const{chain:r}=i;switch(r){case"ethereum":return await this.signInWithEthereum(i);case"solana":return await this.signInWithSolana(i);default:throw new Error(`@supabase/auth-js: Unsupported chain "${r}"`)}}async signInWithEthereum(i){var r,l,c,d,f,g,m,p,_,j,C;let N,k;if("message"in i)N=i.message,k=i.signature;else{const{chain:P,wallet:E,statement:V,options:L}=i;let U;if(Hn())if(typeof E=="object")U=E;else{const T=window;if("ethereum"in T&&typeof T.ethereum=="object"&&"request"in T.ethereum&&typeof T.ethereum.request=="function")U=T.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof E!="object"||!L?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");U=E}const O=new URL((r=L?.url)!==null&&r!==void 0?r:window.location.href),M=await U.request({method:"eth_requestAccounts"}).then(T=>T).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!M||M.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const G=mg(M[0]);let q=(l=L?.signInWithEthereum)===null||l===void 0?void 0:l.chainId;if(!q){const T=await U.request({method:"eth_chainId"});q=nj(T)}const Y={domain:O.host,address:G,statement:V,uri:O.href,version:"1",chainId:q,nonce:(c=L?.signInWithEthereum)===null||c===void 0?void 0:c.nonce,issuedAt:(f=(d=L?.signInWithEthereum)===null||d===void 0?void 0:d.issuedAt)!==null&&f!==void 0?f:new Date,expirationTime:(g=L?.signInWithEthereum)===null||g===void 0?void 0:g.expirationTime,notBefore:(m=L?.signInWithEthereum)===null||m===void 0?void 0:m.notBefore,requestId:(p=L?.signInWithEthereum)===null||p===void 0?void 0:p.requestId,resources:(_=L?.signInWithEthereum)===null||_===void 0?void 0:_.resources};N=sj(Y),k=await U.request({method:"personal_sign",params:[aj(N),G]})}try{const{data:P,error:E}=await Je(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:N,signature:k},!((j=i.options)===null||j===void 0)&&j.captchaToken?{gotrue_meta_security:{captcha_token:(C=i.options)===null||C===void 0?void 0:C.captchaToken}}:null),xform:ia});if(E)throw E;return!P||!P.session||!P.user?{data:{user:null,session:null},error:new Oi}:(P.session&&(await this._saveSession(P.session),await this._notifyAllSubscribers("SIGNED_IN",P.session)),{data:Object.assign({},P),error:E})}catch(P){if(Ve(P))return{data:{user:null,session:null},error:P};throw P}}async signInWithSolana(i){var r,l,c,d,f,g,m,p,_,j,C,N;let k,P;if("message"in i)k=i.message,P=i.signature;else{const{chain:E,wallet:V,statement:L,options:U}=i;let O;if(Hn())if(typeof V=="object")O=V;else{const G=window;if("solana"in G&&typeof G.solana=="object"&&("signIn"in G.solana&&typeof G.solana.signIn=="function"||"signMessage"in G.solana&&typeof G.solana.signMessage=="function"))O=G.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof V!="object"||!U?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");O=V}const M=new URL((r=U?.url)!==null&&r!==void 0?r:window.location.href);if("signIn"in O&&O.signIn){const G=await O.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},U?.signInWithSolana),{version:"1",domain:M.host,uri:M.href}),L?{statement:L}:null));let q;if(Array.isArray(G)&&G[0]&&typeof G[0]=="object")q=G[0];else if(G&&typeof G=="object"&&"signedMessage"in G&&"signature"in G)q=G;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in q&&"signature"in q&&(typeof q.signedMessage=="string"||q.signedMessage instanceof Uint8Array)&&q.signature instanceof Uint8Array)k=typeof q.signedMessage=="string"?q.signedMessage:new TextDecoder().decode(q.signedMessage),P=q.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in O)||typeof O.signMessage!="function"||!("publicKey"in O)||typeof O!="object"||!O.publicKey||!("toBase58"in O.publicKey)||typeof O.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");k=[`${M.host} wants you to sign in with your Solana account:`,O.publicKey.toBase58(),...L?["",L,""]:[""],"Version: 1",`URI: ${M.href}`,`Issued At: ${(c=(l=U?.signInWithSolana)===null||l===void 0?void 0:l.issuedAt)!==null&&c!==void 0?c:new Date().toISOString()}`,...!((d=U?.signInWithSolana)===null||d===void 0)&&d.notBefore?[`Not Before: ${U.signInWithSolana.notBefore}`]:[],...!((f=U?.signInWithSolana)===null||f===void 0)&&f.expirationTime?[`Expiration Time: ${U.signInWithSolana.expirationTime}`]:[],...!((g=U?.signInWithSolana)===null||g===void 0)&&g.chainId?[`Chain ID: ${U.signInWithSolana.chainId}`]:[],...!((m=U?.signInWithSolana)===null||m===void 0)&&m.nonce?[`Nonce: ${U.signInWithSolana.nonce}`]:[],...!((p=U?.signInWithSolana)===null||p===void 0)&&p.requestId?[`Request ID: ${U.signInWithSolana.requestId}`]:[],...!((j=(_=U?.signInWithSolana)===null||_===void 0?void 0:_.resources)===null||j===void 0)&&j.length?["Resources",...U.signInWithSolana.resources.map(q=>`- ${q}`)]:[]].join(`
`);const G=await O.signMessage(new TextEncoder().encode(k),"utf8");if(!G||!(G instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");P=G}}try{const{data:E,error:V}=await Je(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:k,signature:Fs(P)},!((C=i.options)===null||C===void 0)&&C.captchaToken?{gotrue_meta_security:{captcha_token:(N=i.options)===null||N===void 0?void 0:N.captchaToken}}:null),xform:ia});if(V)throw V;return!E||!E.session||!E.user?{data:{user:null,session:null},error:new Oi}:(E.session&&(await this._saveSession(E.session),await this._notifyAllSubscribers("SIGNED_IN",E.session)),{data:Object.assign({},E),error:V})}catch(E){if(Ve(E))return{data:{user:null,session:null},error:E};throw E}}async _exchangeCodeForSession(i){const r=await zs(this.storage,`${this.storageKey}-code-verifier`),[l,c]=(r??"").split("/");try{const{data:d,error:f}=await Je(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:i,code_verifier:l},xform:ia});if(await hs(this.storage,`${this.storageKey}-code-verifier`),f)throw f;return!d||!d.session||!d.user?{data:{user:null,session:null,redirectType:null},error:new Oi}:(d.session&&(await this._saveSession(d.session),await this._notifyAllSubscribers("SIGNED_IN",d.session)),{data:Object.assign(Object.assign({},d),{redirectType:c??null}),error:f})}catch(d){if(Ve(d))return{data:{user:null,session:null,redirectType:null},error:d};throw d}}async signInWithIdToken(i){try{const{options:r,provider:l,token:c,access_token:d,nonce:f}=i,g=await Je(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:l,id_token:c,access_token:d,nonce:f,gotrue_meta_security:{captcha_token:r?.captchaToken}},xform:ia}),{data:m,error:p}=g;return p?{data:{user:null,session:null},error:p}:!m||!m.session||!m.user?{data:{user:null,session:null},error:new Oi}:(m.session&&(await this._saveSession(m.session),await this._notifyAllSubscribers("SIGNED_IN",m.session)),{data:m,error:p})}catch(r){if(Ve(r))return{data:{user:null,session:null},error:r};throw r}}async signInWithOtp(i){var r,l,c,d,f;try{if("email"in i){const{email:g,options:m}=i;let p=null,_=null;this.flowType==="pkce"&&([p,_]=await Ri(this.storage,this.storageKey));const{error:j}=await Je(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:g,data:(r=m?.data)!==null&&r!==void 0?r:{},create_user:(l=m?.shouldCreateUser)!==null&&l!==void 0?l:!0,gotrue_meta_security:{captcha_token:m?.captchaToken},code_challenge:p,code_challenge_method:_},redirectTo:m?.emailRedirectTo});return{data:{user:null,session:null},error:j}}if("phone"in i){const{phone:g,options:m}=i,{data:p,error:_}=await Je(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:g,data:(c=m?.data)!==null&&c!==void 0?c:{},create_user:(d=m?.shouldCreateUser)!==null&&d!==void 0?d:!0,gotrue_meta_security:{captcha_token:m?.captchaToken},channel:(f=m?.channel)!==null&&f!==void 0?f:"sms"}});return{data:{user:null,session:null,messageId:p?.message_id},error:_}}throw new uo("You must provide either an email or phone number.")}catch(g){if(Ve(g))return{data:{user:null,session:null},error:g};throw g}}async verifyOtp(i){var r,l;try{let c,d;"options"in i&&(c=(r=i.options)===null||r===void 0?void 0:r.redirectTo,d=(l=i.options)===null||l===void 0?void 0:l.captchaToken);const{data:f,error:g}=await Je(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},i),{gotrue_meta_security:{captcha_token:d}}),redirectTo:c,xform:ia});if(g)throw g;if(!f)throw new Error("An error occurred on token verification.");const m=f.session,p=f.user;return m?.access_token&&(await this._saveSession(m),await this._notifyAllSubscribers(i.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",m)),{data:{user:p,session:m},error:null}}catch(c){if(Ve(c))return{data:{user:null,session:null},error:c};throw c}}async signInWithSSO(i){var r,l,c;try{let d=null,f=null;return this.flowType==="pkce"&&([d,f]=await Ri(this.storage,this.storageKey)),await Je(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in i?{provider_id:i.providerId}:null),"domain"in i?{domain:i.domain}:null),{redirect_to:(l=(r=i.options)===null||r===void 0?void 0:r.redirectTo)!==null&&l!==void 0?l:void 0}),!((c=i?.options)===null||c===void 0)&&c.captchaToken?{gotrue_meta_security:{captcha_token:i.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:d,code_challenge_method:f}),headers:this.headers,xform:Qb})}catch(d){if(Ve(d))return{data:null,error:d};throw d}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async i=>{const{data:{session:r},error:l}=i;if(l)throw l;if(!r)throw new fs;const{error:c}=await Je(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:r.access_token});return{data:{user:null,session:null},error:c}})}catch(i){if(Ve(i))return{data:{user:null,session:null},error:i};throw i}}async resend(i){try{const r=`${this.url}/resend`;if("email"in i){const{email:l,type:c,options:d}=i,{error:f}=await Je(this.fetch,"POST",r,{headers:this.headers,body:{email:l,type:c,gotrue_meta_security:{captcha_token:d?.captchaToken}},redirectTo:d?.emailRedirectTo});return{data:{user:null,session:null},error:f}}else if("phone"in i){const{phone:l,type:c,options:d}=i,{data:f,error:g}=await Je(this.fetch,"POST",r,{headers:this.headers,body:{phone:l,type:c,gotrue_meta_security:{captcha_token:d?.captchaToken}}});return{data:{user:null,session:null,messageId:f?.message_id},error:g}}throw new uo("You must provide either an email or phone number and a type")}catch(r){if(Ve(r))return{data:{user:null,session:null},error:r};throw r}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async r=>r))}async _acquireLock(i,r){this._debug("#_acquireLock","begin",i);try{if(this.lockAcquired){const l=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),c=(async()=>(await l,await r()))();return this.pendingInLock.push((async()=>{try{await c}catch{}})()),c}return await this.lock(`lock:${this.storageKey}`,i,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const l=r();for(this.pendingInLock.push((async()=>{try{await l}catch{}})()),await l;this.pendingInLock.length;){const c=[...this.pendingInLock];await Promise.all(c),this.pendingInLock.splice(0,c.length)}return await l}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(i){this._debug("#_useSession","begin");try{const r=await this.__loadSession();return await i(r)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let i=null;const r=await zs(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",r),r!==null&&(this._isValidSession(r)?i=r:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!i)return{data:{session:null},error:null};const l=i.expires_at?i.expires_at*1e3-Date.now()<zu:!1;if(this._debug("#__loadSession()",`session has${l?"":" not"} expired`,"expires_at",i.expires_at),!l){if(this.userStorage){const f=await zs(this.userStorage,this.storageKey+"-user");f?.user?i.user=f.user:i.user=Bu()}if(this.storage.isServer&&i.user){let f=this.suppressGetSessionWarning;i=new Proxy(i,{get:(m,p,_)=>(!f&&p==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),f=!0,this.suppressGetSessionWarning=!0),Reflect.get(m,p,_))})}return{data:{session:i},error:null}}const{data:c,error:d}=await this._callRefreshToken(i.refresh_token);return d?{data:{session:null},error:d}:{data:{session:c},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(i){return i?await this._getUser(i):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(i){try{return i?await Je(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:i,xform:ms}):await this._useSession(async r=>{var l,c,d;const{data:f,error:g}=r;if(g)throw g;return!(!((l=f.session)===null||l===void 0)&&l.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new fs}:await Je(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(d=(c=f.session)===null||c===void 0?void 0:c.access_token)!==null&&d!==void 0?d:void 0,xform:ms})})}catch(r){if(Ve(r))return jb(r)&&(await this._removeSession(),await hs(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:r};throw r}}async updateUser(i,r={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(i,r))}async _updateUser(i,r={}){try{return await this._useSession(async l=>{const{data:c,error:d}=l;if(d)throw d;if(!c.session)throw new fs;const f=c.session;let g=null,m=null;this.flowType==="pkce"&&i.email!=null&&([g,m]=await Ri(this.storage,this.storageKey));const{data:p,error:_}=await Je(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:r?.emailRedirectTo,body:Object.assign(Object.assign({},i),{code_challenge:g,code_challenge_method:m}),jwt:f.access_token,xform:ms});if(_)throw _;return f.user=p.user,await this._saveSession(f),await this._notifyAllSubscribers("USER_UPDATED",f),{data:{user:f.user},error:null}})}catch(l){if(Ve(l))return{data:{user:null},error:l};throw l}}async setSession(i){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(i))}async _setSession(i){try{if(!i.access_token||!i.refresh_token)throw new fs;const r=Date.now()/1e3;let l=r,c=!0,d=null;const{payload:f}=Uu(i.access_token);if(f.exp&&(l=f.exp,c=l<=r),c){const{data:g,error:m}=await this._callRefreshToken(i.refresh_token);if(m)return{data:{user:null,session:null},error:m};if(!g)return{data:{user:null,session:null},error:null};d=g}else{const{data:g,error:m}=await this._getUser(i.access_token);if(m)throw m;d={access_token:i.access_token,refresh_token:i.refresh_token,user:g.user,token_type:"bearer",expires_in:l-r,expires_at:l},await this._saveSession(d),await this._notifyAllSubscribers("SIGNED_IN",d)}return{data:{user:d.user,session:d},error:null}}catch(r){if(Ve(r))return{data:{session:null,user:null},error:r};throw r}}async refreshSession(i){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(i))}async _refreshSession(i){try{return await this._useSession(async r=>{var l;if(!i){const{data:f,error:g}=r;if(g)throw g;i=(l=f.session)!==null&&l!==void 0?l:void 0}if(!i?.refresh_token)throw new fs;const{data:c,error:d}=await this._callRefreshToken(i.refresh_token);return d?{data:{user:null,session:null},error:d}:c?{data:{user:c.user,session:c},error:null}:{data:{user:null,session:null},error:null}})}catch(r){if(Ve(r))return{data:{user:null,session:null},error:r};throw r}}async _getSessionFromURL(i,r){try{if(!Hn())throw new ho("No browser detected.");if(i.error||i.error_description||i.error_code)throw new ho(i.error_description||"Error in URL with unspecified error_description",{error:i.error||"unspecified_error",code:i.error_code||"unspecified_code"});switch(r){case"implicit":if(this.flowType==="pkce")throw new bp("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new ho("Not a valid implicit grant flow url.");break;default:}if(r==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!i.code)throw new bp("No code detected.");const{data:L,error:U}=await this._exchangeCodeForSession(i.code);if(U)throw U;const O=new URL(window.location.href);return O.searchParams.delete("code"),window.history.replaceState(window.history.state,"",O.toString()),{data:{session:L.session,redirectType:null},error:null}}const{provider_token:l,provider_refresh_token:c,access_token:d,refresh_token:f,expires_in:g,expires_at:m,token_type:p}=i;if(!d||!g||!f||!p)throw new ho("No session defined in URL");const _=Math.round(Date.now()/1e3),j=parseInt(g);let C=_+j;m&&(C=parseInt(m));const N=C-_;N*1e3<=zi&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${N}s, should have been closer to ${j}s`);const k=C-j;_-k>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",k,C,_):_-k<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",k,C,_);const{data:P,error:E}=await this._getUser(d);if(E)throw E;const V={provider_token:l,provider_refresh_token:c,access_token:d,expires_in:j,expires_at:C,refresh_token:f,token_type:p,user:P.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:V,redirectType:i.type},error:null}}catch(l){if(Ve(l))return{data:{session:null,redirectType:null},error:l};throw l}}_isImplicitGrantCallback(i){return!!(i.access_token||i.error_description)}async _isPKCECallback(i){const r=await zs(this.storage,`${this.storageKey}-code-verifier`);return!!(i.code&&r)}async signOut(i={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(i))}async _signOut({scope:i}={scope:"global"}){return await this._useSession(async r=>{var l;const{data:c,error:d}=r;if(d)return{error:d};const f=(l=c.session)===null||l===void 0?void 0:l.access_token;if(f){const{error:g}=await this.admin.signOut(f,i);if(g&&!(bb(g)&&(g.status===404||g.status===401||g.status===403)))return{error:g}}return i!=="others"&&(await this._removeSession(),await hs(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(i){const r=kb(),l={id:r,callback:i,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",r),this.stateChangeEmitters.delete(r)}};return this._debug("#onAuthStateChange()","registered callback with id",r),this.stateChangeEmitters.set(r,l),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(r)})))(),{data:{subscription:l}}}async _emitInitialSession(i){return await this._useSession(async r=>{var l,c;try{const{data:{session:d},error:f}=r;if(f)throw f;await((l=this.stateChangeEmitters.get(i))===null||l===void 0?void 0:l.callback("INITIAL_SESSION",d)),this._debug("INITIAL_SESSION","callback id",i,"session",d)}catch(d){await((c=this.stateChangeEmitters.get(i))===null||c===void 0?void 0:c.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",i,"error",d),console.error(d)}})}async resetPasswordForEmail(i,r={}){let l=null,c=null;this.flowType==="pkce"&&([l,c]=await Ri(this.storage,this.storageKey,!0));try{return await Je(this.fetch,"POST",`${this.url}/recover`,{body:{email:i,code_challenge:l,code_challenge_method:c,gotrue_meta_security:{captcha_token:r.captchaToken}},headers:this.headers,redirectTo:r.redirectTo})}catch(d){if(Ve(d))return{data:null,error:d};throw d}}async getUserIdentities(){var i;try{const{data:r,error:l}=await this.getUser();if(l)throw l;return{data:{identities:(i=r.user.identities)!==null&&i!==void 0?i:[]},error:null}}catch(r){if(Ve(r))return{data:null,error:r};throw r}}async linkIdentity(i){return"token"in i?this.linkIdentityIdToken(i):this.linkIdentityOAuth(i)}async linkIdentityOAuth(i){var r;try{const{data:l,error:c}=await this._useSession(async d=>{var f,g,m,p,_;const{data:j,error:C}=d;if(C)throw C;const N=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,i.provider,{redirectTo:(f=i.options)===null||f===void 0?void 0:f.redirectTo,scopes:(g=i.options)===null||g===void 0?void 0:g.scopes,queryParams:(m=i.options)===null||m===void 0?void 0:m.queryParams,skipBrowserRedirect:!0});return await Je(this.fetch,"GET",N,{headers:this.headers,jwt:(_=(p=j.session)===null||p===void 0?void 0:p.access_token)!==null&&_!==void 0?_:void 0})});if(c)throw c;return Hn()&&!(!((r=i.options)===null||r===void 0)&&r.skipBrowserRedirect)&&window.location.assign(l?.url),{data:{provider:i.provider,url:l?.url},error:null}}catch(l){if(Ve(l))return{data:{provider:i.provider,url:null},error:l};throw l}}async linkIdentityIdToken(i){return await this._useSession(async r=>{var l;try{const{error:c,data:{session:d}}=r;if(c)throw c;const{options:f,provider:g,token:m,access_token:p,nonce:_}=i,j=await Je(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(l=d?.access_token)!==null&&l!==void 0?l:void 0,body:{provider:g,id_token:m,access_token:p,nonce:_,link_identity:!0,gotrue_meta_security:{captcha_token:f?.captchaToken}},xform:ia}),{data:C,error:N}=j;return N?{data:{user:null,session:null},error:N}:!C||!C.session||!C.user?{data:{user:null,session:null},error:new Oi}:(C.session&&(await this._saveSession(C.session),await this._notifyAllSubscribers("USER_UPDATED",C.session)),{data:C,error:N})}catch(c){if(Ve(c))return{data:{user:null,session:null},error:c};throw c}})}async unlinkIdentity(i){try{return await this._useSession(async r=>{var l,c;const{data:d,error:f}=r;if(f)throw f;return await Je(this.fetch,"DELETE",`${this.url}/user/identities/${i.identity_id}`,{headers:this.headers,jwt:(c=(l=d.session)===null||l===void 0?void 0:l.access_token)!==null&&c!==void 0?c:void 0})})}catch(r){if(Ve(r))return{data:null,error:r};throw r}}async _refreshAccessToken(i){const r=`#_refreshAccessToken(${i.substring(0,5)}...)`;this._debug(r,"begin");try{const l=Date.now();return await Db(async c=>(c>0&&await qb(200*Math.pow(2,c-1)),this._debug(r,"refreshing attempt",c),await Je(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:i},headers:this.headers,xform:ia})),(c,d)=>{const f=200*Math.pow(2,c);return d&&Lu(d)&&Date.now()+f-l<zi})}catch(l){if(this._debug(r,"error",l),Ve(l))return{data:{session:null,user:null},error:l};throw l}finally{this._debug(r,"end")}}_isValidSession(i){return typeof i=="object"&&i!==null&&"access_token"in i&&"refresh_token"in i&&"expires_at"in i}async _handleProviderSignIn(i,r){const l=await this._getUrlForProvider(`${this.url}/authorize`,i,{redirectTo:r.redirectTo,scopes:r.scopes,queryParams:r.queryParams});return this._debug("#_handleProviderSignIn()","provider",i,"options",r,"url",l),Hn()&&!r.skipBrowserRedirect&&window.location.assign(l),{data:{provider:i,url:l},error:null}}async _recoverAndRefresh(){var i,r;const l="#_recoverAndRefresh()";this._debug(l,"begin");try{const c=await zs(this.storage,this.storageKey);if(c&&this.userStorage){let f=await zs(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!f&&(f={user:c.user},await Li(this.userStorage,this.storageKey+"-user",f)),c.user=(i=f?.user)!==null&&i!==void 0?i:Bu()}else if(c&&!c.user&&!c.user){const f=await zs(this.storage,this.storageKey+"-user");f&&f?.user?(c.user=f.user,await hs(this.storage,this.storageKey+"-user"),await Li(this.storage,this.storageKey,c)):c.user=Bu()}if(this._debug(l,"session from storage",c),!this._isValidSession(c)){this._debug(l,"session is not valid"),c!==null&&await this._removeSession();return}const d=((r=c.expires_at)!==null&&r!==void 0?r:1/0)*1e3-Date.now()<zu;if(this._debug(l,`session has${d?"":" not"} expired with margin of ${zu}s`),d){if(this.autoRefreshToken&&c.refresh_token){const{error:f}=await this._callRefreshToken(c.refresh_token);f&&(console.error(f),Lu(f)||(this._debug(l,"refresh failed with a non-retryable error, removing the session",f),await this._removeSession()))}}else if(c.user&&c.user.__isUserNotAvailableProxy===!0)try{const{data:f,error:g}=await this._getUser(c.access_token);!g&&f?.user?(c.user=f.user,await this._saveSession(c),await this._notifyAllSubscribers("SIGNED_IN",c)):this._debug(l,"could not get user data, skipping SIGNED_IN notification")}catch(f){console.error("Error getting user data:",f),this._debug(l,"error getting user data, skipping SIGNED_IN notification",f)}else await this._notifyAllSubscribers("SIGNED_IN",c)}catch(c){this._debug(l,"error",c),console.error(c);return}finally{this._debug(l,"end")}}async _callRefreshToken(i){var r,l;if(!i)throw new fs;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const c=`#_callRefreshToken(${i.substring(0,5)}...)`;this._debug(c,"begin");try{this.refreshingDeferred=new jo;const{data:d,error:f}=await this._refreshAccessToken(i);if(f)throw f;if(!d.session)throw new fs;await this._saveSession(d.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",d.session);const g={data:d.session,error:null};return this.refreshingDeferred.resolve(g),g}catch(d){if(this._debug(c,"error",d),Ve(d)){const f={data:null,error:d};return Lu(d)||await this._removeSession(),(r=this.refreshingDeferred)===null||r===void 0||r.resolve(f),f}throw(l=this.refreshingDeferred)===null||l===void 0||l.reject(d),d}finally{this.refreshingDeferred=null,this._debug(c,"end")}}async _notifyAllSubscribers(i,r,l=!0){const c=`#_notifyAllSubscribers(${i})`;this._debug(c,"begin",r,`broadcast = ${l}`);try{this.broadcastChannel&&l&&this.broadcastChannel.postMessage({event:i,session:r});const d=[],f=Array.from(this.stateChangeEmitters.values()).map(async g=>{try{await g.callback(i,r)}catch(m){d.push(m)}});if(await Promise.all(f),d.length>0){for(let g=0;g<d.length;g+=1)console.error(d[g]);throw d[0]}}finally{this._debug(c,"end")}}async _saveSession(i){this._debug("#_saveSession()",i),this.suppressGetSessionWarning=!0;const r=Object.assign({},i),l=r.user&&r.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!l&&r.user&&await Li(this.userStorage,this.storageKey+"-user",{user:r.user});const c=Object.assign({},r);delete c.user;const d=Cp(c);await Li(this.storage,this.storageKey,d)}else{const c=Cp(r);await Li(this.storage,this.storageKey,c)}}async _removeSession(){this._debug("#_removeSession()"),await hs(this.storage,this.storageKey),await hs(this.storage,this.storageKey+"-code-verifier"),await hs(this.storage,this.storageKey+"-user"),this.userStorage&&await hs(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const i=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{i&&Hn()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",i)}catch(r){console.error("removing visibilitychange callback failed",r)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const i=setInterval(()=>this._autoRefreshTokenTick(),zi);this.autoRefreshTicker=i,i&&typeof i=="object"&&typeof i.unref=="function"?i.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(i),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const i=this.autoRefreshTicker;this.autoRefreshTicker=null,i&&clearInterval(i)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const i=Date.now();try{return await this._useSession(async r=>{const{data:{session:l}}=r;if(!l||!l.refresh_token||!l.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const c=Math.floor((l.expires_at*1e3-i)/zi);this._debug("#_autoRefreshTokenTick()",`access token expires in ${c} ticks, a tick lasts ${zi}ms, refresh threshold is ${Ju} ticks`),c<=Ju&&await this._callRefreshToken(l.refresh_token)})}catch(r){console.error("Auto refresh tick failed with error. This is likely a transient error.",r)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(i){if(i.isAcquireTimeout||i instanceof fg)this._debug("auto refresh token tick lock not available");else throw i}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!Hn()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(i){console.error("_handleVisibilityChange",i)}}async _onVisibilityChanged(i){const r=`#_onVisibilityChanged(${i})`;this._debug(r,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),i||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(r,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(i,r,l){const c=[`provider=${encodeURIComponent(r)}`];if(l?.redirectTo&&c.push(`redirect_to=${encodeURIComponent(l.redirectTo)}`),l?.scopes&&c.push(`scopes=${encodeURIComponent(l.scopes)}`),this.flowType==="pkce"){const[d,f]=await Ri(this.storage,this.storageKey),g=new URLSearchParams({code_challenge:`${encodeURIComponent(d)}`,code_challenge_method:`${encodeURIComponent(f)}`});c.push(g.toString())}if(l?.queryParams){const d=new URLSearchParams(l.queryParams);c.push(d.toString())}return l?.skipBrowserRedirect&&c.push(`skip_http_redirect=${l.skipBrowserRedirect}`),`${i}?${c.join("&")}`}async _unenroll(i){try{return await this._useSession(async r=>{var l;const{data:c,error:d}=r;return d?{data:null,error:d}:await Je(this.fetch,"DELETE",`${this.url}/factors/${i.factorId}`,{headers:this.headers,jwt:(l=c?.session)===null||l===void 0?void 0:l.access_token})})}catch(r){if(Ve(r))return{data:null,error:r};throw r}}async _enroll(i){try{return await this._useSession(async r=>{var l,c;const{data:d,error:f}=r;if(f)return{data:null,error:f};const g=Object.assign({friendly_name:i.friendlyName,factor_type:i.factorType},i.factorType==="phone"?{phone:i.phone}:i.factorType==="totp"?{issuer:i.issuer}:{}),{data:m,error:p}=await Je(this.fetch,"POST",`${this.url}/factors`,{body:g,headers:this.headers,jwt:(l=d?.session)===null||l===void 0?void 0:l.access_token});return p?{data:null,error:p}:(i.factorType==="totp"&&m.type==="totp"&&(!((c=m?.totp)===null||c===void 0)&&c.qr_code)&&(m.totp.qr_code=`data:image/svg+xml;utf-8,${m.totp.qr_code}`),{data:m,error:null})})}catch(r){if(Ve(r))return{data:null,error:r};throw r}}async _verify(i){return this._acquireLock(-1,async()=>{try{return await this._useSession(async r=>{var l;const{data:c,error:d}=r;if(d)return{data:null,error:d};const f=Object.assign({challenge_id:i.challengeId},"webauthn"in i?{webauthn:Object.assign(Object.assign({},i.webauthn),{credential_response:i.webauthn.type==="create"?dj(i.webauthn.credential_response):hj(i.webauthn.credential_response)})}:{code:i.code}),{data:g,error:m}=await Je(this.fetch,"POST",`${this.url}/factors/${i.factorId}/verify`,{body:f,headers:this.headers,jwt:(l=c?.session)===null||l===void 0?void 0:l.access_token});return m?{data:null,error:m}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+g.expires_in},g)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",g),{data:g,error:m})})}catch(r){if(Ve(r))return{data:null,error:r};throw r}})}async _challenge(i){return this._acquireLock(-1,async()=>{try{return await this._useSession(async r=>{var l;const{data:c,error:d}=r;if(d)return{data:null,error:d};const f=await Je(this.fetch,"POST",`${this.url}/factors/${i.factorId}/challenge`,{body:i,headers:this.headers,jwt:(l=c?.session)===null||l===void 0?void 0:l.access_token});if(f.error)return f;const{data:g}=f;if(g.type!=="webauthn")return{data:g,error:null};switch(g.webauthn.type){case"create":return{data:Object.assign(Object.assign({},g),{webauthn:Object.assign(Object.assign({},g.webauthn),{credential_options:Object.assign(Object.assign({},g.webauthn.credential_options),{publicKey:cj(g.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},g),{webauthn:Object.assign(Object.assign({},g.webauthn),{credential_options:Object.assign(Object.assign({},g.webauthn.credential_options),{publicKey:uj(g.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(r){if(Ve(r))return{data:null,error:r};throw r}})}async _challengeAndVerify(i){const{data:r,error:l}=await this._challenge({factorId:i.factorId});return l?{data:null,error:l}:await this._verify({factorId:i.factorId,challengeId:r.id,code:i.code})}async _listFactors(){var i;const{data:{user:r},error:l}=await this.getUser();if(l)return{data:null,error:l};const c={all:[],phone:[],totp:[],webauthn:[]};for(const d of(i=r?.factors)!==null&&i!==void 0?i:[])c.all.push(d),d.status==="verified"&&c[d.factor_type].push(d);return{data:c,error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async i=>{var r,l;const{data:{session:c},error:d}=i;if(d)return{data:null,error:d};if(!c)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:f}=Uu(c.access_token);let g=null;f.aal&&(g=f.aal);let m=g;((l=(r=c.user.factors)===null||r===void 0?void 0:r.filter(j=>j.status==="verified"))!==null&&l!==void 0?l:[]).length>0&&(m="aal2");const _=f.amr||[];return{data:{currentLevel:g,nextLevel:m,currentAuthenticationMethods:_},error:null}}))}async fetchJwk(i,r={keys:[]}){let l=r.keys.find(g=>g.kid===i);if(l)return l;const c=Date.now();if(l=this.jwks.keys.find(g=>g.kid===i),l&&this.jwks_cached_at+yb>c)return l;const{data:d,error:f}=await Je(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(f)throw f;return!d.keys||d.keys.length===0||(this.jwks=d,this.jwks_cached_at=c,l=d.keys.find(g=>g.kid===i),!l)?null:l}async getClaims(i,r={}){try{let l=i;if(!l){const{data:N,error:k}=await this.getSession();if(k||!N.session)return{data:null,error:k};l=N.session.access_token}const{header:c,payload:d,signature:f,raw:{header:g,payload:m}}=Uu(l);r?.allowExpired||Fb(d.exp);const p=!c.alg||c.alg.startsWith("HS")||!c.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(c.kid,r?.keys?{keys:r.keys}:r?.jwks);if(!p){const{error:N}=await this.getUser(l);if(N)throw N;return{data:{claims:d,header:c,signature:f},error:null}}const _=Hb(c.alg),j=await crypto.subtle.importKey("jwk",p,_,!0,["verify"]);if(!await crypto.subtle.verify(_,j,f,Tb(`${g}.${m}`)))throw new Wu("Invalid JWT signature");return{data:{claims:d,header:c,signature:f},error:null}}catch(l){if(Ve(l))return{data:null,error:l};throw l}}}Gr.nextInstanceID=0;const bj=Gr;class jj extends bj{constructor(i){super(i)}}var Sj=function(o,i,r,l){function c(d){return d instanceof r?d:new r(function(f){f(d)})}return new(r||(r=Promise))(function(d,f){function g(_){try{p(l.next(_))}catch(j){f(j)}}function m(_){try{p(l.throw(_))}catch(j){f(j)}}function p(_){_.done?d(_.value):c(_.value).then(g,m)}p((l=l.apply(o,i||[])).next())})};class wj{constructor(i,r,l){var c,d,f;this.supabaseUrl=i,this.supabaseKey=r;const g=mb(i);if(!r)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",g),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",g),this.storageUrl=new URL("storage/v1",g),this.functionsUrl=new URL("functions/v1",g);const m=`sb-${g.hostname.split(".")[0]}-auth-token`,p={db:sb,realtime:rb,auth:Object.assign(Object.assign({},ib),{storageKey:m}),global:ab},_=fb(l??{},p);this.storageKey=(c=_.auth.storageKey)!==null&&c!==void 0?c:"",this.headers=(d=_.global.headers)!==null&&d!==void 0?d:{},_.accessToken?(this.accessToken=_.accessToken,this.auth=new Proxy({},{get:(j,C)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(C)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((f=_.auth)!==null&&f!==void 0?f:{},this.headers,_.global.fetch),this.fetch=ub(r,this._getAccessToken.bind(this),_.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},_.realtime)),this.rest=new xx(new URL("rest/v1",g).href,{headers:this.headers,schema:_.db.schema,fetch:this.fetch}),this.storage=new eb(this.storageUrl.href,this.headers,this.fetch,l?.storage),_.accessToken||this._listenForAuthEvents()}get functions(){return new ux(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(i){return this.rest.from(i)}schema(i){return this.rest.schema(i)}rpc(i,r={},l={head:!1,get:!1,count:void 0}){return this.rest.rpc(i,r,l)}channel(i,r={config:{}}){return this.realtime.channel(i,r)}getChannels(){return this.realtime.getChannels()}removeChannel(i){return this.realtime.removeChannel(i)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){return Sj(this,void 0,void 0,function*(){var i,r;if(this.accessToken)return yield this.accessToken();const{data:l}=yield this.auth.getSession();return(r=(i=l.session)===null||i===void 0?void 0:i.access_token)!==null&&r!==void 0?r:this.supabaseKey})}_initSupabaseAuthClient({autoRefreshToken:i,persistSession:r,detectSessionInUrl:l,storage:c,userStorage:d,storageKey:f,flowType:g,lock:m,debug:p},_,j){const C={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new jj({url:this.authUrl.href,headers:Object.assign(Object.assign({},C),_),storageKey:f,autoRefreshToken:i,persistSession:r,detectSessionInUrl:l,storage:c,userStorage:d,flowType:g,lock:m,debug:p,fetch:j,hasCustomAuthorizationHeader:Object.keys(this.headers).some(N=>N.toLowerCase()==="authorization")})}_initRealtimeClient(i){return new Lx(this.realtimeUrl.href,Object.assign(Object.assign({},i),{params:Object.assign({apikey:this.supabaseKey},i?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((r,l)=>{this._handleTokenChanged(r,"CLIENT",l?.access_token)})}_handleTokenChanged(i,r,l){(i==="TOKEN_REFRESHED"||i==="SIGNED_IN")&&this.changedAccessToken!==l?(this.changedAccessToken=l,this.realtime.setAuth(l)):i==="SIGNED_OUT"&&(this.realtime.setAuth(),r=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const Nj=(o,i,r)=>new wj(o,i,r);function Cj(){if(typeof window<"u"||typeof process>"u")return!1;const o=process.version;if(o==null)return!1;const i=o.match(/^v(\d+)\./);return i?parseInt(i[1],10)<=18:!1}Cj()&&console.warn("⚠️  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const Ej="https://lcknhxrksephkshpvfmp.supabase.co",Tj="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imxja25oeHJrc2VwaGtzaHB2Zm1wIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA2MjUxNTAsImV4cCI6MjA3NjIwMTE1MH0.4HAG-6vgyHxRfmakn9CgJiMMbVO1lBYbIYYq3ZDdjv0",A=Nj(Ej,Tj),vg=y.createContext({}),$s=()=>{const o=y.useContext(vg);if(!o)throw new Error("useAuth must be used within an AuthProvider");return o},Aj=({children:o})=>{const[i,r]=y.useState(null),[l,c]=y.useState(!0);y.useEffect(()=>{console.log("[AuthContext] useEffect - Starting session check"),(async()=>{try{console.log("[AuthContext] Checking localStorage");const p=localStorage.getItem("erp_user"),_=localStorage.getItem("erp_token");if(console.log("[AuthContext] Stored user:",p?"exists":"null"),console.log("[AuthContext] Stored token:",_?"exists":"null"),p&&_){r(JSON.parse(p)),c(!1);try{console.log("[AuthContext] Validating session in background");const j=new Promise((P,E)=>setTimeout(()=>E(new Error("Timeout")),2e3)),C=A.from("user_sessions").select("*").eq("token",_).gt("expires_at",new Date().toISOString()).maybeSingle(),{data:N,error:k}=await Promise.race([C,j]);console.log("[AuthContext] Query result - data:",!!N,"error:",k),(!N||k)&&(console.log("[AuthContext] Session invalid, clearing storage"),localStorage.removeItem("erp_user"),localStorage.removeItem("erp_token"),r(null))}catch(j){console.error("[AuthContext] Database error during session check:",j)}}else console.log("[AuthContext] No stored credentials"),c(!1)}catch(p){console.error("[AuthContext] Session verification error:",p),r(null),c(!1)}})()},[]);const g={user:i,loading:l,signIn:async(m,p)=>{const j=await fetch("https://lcknhxrksephkshpvfmp.supabase.co/functions/v1/auth-login",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imxja25oeHJrc2VwaGtzaHB2Zm1wIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA2MjUxNTAsImV4cCI6MjA3NjIwMTE1MH0.4HAG-6vgyHxRfmakn9CgJiMMbVO1lBYbIYYq3ZDdjv0"},body:JSON.stringify({login:m,password:p})}),C=await j.json();if(!j.ok)throw new Error(C.error||"Erreur de connexion");return localStorage.setItem("erp_user",JSON.stringify(C.user)),localStorage.setItem("erp_token",C.token),r(C.user),{user:C.user}},signOut:async()=>{const m=localStorage.getItem("erp_token");m&&i&&(await A.from("user_action_logs").insert({employee_id:i.id,action_type:"logout",module:"auth",details:{},ip_address:null}),await A.from("user_sessions").delete().eq("token",m)),localStorage.removeItem("erp_user"),localStorage.removeItem("erp_token"),r(null)}};return n.jsx(vg.Provider,{value:g,children:o})};class kj extends Dp.Component{constructor(i){super(i),this.state={hasError:!1,error:null}}static getDerivedStateFromError(i){return{hasError:!0,error:i}}componentDidCatch(i,r){console.error("Error caught by boundary:",i,r)}render(){return this.state.hasError?n.jsxs("div",{style:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",height:"100vh",padding:"20px",textAlign:"center"},children:[n.jsx("h1",{style:{color:"#e53e3e",marginBottom:"20px"},children:"Une erreur est survenue"}),n.jsx("p",{style:{marginBottom:"20px",color:"#4a5568"},children:this.state.error?.message||"Erreur inconnue"}),n.jsx("button",{onClick:()=>{this.setState({hasError:!1,error:null}),window.location.href="/"},style:{padding:"10px 20px",backgroundColor:"#3182ce",color:"white",border:"none",borderRadius:"5px",cursor:"pointer",fontSize:"16px"},children:"Recharger l'application"})]}):this.props.children}}const Oj=()=>{const[o,i]=y.useState(""),[r,l]=y.useState(""),[c,d]=y.useState(""),[f,g]=y.useState(!1),{signIn:m}=$s(),p=Qr(),_=async j=>{j.preventDefault(),d(""),g(!0);try{await m(o,r),p("/dashboard")}catch(C){d(C.message||"Erreur de connexion")}finally{g(!1)}};return n.jsx("div",{className:"login-container",children:n.jsxs("div",{className:"login-card",children:[n.jsx("h1",{children:"ERP Hôtel Casino"}),n.jsx("h2",{children:"Connexion"}),n.jsxs("form",{onSubmit:_,children:[n.jsxs("div",{className:"form-group",children:[n.jsx("label",{htmlFor:"login",children:"Login"}),n.jsx("input",{id:"login",type:"text",value:o,onChange:j=>i(j.target.value),required:!0,autoComplete:"username",placeholder:"Entrez votre login"})]}),n.jsxs("div",{className:"form-group",children:[n.jsx("label",{htmlFor:"password",children:"Mot de passe"}),n.jsx("input",{id:"password",type:"password",value:r,onChange:j=>l(j.target.value),required:!0,autoComplete:"current-password",placeholder:"Entrez votre mot de passe"})]}),c&&n.jsx("div",{className:"error-message",children:c}),n.jsx("button",{type:"submit",disabled:f,children:f?"Connexion...":"Se connecter"})]}),n.jsxs("div",{className:"login-info",children:[n.jsxs("p",{children:["Login par défaut : ",n.jsx("strong",{children:"admin"})]}),n.jsxs("p",{children:["Mot de passe : ",n.jsx("strong",{children:"admin123"})]})]})]})})};function Zr(){const{user:o}=$s(),[i,r]=y.useState([]),[l,c]=y.useState(!0);y.useEffect(()=>{o?.role_id?d():(r([]),c(!1))},[o?.role_id]);async function d(){try{const{data:N,error:k}=await A.from("role_permissions").select("permissions(module, action)").eq("role_id",o.role_id);if(k)throw k;const P=N.map(E=>({module:E.permissions.module,action:E.permissions.action}));r(P)}catch(N){console.error("Erreur lors du chargement des permissions:",N),r([])}finally{c(!1)}}function f(N,k){return o?.roles?.name==="Administrateur"?!0:i.some(P=>P.module===N&&P.action===k)}function g(N){return o?.roles?.name==="Administrateur"?!0:i.some(k=>k.module===N)}function m(N){return f(N,"view")}function p(N){return f(N,"create")}function _(N){return f(N,"update")}function j(N){return f(N,"delete")}function C(N){if(o?.roles?.name==="Administrateur")return!0;const k=i.filter(P=>P.module===N);return!(k.length===0||k.length===1&&k[0].action==="view")}return{permissions:i,loading:l,hasPermission:f,hasAnyPermission:g,canView:m,canCreate:p,canUpdate:_,canDelete:j,hasActionablePermissions:C}}function Rj(){const{canCreate:o,canUpdate:i,canDelete:r}=Zr(),[l,c]=y.useState([]),[d,f]=y.useState([]),[g,m]=y.useState([]),[p,_]=y.useState([]),[j,C]=y.useState([]),[N,k]=y.useState([]),[P,E]=y.useState(!0),[V,L]=y.useState(!1),[U,O]=y.useState(null),[M,G]=y.useState([]),[q,Y]=y.useState([]),[T,ce]=y.useState({name:"",description:"",reference:"",category_id:"",product_type_id:"",unit:"piece",base_price:0,cost_price:0,vat_rate:10,barcode:"",is_composed:!1,printer_id:"",min_stock_alert:0,storage_location_id:"",price_includes_vat:!0}),[se,ee]=y.useState({base_price_ht:0,base_price_ttc:0,cost_price_ht:0,cost_price_ttc:0}),[_e,ue]=y.useState([]),[Ce,F]=y.useState(""),[ne,K]=y.useState(1),[le,Ee]=y.useState(""),[R,X]=y.useState(""),[fe,be]=y.useState(""),[$,D]=y.useState(""),[re,we]=y.useState(!1),[Ne,nt]=y.useState("name"),[Le,Ue]=y.useState("asc"),[lt,We]=y.useState(0),[qt,Dt]=y.useState(!1),[yn,ln]=y.useState([]),[Vt,en]=y.useState(!1),[gt,on]=y.useState(null),[$n,St]=y.useState(!1),[Ht,mn]=y.useState([]),[tn,B]=y.useState(!1),[w,ae]=y.useState(0),[S,he]=y.useState(""),[ge,Te]=y.useState(!1),[Ye,Pe]=y.useState(null),[dt,ht]=y.useState(0),[Ut,Lt]=y.useState(0),[Et,Tt]=y.useState(!1),Bt=I=>I.replace(/\b\w/g,ve=>ve.toUpperCase());y.useEffect(()=>{Gt()},[]);const Gt=async()=>{try{const[I,ve,Me,Ae,Re,pe,ye]=await Promise.all([A.from("products").select("*, product_categories(name), product_types(name, can_be_sold), storage_locations(name)").order("name"),A.from("product_categories").select("*").order("name"),A.from("product_types").select("*").eq("is_active",!0).order("name"),A.from("printers").select("*").order("name"),A.from("storage_locations").select("*").eq("is_active",!0).order("name"),A.from("sales_points").select("*").eq("is_active",!0).order("name"),A.from("product_prices").select("*, sales_points(name), storage_locations(name)")]);I.data&&c(I.data),ve.data&&f(ve.data),Me.data&&m(Me.data),Ae.data&&_(Ae.data),Re.data&&(console.log("Storage locations loaded:",Re.data),C(Re.data)),pe.data&&(console.log("Sales points loaded:",pe.data),k(pe.data)),ye.data&&G(ye.data)}catch(I){console.error("Erreur chargement:",I)}finally{E(!1)}},jn=async()=>{try{const{productId:I,oldRecipeSnapshot:ve}=gt;if(await A.from("product_recipes").delete().eq("product_id",I),ve&&ve.ingredients){const Ae=ve.ingredients.map(Re=>({product_id:I,ingredient_id:Re.ingredient_id,quantity:Re.quantity}));await A.from("product_recipes").insert(Ae)}await A.from("product_recipes_by_sales_point").delete().eq("product_id",I);const{data:Me}=await A.from("product_prices").select("sales_point_id, storage_location_id").eq("product_id",I);if(ve&&ve.ingredients&&Me){const Ae=[];for(const Re of Me)if(Re.sales_point_id&&Re.storage_location_id)for(const pe of ve.ingredients)Ae.push({product_id:I,sales_point_id:Re.sales_point_id,ingredient_id:pe.ingredient_id,storage_location_id:Re.storage_location_id,quantity:pe.quantity});Ae.length>0&&await A.from("product_recipes_by_sales_point").insert(Ae)}await A.from("product_recipes_history").delete().eq("product_id",I).order("modified_at",{ascending:!1}).limit(1),alert("⚠️ Modification annulée. La recette a été restaurée à son état précédent."),en(!1),L(!1),nn(),Gt(),on(null)}catch(I){console.error("Erreur annulation:",I),alert("Erreur lors de l'annulation: "+I.message)}},wn=async I=>{try{const{productId:ve,lastModifiedAt:Me,newRecipe:Ae,oldRecipeSnapshot:Re}=gt;let pe=null;I==="since_last_change"&&(pe=Me);const ye=A.from("order_items").select("id, quantity, order_id, orders!inner(created_at, sales_point_id, sales_points(default_storage_location_id))").eq("product_id",ve);pe&&ye.gte("orders.created_at",pe);const{data:ke}=await ye;if(!ke||ke.length===0){alert("Aucune vente trouvée dans cette période. La modification a été enregistrée sans ajustement rétroactif."),en(!1),gt.productPrices&&gt.formData?await ca(gt.productId,gt.newRecipe,gt.productPrices,gt.formData):(L(!1),nn(),Gt());return}const Fe=Re?.ingredients||[],qe={};Fe.forEach(ft=>{qe[ft.ingredient_id]=parseFloat(ft.quantity)});const Oe={};Ae.forEach(ft=>{Oe[ft.ingredient_id]=parseFloat(ft.quantity)});const Qe=new Set([...Object.keys(qe),...Object.keys(Oe)]);let ot={};for(const ft of ke){const ut=ft.orders.sales_points?.default_storage_location_id;if(ut)for(const xn of Qe){const ta=qe[xn]||0,Gs=(Oe[xn]||0)-ta;if(Gs===0)continue;const Vn=`${xn}_${ut}`,_a=Gs*parseFloat(ft.quantity);if(!ot[Vn]){const Cn=Ae.find(cn=>cn.ingredient_id===xn)||Fe.find(cn=>cn.ingredient_id===xn);ot[Vn]={ingredient_id:xn,storage_location_id:ut,quantity:0,ingredient_name:Cn?.ingredient_name||"Inconnu"}}ot[Vn].quantity+=_a}}for(const ft in ot){const ut=ot[ft];if(Math.abs(ut.quantity)<.001)continue;const{data:xn}=await A.from("product_stocks").select("id, quantity").eq("product_id",ut.ingredient_id).eq("storage_location_id",ut.storage_location_id).maybeSingle();if(xn){const ta=parseFloat(xn.quantity),Fa=ta-ut.quantity;await A.from("product_stocks").update({quantity:Fa,updated_at:new Date().toISOString()}).eq("id",xn.id),await A.from("stock_movements").insert({product_id:ut.ingredient_id,storage_location_id:ut.storage_location_id,movement_type:"adjustment",quantity:-ut.quantity,previous_quantity:ta,new_quantity:Fa,notes:`Ajustement rétroactif suite modification recette (${I==="all"?"depuis le début":"depuis dernière modification"}) - Différence: ${ut.quantity>0?"+":""}${ut.quantity.toFixed(2)}`})}}const Nt=Object.values(ot).filter(ft=>Math.abs(ft.quantity)>=.001).length;alert(`✅ Ajustement rétroactif effectué avec succès !

${Nt} ajustement(s) de stock réalisé(s) basé(s) sur la différence entre ancienne et nouvelle recette.`),en(!1),gt.shouldCloseForm&&gt.productPrices&&gt.formData?await ca(gt.productId,gt.newRecipe,gt.productPrices,gt.formData):gt.shouldCloseForm&&(L(!1),nn(),Gt()),on(null)}catch(ve){console.error("Erreur ajustement rétroactif:",ve),alert("Erreur lors de l'ajustement rétroactif: "+ve.message)}},gs=async()=>{try{const{data:I,error:ve}=await A.from("stock_movements").select("*").eq("movement_type","adjustment").ilike("notes","%Ajustement rétroactif%").order("created_at",{ascending:!0});if(ve)throw ve;if(!I||I.length===0){alert("Aucun ajustement rétroactif à corriger.");return}let Me={};for(const Re of I){const pe=`${Re.product_id}_${Re.storage_location_id}`;Me[pe]||(Me[pe]={product_id:Re.product_id,storage_location_id:Re.storage_location_id,total_correction:0,movements:[]}),Me[pe].total_correction-=Re.quantity,Me[pe].movements.push(Re)}const Ae=[];for(const Re in Me){const pe=Me[Re],{data:ye}=await A.from("products").select("name").eq("id",pe.product_id).single(),{data:ke}=await A.from("storage_locations").select("name").eq("id",pe.storage_location_id).single(),{data:Fe}=await A.from("product_stocks").select("id, quantity").eq("product_id",pe.product_id).eq("storage_location_id",pe.storage_location_id).maybeSingle();if(Fe){const qe=parseFloat(Fe.quantity),Oe=qe-pe.total_correction;await A.from("product_stocks").update({quantity:Oe,updated_at:new Date().toISOString()}).eq("id",Fe.id),await A.from("stock_movements").insert({product_id:pe.product_id,storage_location_id:pe.storage_location_id,movement_type:"adjustment",quantity:-pe.total_correction,previous_quantity:qe,new_quantity:Oe,notes:`Réparation: annulation de ${pe.movements.length} ajustement(s) rétroactif(s) incorrect(s)`});for(const Qe of pe.movements)await A.from("stock_movements").delete().eq("id",Qe.id);Ae.push({product:ye?.name||"Inconnu",storage:ke?.name||"Inconnu",correction:-pe.total_correction,previousStock:qe,newStock:Oe,movementsDeleted:pe.movements.length})}}Pe(Ae),Te(!0)}catch(I){console.error("Erreur réparation:",I),alert("Erreur lors de la réparation: "+I.message)}},Pa=async()=>{try{const I=yn.length;for(const ve of yn){const{data:Me}=await A.from("product_prices").select("id").eq("product_id",ve.ingredientId).eq("storage_location_id",ve.storageId).maybeSingle();if(!Me){await A.from("product_prices").insert([{product_id:ve.ingredientId,storage_location_id:ve.storageId,sales_point_id:null,selling_price:null,is_active:!0}]);const{data:Ae}=await A.from("product_stocks").select("id").eq("product_id",ve.ingredientId).eq("storage_location_id",ve.storageId).maybeSingle();Ae||await A.from("product_stocks").insert([{product_id:ve.ingredientId,storage_location_id:ve.storageId,quantity:0}])}}Dt(!1),ln([]),alert(`✅ Configuration mise à jour avec succès !

${I} dépôt(s) ajouté(s) aux ingrédients.`),B(!0),setTimeout(()=>{const ve=document.querySelector("form");ve&&ve.dispatchEvent(new Event("submit",{cancelable:!0,bubbles:!0}))},100)}catch(I){console.error("Erreur lors de la correction automatique:",I),alert("Erreur lors de la mise à jour automatique: "+I.message)}},ca=async(I,ve,Me,Ae)=>{try{if(Ae.is_composed&&ve.length>0&&Me.length>0){const pe=[];for(const ye of Me)if(ye.sales_point_id&&ye.storage_location_id)for(const ke of ve)pe.push({product_id:I,sales_point_id:ye.sales_point_id,ingredient_id:ke.ingredient_id,storage_location_id:ye.storage_location_id,quantity:ke.quantity});if(pe.length>0){const{error:ye}=await A.from("product_recipes_by_sales_point").insert(pe);if(ye)throw ye}}if(Me.length>0){const pe=Me.filter(ye=>ye.sales_point_id||ye.storage_location_id).map(ye=>({product_id:I,sales_point_id:ye.sales_point_id||null,storage_location_id:ye.storage_location_id||null,selling_price:ye.selling_price?parseFloat(ye.selling_price):null,is_active:!0}));if(pe.length>0){const{error:ye}=await A.from("product_prices").insert(pe);if(ye)throw ye}}const{data:Re}=await A.from("product_types").select("name").eq("id",Ae.product_type_id).single();if(Re?.name==="Matières Premières"){const{data:pe}=await A.from("storage_locations").select("id, name").in("name",["Casse / Périmés","Economat Général"]);if(pe&&pe.length>0){const ye=Me.map(Fe=>Fe.storage_location_id).filter(Boolean),ke=pe.filter(Fe=>!ye.includes(Fe.id));if(ke.length>0){const Fe=ke.map(qe=>({product_id:I,sales_point_id:null,storage_location_id:qe.id,selling_price:null,is_active:!0}));await A.from("product_prices").insert(Fe)}}}L(!1),nn(),Gt()}catch(Re){console.error("Erreur finalisation:",Re),alert("Erreur lors de la finalisation: "+Re.message)}},Ii=async I=>{I.preventDefault();try{if(!tn&&T.is_composed&&_e.length>0&&M.length>0){const qe=[];for(const Oe of M)if(!(!Oe.sales_point_id||!Oe.storage_location_id))for(const Qe of _e){const{data:ot}=await A.from("product_prices").select("storage_location_id, products(name)").eq("product_id",Qe.ingredient_id).eq("storage_location_id",Oe.storage_location_id);if(!ot||ot.length===0){const{data:Nt}=await A.from("products").select("name").eq("id",Qe.ingredient_id).single(),{data:ft}=await A.from("storage_locations").select("name").eq("id",Oe.storage_location_id).single(),{data:ut}=await A.from("sales_points").select("name").eq("id",Oe.sales_point_id).single();qe.push({ingredientId:Qe.ingredient_id,ingredient:Nt?.name||"Inconnu",storageId:Oe.storage_location_id,storage:ft?.name||"Inconnu",salesPoint:ut?.name||"Inconnu"})}}if(qe.length>0){ln(qe),Dt(!0);return}}tn&&B(!1);const Ae=(g.find(qe=>qe.id===T.product_type_id)?.name||"")==="Produits Vente",Re=T.is_composed,pe=Ae&&Re&&lt>0?lt:parseFloat(T.cost_price),ye={...T,base_price:parseFloat(T.base_price),cost_price:pe,vat_rate:parseFloat(T.vat_rate),min_stock_alert:parseFloat(T.min_stock_alert),storage_location_id:T.storage_location_id||null,category_id:T.category_id||null,product_type_id:T.product_type_id||null,printer_id:T.printer_id||null};let ke;if(U){const{error:qe}=await A.from("products").update(ye).eq("id",U.id);if(qe)throw qe;ke=U.id,await A.from("product_recipes").delete().eq("product_id",ke)}else{const{data:qe,error:Oe}=await A.from("products").insert(ye).select().single();if(Oe)throw Oe;ke=qe.id}if(T.is_composed&&_e.length>0){if(U){const{data:ot}=await A.from("product_recipes").select(`
              ingredient_id,
              quantity,
              products:ingredient_id (name, unit)
            `).eq("product_id",ke);if(ot&&ot.length>0){const{data:Nt}=await A.from("product_recipes_history").select("id").eq("product_id",ke).limit(1);if(!Nt||Nt.length===0){const ft={ingredients:ot.map(ut=>({ingredient_id:ut.ingredient_id,ingredient_name:ut.products?.name||"Inconnu",quantity:ut.quantity,unit:ut.products?.unit||""})),product_name:T.name,modified_at:new Date().toISOString()};await A.from("product_recipes_history").insert({product_id:ke,recipe_snapshot:ft,modified_by:null,modification_type:"create",notes:"Sauvegarde de la recette existante avant modification"})}}}const qe=_e.map(ot=>({product_id:ke,ingredient_id:ot.ingredient_id,quantity:ot.quantity})),{error:Oe}=await A.from("product_recipes").insert(qe);if(Oe)throw Oe;const Qe={ingredients:_e.map(ot=>({ingredient_id:ot.ingredient_id,ingredient_name:ot.ingredient_name,quantity:ot.quantity,unit:ot.unit})),product_name:T.name,modified_at:new Date().toISOString()};await A.from("product_recipes_history").insert({product_id:ke,recipe_snapshot:Qe,modified_by:null,modification_type:U?"update":"create",notes:U?"Modification de la recette":"Création initiale de la recette"}),await A.from("products").update({last_recipe_modified_at:new Date().toISOString(),last_recipe_modified_by:null}).eq("id",ke)}if(U){const{data:qe}=await A.from("product_prices").select("storage_location_id").eq("product_id",ke),Oe=qe?.map(Nt=>Nt.storage_location_id).filter(Boolean)||[],Qe=M.map(Nt=>Nt.storage_location_id).filter(Boolean),ot=Oe.filter(Nt=>!Qe.includes(Nt));if(ot.length>0){const{data:Nt}=await A.from("product_stocks").select("storage_location_id, quantity, storage_locations(name)").eq("product_id",ke).in("storage_location_id",ot),ft=Nt?.filter(ut=>parseFloat(ut.quantity)!==0)||[];if(ft.length>0){const ut=ft.map(xn=>xn.storage_locations?.name||"Inconnu").join(", ");alert(`Impossible de supprimer les dépôts suivants car ils contiennent encore du stock : ${ut}. Veuillez d'abord vider les stocks.`),E(!1);return}}await A.from("product_recipes_by_sales_point").delete().eq("product_id",ke),await A.from("product_prices").delete().eq("product_id",ke)}if(T.is_composed&&_e.length>0&&M.length>0){if(M.some(Oe=>Oe.sales_point_id&&!Oe.storage_location_id)){alert("Veuillez sélectionner un dépôt de stockage pour chaque point de vente"),E(!1);return}if(U){const{data:Oe,error:Qe}=await A.from("product_recipes_history").select("modified_at, recipe_snapshot").eq("product_id",ke).order("modified_at",{ascending:!1}).limit(2);if(console.log("Historique récupéré:",Oe,"Erreur:",Qe),Oe&&Oe.length>1){console.log("Modal de rétroactivité devrait apparaître"),on({productId:ke,productName:T.name,lastModifiedAt:Oe[1].modified_at,newRecipe:_e,oldRecipeSnapshot:Oe[1].recipe_snapshot,shouldCloseForm:!0,productPrices:M,formData:T}),en(!0),E(!1);return}else console.log("Pas assez d'entrées dans l'historique pour afficher la rétroactivité:",Oe?.length)}}if(T.is_composed&&_e.length>0&&M.length>0){const qe=[];for(const Oe of M)if(Oe.sales_point_id&&Oe.storage_location_id)for(const Qe of _e)qe.push({product_id:ke,sales_point_id:Oe.sales_point_id,ingredient_id:Qe.ingredient_id,storage_location_id:Oe.storage_location_id,quantity:Qe.quantity});if(qe.length>0){const{error:Oe}=await A.from("product_recipes_by_sales_point").insert(qe);if(Oe)throw Oe}}if(M.length>0){const qe=M.filter(Oe=>Oe.sales_point_id||Oe.storage_location_id).map(Oe=>({product_id:ke,sales_point_id:Oe.sales_point_id||null,storage_location_id:Oe.storage_location_id||null,selling_price:Oe.selling_price?parseFloat(Oe.selling_price):null,is_active:!0}));if(qe.length>0){const{error:Oe}=await A.from("product_prices").insert(qe);if(Oe)throw Oe}}const{data:Fe}=await A.from("product_types").select("name").eq("id",T.product_type_id).single();if(Fe?.name==="Matières Premières"){const{data:qe}=await A.from("storage_locations").select("id, name").in("name",["Casse / Périmés","Economat Général"]);if(qe&&qe.length>0){const Oe=M.map(ot=>ot.storage_location_id).filter(Boolean),Qe=qe.filter(ot=>!Oe.includes(ot.id));if(Qe.length>0){const ot=Qe.map(ft=>({product_id:ke,sales_point_id:null,storage_location_id:ft.id,selling_price:null,is_active:!0})),{error:Nt}=await A.from("product_prices").insert(ot);Nt&&console.error("Erreur ajout dépôts par défaut:",Nt)}}}L(!1),nn(),Gt()}catch(ve){console.error("Erreur sauvegarde:",ve),ve.message&&ve.message.includes("storage_location_id")&&ve.message.includes("not-null constraint")?alert("Veuillez sélectionner un dépôt de stockage pour le point de vente"):alert("Erreur lors de la sauvegarde: "+ve.message)}},ea=async I=>{if(O(I),ce({name:I.name,description:I.description||"",reference:I.reference||"",category_id:I.category_id||"",product_type_id:I.product_type_id||"",unit:I.unit||"piece",base_price:I.base_price,cost_price:I.cost_price||0,vat_rate:I.vat_rate||10,barcode:I.barcode||"",is_composed:I.is_composed,printer_id:I.printer_id||"",min_stock_alert:I.min_stock_alert||0,storage_location_id:I.storage_location_id||"",price_includes_vat:I.price_includes_vat!==!1}),I.is_composed){const{data:Ae}=await A.from("product_recipes").select("*, ingredient:products!product_recipes_ingredient_id_fkey(id, name, unit, cost_price)").eq("product_id",I.id);if(Ae){const Re=Ae.map(pe=>({ingredient_id:pe.ingredient_id,ingredient_name:pe.ingredient.name,unit:pe.ingredient.unit,quantity:pe.quantity,cost_price:pe.ingredient.cost_price||0}));ue(Re),Nn(Re)}}const{data:ve}=await A.from("product_prices").select("*, sales_points(name), storage_locations(name)").eq("product_id",I.id),{data:Me}=await A.from("product_stocks").select("*, storage_locations(name)").eq("product_id",I.id);console.log("Prices data for product:",ve),console.log("Stocks data for product:",Me),console.log("Available storage locations:",j),G(ve?ve.map(Ae=>({product_id:Ae.product_id,sales_point_id:Ae.sales_point_id,storage_location_id:Ae.storage_location_id,selling_price:Ae.selling_price,sales_points:Ae.sales_points,storage_locations:Ae.storage_locations})):[]),Y(Me||[]),L(!0)},ua=async I=>{if(confirm("Supprimer ce produit ?"))try{const{error:ve}=await A.from("products").delete().eq("id",I);if(ve)throw ve;Gt()}catch(ve){console.error("Erreur suppression:",ve),alert("Erreur: "+ve.message)}},nn=()=>{ce({name:"",description:"",reference:"",category_id:"",product_type_id:"",unit:"piece",base_price:0,cost_price:0,vat_rate:10,barcode:"",is_composed:!1,printer_id:"",min_stock_alert:0,storage_location_id:"",price_includes_vat:!0}),ee({base_price_ht:0,base_price_ttc:0,cost_price_ht:0,cost_price_ttc:0}),ue([]),G([]),Y([]),O(null),F(""),K(1),Ee(""),We(0),ae(0),he(""),ht(0),Lt(0),Tt(!1),B(!1)},vs=()=>{if(!Ce)return;const I=l.find(Ae=>Ae.id===Ce);if(!I)return;if(_e.find(Ae=>Ae.ingredient_id===Ce)){alert("Cet ingrédient est déjà dans la recette");return}const Me=[..._e,{ingredient_id:I.id,ingredient_name:I.name,unit:I.unit,quantity:parseFloat(ne),cost_price:I.cost_price||0}];ue(Me),Nn(Me),F(""),K(1)},Nn=I=>{const ve=I.reduce((Me,Ae)=>{const pe=l.find(ye=>ye.id===Ae.ingredient_id)?.cost_price||0;return Me+pe*Ae.quantity},0);if(We(ve),T.base_price>0&&ve>0){const Ae=T.base_price/(1+T.vat_rate/100)/ve;ae(Ae)}},Is=()=>{if(!S||lt===0){alert("Veuillez saisir un coefficient valide");return}const I=parseFloat(S),ve=lt*I,Me=ve*(1+T.vat_rate/100);ht(ve),Lt(Me),Tt(!0)},Vs=()=>{ce({...T,base_price:Math.round(Ut)}),ae(parseFloat(S)),Tt(!1)};y.useEffect(()=>{if(_e.length>0&&T.base_price>0&&lt>0){const ve=T.base_price/(1+T.vat_rate/100)/lt;ae(ve)}},[T.base_price,T.vat_rate,lt,_e.length]);const In=I=>{const ve=_e.filter(Me=>Me.ingredient_id!==I);ue(ve),Nn(ve)},wt=I=>{Ne===I?Ue(Le==="asc"?"desc":"asc"):(nt(I),Ue("asc"))},Yt=l.filter(I=>{const ve=I.name.toLowerCase().includes(R.toLowerCase()),Me=!fe||I.product_type_id===fe,Ae=!$||I.storage_location_id===$;return ve&&Me&&Ae}).sort((I,ve)=>{let Me=I[Ne],Ae=ve[Ne];if(Ne==="product_type_id"){const Re=g.find(ye=>ye.id===I.product_type_id),pe=g.find(ye=>ye.id===ve.product_type_id);Me=Re?.name||"",Ae=pe?.name||""}else if(Ne==="storage_location_id"){const Re=j.find(ye=>ye.id===I.storage_location_id),pe=j.find(ye=>ye.id===ve.storage_location_id);Me=Re?.name||"",Ae=pe?.name||""}return typeof Me=="string"&&(Me=Me.toLowerCase(),Ae=Ae?.toLowerCase()||""),Me<Ae?Le==="asc"?-1:1:Me>Ae?Le==="asc"?1:-1:0});return P?n.jsx("div",{className:"loading",children:"Chargement..."}):n.jsxs("div",{className:"products-page",children:[n.jsxs("div",{className:"page-header",children:[n.jsx("h1",{children:"Gestion des Produits"}),n.jsxs("div",{style:{display:"flex",gap:"12px"},children:[n.jsx("button",{className:"btn-primary",onClick:()=>gs(),style:{background:"#ef4444"},children:"🔧 Réparer ajustements rétroactifs"}),o("products")&&n.jsx("button",{className:"btn-primary",onClick:()=>{nn(),L(!0)},children:"+ Nouveau Produit"})]})]}),n.jsxs("div",{className:"search-filters",children:[n.jsx("input",{type:"text",placeholder:"Rechercher par nom...",value:R,onChange:I=>X(I.target.value),className:"search-input"}),n.jsxs("select",{value:fe,onChange:I=>be(I.target.value),className:"search-select",children:[n.jsx("option",{value:"",children:"Tous les types"}),g.map(I=>n.jsx("option",{value:I.id,children:I.name},I.id))]}),n.jsxs("select",{value:$,onChange:I=>D(I.target.value),className:"search-select",children:[n.jsx("option",{value:"",children:"Tous les dépôts"}),j.map(I=>n.jsx("option",{value:I.id,children:I.name},I.id))]})]}),n.jsx("div",{className:"products-table-container",children:n.jsxs("table",{className:"products-table",children:[n.jsx("thead",{children:n.jsxs("tr",{children:[n.jsxs("th",{onClick:()=>wt("name"),style:{cursor:"pointer"},children:["Nom ",Ne==="name"&&(Le==="asc"?"↑":"↓")]}),n.jsxs("th",{onClick:()=>wt("reference"),style:{cursor:"pointer"},children:["Référence ",Ne==="reference"&&(Le==="asc"?"↑":"↓")]}),n.jsxs("th",{onClick:()=>wt("product_type_id"),style:{cursor:"pointer"},children:["Type Produit ",Ne==="product_type_id"&&(Le==="asc"?"↑":"↓")]}),n.jsxs("th",{onClick:()=>wt("storage_location_id"),style:{cursor:"pointer"},children:["Dépôt ",Ne==="storage_location_id"&&(Le==="asc"?"↑":"↓")]}),n.jsxs("th",{onClick:()=>wt("base_price"),style:{cursor:"pointer"},children:["Prix vente ",Ne==="base_price"&&(Le==="asc"?"↑":"↓")]}),n.jsxs("th",{onClick:()=>wt("cost_price"),style:{cursor:"pointer"},children:["Coût ",Ne==="cost_price"&&(Le==="asc"?"↑":"↓")]}),n.jsxs("th",{onClick:()=>wt("min_stock_alert"),style:{cursor:"pointer"},children:["Stock min ",Ne==="min_stock_alert"&&(Le==="asc"?"↑":"↓")]}),n.jsx("th",{children:"Actions"})]})}),n.jsx("tbody",{children:Yt.map(I=>n.jsxs("tr",{children:[n.jsxs("td",{children:[I.name,I.is_composed&&n.jsx("span",{className:"badge-composed",children:"Composé"})]}),n.jsx("td",{children:I.reference}),n.jsx("td",{children:I.product_types?.name||"-"}),n.jsx("td",{children:I.storage_locations?.name||"-"}),n.jsxs("td",{children:[I.base_price," F"]}),n.jsxs("td",{children:[I.cost_price," F"]}),n.jsx("td",{children:I.min_stock_alert}),n.jsx("td",{children:n.jsxs("div",{className:"table-actions",children:[i("products")&&n.jsx("button",{className:"btn-edit",onClick:()=>ea(I),children:"✏️"}),r("products")&&n.jsx("button",{className:"btn-delete",onClick:()=>ua(I.id),children:"🗑️"})]})})]},I.id))})]})}),V&&n.jsx("div",{className:"modal-overlay",onClick:()=>{L(!1),nn()},children:n.jsxs("div",{className:"modal-content",onClick:I=>I.stopPropagation(),children:[n.jsxs("div",{className:"modal-header",children:[n.jsx("h2",{children:U?"Modifier le produit":"Nouveau produit"}),n.jsxs("div",{style:{display:"flex",gap:"12px",alignItems:"center"},children:[U&&T.is_composed&&n.jsx("button",{type:"button",onClick:async()=>{const{data:I}=await A.from("product_recipes_history").select("*").eq("product_id",U.id).order("modified_at",{ascending:!1});mn(I||[]),St(!0)},style:{padding:"8px 16px",background:"#3b82f6",color:"white",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"14px",fontWeight:"500"},children:"📜 Historique"}),n.jsx("button",{className:"btn-close",onClick:()=>{L(!1),nn()},children:"×"})]})]}),n.jsxs("form",{onSubmit:Ii,children:[n.jsxs("div",{className:"form-grid",children:[n.jsxs("div",{className:"form-group",children:[n.jsx("label",{children:"Nom *"}),n.jsx("input",{type:"text",value:T.name,onChange:I=>ce({...T,name:I.target.value}),onBlur:I=>ce({...T,name:Bt(I.target.value)}),required:!0})]}),n.jsxs("div",{className:"form-group",children:[n.jsx("label",{children:"Référence *"}),n.jsx("input",{type:"text",value:T.reference,onChange:I=>ce({...T,reference:I.target.value}),required:!0})]}),n.jsxs("div",{className:"form-group",children:[n.jsx("label",{children:"Type de produit *"}),n.jsxs("select",{value:T.product_type_id,onChange:I=>ce({...T,product_type_id:I.target.value}),required:!0,children:[n.jsx("option",{value:"",children:"Sélectionner..."}),g.map(I=>n.jsx("option",{value:I.id,children:I.name},I.id))]})]}),n.jsxs("div",{className:"form-group",children:[n.jsx("label",{children:"Catégorie"}),n.jsxs("select",{value:T.category_id,onChange:I=>ce({...T,category_id:I.target.value}),children:[n.jsx("option",{value:"",children:"Sélectionner..."}),d.map(I=>n.jsx("option",{value:I.id,children:I.name},I.id))]})]}),n.jsxs("div",{className:"form-group",children:[n.jsx("label",{children:"Unité"}),n.jsxs("select",{value:T.unit,onChange:I=>ce({...T,unit:I.target.value}),children:[n.jsx("option",{value:"piece",children:"Pièce"}),n.jsx("option",{value:"liter",children:"Litre"}),n.jsx("option",{value:"kg",children:"Kilogramme"}),n.jsx("option",{value:"gram",children:"Gramme"}),n.jsx("option",{value:"ml",children:"Millilitre"}),n.jsx("option",{value:"portion",children:"Portion"})]})]}),n.jsxs("div",{className:"form-group",children:[n.jsx("label",{children:"Prix de vente TTC (FCFA) *"}),n.jsx("input",{type:"number",step:"0.01",value:T.base_price,onChange:I=>ce({...T,base_price:I.target.value}),required:!0}),n.jsxs("small",{style:{color:"#6b7280",marginTop:"4px",display:"block"},children:["Prix HT: ",T.base_price&&T.vat_rate?(T.base_price/(1+T.vat_rate/100)).toFixed(0):0," FCFA"]})]}),n.jsxs("div",{className:"form-group",children:[n.jsx("label",{children:"Coût d'achat HT (FCFA)"}),(()=>{const Me=(g.find(Re=>Re.id===T.product_type_id)?.name||"")==="Produits Vente",Ae=T.is_composed;return Me&&Ae&&lt>0?n.jsxs(n.Fragment,{children:[n.jsx("input",{type:"number",step:"0.01",value:lt.toFixed(2),disabled:!0,style:{background:"#f3f4f6",cursor:"not-allowed"}}),n.jsx("small",{style:{color:"#3b82f6",marginTop:"4px",display:"block",fontWeight:"500"},children:"💡 Coût calculé automatiquement à partir de la recette"})]}):n.jsxs(n.Fragment,{children:[n.jsx("input",{type:"number",step:"0.01",value:T.cost_price,onChange:Re=>ce({...T,cost_price:Re.target.value})}),n.jsxs("small",{style:{color:"#6b7280",marginTop:"4px",display:"block"},children:["Coût TTC: ",T.cost_price&&T.vat_rate?(T.cost_price*(1+T.vat_rate/100)).toFixed(0):0," FCFA"]})]})})()]}),n.jsxs("div",{className:"form-group",children:[n.jsx("label",{children:"TVA (%) - Sénégal Hôtellerie/Restauration"}),n.jsx("input",{type:"number",step:"0.01",value:T.vat_rate,onChange:I=>ce({...T,vat_rate:I.target.value}),required:!0})]}),n.jsxs("div",{className:"form-group",children:[n.jsx("label",{children:"Alerte stock minimum"}),n.jsx("input",{type:"number",step:"0.01",value:T.min_stock_alert,onChange:I=>ce({...T,min_stock_alert:I.target.value})})]}),n.jsxs("div",{className:"form-group",children:[n.jsx("label",{children:"Imprimante"}),n.jsxs("select",{value:T.printer_id,onChange:I=>ce({...T,printer_id:I.target.value}),children:[n.jsx("option",{value:"",children:"Aucune"}),p.map(I=>n.jsx("option",{value:I.id,children:I.name},I.id))]})]}),n.jsxs("div",{className:"form-group",children:[n.jsx("label",{children:"Code-barres"}),n.jsx("input",{type:"text",value:T.barcode,onChange:I=>ce({...T,barcode:I.target.value})})]})]}),n.jsxs("div",{className:"form-group full-width",children:[n.jsx("label",{children:"Description"}),n.jsx("textarea",{value:T.description,onChange:I=>ce({...T,description:I.target.value}),rows:"3"})]}),n.jsx("div",{className:"form-group full-width",children:n.jsxs("label",{className:"checkbox-label",children:[n.jsx("input",{type:"checkbox",checked:T.is_composed,onChange:I=>ce({...T,is_composed:I.target.checked})}),"Produit composé (avec recette)"]})}),(()=>{const I=g.find(Re=>Re.id===T.product_type_id),ve=I?.can_be_sold,Ae=(I?.name||"")==="Produits Vente";return ve?n.jsxs("div",{className:"price-section",children:[n.jsx("h3",{children:"Points de vente"}),n.jsx("p",{className:"help-text",children:"Sélectionnez les points de vente où ce produit sera disponible. Si aucun prix spécifique n'est défini, le prix de base sera utilisé."}),n.jsx("div",{className:"prices-grid",children:M.map((Re,pe)=>(N.find(ye=>ye.id===Re.sales_point_id),n.jsxs("div",{className:"price-item-detailed",children:[n.jsxs("div",{className:"price-header",children:[n.jsxs("select",{className:"sales-point-select",value:Re.sales_point_id,onChange:ye=>{const ke=[...M];ke[pe].sales_point_id=ye.target.value,G(ke)},children:[n.jsx("option",{value:"",children:"Sélectionner un point de vente..."}),N.map(ye=>n.jsx("option",{value:ye.id,children:ye.name},ye.id))]}),n.jsx("button",{type:"button",className:"btn-remove-price",onClick:()=>{G(M.filter((ye,ke)=>ke!==pe))},children:"✕"})]}),n.jsxs("div",{className:"price-inputs",children:[n.jsxs("div",{className:"input-group",children:[n.jsx("span",{className:"input-label",children:"Prix de vente (F)"}),n.jsx("input",{type:"number",step:"0.01",placeholder:`Prix (défaut: ${T.base_price} F)`,value:Re.selling_price||"",onChange:ye=>{const ke=[...M];ke[pe].selling_price=ye.target.value,G(ke)}})]}),n.jsxs("div",{className:"input-group",children:[n.jsx("span",{className:"input-label",children:"Dépôt de stockage"}),n.jsxs("select",{value:Re.storage_location_id||"",onChange:ye=>{const ke=[...M];ke[pe].storage_location_id=ye.target.value,G(ke)},children:[n.jsx("option",{value:"",children:"Sélectionner un dépôt..."}),j.map(ye=>n.jsx("option",{value:ye.id,children:ye.name},ye.id))]})]}),T.is_composed&&Ae&&lt>0&&n.jsx("div",{className:"input-group",style:{gridColumn:"1 / -1",marginTop:"8px"},children:n.jsxs("div",{style:{padding:"10px",background:"#f0f9ff",borderRadius:"6px",border:"1px solid #3b82f6"},children:[n.jsx("span",{style:{fontSize:"13px",color:"#6b7280",marginRight:"10px"},children:"Coefficient pour ce point de vente:"}),n.jsx("span",{style:{fontSize:"16px",fontWeight:"bold",color:(()=>{const ye=Re.selling_price||T.base_price;if(!ye)return"#6b7280";const Fe=ye/(1+T.vat_rate/100)/lt;return Fe>=3?"#10b981":Fe>=2?"#f59e0b":"#ef4444"})()},children:(()=>{const ye=Re.selling_price||T.base_price;return ye?(ye/(1+T.vat_rate/100)/lt).toFixed(2):"-"})()})]})})]})]},pe)))}),n.jsx("button",{type:"button",className:"btn-add-price",onClick:()=>{G([...M,{product_id:U?.id||null,sales_point_id:"",storage_location_id:"",selling_price:""}])},children:"+ Ajouter un point de vente"})]}):null})(),(()=>{const Me=(g.find(Ae=>Ae.id===T.product_type_id)?.name||"")==="Produits Vente";return T.is_composed&&M.length>0&&Me&&n.jsxs("div",{className:"recipe-by-sales-point-section",children:[n.jsx("h3",{children:"Configuration des recettes par point de vente"}),n.jsx("p",{className:"help-text",children:"Pour chaque point de vente, spécifiez le dépôt de stockage d'où seront prélevés les ingrédients."}),M.map((Ae,Re)=>{const pe=N.find(ye=>ye.id===Ae.sales_point_id);return pe?n.jsxs("div",{className:"sales-point-recipe-config",children:[n.jsx("h4",{children:pe.name}),n.jsxs("div",{className:"form-group",children:[n.jsx("label",{children:"Dépôt de stockage pour les ingrédients"}),n.jsxs("select",{value:Ae.storage_location_id||"",onChange:ye=>{const ke=[...M];ke[Re].storage_location_id=ye.target.value,G(ke)},children:[n.jsx("option",{value:"",children:"Sélectionner un dépôt..."}),j.map(ye=>n.jsx("option",{value:ye.id,children:ye.name},ye.id))]})]})]},Re):null})]})})(),(()=>{const Me=(g.find(pe=>pe.id===T.product_type_id)?.name||"")==="Produits Vente",Ae=g.find(pe=>pe.name==="Matières Premières"),Re=l.filter(pe=>pe.product_type_id===Ae?.id&&pe.id!==U?.id).filter(pe=>{if(!le)return!0;const ye=le.toLowerCase(),ke=pe.name.toLowerCase();return ke.split(/\s+/).some(qe=>qe.includes(ye))||ke.includes(ye)});return T.is_composed&&Me&&n.jsxs("div",{className:"recipe-section",children:[n.jsx("h3",{children:"Recette / Ingrédients"}),n.jsxs("div",{className:"ingredient-search-container",children:[n.jsxs("div",{className:"ingredient-search",children:[n.jsx("span",{className:"search-icon",children:"🔍"}),n.jsx("input",{type:"text",placeholder:"Rechercher un ingrédient...",value:le,onChange:pe=>Ee(pe.target.value),onFocus:()=>we(!0),className:"search-input"})]}),re&&le&&n.jsx("div",{className:"ingredient-dropdown",children:Re.length>0?Re.map(pe=>n.jsxs("div",{className:"ingredient-item",onClick:()=>{F(pe.id),Ee(pe.name),we(!1)},children:[pe.name," (",pe.unit,")"]},pe.id)):n.jsx("div",{className:"ingredient-item-empty",children:"Aucun ingrédient trouvé"})})]}),n.jsxs("div",{className:"add-ingredient",children:[n.jsx("input",{type:"number",step:"0.001",min:"0",value:ne,onChange:pe=>K(pe.target.value),placeholder:"Quantité",className:"ingredient-quantity"}),n.jsx("button",{type:"button",className:"btn-add",onClick:()=>{vs(),Ee(""),F("")},disabled:!Ce,children:"Ajouter"})]}),_e.length>0&&n.jsxs(n.Fragment,{children:[n.jsxs("div",{style:{marginBottom:"20px"},children:[n.jsx("h4",{style:{marginBottom:"10px",color:"#1f2937"},children:"Recette de fabrication"}),n.jsxs("table",{className:"recipe-table",style:{width:"100%",borderCollapse:"collapse",background:"white",boxShadow:"0 1px 3px rgba(0,0,0,0.1)"},children:[n.jsx("thead",{children:n.jsxs("tr",{style:{background:"#f9fafb",borderBottom:"2px solid #e5e7eb"},children:[n.jsx("th",{style:{padding:"12px",textAlign:"left",fontWeight:"600",color:"#374151"},children:"Ingrédient"}),n.jsx("th",{style:{padding:"12px",textAlign:"center",fontWeight:"600",color:"#374151"},children:"Qté utilisée"}),n.jsx("th",{style:{padding:"12px",textAlign:"center",fontWeight:"600",color:"#374151"},children:"Unité"}),n.jsx("th",{style:{padding:"12px",textAlign:"right",fontWeight:"600",color:"#374151"},children:"Coût unitaire HT"}),n.jsx("th",{style:{padding:"12px",textAlign:"right",fontWeight:"600",color:"#374151"},children:"Prix de revient HT"}),n.jsx("th",{style:{padding:"12px",textAlign:"center",fontWeight:"600",color:"#374151"},children:"Action"})]})}),n.jsxs("tbody",{children:[_e.map((pe,ye)=>{const Fe=l.find(Oe=>Oe.id===pe.ingredient_id)?.cost_price||0,qe=Fe*pe.quantity;return n.jsxs("tr",{style:{borderBottom:"1px solid #e5e7eb"},children:[n.jsx("td",{style:{padding:"12px",color:"#111827"},children:pe.ingredient_name}),n.jsx("td",{style:{padding:"12px",textAlign:"center",color:"#111827",fontWeight:"500"},children:pe.quantity}),n.jsx("td",{style:{padding:"12px",textAlign:"center",color:"#6b7280"},children:pe.unit}),n.jsxs("td",{style:{padding:"12px",textAlign:"right",color:"#111827"},children:[Fe.toFixed(0)," FCFA"]}),n.jsxs("td",{style:{padding:"12px",textAlign:"right",color:"#111827",fontWeight:"600"},children:[qe.toFixed(0)," FCFA"]}),n.jsx("td",{style:{padding:"12px",textAlign:"center"},children:n.jsx("button",{type:"button",className:"btn-remove",onClick:()=>In(pe.ingredient_id),style:{padding:"6px 12px",background:"#ef4444",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",fontSize:"13px"},children:"Retirer"})})]},ye)}),n.jsxs("tr",{style:{background:"#f9fafb",borderTop:"2px solid #3b82f6"},children:[n.jsx("td",{colSpan:"4",style:{padding:"12px",textAlign:"right",fontWeight:"700",color:"#111827",fontSize:"15px"},children:"TOTAL PRIX DE REVIENT HT"}),n.jsxs("td",{style:{padding:"12px",textAlign:"right",fontWeight:"700",color:"#3b82f6",fontSize:"16px"},children:[lt.toFixed(0)," FCFA"]}),n.jsx("td",{})]})]})]})]}),n.jsxs("div",{className:"recipe-cost-summary",style:{marginTop:"20px",padding:"20px",background:"#f3f4f6",borderRadius:"8px",border:"2px solid #3b82f6"},children:[n.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"15px",marginBottom:"15px"},children:[n.jsxs("div",{children:[n.jsx("label",{style:{display:"block",fontWeight:"bold",marginBottom:"5px",color:"#1f2937"},children:"Prix de revient (coût total)"}),n.jsxs("div",{style:{fontSize:"24px",fontWeight:"bold",color:"#3b82f6"},children:[lt.toFixed(0)," FCFA"]})]}),n.jsxs("div",{children:[n.jsx("label",{style:{display:"block",fontWeight:"bold",marginBottom:"5px",color:"#1f2937"},children:"Coefficient multiplicateur"}),n.jsx("div",{style:{fontSize:"24px",fontWeight:"bold",color:w>=3?"#10b981":w>=2?"#f59e0b":"#ef4444"},children:w>0?w.toFixed(2):"-"}),n.jsx("small",{style:{color:"#6b7280",fontSize:"12px"},children:"Prix vente HT / Prix de revient"})]})]}),n.jsxs("div",{style:{borderTop:"1px solid #d1d5db",paddingTop:"15px"},children:[n.jsx("label",{style:{display:"block",fontWeight:"bold",marginBottom:"10px",color:"#1f2937"},children:"Calculer le prix de vente à partir d'un coefficient"}),n.jsxs("div",{style:{display:"flex",gap:"10px",alignItems:"center",marginBottom:"15px"},children:[n.jsx("input",{type:"number",step:"0.1",min:"0",placeholder:"Ex: 3.5",value:S,onChange:pe=>{he(pe.target.value),Tt(!1)},style:{flex:"1",padding:"10px",border:"1px solid #d1d5db",borderRadius:"6px",fontSize:"16px"}}),n.jsx("button",{type:"button",onClick:Is,disabled:!S||lt===0,style:{padding:"10px 20px",background:"#3b82f6",color:"white",border:"none",borderRadius:"6px",fontWeight:"bold",cursor:"pointer",opacity:!S||lt===0?.5:1},children:"Calculer"})]}),Et&&n.jsxs("div",{style:{padding:"15px",background:"#ecfdf5",borderRadius:"8px",border:"2px solid #10b981",marginTop:"10px"},children:[n.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"15px",marginBottom:"15px"},children:[n.jsxs("div",{children:[n.jsx("label",{style:{display:"block",fontSize:"13px",color:"#6b7280",marginBottom:"4px"},children:"Prix de vente HT"}),n.jsxs("div",{style:{fontSize:"20px",fontWeight:"bold",color:"#059669"},children:[dt.toFixed(0)," FCFA"]})]}),n.jsxs("div",{children:[n.jsx("label",{style:{display:"block",fontSize:"13px",color:"#6b7280",marginBottom:"4px"},children:"Prix de vente TTC"}),n.jsxs("div",{style:{fontSize:"20px",fontWeight:"bold",color:"#059669"},children:[Ut.toFixed(0)," FCFA"]})]})]}),n.jsx("button",{type:"button",onClick:Vs,style:{width:"100%",padding:"12px",background:"#10b981",color:"white",border:"none",borderRadius:"6px",fontWeight:"bold",cursor:"pointer",fontSize:"15px"},children:"Valider ce prix"})]})]})]})]})]})})(),(()=>{const ve=g.find(Re=>Re.id===T.product_type_id)?.name||"",Me=ve==="Matières Premières",Ae=ve==="Consommables";return console.log("Product type check:",{typeName:ve,isRawMaterial:Me,isConsumable:Ae,shouldShowStorageSection:Me||Ae,productPricesLength:M.length}),(Me||Ae)&&n.jsxs("div",{className:"storage-locations-section",children:[n.jsx("h3",{children:"Dépôts de stockage"}),n.jsx("p",{className:"help-text",children:"Sélectionnez les dépôts de stockage où ce produit sera disponible."}),M.length===0&&n.jsx("div",{style:{padding:"20px",background:"#fef3c7",borderRadius:"8px",marginBottom:"16px",textAlign:"center",color:"#92400e",fontWeight:"500"},children:"⚠️ Aucun dépôt de stockage configuré. Cliquez sur le bouton ci-dessous pour en ajouter un."}),n.jsx("div",{className:"prices-grid",children:M.map((Re,pe)=>(j.find(ye=>ye.id===Re.storage_location_id),n.jsx("div",{className:"price-item-detailed",children:n.jsxs("div",{className:"price-header",children:[n.jsxs("select",{className:"sales-point-select",value:Re.storage_location_id,onChange:ye=>{const ke=[...M];ke[pe].storage_location_id=ye.target.value,G(ke)},children:[n.jsx("option",{value:"",children:"Sélectionner un dépôt..."}),j.map(ye=>n.jsx("option",{value:ye.id,children:ye.name},ye.id))]}),n.jsx("button",{type:"button",className:"btn-remove-price",onClick:()=>{G(M.filter((ye,ke)=>ke!==pe))},children:"✕"})]})},pe)))}),n.jsx("button",{type:"button",className:"btn-add-price",onClick:()=>{G([...M,{product_id:U?.id||null,sales_point_id:null,storage_location_id:"",selling_price:null}])},children:"+ Ajouter un dépôt de stockage"})]})})(),n.jsxs("div",{className:"form-actions",children:[n.jsx("button",{type:"button",className:"btn-cancel",onClick:()=>{L(!1),nn()},children:"Annuler"}),n.jsx("button",{type:"submit",className:"btn-submit",children:U?"Mettre à jour":"Créer"})]})]})]})}),qt&&n.jsx("div",{className:"modal-overlay",children:n.jsxs("div",{className:"modal-content",onClick:I=>I.stopPropagation(),style:{maxWidth:"600px"},children:[n.jsx("div",{className:"modal-header",children:n.jsx("h2",{children:"⚠️ Configuration incomplète"})}),n.jsxs("div",{style:{padding:"24px"},children:[n.jsx("p",{style:{marginBottom:"20px",fontSize:"15px",color:"#4b5563"},children:"Les ingrédients suivants ne sont pas configurés pour les dépôts requis :"}),n.jsx("div",{style:{background:"#fef3c7",border:"1px solid #fbbf24",borderRadius:"8px",padding:"16px",marginBottom:"24px"},children:yn.map((I,ve)=>n.jsxs("div",{style:{marginBottom:ve<yn.length-1?"12px":"0",paddingBottom:ve<yn.length-1?"12px":"0",borderBottom:ve<yn.length-1?"1px solid #fbbf24":"none"},children:[n.jsx("div",{style:{fontWeight:"600",color:"#92400e",marginBottom:"4px"},children:I.ingredient}),n.jsxs("div",{style:{fontSize:"14px",color:"#78350f"},children:["→ Dépôt manquant : ",n.jsx("strong",{children:I.storage})]}),n.jsxs("div",{style:{fontSize:"13px",color:"#78350f",marginTop:"2px"},children:["(requis pour le point de vente : ",I.salesPoint,")"]})]},ve))}),n.jsx("div",{style:{background:"#e0f2fe",border:"1px solid #0ea5e9",borderRadius:"8px",padding:"16px",marginBottom:"24px"},children:n.jsxs("div",{style:{fontSize:"14px",color:"#0c4a6e",lineHeight:"1.6"},children:[n.jsx("strong",{children:"💡 Correction automatique disponible"}),n.jsx("p",{style:{margin:"8px 0 0 0"},children:'Cliquez sur "Corriger automatiquement" pour ajouter les dépôts manquants aux fiches ingrédients. Les stocks seront initialisés à 0.'})]})}),n.jsxs("div",{style:{display:"flex",gap:"12px",justifyContent:"flex-end"},children:[n.jsx("button",{type:"button",className:"btn-cancel",onClick:()=>Dt(!1),style:{padding:"12px 24px"},children:"Annuler"}),n.jsx("button",{type:"button",className:"btn-submit",onClick:Pa,style:{padding:"12px 24px",background:"#0ea5e9"},children:"✓ Corriger automatiquement"})]})]})]})}),Vt&&gt&&n.jsx("div",{className:"modal-overlay",children:n.jsxs("div",{className:"modal-content",onClick:I=>I.stopPropagation(),style:{maxWidth:"650px"},children:[n.jsx("div",{className:"modal-header",children:n.jsx("h2",{children:"📊 Ajustement rétroactif des stocks"})}),n.jsxs("div",{style:{padding:"24px"},children:[n.jsxs("div",{style:{background:"#fff3cd",border:"1px solid #ffc107",borderRadius:"8px",padding:"16px",marginBottom:"24px"},children:[n.jsx("div",{style:{fontWeight:"600",color:"#856404",marginBottom:"8px"},children:"⚠️ Modification de recette détectée"}),n.jsxs("div",{style:{fontSize:"14px",color:"#856404"},children:["Vous avez modifié la recette de ",n.jsx("strong",{children:gt.productName}),"."]}),n.jsxs("div",{style:{fontSize:"13px",color:"#856404",marginTop:"4px"},children:["Dernière modification : ",new Date(gt.lastModifiedAt).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})]})]}),n.jsxs("div",{style:{marginBottom:"24px"},children:[n.jsx("p",{style:{fontSize:"15px",color:"#4b5563",lineHeight:"1.6",marginBottom:"16px"},children:"Souhaitez-vous ajuster rétroactivement les stocks pour refléter cette modification ?"}),n.jsx("div",{style:{background:"#e0f2fe",border:"1px solid #0ea5e9",borderRadius:"8px",padding:"16px",marginBottom:"16px"},children:n.jsxs("div",{style:{fontSize:"14px",color:"#0c4a6e",lineHeight:"1.6"},children:[n.jsx("strong",{children:"💡 Deux options disponibles :"}),n.jsxs("ul",{style:{margin:"12px 0 0 0",paddingLeft:"20px"},children:[n.jsxs("li",{style:{marginBottom:"8px"},children:[n.jsx("strong",{children:"Depuis la dernière modification"})," : Ajuste uniquement les ventes effectuées après la dernière modification de recette"]}),n.jsxs("li",{children:[n.jsx("strong",{children:"Depuis le début"})," : Ajuste TOUTES les ventes historiques de ce produit (à utiliser avec précaution)"]})]})]})}),n.jsxs("div",{style:{background:"#fee2e2",border:"1px solid #ef4444",borderRadius:"8px",padding:"12px",fontSize:"13px",color:"#991b1b"},children:[n.jsx("strong",{children:"⚠️ Attention :"})," Cette action modifiera les quantités en stock et créera des mouvements d'ajustement dans l'historique."]})]}),n.jsxs("div",{style:{display:"flex",gap:"12px",justifyContent:"flex-end"},children:[n.jsx("button",{type:"button",className:"btn-cancel",onClick:()=>jn(),style:{padding:"12px 24px"},children:"Annuler modification"}),n.jsx("button",{type:"button",className:"btn-submit",onClick:()=>wn("since_last_change"),style:{padding:"12px 24px",background:"#0ea5e9"},children:"Depuis dernière modification"}),n.jsx("button",{type:"button",className:"btn-submit",onClick:()=>wn("all"),style:{padding:"12px 24px",background:"#ef4444"},children:"Depuis le début"})]})]})]})}),$n&&n.jsx("div",{className:"modal-overlay",onClick:()=>St(!1),children:n.jsxs("div",{className:"modal-content",onClick:I=>I.stopPropagation(),style:{maxWidth:"800px",maxHeight:"80vh",overflow:"auto"},children:[n.jsxs("div",{className:"modal-header",children:[n.jsx("h2",{children:"📜 Historique des modifications de recette"}),n.jsx("button",{className:"btn-close",onClick:()=>St(!1),children:"×"})]}),n.jsx("div",{style:{padding:"24px"},children:Ht.length===0?n.jsx("div",{style:{textAlign:"center",padding:"40px",color:"#6b7280",fontSize:"15px"},children:"Aucune modification enregistrée pour ce produit"}):n.jsxs(n.Fragment,{children:[n.jsxs("div",{style:{marginBottom:"20px",padding:"16px",background:"#f0f9ff",borderRadius:"8px",border:"1px solid #bae6fd"},children:[n.jsx("div",{style:{fontWeight:"600",fontSize:"15px",color:"#0369a1",marginBottom:"8px"},children:"📊 Statistiques"}),n.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(150px, 1fr))",gap:"12px",fontSize:"13px"},children:[n.jsxs("div",{children:[n.jsx("span",{style:{color:"#64748b"},children:"Total modifications : "}),n.jsx("span",{style:{fontWeight:"600",color:"#0f172a"},children:Ht.length})]}),n.jsxs("div",{children:[n.jsx("span",{style:{color:"#64748b"},children:"Version actuelle : "}),n.jsxs("span",{style:{fontWeight:"600",color:"#0f172a"},children:[Ht[0]?.recipe_snapshot?.ingredients?.length||0," ingrédients"]})]}),n.jsxs("div",{children:[n.jsx("span",{style:{color:"#64748b"},children:"Dernière modification : "}),n.jsx("span",{style:{fontWeight:"600",color:"#0f172a"},children:new Date(Ht[0]?.modified_at).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"})})]})]})]}),n.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:Ht.map((I,ve)=>{const Me=ve<Ht.length-1?Ht[ve+1]:null,Ae=I.recipe_snapshot?.ingredients||[],Re=Me?.recipe_snapshot?.ingredients||[],pe=[],ye=[],ke=[];if(Me&&I.modification_type==="update"){const Fe={};Re.forEach(qe=>{Fe[qe.ingredient_id]=qe}),Ae.forEach(qe=>{const Oe=Fe[qe.ingredient_id];Oe?Oe.quantity!==qe.quantity&&ke.push({current:qe,previous:Oe}):pe.push(qe),delete Fe[qe.ingredient_id]}),Object.values(Fe).forEach(qe=>ye.push(qe))}return n.jsxs("div",{style:{background:ve===0?"#f0fdf4":"#f9fafb",border:`2px solid ${ve===0?"#10b981":"#e5e7eb"}`,borderRadius:"8px",padding:"16px"},children:[n.jsx("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"12px"},children:n.jsxs("div",{children:[n.jsxs("div",{style:{fontWeight:"600",fontSize:"15px",color:"#1f2937",marginBottom:"4px"},children:[I.modification_type==="create"&&"🆕 Création initiale",I.modification_type==="update"&&"✏️ Modification",I.modification_type==="delete"&&"🗑️ Suppression",ve===0&&n.jsx("span",{style:{marginLeft:"8px",background:"#10b981",color:"white",padding:"2px 8px",borderRadius:"4px",fontSize:"12px"},children:"Actuel"})]}),n.jsx("div",{style:{fontSize:"13px",color:"#6b7280"},children:new Date(I.modified_at).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"})})]})}),I.notes&&n.jsx("div",{style:{background:"#fff",padding:"8px 12px",borderRadius:"4px",fontSize:"13px",color:"#4b5563",marginBottom:"12px",fontStyle:"italic"},children:I.notes}),(pe.length>0||ye.length>0||ke.length>0)&&n.jsxs("div",{style:{marginBottom:"12px"},children:[n.jsx("div",{style:{fontWeight:"500",fontSize:"14px",color:"#374151",marginBottom:"8px"},children:"🔄 Changements :"}),n.jsxs("div",{style:{background:"#fff",borderRadius:"6px",padding:"12px",border:"1px solid #e5e7eb"},children:[pe.length>0&&n.jsxs("div",{style:{marginBottom:ke.length>0||ye.length>0?"8px":"0"},children:[n.jsxs("div",{style:{fontSize:"13px",fontWeight:"600",color:"#059669",marginBottom:"4px"},children:["+ Ajouté (",pe.length,") :"]}),pe.map((Fe,qe)=>n.jsxs("div",{style:{fontSize:"13px",color:"#059669",paddingLeft:"12px"},children:["• ",Fe.ingredient_name," : ",Fe.quantity," ",Fe.unit]},qe))]}),ke.length>0&&n.jsxs("div",{style:{marginBottom:ye.length>0?"8px":"0"},children:[n.jsxs("div",{style:{fontSize:"13px",fontWeight:"600",color:"#2563eb",marginBottom:"4px"},children:["↔ Modifié (",ke.length,") :"]}),ke.map((Fe,qe)=>n.jsxs("div",{style:{fontSize:"13px",color:"#2563eb",paddingLeft:"12px"},children:["• ",Fe.current.ingredient_name," : ",n.jsx("span",{style:{textDecoration:"line-through",color:"#94a3b8"},children:Fe.previous.quantity})," → ",Fe.current.quantity," ",Fe.current.unit]},qe))]}),ye.length>0&&n.jsxs("div",{children:[n.jsxs("div",{style:{fontSize:"13px",fontWeight:"600",color:"#dc2626",marginBottom:"4px"},children:["- Retiré (",ye.length,") :"]}),ye.map((Fe,qe)=>n.jsxs("div",{style:{fontSize:"13px",color:"#dc2626",paddingLeft:"12px"},children:["• ",Fe.ingredient_name," : ",Fe.quantity," ",Fe.unit]},qe))]})]})]}),Ae.length>0&&n.jsxs("div",{children:[n.jsxs("div",{style:{fontWeight:"500",fontSize:"14px",color:"#374151",marginBottom:"8px"},children:["📋 Composition complète (",Ae.length,") :"]}),n.jsx("div",{style:{background:"#fff",borderRadius:"6px",padding:"12px",border:"1px solid #e5e7eb"},children:Ae.map((Fe,qe)=>n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",padding:"6px 0",borderBottom:qe<Ae.length-1?"1px solid #f3f4f6":"none"},children:[n.jsx("span",{style:{fontSize:"14px",color:"#1f2937"},children:Fe.ingredient_name||"Inconnu"}),n.jsxs("span",{style:{fontSize:"14px",fontWeight:"500",color:"#3b82f6"},children:[Fe.quantity," ",Fe.unit||""]})]},qe))})]})]},I.id)})})]})}),n.jsx("div",{style:{padding:"0 24px 24px",display:"flex",justifyContent:"flex-end"},children:n.jsx("button",{type:"button",className:"btn-cancel",onClick:()=>St(!1),style:{padding:"12px 24px"},children:"Fermer"})})]})}),ge&&Ye&&n.jsx("div",{className:"modal-overlay",onClick:()=>Te(!1),children:n.jsxs("div",{className:"modal-content",onClick:I=>I.stopPropagation(),style:{maxWidth:"700px"},children:[n.jsxs("div",{className:"modal-header",children:[n.jsx("h2",{children:"Réparation des ajustements rétroactifs"}),n.jsx("button",{className:"btn-close",onClick:()=>Te(!1),children:"×"})]}),n.jsxs("div",{style:{padding:"24px"},children:[n.jsxs("div",{style:{background:"#d1fae5",border:"2px solid #10b981",borderRadius:"8px",padding:"16px",marginBottom:"20px",textAlign:"center"},children:[n.jsx("div",{style:{fontSize:"18px",fontWeight:"600",color:"#065f46",marginBottom:"4px"},children:"Réparation terminée avec succès !"}),n.jsx("div",{style:{fontSize:"14px",color:"#047857"},children:"Les stocks ont été corrigés en annulant les ajustements rétroactifs incorrects"})]}),n.jsxs("div",{style:{marginTop:"20px"},children:[n.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",marginBottom:"12px",color:"#1f2937"},children:"Résumé des corrections :"}),Ye.map((I,ve)=>n.jsxs("div",{style:{background:"#f9fafb",border:"1px solid #e5e7eb",borderRadius:"6px",padding:"12px",marginBottom:"8px"},children:[n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"8px"},children:[n.jsx("div",{style:{fontWeight:"600",fontSize:"14px",color:"#1f2937"},children:I.product}),n.jsx("div",{style:{fontSize:"13px",color:"#6b7280"},children:I.storage})]}),n.jsxs("div",{style:{fontSize:"13px",color:"#4b5563"},children:[n.jsxs("div",{style:{marginBottom:"4px"},children:["Stock avant : ",n.jsx("strong",{children:I.previousStock.toFixed(2)})]}),n.jsxs("div",{style:{marginBottom:"4px"},children:["Correction appliquée : ",n.jsxs("strong",{style:{color:I.correction>0?"#10b981":"#ef4444"},children:[I.correction>0?"+":"",I.correction.toFixed(2)]})]}),n.jsxs("div",{style:{marginBottom:"4px"},children:["Nouveau stock : ",n.jsx("strong",{style:{color:"#3b82f6"},children:I.newStock.toFixed(2)})]}),n.jsxs("div",{style:{fontSize:"12px",color:"#9ca3af",marginTop:"4px"},children:[I.movementsDeleted," mouvement(s) incorrect(s) supprimé(s)"]})]})]},ve))]}),n.jsxs("div",{style:{marginTop:"20px",padding:"12px",background:"#fef3c7",border:"1px solid #f59e0b",borderRadius:"6px",fontSize:"13px",color:"#92400e"},children:[n.jsx("strong",{children:"Note :"})," Vous pouvez maintenant modifier à nouveau les recettes. Le système utilisera la nouvelle logique différentielle qui évite les doubles déductions."]})]}),n.jsx("div",{style:{padding:"0 24px 24px",display:"flex",justifyContent:"flex-end"},children:n.jsx("button",{type:"button",className:"btn-primary",onClick:()=>{Te(!1),Pe(null),Gt()},style:{padding:"12px 24px"},children:"Fermer et actualiser"})})]})})]})}function qj(){const[o,i]=y.useState([]),[r,l]=y.useState(!0),[c,d]=y.useState(!1),[f,g]=y.useState(null),[m,p]=y.useState({name:"",code:"",description:"",is_active:!0}),[_,j]=y.useState(""),[C,N]=y.useState("name"),[k,P]=y.useState("asc");y.useEffect(()=>{E()},[]);const E=async()=>{try{const{data:q,error:Y}=await A.from("storage_locations").select("*").order("name");if(Y)throw Y;q&&i(q)}catch(q){console.error("Erreur chargement:",q)}finally{l(!1)}},V=async q=>{q.preventDefault();try{if(f){const{error:Y}=await A.from("storage_locations").update(m).eq("id",f.id);if(Y)throw Y}else{const{error:Y}=await A.from("storage_locations").insert(m);if(Y)throw Y}d(!1),O(),E()}catch(Y){console.error("Erreur sauvegarde:",Y),alert("Erreur lors de la sauvegarde: "+Y.message)}},L=q=>{g(q),p({name:q.name,code:q.code,description:q.description||"",is_active:q.is_active}),d(!0)},U=async q=>{if(confirm("Supprimer ce dépôt de stockage ?"))try{const{error:Y}=await A.from("storage_locations").delete().eq("id",q);if(Y)throw Y;E()}catch(Y){console.error("Erreur suppression:",Y),alert("Erreur: "+Y.message)}},O=()=>{p({name:"",code:"",description:"",is_active:!0}),g(null)},M=q=>{C===q?P(k==="asc"?"desc":"asc"):(N(q),P("asc"))},G=o.filter(q=>q.name.toLowerCase().includes(_.toLowerCase())||q.code.toLowerCase().includes(_.toLowerCase())||q.description&&q.description.toLowerCase().includes(_.toLowerCase())).sort((q,Y)=>{let T=q[C]||"",ce=Y[C]||"";return C==="is_active"?(T=q.is_active?1:0,ce=Y.is_active?1:0):typeof T=="string"&&(T=T.toLowerCase(),ce=ce.toLowerCase()),T<ce?k==="asc"?-1:1:T>ce?k==="asc"?1:-1:0});return r?n.jsx("div",{className:"loading",children:"Chargement..."}):n.jsxs("div",{className:"storage-locations-page",children:[n.jsxs("div",{className:"page-header",children:[n.jsx("h1",{children:"Dépôts de Stockage"}),n.jsx("button",{className:"btn-primary",onClick:()=>d(!0),children:"+ Nouveau Dépôt"})]}),n.jsx("div",{className:"search-bar",children:n.jsx("input",{type:"text",placeholder:"Rechercher un dépôt...",value:_,onChange:q=>j(q.target.value),className:"search-input"})}),n.jsx("div",{className:"table-container",children:n.jsxs("table",{className:"locations-table",children:[n.jsx("thead",{children:n.jsxs("tr",{children:[n.jsxs("th",{onClick:()=>M("name"),style:{cursor:"pointer"},children:["Nom ",C==="name"&&(k==="asc"?"↑":"↓")]}),n.jsxs("th",{onClick:()=>M("code"),style:{cursor:"pointer"},children:["Code ",C==="code"&&(k==="asc"?"↑":"↓")]}),n.jsxs("th",{onClick:()=>M("description"),style:{cursor:"pointer"},children:["Description ",C==="description"&&(k==="asc"?"↑":"↓")]}),n.jsxs("th",{onClick:()=>M("is_active"),style:{cursor:"pointer"},children:["Statut ",C==="is_active"&&(k==="asc"?"↑":"↓")]}),n.jsx("th",{children:"Actions"})]})}),n.jsx("tbody",{children:G.map(q=>n.jsxs("tr",{children:[n.jsx("td",{children:n.jsx("strong",{children:q.name})}),n.jsx("td",{children:n.jsx("code",{children:q.code})}),n.jsx("td",{children:q.description||"-"}),n.jsx("td",{children:n.jsx("span",{className:`status-badge ${q.is_active?"active":"inactive"}`,children:q.is_active?"Actif":"Inactif"})}),n.jsx("td",{children:n.jsxs("div",{className:"table-actions",children:[n.jsx("button",{className:"btn-edit",onClick:()=>L(q),children:"✏️"}),n.jsx("button",{className:"btn-delete",onClick:()=>U(q.id),children:"🗑️"})]})})]},q.id))})]})}),c&&n.jsx("div",{className:"modal-overlay",onClick:()=>{d(!1),O()},children:n.jsxs("div",{className:"modal-content",onClick:q=>q.stopPropagation(),children:[n.jsxs("div",{className:"modal-header",children:[n.jsx("h2",{children:f?"Modifier le dépôt":"Nouveau dépôt"}),n.jsx("button",{className:"btn-close",onClick:()=>{d(!1),O()},children:"×"})]}),n.jsxs("form",{onSubmit:V,children:[n.jsxs("div",{className:"form-group",children:[n.jsx("label",{children:"Nom *"}),n.jsx("input",{type:"text",value:m.name,onChange:q=>p({...m,name:q.target.value}),required:!0})]}),n.jsxs("div",{className:"form-group",children:[n.jsx("label",{children:"Code *"}),n.jsx("input",{type:"text",value:m.code,onChange:q=>p({...m,code:q.target.value.toUpperCase()}),required:!0})]}),n.jsxs("div",{className:"form-group",children:[n.jsx("label",{children:"Description"}),n.jsx("textarea",{value:m.description,onChange:q=>p({...m,description:q.target.value}),rows:"3"})]}),n.jsx("div",{className:"form-group",children:n.jsxs("label",{className:"checkbox-label",children:[n.jsx("input",{type:"checkbox",checked:m.is_active,onChange:q=>p({...m,is_active:q.target.checked})}),"Actif"]})}),n.jsxs("div",{className:"form-actions",children:[n.jsx("button",{type:"button",className:"btn-cancel",onClick:()=>{d(!1),O()},children:"Annuler"}),n.jsx("button",{type:"submit",className:"btn-submit",children:f?"Mettre à jour":"Créer"})]})]})]})})]})}function Dj(){const[o,i]=y.useState([]),[r,l]=y.useState(!0),[c,d]=y.useState(!1),[f,g]=y.useState(null),[m,p]=y.useState({name:"",description:""}),[_,j]=y.useState(""),[C,N]=y.useState("name"),[k,P]=y.useState("asc");y.useEffect(()=>{E()},[]);const E=async()=>{try{const{data:q,error:Y}=await A.from("product_categories").select("*").order("name");if(Y)throw Y;q&&i(q)}catch(q){console.error("Erreur chargement:",q)}finally{l(!1)}},V=async q=>{q.preventDefault();try{if(f){const{error:Y}=await A.from("product_categories").update(m).eq("id",f.id);if(Y)throw Y}else{const{error:Y}=await A.from("product_categories").insert(m);if(Y)throw Y}d(!1),O(),E()}catch(Y){console.error("Erreur sauvegarde:",Y),alert("Erreur lors de la sauvegarde: "+Y.message)}},L=q=>{g(q),p({name:q.name,description:q.description||""}),d(!0)},U=async q=>{if(confirm("Supprimer cette catégorie ?"))try{const{error:Y}=await A.from("product_categories").delete().eq("id",q);if(Y)throw Y;E()}catch(Y){console.error("Erreur suppression:",Y),alert("Erreur: "+Y.message)}},O=()=>{p({name:"",description:""}),g(null)},M=q=>{C===q?P(k==="asc"?"desc":"asc"):(N(q),P("asc"))},G=o.filter(q=>q.name.toLowerCase().includes(_.toLowerCase())||q.description&&q.description.toLowerCase().includes(_.toLowerCase())).sort((q,Y)=>{let T=q[C]||"",ce=Y[C]||"";return typeof T=="string"&&(T=T.toLowerCase(),ce=ce.toLowerCase()),T<ce?k==="asc"?-1:1:T>ce?k==="asc"?1:-1:0});return r?n.jsx("div",{className:"loading",children:"Chargement..."}):n.jsxs("div",{className:"categories-page",children:[n.jsxs("div",{className:"page-header",children:[n.jsx("h1",{children:"Catégories de Produits"}),n.jsx("button",{className:"btn-primary",onClick:()=>d(!0),children:"+ Nouvelle Catégorie"})]}),n.jsx("div",{className:"search-bar",children:n.jsx("input",{type:"text",placeholder:"Rechercher une catégorie...",value:_,onChange:q=>j(q.target.value),className:"search-input"})}),n.jsx("div",{className:"table-container",children:n.jsxs("table",{className:"categories-table",children:[n.jsx("thead",{children:n.jsxs("tr",{children:[n.jsxs("th",{onClick:()=>M("name"),style:{cursor:"pointer"},children:["Nom ",C==="name"&&(k==="asc"?"↑":"↓")]}),n.jsxs("th",{onClick:()=>M("description"),style:{cursor:"pointer"},children:["Description ",C==="description"&&(k==="asc"?"↑":"↓")]}),n.jsx("th",{children:"Actions"})]})}),n.jsx("tbody",{children:G.map(q=>n.jsxs("tr",{children:[n.jsx("td",{children:n.jsx("strong",{children:q.name})}),n.jsx("td",{children:q.description||"-"}),n.jsx("td",{children:n.jsxs("div",{className:"table-actions",children:[n.jsx("button",{className:"btn-edit",onClick:()=>L(q),children:"✏️"}),n.jsx("button",{className:"btn-delete",onClick:()=>U(q.id),children:"🗑️"})]})})]},q.id))})]})}),c&&n.jsx("div",{className:"modal-overlay",onClick:()=>{d(!1),O()},children:n.jsxs("div",{className:"modal-content",onClick:q=>q.stopPropagation(),children:[n.jsxs("div",{className:"modal-header",children:[n.jsx("h2",{children:f?"Modifier la catégorie":"Nouvelle catégorie"}),n.jsx("button",{className:"btn-close",onClick:()=>{d(!1),O()},children:"×"})]}),n.jsxs("form",{onSubmit:V,children:[n.jsxs("div",{className:"form-group",children:[n.jsx("label",{children:"Nom *"}),n.jsx("input",{type:"text",value:m.name,onChange:q=>p({...m,name:q.target.value}),required:!0})]}),n.jsxs("div",{className:"form-group",children:[n.jsx("label",{children:"Description"}),n.jsx("textarea",{value:m.description,onChange:q=>p({...m,description:q.target.value}),rows:"3"})]}),n.jsxs("div",{className:"form-actions",children:[n.jsx("button",{type:"button",className:"btn-cancel",onClick:()=>{d(!1),O()},children:"Annuler"}),n.jsx("button",{type:"submit",className:"btn-submit",children:f?"Mettre à jour":"Créer"})]})]})]})})]})}const Mj=()=>{const[o,i]=y.useState([]),[r,l]=y.useState(!0),[c,d]=y.useState(!1),[f,g]=y.useState(null),[m,p]=y.useState({name:"",code:"",description:"",can_be_sold:!1,is_active:!0}),[_,j]=y.useState("name"),[C,N]=y.useState("asc");y.useEffect(()=>{k()},[]);const k=async()=>{try{l(!0);const{data:U,error:O}=await A.from("product_types").select("*");if(O)throw O;i(U||[])}catch(U){console.error("Erreur lors du chargement des types de produits:",U),alert("Erreur lors du chargement des types de produits")}finally{l(!1)}},P=async U=>{U.preventDefault();try{if(f){const{error:O}=await A.from("product_types").update({name:m.name,code:m.code,description:m.description,can_be_sold:m.can_be_sold,is_active:m.is_active,updated_at:new Date().toISOString()}).eq("id",f.id);if(O)throw O}else{const{error:O}=await A.from("product_types").insert([m]);if(O)throw O}d(!1),g(null),p({name:"",code:"",description:"",can_be_sold:!1,is_active:!0}),k()}catch(O){console.error("Erreur lors de la sauvegarde:",O),alert("Erreur lors de la sauvegarde du type de produit")}},E=U=>{g(U),p({name:U.name,code:U.code,description:U.description||"",can_be_sold:U.can_be_sold,is_active:U.is_active}),d(!0)},V=async U=>{if(confirm("Êtes-vous sûr de vouloir supprimer ce type de produit ?"))try{const{error:O}=await A.from("product_types").delete().eq("id",U);if(O)throw O;k()}catch(O){console.error("Erreur lors de la suppression:",O),alert("Erreur lors de la suppression du type de produit")}},L=()=>{g(null),p({name:"",code:"",description:"",can_be_sold:!1,is_active:!0}),d(!0)};return r?n.jsx("div",{className:"loading",children:"Chargement..."}):n.jsxs("div",{className:"product-types-container",children:[n.jsxs("div",{className:"types-header",children:[n.jsx("h2",{children:"Types de produits"}),n.jsxs("div",{className:"header-actions",children:[n.jsxs("select",{value:_,onChange:U=>{j(U.target.value),N("asc")},className:"sort-select",children:[n.jsx("option",{value:"name",children:"Trier par Nom"}),n.jsx("option",{value:"code",children:"Trier par Code"})]}),n.jsx("button",{onClick:()=>N(C==="asc"?"desc":"asc"),className:"btn-sort",children:C==="asc"?"↑":"↓"}),n.jsx("button",{className:"btn-primary",onClick:L,children:"+ Nouveau type"})]})]}),n.jsx("div",{className:"types-grid",children:o.sort((U,O)=>{let M=U[_]||"",G=O[_]||"";return typeof M=="string"&&(M=M.toLowerCase(),G=G.toLowerCase()),M<G?C==="asc"?-1:1:M>G?C==="asc"?1:-1:0}).map(U=>n.jsxs("div",{className:"type-card",children:[n.jsxs("div",{className:"type-card-header",children:[n.jsx("h3",{children:U.name}),n.jsx("span",{className:`type-badge ${U.is_active?"active":"inactive"}`,children:U.is_active?"Actif":"Inactif"})]}),n.jsxs("div",{className:"type-card-body",children:[n.jsxs("p",{className:"type-code",children:["Code: ",U.code]}),U.description&&n.jsx("p",{className:"type-description",children:U.description}),n.jsx("p",{className:"type-can-sell",children:U.can_be_sold?"✓ Peut être vendu":"✗ Non vendable"})]}),n.jsxs("div",{className:"type-card-footer",children:[n.jsx("button",{className:"btn-edit",onClick:()=>E(U),children:"Modifier"}),n.jsx("button",{className:"btn-delete",onClick:()=>V(U.id),children:"Supprimer"})]})]},U.id))}),c&&n.jsx("div",{className:"modal-overlay",onClick:()=>d(!1),children:n.jsxs("div",{className:"modal-content",onClick:U=>U.stopPropagation(),children:[n.jsxs("div",{className:"modal-header",children:[n.jsx("h2",{children:f?"Modifier le type":"Nouveau type"}),n.jsx("button",{className:"modal-close",onClick:()=>d(!1),children:"×"})]}),n.jsxs("form",{onSubmit:P,children:[n.jsxs("div",{className:"form-group",children:[n.jsx("label",{children:"Nom *"}),n.jsx("input",{type:"text",value:m.name,onChange:U=>p({...m,name:U.target.value}),required:!0})]}),n.jsxs("div",{className:"form-group",children:[n.jsx("label",{children:"Code *"}),n.jsx("input",{type:"text",value:m.code,onChange:U=>p({...m,code:U.target.value.toUpperCase()}),required:!0,placeholder:"Ex: SALES, RAW_MATERIAL"})]}),n.jsxs("div",{className:"form-group",children:[n.jsx("label",{children:"Description"}),n.jsx("textarea",{value:m.description,onChange:U=>p({...m,description:U.target.value}),rows:"3"})]}),n.jsx("div",{className:"form-group checkbox-group",children:n.jsxs("label",{children:[n.jsx("input",{type:"checkbox",checked:m.can_be_sold,onChange:U=>p({...m,can_be_sold:U.target.checked})}),"Peut être vendu directement"]})}),n.jsx("div",{className:"form-group checkbox-group",children:n.jsxs("label",{children:[n.jsx("input",{type:"checkbox",checked:m.is_active,onChange:U=>p({...m,is_active:U.target.checked})}),"Actif"]})}),n.jsxs("div",{className:"modal-footer",children:[n.jsx("button",{type:"button",className:"btn-cancel",onClick:()=>d(!1),children:"Annuler"}),n.jsx("button",{type:"submit",className:"btn-primary",children:f?"Mettre à jour":"Créer"})]})]})]})})]})};function zj(){const[o,i]=y.useState([]),[r,l]=y.useState(!0),[c,d]=y.useState(!1),[f,g]=y.useState(null),[m,p]=y.useState({name:"",type:"bar",opening_time:"08:00",closing_time:"22:00",has_pos:!0,has_tablets:!1,is_active:!0,vat_rate:10}),[_,j]=y.useState("name"),[C,N]=y.useState("asc");y.useEffect(()=>{k()},[]);const k=async()=>{try{const{data:O,error:M}=await A.from("sales_points").select("*");if(M)throw M;i(O||[])}catch(O){console.error("Erreur chargement points de vente:",O)}finally{l(!1)}},P=async O=>{O.preventDefault();try{if(f){const{error:M}=await A.from("sales_points").update(m).eq("id",f.id);if(M)throw M}else{const{error:M}=await A.from("sales_points").insert([m]);if(M)throw M}L(),k()}catch(M){console.error("Erreur sauvegarde:",M)}},E=O=>{g(O),p({name:O.name,type:O.type,opening_time:O.opening_time||"08:00",closing_time:O.closing_time||"22:00",has_pos:O.has_pos,has_tablets:O.has_tablets,is_active:O.is_active,vat_rate:O.vat_rate||10}),d(!0)},V=async O=>{if(confirm("Supprimer ce point de vente ?"))try{const{error:M}=await A.from("sales_points").delete().eq("id",O);if(M)throw M;k()}catch(M){console.error("Erreur suppression:",M)}},L=()=>{p({name:"",type:"bar",opening_time:"08:00",closing_time:"22:00",has_pos:!0,has_tablets:!1,is_active:!0,vat_rate:10}),g(null),d(!1)},U=O=>({bar:"Bar",restaurant:"Restaurant",nightclub:"Boîte de Nuit",hotel:"Hôtel",other:"Autre"})[O]||O;return r?n.jsx("div",{className:"loading",children:"Chargement..."}):n.jsxs("div",{className:"sales-points-container",children:[n.jsxs("div",{className:"page-header",children:[n.jsx("h2",{children:"Points de Vente"}),n.jsxs("div",{className:"header-actions",children:[n.jsxs("select",{value:_,onChange:O=>{j(O.target.value),N("asc")},className:"sort-select",children:[n.jsx("option",{value:"name",children:"Trier par Nom"}),n.jsx("option",{value:"type",children:"Trier par Type"})]}),n.jsx("button",{onClick:()=>N(C==="asc"?"desc":"asc"),className:"btn-sort",children:C==="asc"?"↑":"↓"}),n.jsx("button",{className:"btn-primary",onClick:()=>d(!0),children:"Nouveau Point de Vente"})]})]}),n.jsx("div",{className:"points-grid",children:o.sort((O,M)=>{let G=O[_]||"",q=M[_]||"";return typeof G=="string"&&(G=G.toLowerCase(),q=q.toLowerCase()),G<q?C==="asc"?-1:1:G>q?C==="asc"?1:-1:0}).map(O=>n.jsxs("div",{className:`point-card ${O.is_active?"":"inactive"}`,children:[n.jsxs("div",{className:"point-header",children:[n.jsx("h3",{children:O.name}),n.jsx("span",{className:`status-badge ${O.is_active?"active":"inactive"}`,children:O.is_active?"Actif":"Inactif"})]}),n.jsxs("div",{className:"point-body",children:[n.jsxs("div",{className:"point-info",children:[n.jsx("span",{className:"label",children:"Type:"}),n.jsx("span",{className:"value",children:U(O.type)})]}),n.jsxs("div",{className:"point-info",children:[n.jsx("span",{className:"label",children:"Horaires:"}),n.jsxs("span",{className:"value",children:[O.opening_time," - ",O.closing_time]})]}),n.jsxs("div",{className:"point-info",children:[n.jsx("span",{className:"label",children:"TVA:"}),n.jsxs("span",{className:"value",children:[O.vat_rate||10,"%"]})]}),n.jsxs("div",{className:"point-features",children:[O.has_pos&&n.jsx("span",{className:"feature",children:"📟 Caisse"}),O.has_tablets&&n.jsx("span",{className:"feature",children:"📱 Tablettes"})]})]}),n.jsxs("div",{className:"point-actions",children:[n.jsx("button",{className:"btn-edit",onClick:()=>E(O),children:"Modifier"}),n.jsx("button",{className:"btn-delete",onClick:()=>V(O.id),children:"Supprimer"})]})]},O.id))}),c&&n.jsx("div",{className:"modal-overlay",onClick:L,children:n.jsxs("div",{className:"modal-content",onClick:O=>O.stopPropagation(),children:[n.jsxs("div",{className:"modal-header",children:[n.jsxs("h3",{children:[f?"Modifier":"Nouveau"," Point de Vente"]}),n.jsx("button",{className:"close-btn",onClick:L,children:"×"})]}),n.jsxs("form",{onSubmit:P,children:[n.jsxs("div",{className:"form-row",children:[n.jsxs("div",{className:"form-group",children:[n.jsx("label",{children:"Nom"}),n.jsx("input",{type:"text",value:m.name,onChange:O=>p({...m,name:O.target.value}),required:!0})]}),n.jsxs("div",{className:"form-group",children:[n.jsx("label",{children:"Type"}),n.jsxs("select",{value:m.type,onChange:O=>p({...m,type:O.target.value}),required:!0,children:[n.jsx("option",{value:"bar",children:"Bar"}),n.jsx("option",{value:"restaurant",children:"Restaurant"}),n.jsx("option",{value:"nightclub",children:"Boîte de Nuit"}),n.jsx("option",{value:"hotel",children:"Hôtel"}),n.jsx("option",{value:"other",children:"Autre"})]})]})]}),n.jsxs("div",{className:"form-row",children:[n.jsxs("div",{className:"form-group",children:[n.jsx("label",{children:"Heure d'ouverture"}),n.jsx("input",{type:"time",value:m.opening_time,onChange:O=>p({...m,opening_time:O.target.value})})]}),n.jsxs("div",{className:"form-group",children:[n.jsx("label",{children:"Heure de fermeture"}),n.jsx("input",{type:"time",value:m.closing_time,onChange:O=>p({...m,closing_time:O.target.value})})]})]}),n.jsx("div",{className:"form-row",children:n.jsxs("div",{className:"form-group",children:[n.jsx("label",{children:"Taux de TVA (%) - Sénégal"}),n.jsx("input",{type:"number",step:"0.01",value:m.vat_rate,onChange:O=>p({...m,vat_rate:O.target.value}),required:!0}),n.jsx("small",{style:{color:"#6b7280",marginTop:"4px",display:"block"},children:"Taux standard: 10% (Hôtellerie-Restauration au Sénégal)"})]})}),n.jsxs("div",{className:"form-row",children:[n.jsxs("label",{className:"checkbox-label",children:[n.jsx("input",{type:"checkbox",checked:m.has_pos,onChange:O=>p({...m,has_pos:O.target.checked})}),n.jsx("span",{children:"Possède une caisse"})]}),n.jsxs("label",{className:"checkbox-label",children:[n.jsx("input",{type:"checkbox",checked:m.has_tablets,onChange:O=>p({...m,has_tablets:O.target.checked})}),n.jsx("span",{children:"Possède des tablettes"})]}),n.jsxs("label",{className:"checkbox-label",children:[n.jsx("input",{type:"checkbox",checked:m.is_active,onChange:O=>p({...m,is_active:O.target.checked})}),n.jsx("span",{children:"Actif"})]})]}),n.jsxs("div",{className:"modal-actions",children:[n.jsx("button",{type:"button",className:"btn-secondary",onClick:L,children:"Annuler"}),n.jsx("button",{type:"submit",className:"btn-primary",children:f?"Modifier":"Créer"})]})]})]})})]})}function Lj(){const{hasPermission:o}=Zr(),[i,r]=y.useState([]),[l,c]=y.useState([]),[d,f]=y.useState([]),[g,m]=y.useState(!0),[p,_]=y.useState(!1),[j,C]=y.useState(!1),[N,k]=y.useState(!1),[P,E]=y.useState(!1),[V,L]=y.useState(null),[U,O]=y.useState([]),[M,G]=y.useState([]),[q,Y]=y.useState(null),[T,ce]=y.useState(""),[se,ee]=y.useState(""),[_e,ue]=y.useState("product_name"),[Ce,F]=y.useState("asc"),[ne,K]=y.useState(""),[le,Ee]=y.useState(!0),[R,X]=y.useState([]),[fe,be]=y.useState(!1),[$,D]=y.useState({from_storage_id:"",to_storage_id:"",notes:""}),[re,we]=y.useState([]),[Ne,nt]=y.useState(""),[Le,Ue]=y.useState([]);y.useEffect(()=>{lt()},[]),y.useEffect(()=>{ne&&qt()},[ne,le]);const lt=async()=>{try{const{data:B,error:w}=await A.from("storage_locations").select("*").eq("is_active",!0).order("name");if(w)throw w;f(B||[]),m(!1)}catch(B){console.error("Erreur chargement dépôts:",B),m(!1)}},We=B=>{_e===B?F(Ce==="asc"?"desc":"asc"):(ue(B),F("asc"))},qt=async()=>{try{m(!0);const{data:B,error:w}=await A.from("product_prices").select("product_id").eq("storage_location_id",ne);if(w)throw w;const ae=B?.map(Ye=>Ye.product_id)||[];if(ae.length===0){r([]),c([]),m(!1);return}let S=A.from("product_stocks").select(`
          *,
          products:product_id (id, name, reference, unit),
          storage_locations:storage_location_id (id, name, code)
        `).eq("storage_location_id",ne).in("product_id",ae).order("updated_at",{ascending:!1}),he=A.from("products").select("*, product_types(name)").eq("is_active",!0).in("id",ae);if(le){const{data:Ye}=await A.from("product_types").select("id").eq("name","Matières Premières").single();Ye&&(he=he.eq("product_type_id",Ye.id))}he=he.order("name");const[ge,Te]=await Promise.all([S,he]);if(ge.error)throw ge.error;if(Te.error)throw Te.error;r(ge.data||[]),c(Te.data||[])}catch(B){console.error("Erreur chargement données:",B)}finally{m(!1)}},Dt=async(B,w)=>{try{let ae=A.from("stock_movements").select(`
          *,
          products:product_id (name, reference),
          storage_locations:storage_location_id (name, code),
          sales_points:pos_id (name)
        `).eq("product_id",B).eq("storage_location_id",w).order("created_at",{ascending:!1});T&&(ae=ae.gte("created_at",T+"T00:00:00")),se&&(ae=ae.lte("created_at",se+"T23:59:59"));const{data:S,error:he}=await ae;if(he)throw he;O(S||[]),L({productId:B,storageLocationId:w}),k(!0)}catch(ae){console.error("Erreur chargement historique:",ae),alert("Erreur lors du chargement de l'historique: "+ae.message)}},yn=async()=>{if(ne)try{const B=await Promise.all(l.map(async w=>{const ae=i.find(S=>S.product_id===w.id&&S.storage_location_id===ne);if(ae){const{data:S}=await A.from("stock_movements").select("quantity, movement_type, created_at").eq("product_id",ae.product_id).eq("storage_location_id",ae.storage_location_id).gte("created_at",ae.last_inventory_date||"2000-01-01").order("created_at");let he=parseFloat(ae.quantity);return S?.forEach(ge=>{he+=parseFloat(ge.quantity)}),{...ae,currentQuantity:parseFloat(ae.quantity),expectedQuantity:he.toFixed(2),countedQuantity:0,difference:0}}else return{id:null,product_id:w.id,storage_location_id:ne,products:w,currentQuantity:0,expectedQuantity:0,countedQuantity:0,difference:0}}));X(B),be(!1),_(!0)}catch(B){console.error("Erreur chargement inventaire:",B),alert("Erreur lors du chargement des données d'inventaire")}},ln=async()=>{if(confirm("Valider cet inventaire ? Les stocks seront mis à jour."))try{const B=R.filter(ge=>ge.difference!==0).length,{data:w,error:ae}=await A.from("inventories").insert([{storage_location_id:ne,inventory_date:new Date().toISOString(),status:"validated",total_items:R.length,total_discrepancies:B,notes:`Inventaire ${d.find(ge=>ge.id===ne)?.name}`,created_by:"admin",validated_at:new Date().toISOString()}]).select().single();if(ae)throw ae;const S=R.map(ge=>({inventory_id:w.id,product_id:ge.product_id,expected_quantity:ge.currentQuantity,counted_quantity:parseFloat(ge.countedQuantity),difference:ge.difference})),{error:he}=await A.from("inventory_lines").insert(S);if(he)throw he;for(const ge of R){const Te=parseFloat(ge.countedQuantity);ge.id?ge.difference!==0&&(await A.from("product_stocks").update({quantity:Te,last_inventory_date:new Date().toISOString()}).eq("id",ge.id),await A.from("stock_movements").insert([{product_id:ge.product_id,storage_location_id:ge.storage_location_id,movement_type:"inventory_adjustment",quantity:ge.difference,previous_quantity:ge.currentQuantity,new_quantity:Te,notes:`Inventaire #${w.id.substring(0,8)} - Écart: ${ge.difference.toFixed(2)}`}])):Te>0&&(await A.from("product_stocks").insert([{product_id:ge.product_id,storage_location_id:ge.storage_location_id,quantity:Te,last_inventory_date:new Date().toISOString()}]),await A.from("stock_movements").insert([{product_id:ge.product_id,storage_location_id:ge.storage_location_id,movement_type:"inventory_adjustment",quantity:Te,previous_quantity:0,new_quantity:Te,notes:`Inventaire #${w.id.substring(0,8)} - Création stock`}]))}alert("Inventaire validé avec succès"),_(!1),be(!1),qt()}catch(B){console.error("Erreur validation inventaire:",B),alert("Erreur lors de la validation de l'inventaire: "+B.message)}},Vt=async()=>{try{const{data:B,error:w}=await A.from("inventories").select(`
          *,
          storage_locations:storage_location_id (name, code)
        `).order("inventory_date",{ascending:!1});if(w)throw w;G(B||[]),E(!0)}catch(B){console.error("Erreur chargement historique inventaires:",B),alert("Erreur lors du chargement de l'historique des inventaires")}},en=async B=>{try{const{data:w,error:ae}=await A.from("inventory_lines").select(`
          *,
          products:product_id (name, reference, unit)
        `).eq("inventory_id",B).order("products(name)");if(ae)throw ae;Y(w||[])}catch(w){console.error("Erreur chargement détails inventaire:",w),alert("Erreur lors du chargement des détails de l'inventaire")}},gt=()=>{const B=d.find(ae=>ae.id===ne);let w="";B?.name!=="Economat Général"&&B?.name!=="Casse / Périmés"&&(w=d.find(S=>S.name==="Casse / Périmés")?.id||""),D({from_storage_id:ne||"",to_storage_id:w,notes:""}),we([]),nt(""),w?Ht(w):Ue([]),C(!0)},on=B=>{if(!B)return;if(re.find(S=>S.product_id===B)){alert("Ce produit est déjà dans la liste");return}const ae=l.find(S=>S.id===B);ae&&(we([...re,{id:Date.now(),product_id:B,product_name:ae.name,product_reference:ae.reference,quantity:0}]),nt(""))},$n=B=>{we(re.filter(w=>w.id!==B))},St=(B,w)=>{we(re.map(ae=>ae.id===B?{...ae,quantity:parseFloat(w)||0}:ae))},Ht=async B=>{if(!B){Ue([]);return}try{const{data:w,error:ae}=await A.from("product_prices").select("product_id").eq("storage_location_id",$.from_storage_id);if(ae)throw ae;const{data:S,error:he}=await A.from("product_prices").select("product_id").eq("storage_location_id",B);if(he)throw he;const ge=w?.map(ht=>ht.product_id)||[],Te=S?.map(ht=>ht.product_id)||[],Ye=ge.filter(ht=>Te.includes(ht));if(Ye.length===0){Ue([]);return}const{data:Pe,error:dt}=await A.from("products").select("*").eq("is_active",!0).in("id",Ye).order("name");if(dt)throw dt;Ue(Pe||[])}catch(w){console.error("Erreur chargement produits disponibles:",w),Ue([])}},mn=async B=>{if(B.preventDefault(),re.length===0){alert("Veuillez ajouter au moins un produit");return}if(re.filter(ae=>ae.quantity<=0).length>0){alert("Toutes les quantités doivent être supérieures à 0");return}try{for(const ae of re){if(!(await A.from("product_prices").select("id").eq("product_id",ae.product_id).eq("storage_location_id",$.to_storage_id).maybeSingle()).data){const Pe=d.find(dt=>dt.id===$.to_storage_id);alert(`Le produit "${ae.product_name}" n'est pas configuré pour le dépôt "${Pe?.name}". Configurez-le d'abord dans la fiche produit.`);return}const he=await A.from("product_stocks").select("quantity").eq("product_id",ae.product_id).eq("storage_location_id",$.from_storage_id).maybeSingle();if(!he.data){alert(`Stock source introuvable pour ${ae.product_name}`);return}const ge=parseFloat(he.data.quantity),Te=ge-ae.quantity;await A.from("product_stocks").update({quantity:Te}).eq("product_id",ae.product_id).eq("storage_location_id",$.from_storage_id),await A.from("stock_movements").insert([{product_id:ae.product_id,storage_location_id:$.from_storage_id,movement_type:"transfer",quantity:-ae.quantity,previous_quantity:ge,new_quantity:Te,notes:`Transfert vers ${d.find(Pe=>Pe.id===$.to_storage_id)?.name} - ${$.notes}`}]);const Ye=await A.from("product_stocks").select("quantity").eq("product_id",ae.product_id).eq("storage_location_id",$.to_storage_id).maybeSingle();if(Ye.data){const Pe=parseFloat(Ye.data.quantity),dt=Pe+ae.quantity;await A.from("product_stocks").update({quantity:dt}).eq("product_id",ae.product_id).eq("storage_location_id",$.to_storage_id),await A.from("stock_movements").insert([{product_id:ae.product_id,storage_location_id:$.to_storage_id,movement_type:"transfer",quantity:ae.quantity,previous_quantity:Pe,new_quantity:dt,notes:`Transfert depuis ${d.find(ht=>ht.id===$.from_storage_id)?.name} - ${$.notes}`}])}else await A.from("product_stocks").insert([{product_id:ae.product_id,storage_location_id:$.to_storage_id,quantity:ae.quantity}]),await A.from("stock_movements").insert([{product_id:ae.product_id,storage_location_id:$.to_storage_id,movement_type:"transfer",quantity:ae.quantity,previous_quantity:0,new_quantity:ae.quantity,notes:`Transfert depuis ${d.find(Pe=>Pe.id===$.from_storage_id)?.name} - ${$.notes}`}])}alert("Transferts effectués avec succès"),C(!1),D({from_storage_id:"",to_storage_id:"",notes:""}),we([]),qt()}catch(ae){console.error("Erreur transfert:",ae),alert("Erreur lors du transfert: "+ae.message)}},tn=(B,w)=>{const ae=parseFloat(B),S=parseFloat(w||0);return ae<0?"negative":ae===0?"empty":ae<=S?"low":"ok"};return g?n.jsx("div",{className:"loading",children:"Chargement..."}):n.jsxs("div",{className:"inventory-container",children:[n.jsxs("div",{className:"page-header",children:[n.jsxs("div",{children:[n.jsx("h2",{children:"Gestion des Stocks"}),n.jsxs("div",{className:"filter-group",style:{marginTop:"12px"},children:[n.jsx("label",{style:{fontWeight:"500",marginRight:"8px"},children:"Dépôt de stockage:"}),n.jsxs("select",{value:ne,onChange:B=>K(B.target.value),style:{padding:"8px 12px",fontSize:"14px",borderRadius:"6px",border:"1px solid #d1d5db",minWidth:"250px"},children:[n.jsx("option",{value:"",children:"Sélectionner un dépôt"}),d.map(B=>n.jsxs("option",{value:B.id,children:[B.name," (",B.code,")"]},B.id))]})]})]}),n.jsxs("div",{style:{display:"flex",gap:"12px"},children:[o("inventory","validate")&&n.jsx("button",{className:"btn-primary",onClick:yn,disabled:!ne,children:"Inventaire"}),o("inventory","create")&&n.jsx("button",{className:"btn-primary",onClick:gt,disabled:!ne||d.find(B=>B.id===ne)?.code==="CASSE",style:{background:"#10b981"},title:d.find(B=>B.id===ne)?.code==="CASSE"?"Les mouvements de stock ne sont pas autorisés pour ce dépôt":"",children:"Mouvement de stock"}),o("inventory","view_history")&&n.jsx("button",{className:"btn-primary",onClick:Vt,style:{background:"#f59e0b"},children:"Historique inventaires"})]})]}),n.jsx("div",{className:"filters",children:n.jsx("div",{className:"filter-group",children:n.jsxs("label",{children:[n.jsx("input",{type:"checkbox",checked:le,onChange:B=>Ee(B.target.checked),style:{marginRight:"8px"}}),"Afficher uniquement les ingrédients"]})})}),ne?n.jsx("div",{className:"stocks-table",children:n.jsxs("table",{children:[n.jsx("thead",{children:n.jsxs("tr",{children:[n.jsxs("th",{onClick:()=>We("product_name"),style:{cursor:"pointer"},children:["Produit ",_e==="product_name"&&(Ce==="asc"?"↑":"↓")]}),n.jsxs("th",{onClick:()=>We("reference"),style:{cursor:"pointer"},children:["Référence ",_e==="reference"&&(Ce==="asc"?"↑":"↓")]}),n.jsxs("th",{onClick:()=>We("pos_name"),style:{cursor:"pointer"},children:["Point de vente ",_e==="pos_name"&&(Ce==="asc"?"↑":"↓")]}),n.jsxs("th",{onClick:()=>We("storage_name"),style:{cursor:"pointer"},children:["Dépôt ",_e==="storage_name"&&(Ce==="asc"?"↑":"↓")]}),n.jsxs("th",{onClick:()=>We("quantity"),style:{cursor:"pointer"},children:["Quantité ",_e==="quantity"&&(Ce==="asc"?"↑":"↓")]}),n.jsx("th",{children:"Unité"}),n.jsxs("th",{onClick:()=>We("last_inventory_date"),style:{cursor:"pointer"},children:["Dernier inventaire ",_e==="last_inventory_date"&&(Ce==="asc"?"↑":"↓")]}),n.jsx("th",{children:"Statut"}),n.jsx("th",{children:"Actions"})]})}),n.jsx("tbody",{children:i.length===0?n.jsx("tr",{children:n.jsx("td",{colSpan:"9",style:{textAlign:"center",padding:"40px"},children:"Aucun stock trouvé"})}):i.map(B=>({...B,product_name:B.products?.name||"",reference:B.products?.reference||"",pos_name:B.sales_points?.name||"",storage_name:B.storage_locations?.name||""})).sort((B,w)=>{let ae=B[_e]||"",S=w[_e]||"";return typeof ae=="string"&&(ae=ae.toLowerCase(),S=S.toLowerCase()),ae<S?Ce==="asc"?-1:1:ae>S?Ce==="asc"?1:-1:0}).map(B=>n.jsxs("tr",{children:[n.jsx("td",{children:B.products?.name||"-"}),n.jsx("td",{children:B.products?.reference||"-"}),n.jsx("td",{children:B.sales_points?.name||"-"}),n.jsx("td",{children:B.storage_locations?.name||"-"}),n.jsx("td",{className:`quantity ${tn(B.quantity,B.products?.min_stock_alert)}`,children:parseFloat(B.quantity).toFixed(2)}),n.jsx("td",{children:B.products?.unit||"unité"}),n.jsx("td",{children:B.last_inventory_date?new Date(B.last_inventory_date).toLocaleDateString("fr-FR"):"-"}),n.jsx("td",{children:n.jsx("span",{className:`status-badge ${tn(B.quantity,B.products?.min_stock_alert)}`,children:tn(B.quantity,B.products?.min_stock_alert)==="negative"?"Négatif":tn(B.quantity,B.products?.min_stock_alert)==="empty"?"Vide":tn(B.quantity,B.products?.min_stock_alert)==="low"?"Faible":"OK"})}),n.jsx("td",{children:n.jsx("button",{className:"btn-history",onClick:()=>Dt(B.product_id,B.storage_location_id),style:{background:"#3b82f6"},children:"Historique"})})]},B.id))})]})}):n.jsx("div",{style:{textAlign:"center",padding:"60px 20px",color:"#6b7280"},children:n.jsx("p",{style:{fontSize:"16px"},children:"Veuillez sélectionner un dépôt de stockage pour afficher les stocks"})}),p&&n.jsx("div",{className:"modal-overlay",onClick:()=>_(!1),children:n.jsxs("div",{className:"modal-content",style:{maxWidth:"1000px"},onClick:B=>B.stopPropagation(),children:[n.jsxs("div",{className:"modal-header",children:[n.jsxs("h3",{children:["Saisie d'Inventaire - ",d.find(B=>B.id===ne)?.name]}),n.jsx("button",{className:"close-btn",onClick:()=>_(!1),children:"×"})]}),n.jsx("div",{className:"modal-body",children:fe?n.jsxs(n.Fragment,{children:[n.jsx("p",{style:{marginBottom:"20px",color:"#6b7280",fontWeight:"500"},children:"Résultats de l'inventaire - Vérifiez les écarts avant validation"}),n.jsx("div",{className:"history-table",children:n.jsxs("table",{children:[n.jsx("thead",{children:n.jsxs("tr",{children:[n.jsx("th",{children:"Produit"}),n.jsx("th",{children:"Stock système"}),n.jsx("th",{children:"Quantité comptée"}),n.jsx("th",{children:"Écart"})]})}),n.jsx("tbody",{children:R.map(B=>n.jsxs("tr",{children:[n.jsx("td",{children:B.products?.name||"-"}),n.jsx("td",{children:B.currentQuantity.toFixed(2)}),n.jsx("td",{children:B.countedQuantity.toFixed(2)}),n.jsxs("td",{className:B.difference<0?"negative":B.difference>0?"positive":"",children:[B.difference>0?"+":"",B.difference.toFixed(2)]})]},B.product_id||B.id))})]})}),n.jsxs("div",{className:"modal-actions",style:{marginTop:"20px"},children:[n.jsx("button",{className:"btn-secondary",onClick:()=>be(!1),children:"Retour à la saisie"}),n.jsx("button",{className:"btn-primary",onClick:ln,children:"Valider l'inventaire"})]})]}):n.jsxs(n.Fragment,{children:[n.jsx("p",{style:{marginBottom:"20px",color:"#6b7280"},children:"Saisissez les quantités comptées physiquement pour chaque produit."}),n.jsx("div",{className:"history-table",children:n.jsxs("table",{children:[n.jsx("thead",{children:n.jsxs("tr",{children:[n.jsx("th",{children:"Produit"}),n.jsx("th",{children:"Référence"}),n.jsx("th",{children:"Quantité comptée"})]})}),n.jsx("tbody",{children:R.map((B,w)=>n.jsxs("tr",{children:[n.jsx("td",{children:B.products?.name||"-"}),n.jsx("td",{children:B.products?.reference||"-"}),n.jsx("td",{children:n.jsx("input",{type:"number",step:"0.01",value:B.countedQuantity,onChange:ae=>{const S=parseFloat(ae.target.value)||0,he=[...R];he[w].countedQuantity=S,he[w].difference=S-B.currentQuantity,X(he)},style:{width:"120px",padding:"6px",textAlign:"right"}})})]},B.product_id||B.id))})]})}),n.jsxs("div",{className:"modal-actions",style:{marginTop:"20px"},children:[n.jsx("button",{className:"btn-secondary",onClick:()=>_(!1),children:"Annuler"}),n.jsx("button",{className:"btn-primary",onClick:()=>be(!0),children:"Calculer les écarts"})]})]})})]})}),j&&n.jsx("div",{className:"modal-overlay",onClick:()=>C(!1),children:n.jsxs("div",{className:"modal-content",onClick:B=>B.stopPropagation(),children:[n.jsxs("div",{className:"modal-header",children:[n.jsx("h3",{children:"Mouvement de Stock (Transfert inter-dépôts)"}),n.jsx("button",{className:"close-btn",onClick:()=>C(!1),children:"×"})]}),n.jsxs("form",{onSubmit:mn,children:[n.jsxs("div",{className:"form-group",children:[n.jsx("label",{children:"Dépôt source"}),n.jsx("input",{type:"text",value:d.find(B=>B.id===$.from_storage_id)?.name||"",disabled:!0,style:{background:"#f3f4f6",cursor:"not-allowed"}})]}),n.jsxs("div",{className:"form-group",children:[n.jsx("label",{children:"Dépôt destination *"}),n.jsxs("select",{value:$.to_storage_id,onChange:B=>{const w=B.target.value;D({...$,to_storage_id:w}),Ht(w)},required:!0,disabled:(()=>{const B=d.find(w=>w.id===$.from_storage_id);return B?.name!=="Economat Général"&&B?.name!=="Casse / Périmés"})(),style:(()=>{const B=d.find(w=>w.id===$.from_storage_id);return B?.name!=="Economat Général"&&B?.name!=="Casse / Périmés"?{background:"#f3f4f6",cursor:"not-allowed"}:{}})(),children:[n.jsx("option",{value:"",children:"Sélectionner le dépôt destination"}),d.find(w=>w.id===$.from_storage_id)?.name==="Economat Général"?d.filter(w=>w.id!==$.from_storage_id).map(w=>n.jsx("option",{value:w.id,children:w.name},w.id)):d.filter(w=>w.name==="Casse / Périmés"&&w.id!==$.from_storage_id).map(w=>n.jsx("option",{value:w.id,children:w.name},w.id))]})]}),n.jsxs("div",{className:"form-group",children:[n.jsx("label",{children:"Rechercher un produit"}),n.jsx("div",{style:{display:"flex",gap:"8px"},children:n.jsx("input",{type:"text",placeholder:"Nom ou référence du produit...",value:Ne,onChange:B=>nt(B.target.value),style:{flex:1}})}),Ne&&!$.to_storage_id&&n.jsx("div",{style:{padding:"12px",marginTop:"8px",background:"#FEF3C7",border:"1px solid #F59E0B",borderRadius:"6px",color:"#92400E",fontSize:"14px"},children:"Veuillez d'abord sélectionner un dépôt de destination"}),Ne&&$.to_storage_id&&n.jsx("div",{style:{maxHeight:"200px",overflowY:"auto",border:"1px solid #d1d5db",borderRadius:"6px",marginTop:"8px",background:"white"},children:(()=>{const B=Le.filter(w=>w.name.toLowerCase().includes(Ne.toLowerCase())||w.reference&&w.reference.toLowerCase().includes(Ne.toLowerCase())).slice(0,10);return B.length===0?n.jsx("div",{style:{padding:"12px",color:"#6b7280",fontSize:"14px",textAlign:"center"},children:"Aucun produit trouvé. Vérifiez que le produit est configuré pour les deux dépôts."}):B.map(w=>n.jsxs("div",{onClick:()=>on(w.id),style:{padding:"10px",cursor:"pointer",borderBottom:"1px solid #e5e7eb",":hover":{background:"#f3f4f6"}},onMouseEnter:ae=>ae.currentTarget.style.background="#f3f4f6",onMouseLeave:ae=>ae.currentTarget.style.background="white",children:[n.jsx("div",{style:{fontWeight:"500"},children:w.name}),n.jsxs("div",{style:{fontSize:"12px",color:"#6b7280"},children:["Réf: ",w.reference||"N/A"]})]},w.id))})()})]}),re.length>0&&n.jsxs("div",{className:"form-group",children:[n.jsx("label",{children:"Produits à transférer"}),n.jsx("div",{className:"history-table",children:n.jsxs("table",{children:[n.jsx("thead",{children:n.jsxs("tr",{children:[n.jsx("th",{children:"Produit"}),n.jsx("th",{children:"Référence"}),n.jsx("th",{children:"Quantité"}),n.jsx("th",{children:"Actions"})]})}),n.jsx("tbody",{children:re.map(B=>n.jsxs("tr",{children:[n.jsx("td",{children:B.product_name}),n.jsx("td",{children:B.product_reference||"-"}),n.jsx("td",{children:n.jsx("input",{type:"number",step:"0.01",value:B.quantity,onChange:w=>St(B.id,w.target.value),style:{width:"100px",padding:"6px",textAlign:"right"},required:!0})}),n.jsx("td",{children:n.jsx("button",{type:"button",onClick:()=>$n(B.id),style:{background:"#ef4444",color:"white",border:"none",padding:"6px 12px",borderRadius:"6px",cursor:"pointer",fontSize:"13px"},children:"Retirer"})})]},B.id))})]})})]}),n.jsxs("div",{className:"form-group",children:[n.jsx("label",{children:"Notes"}),n.jsx("textarea",{value:$.notes,onChange:B=>D({...$,notes:B.target.value}),rows:"3",style:{width:"100%",padding:"8px",borderRadius:"6px",border:"1px solid #d1d5db"}})]}),n.jsxs("div",{className:"modal-actions",children:[n.jsx("button",{type:"button",className:"btn-secondary",onClick:()=>C(!1),children:"Annuler"}),n.jsxs("button",{type:"submit",className:"btn-primary",children:["Effectuer les transferts (",re.length,")"]})]})]})]})}),N&&V&&n.jsx("div",{className:"modal-overlay",onClick:()=>k(!1),children:n.jsxs("div",{className:"modal-content history-modal",onClick:B=>B.stopPropagation(),children:[n.jsxs("div",{className:"modal-header",children:[n.jsx("h3",{children:"Historique des mouvements de stock"}),n.jsx("button",{className:"close-btn",onClick:()=>k(!1),children:"×"})]}),n.jsxs("div",{className:"modal-body",children:[n.jsxs("div",{className:"history-filters",children:[n.jsxs("div",{className:"filter-group",children:[n.jsx("label",{children:"Date de début"}),n.jsx("input",{type:"date",value:T,onChange:B=>ce(B.target.value)})]}),n.jsxs("div",{className:"filter-group",children:[n.jsx("label",{children:"Date de fin"}),n.jsx("input",{type:"date",value:se,onChange:B=>ee(B.target.value)})]}),n.jsxs("div",{className:"quick-filters",style:{display:"flex",gap:"8px",flexWrap:"wrap"},children:[n.jsx("button",{className:"btn-quick-filter",onClick:()=>{const B=new Date().toISOString().split("T")[0];ce(B),ee(B);const w=i.find(ae=>ae.product_id===V.productId&&ae.storage_location_id===V.storageLocationId);w&&setTimeout(()=>Dt(w.product_id,w.storage_location_id),0)},style:{background:"#10b981",color:"white",padding:"8px 12px",border:"none",borderRadius:"6px",cursor:"pointer",fontWeight:"500",fontSize:"13px"},children:"Aujourd'hui"}),n.jsx("button",{className:"btn-quick-filter",onClick:()=>{const B=new Date;B.setDate(B.getDate()-1);const w=B.toISOString().split("T")[0];ce(w),ee(w);const ae=i.find(S=>S.product_id===V.productId&&S.storage_location_id===V.storageLocationId);ae&&setTimeout(()=>Dt(ae.product_id,ae.storage_location_id),0)},style:{background:"#3b82f6",color:"white",padding:"8px 12px",border:"none",borderRadius:"6px",cursor:"pointer",fontWeight:"500",fontSize:"13px"},children:"J-1"}),n.jsx("button",{className:"btn-quick-filter",onClick:()=>{const B=new Date;B.setDate(B.getDate()-2);const w=B.toISOString().split("T")[0];ce(w),ee(w);const ae=i.find(S=>S.product_id===V.productId&&S.storage_location_id===V.storageLocationId);ae&&setTimeout(()=>Dt(ae.product_id,ae.storage_location_id),0)},style:{background:"#3b82f6",color:"white",padding:"8px 12px",border:"none",borderRadius:"6px",cursor:"pointer",fontWeight:"500",fontSize:"13px"},children:"J-2"}),n.jsx("button",{className:"btn-quick-filter",onClick:()=>{const B=new Date,w=new Date;w.setDate(B.getDate()-7),ce(w.toISOString().split("T")[0]),ee(B.toISOString().split("T")[0]);const ae=i.find(S=>S.product_id===V.productId&&S.storage_location_id===V.storageLocationId);ae&&setTimeout(()=>Dt(ae.product_id,ae.storage_location_id),0)},style:{background:"#8b5cf6",color:"white",padding:"8px 12px",border:"none",borderRadius:"6px",cursor:"pointer",fontWeight:"500",fontSize:"13px"},children:"7 derniers jours"}),n.jsx("button",{className:"btn-quick-filter",onClick:()=>{const B=new Date,w=new Date;w.setDate(B.getDate()-30),ce(w.toISOString().split("T")[0]),ee(B.toISOString().split("T")[0]);const ae=i.find(S=>S.product_id===V.productId&&S.storage_location_id===V.storageLocationId);ae&&setTimeout(()=>Dt(ae.product_id,ae.storage_location_id),0)},style:{background:"#8b5cf6",color:"white",padding:"8px 12px",border:"none",borderRadius:"6px",cursor:"pointer",fontWeight:"500",fontSize:"13px"},children:"30 derniers jours"})]}),n.jsx("button",{className:"btn-filter",onClick:()=>{const B=i.find(w=>w.product_id===V.productId&&w.storage_location_id===V.storageLocationId);B&&Dt(B.product_id,B.storage_location_id)},children:"Rechercher"})]}),U.length===0?n.jsx("p",{style:{textAlign:"center",padding:"40px",color:"#6b7280"},children:"Aucun mouvement de stock pour cette période"}):n.jsx("div",{className:"history-table",children:n.jsxs("table",{children:[n.jsx("thead",{children:n.jsxs("tr",{children:[n.jsx("th",{children:"Date"}),n.jsx("th",{children:"Type"}),n.jsx("th",{children:"Point de vente"}),n.jsx("th",{children:"Quantité"}),n.jsx("th",{children:"Stock avant"}),n.jsx("th",{children:"Stock après"}),n.jsx("th",{children:"Référence"}),n.jsx("th",{children:"Notes"})]})}),n.jsx("tbody",{children:U.map(B=>{const w={sale:"Vente",restock:"Réappro",inventory_adjustment:"Inventaire",transfer:"Transfert",breakage:"Casse/Déchet"};return n.jsxs("tr",{children:[n.jsx("td",{children:new Date(B.created_at).toLocaleString("fr-FR")}),n.jsx("td",{children:n.jsx("span",{className:`movement-type ${B.movement_type}`,children:w[B.movement_type]||B.movement_type})}),n.jsx("td",{children:B.sales_points?.name||"-"}),n.jsxs("td",{className:parseFloat(B.quantity)<0?"negative":"positive",children:[parseFloat(B.quantity)>0?"+":"",parseFloat(B.quantity).toFixed(2)]}),n.jsx("td",{children:parseFloat(B.previous_quantity).toFixed(2)}),n.jsx("td",{children:parseFloat(B.new_quantity).toFixed(2)}),n.jsx("td",{children:B.reference||"-"}),n.jsx("td",{children:B.notes||"-"})]},B.id)})})]})})]})]})}),P&&n.jsx("div",{className:"modal-overlay",onClick:()=>E(!1),children:n.jsxs("div",{className:"modal-content",style:{maxWidth:"1200px"},onClick:B=>B.stopPropagation(),children:[n.jsxs("div",{className:"modal-header",children:[n.jsx("h3",{children:"Historique des Inventaires"}),n.jsx("button",{className:"close-btn",onClick:()=>E(!1),children:"×"})]}),n.jsxs("div",{className:"modal-body",children:[n.jsx("div",{className:"history-table",children:n.jsxs("table",{children:[n.jsx("thead",{children:n.jsxs("tr",{children:[n.jsx("th",{children:"Date"}),n.jsx("th",{children:"Dépôt"}),n.jsx("th",{children:"Statut"}),n.jsx("th",{children:"Articles"}),n.jsx("th",{children:"Écarts"}),n.jsx("th",{children:"Notes"}),n.jsx("th",{children:"Actions"})]})}),n.jsx("tbody",{children:M.length===0?n.jsx("tr",{children:n.jsx("td",{colSpan:"7",style:{textAlign:"center",padding:"40px",color:"#6b7280"},children:"Aucun inventaire trouvé"})}):M.map(B=>n.jsxs("tr",{children:[n.jsx("td",{children:new Date(B.inventory_date).toLocaleString("fr-FR")}),n.jsx("td",{children:B.storage_locations?.name||"-"}),n.jsx("td",{children:n.jsx("span",{className:`status-badge ${B.status==="validated"?"ok":"low"}`,children:B.status==="validated"?"Validé":B.status==="draft"?"Brouillon":"Annulé"})}),n.jsx("td",{children:B.total_items}),n.jsx("td",{children:n.jsx("span",{className:B.total_discrepancies>0?"negative":"",children:B.total_discrepancies})}),n.jsx("td",{children:B.notes||"-"}),n.jsx("td",{children:n.jsx("button",{className:"btn-history",onClick:()=>en(B.id),style:{background:"#3b82f6"},children:"Détails"})})]},B.id))})]})}),q&&n.jsxs("div",{style:{marginTop:"30px",borderTop:"2px solid #e5e7eb",paddingTop:"20px"},children:[n.jsx("h4",{style:{marginBottom:"15px"},children:"Détails de l'inventaire"}),n.jsx("div",{className:"history-table",children:n.jsxs("table",{children:[n.jsx("thead",{children:n.jsxs("tr",{children:[n.jsx("th",{children:"Produit"}),n.jsx("th",{children:"Référence"}),n.jsx("th",{children:"Quantité attendue"}),n.jsx("th",{children:"Quantité comptée"}),n.jsx("th",{children:"Écart"}),n.jsx("th",{children:"Unité"})]})}),n.jsx("tbody",{children:q.map(B=>n.jsxs("tr",{children:[n.jsx("td",{children:B.products?.name||"-"}),n.jsx("td",{children:B.products?.reference||"-"}),n.jsx("td",{children:parseFloat(B.expected_quantity).toFixed(2)}),n.jsx("td",{children:parseFloat(B.counted_quantity).toFixed(2)}),n.jsxs("td",{className:parseFloat(B.difference)<0?"negative":parseFloat(B.difference)>0?"positive":"",children:[parseFloat(B.difference)>0?"+":"",parseFloat(B.difference).toFixed(2)]}),n.jsx("td",{children:B.products?.unit||"unité"})]},B.id))})]})}),n.jsx("button",{className:"btn-secondary",onClick:()=>Y(null),style:{marginTop:"15px"},children:"Fermer les détails"})]})]})]})})]})}async function qp(o,i,r,l={},c=null){try{const{error:d}=await A.from("user_action_logs").insert([{employee_id:o,action_type:i,module:r,details:l,ip_address:c}]);d&&console.error("Erreur lors de l'enregistrement du log:",d)}catch(d){console.error("Erreur lors de l'enregistrement du log:",d)}}class Uj{static async printOrder(i,r,l="ticket_cuisine"){try{const d="https://unsatiably-unforbidding-rosella.ngrok-free.dev/print",f=await this.generateTicketHtml(i,l),m=await fetch(d,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({templateHtml:f,printerId:{ticket_cuisine:"CUISINE",ticket_bar:"BAR",ticket_caisse:"CAISSE"}[l]||"CAISSE"})});if(!m.ok){const _=await m.json();throw new Error(_.error||"Print failed")}return{success:!0,message:(await m.json()).message}}catch(c){return console.error(`Error printing ${l}:`,c),{success:!1,message:c.message,error:c}}}static async generateTicketHtml(i,r){const{data:l}=await A.from("orders").select(`
        *,
        order_items(*),
        sales_points(name)
      `).eq("id",i).single();if(!l)return"<div>Commande introuvable</div>";const c=l.order_items||[],d=new Date(l.created_at).toLocaleString("fr-FR");let f=`
      <div class="header">
        ${r==="ticket_cuisine"?"CUISINE":r==="ticket_bar"?"BAR":"TICKET"}
      </div>
      <div class="line">Point de vente: ${l.sales_points?.name||"N/A"}</div>
      <div class="line">N° commande: ${l.order_number}</div>
      <div class="line">Date: ${d}</div>
      <div class="separator"></div>
    `;return c.forEach(g=>{f+=`<div class="line">${g.quantity}x ${g.product_name} - ${g.unit_price.toFixed(2)}€</div>`}),f+=`
      <div class="separator"></div>
      <div class="total">TOTAL: ${l.total_amount.toFixed(2)}€</div>
    `,f}static async printMultipleTickets(i,r,l=["ticket_cuisine","ticket_bar","ticket_caisse"]){const c=[];for(const d of l)try{const f=await this.printOrder(i,r,d);c.push({templateType:d,...f})}catch(f){c.push({templateType:d,success:!1,message:f.message})}return c}static async checkService(){try{const r=await fetch("https://unsatiably-unforbidding-rosella.ngrok-free.dev/health");if(!r.ok)throw new Error("Service unavailable");return await r.json()}catch(i){return console.error("Print service check failed:",i),{status:"error",error:i.message}}}static async getPrinters(){try{const r=await fetch("https://unsatiably-unforbidding-rosella.ngrok-free.dev/printers");if(!r.ok)throw new Error("Failed to fetch printers");return await r.json()}catch(i){return console.error("Error fetching printers:",i),{success:!1,printers:[]}}}static async getMapping(){try{const r=await fetch("https://unsatiably-unforbidding-rosella.ngrok-free.dev/mapping");if(!r.ok)throw new Error("Failed to fetch mapping");return await r.json()}catch(i){return console.error("Error fetching mapping:",i),{success:!1,mapping:{}}}}static async setMapping(i,r){try{const c=await fetch("https://unsatiably-unforbidding-rosella.ngrok-free.dev/mapping",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({logicalPrinterId:i,physicalPrinterName:r})});if(!c.ok)throw new Error("Failed to set mapping");return await c.json()}catch(l){return console.error("Error setting mapping:",l),{success:!1,error:l.message}}}}function Bj({cart:o,totals:i,onClose:r,onSplit:l}){const[c,d]=y.useState("amount"),[f,g]=y.useState([{id:1,amount:""},{id:2,amount:""}]),[m,p]=y.useState([{id:1,items:[]},{id:2,items:[]}]);y.useEffect(()=>{if(c==="product"){const M=[{id:1,items:o.map(G=>({...G,splitQuantity:0}))},{id:2,items:o.map(G=>({...G,splitQuantity:0}))}];p(M)}},[c,o]);const _=()=>{const M=Math.max(...f.map(G=>G.id))+1;g([...f,{id:M,amount:""}])},j=M=>{f.length>2&&g(f.filter(G=>G.id!==M))},C=(M,G)=>{g(f.map(q=>q.id===M?{...q,amount:G}:q))},N=()=>{const M=Math.max(...m.map(G=>G.id))+1;p([...m,{id:M,items:o.map(G=>({...G,splitQuantity:0}))}])},k=M=>{m.length>2&&p(m.filter(G=>G.id!==M))},P=(M,G,q)=>{p(m.map(Y=>Y.id===M?{...Y,items:Y.items.map(T=>T.product_id===G?{...T,splitQuantity:Math.min(parseInt(q)||0,T.quantity)}:T)}:Y))},E=()=>{const M=f.reduce((G,q)=>G+(parseFloat(q.amount)||0),0);return Math.abs(M-i.total)>.01?(alert(`Le total des montants (${M.toFixed(0)} FCFA) doit être égal au total du ticket (${i.total.toFixed(0)} FCFA)`),!1):!0},V=()=>{for(const M of o){const G=m.reduce((q,Y)=>{const T=Y.items.find(ce=>ce.product_id===M.product_id);return q+(T?.splitQuantity||0)},0);if(G!==M.quantity)return alert(`Le produit "${M.product_name}" doit avoir toutes ses quantités réparties (${G}/${M.quantity})`),!1}return!0},L=()=>{if(c==="amount"){if(!E())return;const M=f.filter(G=>parseFloat(G.amount)>0).map(G=>({amount:parseFloat(G.amount),items:o.map(q=>{const Y=parseFloat(G.amount)/i.total;return{...q,quantity:Math.round(q.quantity*Y*100)/100}})}));l(M)}else{if(!V())return;const M=m.map(G=>{const q=G.items.filter(T=>T.splitQuantity>0).map(T=>({...T,quantity:T.splitQuantity}));return{amount:q.reduce((T,ce)=>T+ce.unit_price*ce.quantity,0),items:q}}).filter(G=>G.items.length>0);l(M)}},U=M=>{const G=o.find(Y=>Y.product_id===M),q=m.reduce((Y,T)=>{const ce=T.items.find(se=>se.product_id===M);return Y+(ce?.splitQuantity||0)},0);return G.quantity-q},O=()=>f.reduce((M,G)=>M+(parseFloat(G.amount)||0),0);return!i||typeof i.total>"u"?n.jsx("div",{className:"modal-overlay",onClick:r,children:n.jsxs("div",{className:"modal-content split-modal",onClick:M=>M.stopPropagation(),children:[n.jsxs("div",{className:"modal-header",children:[n.jsx("h3",{children:"Erreur"}),n.jsx("button",{className:"close-btn",onClick:r,children:"×"})]}),n.jsxs("div",{style:{padding:"20px",textAlign:"center"},children:[n.jsx("p",{children:"Impossible de diviser un ticket vide."}),n.jsx("button",{onClick:r,style:{marginTop:"15px",padding:"10px 20px",background:"#10b981",color:"white",border:"none",borderRadius:"8px",cursor:"pointer"},children:"Fermer"})]})]})}):n.jsx("div",{className:"modal-overlay",onClick:r,children:n.jsxs("div",{className:"modal-content split-modal",onClick:M=>M.stopPropagation(),children:[n.jsxs("div",{className:"modal-header",children:[n.jsx("h3",{children:"Diviser le ticket"}),n.jsx("button",{className:"close-btn",onClick:r,children:"×"})]}),n.jsxs("div",{className:"split-mode-toggle",children:[n.jsx("button",{className:c==="amount"?"active":"",onClick:()=>d("amount"),children:"Par montant"}),n.jsx("button",{className:c==="product"?"active":"",onClick:()=>d("product"),children:"Par produit"})]}),n.jsx("div",{className:"split-info",children:n.jsxs("div",{className:"info-item",children:[n.jsx("span",{children:"Total du ticket:"}),n.jsxs("strong",{children:[i.total.toFixed(0)," FCFA"]})]})}),n.jsx("div",{className:"split-content",children:c==="amount"?n.jsxs("div",{className:"amount-splits",children:[f.map((M,G)=>n.jsxs("div",{className:"split-row",children:[n.jsxs("label",{children:["Ticket ",G+1,":"]}),n.jsx("input",{type:"number",value:M.amount,onChange:q=>C(M.id,q.target.value),placeholder:"Montant",min:"0"}),n.jsx("span",{children:"FCFA"}),f.length>2&&n.jsx("button",{className:"btn-remove-split",onClick:()=>j(M.id),children:"×"})]},M.id)),n.jsxs("div",{className:"split-summary",children:[n.jsx("span",{children:"Total réparti:"}),n.jsxs("strong",{className:Math.abs(O()-i.total)<.01?"valid":"invalid",children:[O().toFixed(0)," FCFA"]})]}),n.jsx("button",{className:"btn-add-split",onClick:_,children:"+ Ajouter un ticket"})]}):n.jsxs("div",{className:"product-splits",children:[m.map((M,G)=>n.jsxs("div",{className:"product-split-section",children:[n.jsxs("div",{className:"split-section-header",children:[n.jsxs("h4",{children:["Ticket ",G+1]}),m.length>2&&n.jsx("button",{className:"btn-remove-split",onClick:()=>k(M.id),children:"×"})]}),M.items.map(q=>n.jsxs("div",{className:"product-split-row",children:[n.jsxs("div",{className:"product-info",children:[n.jsx("span",{className:"product-name",children:q.product_name}),n.jsxs("span",{className:"product-available",children:["(reste: ",U(q.product_id),")"]})]}),n.jsx("input",{type:"number",value:q.splitQuantity||"",onChange:Y=>P(M.id,q.product_id,Y.target.value),placeholder:"0",min:"0",max:q.quantity})]},q.product_id)),n.jsxs("div",{className:"split-total",children:["Total: ",M.items.reduce((q,Y)=>q+Y.unit_price*(Y.splitQuantity||0),0).toFixed(0)," FCFA"]})]},M.id)),n.jsx("button",{className:"btn-add-split",onClick:N,children:"+ Ajouter un ticket"})]})}),n.jsxs("div",{className:"modal-actions",children:[n.jsx("button",{className:"btn-secondary",onClick:r,children:"Annuler"}),n.jsx("button",{className:"btn-primary",onClick:L,children:"Diviser et créer les tickets"})]})]})})}function _g(){const{user:o}=$s(),i=Qr(),[r,l]=y.useState([]),[c,d]=y.useState(null),[f,g]=y.useState(null),[m,p]=y.useState([]),[_,j]=y.useState([]),[C,N]=y.useState("all"),[k,P]=y.useState([]),[E,V]=y.useState(!1),[L,U]=y.useState({}),[O,M]=y.useState("cash"),[G,q]=y.useState(""),[Y,T]=y.useState(!0),[ce,se]=y.useState([]),[ee,_e]=y.useState(null),[ue,Ce]=y.useState([]),[F,ne]=y.useState(null),[K,le]=y.useState(!1),[Ee,R]=y.useState(""),[X,fe]=y.useState({first_name:"",last_name:"",phone:"",email:"",company_name:"",type:"individual"}),[be,$]=y.useState([]),[D,re]=y.useState(null),[we,Ne]=y.useState(!1),[nt,Le]=y.useState(null),[Ue,lt]=y.useState(null),[We,qt]=y.useState(!1),[Dt,yn]=y.useState({}),[ln,Vt]=y.useState(null),[en,gt]=y.useState(""),[on,$n]=y.useState(null),[St,Ht]=y.useState([]),[mn,tn]=y.useState(!1),[B,w]=y.useState(null),[ae,S]=y.useState(""),[he,ge]=y.useState(!1),[Te,Ye]=y.useState(!1),[Pe,dt]=y.useState("hold"),[ht,Ut]=y.useState([]),[Lt,Et]=y.useState("draft"),[Tt,Bt]=y.useState(!1),[Gt,jn]=y.useState(!1),[wn,gs]=y.useState(""),[Pa,ca]=y.useState(""),[Ii,ea]=y.useState(!1),[ua,nn]=y.useState(null),[vs,Nn]=y.useState(!1);y.useEffect(()=>{Is()},[]),y.useEffect(()=>{c&&(Vs(),In(),wt(),Yt(),I(),ve())},[c]);const Is=async()=>{try{const{data:x,error:J}=await A.from("sales_points").select("*").order("name");if(J)throw J;l(x||[]),T(!1)}catch(x){console.error("Erreur chargement points de vente:",x),T(!1)}},Vs=async()=>{try{const x=new Date().toISOString().split("T")[0],{data:J}=await A.from("pos_sessions").select("*").eq("sales_point_id",c.id).eq("employee_id",o.id).eq("status","active").gte("opened_at",`${x}T00:00:00`).maybeSingle();if(J)g(J);else{const xe=parseFloat(prompt("Montant en caisse à l'ouverture (FCFA):","0"))||0,{data:je,error:Se}=await A.from("pos_sessions").insert([{sales_point_id:c.id,employee_id:o.id,opened_at:new Date().toISOString(),opening_balance:xe,status:"active"}]).select().single();if(Se)throw Se;g(je),await qp({employee_id:o.id,action_type:"POS_SESSION_OPENED",entity_type:"pos_session",entity_id:je.id,details:`Session ouverte pour ${c.name} avec ${xe} FCFA`,pos_id:c.id})}}catch(x){console.error("Erreur session:",x),alert("Erreur lors de la gestion de la session")}},In=async()=>{try{const{data:x,error:J}=await A.from("categories").select("*").order("name");if(J)throw J;p(x||[])}catch(x){console.error("Erreur chargement catégories:",x)}},wt=async()=>{try{const{data:x,error:J}=await A.from("products").select(`
          *,
          product_prices!inner(
            sales_point_id,
            selling_price
          ),
          product_types!inner(
            can_be_sold
          )
        `).eq("product_prices.sales_point_id",c.id).eq("product_types.can_be_sold",!0).order("name");if(J)throw J;const xe=(x||[]).map(je=>({...je,selling_price:je.product_prices?.[0]?.selling_price||0}));j(xe)}catch(x){console.error("Erreur chargement produits:",x)}},Yt=async()=>{try{const{data:x,error:J}=await A.from("restaurant_tables").select("*").eq("sales_point_id",c.id).order("table_number");if(J)throw J;se(x||[])}catch(x){console.error("Erreur chargement tables:",x)}},I=async()=>{try{const{data:x,error:J}=await A.from("clients").select("*").order("created_at",{ascending:!1});if(J)throw J;Ce(x||[])}catch(x){console.error("Erreur chargement clients:",x)}},ve=async()=>{try{const{data:x,error:J}=await A.from("orders").select("*, order_items(*), restaurant_tables(table_number), clients(first_name, last_name, company_name, type)").eq("sales_point_id",c.id).eq("payment_status","pending").neq("status","voided").order("created_at",{ascending:!1});if(J)throw J;$(x||[])}catch(x){console.error("Erreur chargement tickets en attente:",x)}},Me=async()=>{try{const{data:x,error:J}=await A.from("orders").select("*, order_items(*), restaurant_tables(table_number), clients(first_name, last_name, company_name, type)").eq("sales_point_id",c.id).order("created_at",{ascending:!1}).limit(100);if(J)throw J;Ut(x||[])}catch(x){console.error("Erreur chargement tickets:",x)}},Ae=x=>{const J=k.find(xe=>xe.product_id===x.id);P(J?k.map(xe=>xe.product_id===x.id?{...xe,quantity:xe.quantity+1}:xe):[...k,{product_id:x.id,product_name:x.name,unit_price:x.selling_price,quantity:1,tax_rate:x.vat_rate||0}])},Re=x=>{P(k.filter(J=>J.product_id!==x))},pe=x=>{if(!D){alert("Cette ligne ne peut pas être annulée car la commande n'est pas encore validée. Utilisez le bouton de suppression.");return}w(x),S(""),tn(!0)},ye=()=>{P(x=>x.map(J=>J.product_id===B.product_id?{...J,pendingCancellation:!0,void_reason:ae||"Non spécifiée"}:J)),tn(!1),w(null),S("")},ke=async x=>{if(St.length!==0)try{for(const J of St){const{data:xe}=await A.from("order_items").select("id").eq("order_id",x).eq("product_id",J.product_id).single();xe&&(await A.from("order_items").update({is_voided:!0}).eq("id",xe.id),await A.from("void_logs").insert([{order_id:x,order_item_id:xe.id,product_name:J.product_name,quantity:J.quantity,unit_price:J.unit_price,total_amount:J.unit_price*J.quantity,voided_by:o.id,void_reason:J.void_reason,sales_point_id:c.id}]))}Ht([])}catch(J){console.error("Erreur traitement annulations:",J)}},Fe=async(x,J,xe=null)=>{console.log("🖨️ BON DE FABRICATION:",{orderNumber:J,items:x,orderId:xe});const je=xe||D;if(!je){console.warn("⚠️ Pas d'order_id disponible pour l'impression");return}try{const Se=await Uj.printMultipleTickets(je,c.id,["ticket_cuisine","ticket_bar","ticket_caisse"]);console.log("📄 Résultats impression:",Se);const Ie=Se.filter($e=>!$e.success);Ie.length>0&&console.error("❌ Échecs impression:",Ie)}catch(Se){console.error("❌ Erreur impression:",Se)}},qe=async(x,J)=>{console.log("🖨️ BON D'ANNULATION:",{orderNumber:J,items:x}),await new Promise(xe=>setTimeout(xe,300))},Oe=async(x,J)=>{if(x.length===0)return!1;await qe(x,J);const xe=[];for(const Se of x){const{data:Ie}=await A.from("order_items").select("*").eq("order_id",D).eq("product_id",Se.product_id).maybeSingle();Ie&&(xe.push(Ie),await A.from("order_items").update({is_voided:!0}).eq("id",Ie.id),await A.from("void_logs").insert([{order_id:D,order_item_id:Ie.id,product_name:Se.product_name,quantity:Se.quantity,unit_price:Se.unit_price,total_amount:Se.unit_price*Se.quantity,voided_by:o.id,void_reason:Se.void_reason,sales_point_id:c.id}]))}await ft(xe,J);const je=k.filter(Se=>!Se.pendingCancellation);return je.length===0?(await A.from("orders").update({status:"voided",payment_status:"cancelled"}).eq("id",D),P([]),re(null),Bt(!1),jn(!1),await ve(),!0):(P(je),jn(!0),!1)},Qe=()=>{let x=0,J=0,xe=0;return k.filter(je=>!je.pendingCancellation).forEach(je=>{const Se=je.unit_price*je.quantity;x+=Se;const $e=je.unit_price/(1+je.tax_rate/100)*je.quantity,De=Se-$e;xe+=$e,J+=De}),{subtotal:parseFloat(xe.toFixed(2)),taxAmount:parseFloat(J.toFixed(2)),total:parseFloat(x.toFixed(2))}},ot=async()=>{const x=Qe(),J=Object.values(L).reduce((xe,je)=>xe+parseFloat(je||0),0);if(Math.abs(J-x.total)>.01){alert(`Montant incomplet !
Attendu: ${x.total.toFixed(0)} FCFA
Reçu: ${J.toFixed(0)} FCFA`);return}try{let xe=D,je=null;if(xe){const Se={status:"completed",payment_status:"paid"};ee&&(Se.table_id=ee.id),F&&(Se.client_id=F.id),await A.from("orders").update(Se).eq("id",xe);const{data:Ie}=await A.from("orders").select("order_number").eq("id",xe).single();je=Ie.order_number}else{const Se={order_number:`ORD-${Date.now()}`,sales_point_id:c.id,pos_session_id:f.id,employee_id:o.id,subtotal:x.subtotal,tax_amount:x.taxAmount,total_amount:x.total,status:"completed",payment_status:"paid",kitchen_status:"sent",sent_to_kitchen_at:new Date().toISOString()};ee&&(Se.table_id=ee.id),F&&(Se.client_id=F.id);const{data:Ie,error:$e}=await A.from("orders").insert([Se]).select().single();if($e)throw $e;xe=Ie.id,je=Ie.order_number;const De=k.map(tt=>{const kt=tt.unit_price*tt.quantity,un=kt/(1+tt.tax_rate/100),dn=kt-un;return{order_id:Ie.id,product_id:tt.product_id,product_name:tt.product_name,quantity:tt.quantity,unit_price:tt.unit_price,subtotal:un,tax_rate:tt.tax_rate,tax_amount:dn,total:kt}}),{data:et}=await A.from("order_items").insert(De).select();await Nt(et,Ie.order_number),await ke(Ie.id)}for(const[Se,Ie]of Object.entries(L))parseFloat(Ie||0)>0&&await A.from("payments").insert([{order_id:xe,payment_method:Se,amount:parseFloat(Ie)}]);if(ee&&(await A.from("restaurant_tables").update({status:"available",current_order_id:null}).eq("id",ee.id),await Yt()),await ve(),await qp({employee_id:o.id,action_type:"PAYMENT_PROCESSED",entity_type:"order",entity_id:xe,details:`Paiement de ${x.total.toFixed(0)} FCFA`,pos_id:c.id}),V(!1),P([]),U({}),ne(null),_e(null),re(null),F){const Se=F.type==="company"?F.company_name:`${F.first_name||""} ${F.last_name||""}`.trim()||"Client";alert(`Vente validée !
Commande N° ${je}
Client: ${Se}
Montant: ${x.total.toFixed(0)} FCFA`)}else alert(`Vente validée !
Commande N° ${je}
Montant: ${x.total.toFixed(0)} FCFA`)}catch(xe){console.error("Erreur traitement paiement:",xe),alert("Erreur lors du traitement du paiement: "+xe.message)}},Nt=async(x,J)=>{try{const{data:xe}=await A.from("sales_points").select("default_storage_location_id").eq("id",c.id).single(),je=xe?.default_storage_location_id;if(!je){console.warn("No default storage location configured for this POS");return}for(const Se of x){const{data:Ie}=await A.from("products").select("is_composed").eq("id",Se.product_id).single();if(Ie?.is_composed){const{data:$e,error:De}=await A.from("product_recipes").select("ingredient_id, quantity").eq("product_id",Se.product_id);if(De)throw De;if(!$e||$e.length===0){console.warn(`No recipe found for composed product: ${Se.product_name}`);continue}for(const et of $e){const tt=et.quantity*Se.quantity,{data:kt,error:un}=await A.from("product_stocks").select("*").eq("product_id",et.ingredient_id).eq("storage_location_id",je).maybeSingle();if(un)throw un;let dn=0,_s=null;if(kt)_s=kt.id,dn=parseFloat(kt.quantity);else{const{data:Ha,error:Ki}=await A.from("product_stocks").insert([{product_id:et.ingredient_id,storage_location_id:je,quantity:0}]).select().single();if(Ki)throw Ki;_s=Ha.id,dn=0}const Ks=dn-tt,{error:ya}=await A.from("product_stocks").update({quantity:Ks,updated_at:new Date().toISOString()}).eq("id",_s);if(ya)throw ya;await A.from("stock_movements").insert([{product_id:et.ingredient_id,storage_location_id:je,movement_type:"sale",quantity:-tt,previous_quantity:dn,new_quantity:Ks,reference:J,pos_id:c.id,notes:`Vente: ${Se.product_name}`}])}}}}catch(xe){throw console.error("Erreur déduction stock:",xe),xe}},ft=async(x,J)=>{try{const{data:xe}=await A.from("sales_points").select("default_storage_location_id").eq("id",c.id).single(),je=xe?.default_storage_location_id;if(!je){console.warn("No default storage location configured for this POS");return}for(const Se of x){const{data:Ie}=await A.from("products").select("is_composed").eq("id",Se.product_id).single();if(Ie?.is_composed){const{data:$e}=await A.from("product_recipes").select("ingredient_id, quantity").eq("product_id",Se.product_id);if(!$e||$e.length===0)continue;for(const De of $e){const et=De.quantity*Se.quantity,{data:tt}=await A.from("product_stocks").select("*").eq("product_id",De.ingredient_id).eq("storage_location_id",je).maybeSingle();if(tt){const kt=parseFloat(tt.quantity),un=kt+et;await A.from("product_stocks").update({quantity:un,updated_at:new Date().toISOString()}).eq("id",tt.id),await A.from("stock_movements").insert([{product_id:De.ingredient_id,storage_location_id:je,movement_type:"adjustment_in",quantity:et,previous_quantity:kt,new_quantity:un,reference:J,pos_id:c.id,notes:`Annulation commande: ${Se.product_name}`}])}}}}}catch(xe){console.error("Erreur restauration stock:",xe)}},ut=()=>{Nn(!0)},xn=()=>{le(!0)},ta=async(x,J)=>{ea(!1),x?Nn(!0):J?le(!0):Vn()},Fa=x=>{_e(x),Nn(!1),ua&&(window.confirm("Voulez-vous également affecter ce ticket à un client ?")?le(!0):Vn())},Gs=x=>{ne(x),le(!1),ua&&Vn()},Vn=()=>{ua==="ticket"?_a():ua==="hold"?Cn():ua==="payment"&&Vi(),nn(null)},_a=async()=>{if(console.log("[POS] handlePrintTicket - Start"),k.length===0){alert("Le panier est vide");return}if(!D&&!ee&&!F){console.log("[POS] No order/table/client - showing assignment modal"),nn("ticket"),ea(!0);return}try{console.log("[POS] currentOrderId:",D);const x=Qe();let J=`ORD-${Date.now()}`;if(D){console.log("[POS] Re-printing existing order");const xe=k.filter(Ie=>Ie.pendingCancellation);if(xe.length>0&&!Gt){const{data:Ie}=await A.from("orders").select("order_number").eq("id",D).single();if(J=Ie.order_number,await Oe(xe,J)){alert("✅ Ticket entièrement annulé !");return}}const{data:je}=await A.from("orders").select("print_count").eq("id",D).single(),Se={subtotal:x.subtotal,tax_amount:x.taxAmount,total_amount:x.total,print_count:(je?.print_count||0)+1,last_printed_at:new Date().toISOString()};await A.from("orders").update(Se).eq("id",D),console.log("[POS] Order updated, print complete"),alert("✅ Ticket réimprimé !"),console.log("[POS] handlePrintTicket - End (success)")}else{console.log("[POS] Creating new order");const xe={order_number:J,sales_point_id:c.id,pos_session_id:f.id,employee_id:o.id,subtotal:x.subtotal,tax_amount:x.taxAmount,total_amount:x.total,status:"pending",payment_status:"pending",kitchen_status:"sent",sent_to_kitchen_at:new Date().toISOString(),print_count:1,last_printed_at:new Date().toISOString()};ee&&(xe.table_id=ee.id),F&&(xe.client_id=F.id);const{data:je,error:Se}=await A.from("orders").insert([xe]).select().single();if(Se)throw Se;ee&&await A.from("restaurant_tables").update({status:"occupied",current_order_id:je.id}).eq("id",ee.id);const Ie=k.filter(De=>!De.pendingCancellation).map(De=>{const et=De.unit_price*De.quantity,tt=et/(1+De.tax_rate/100),kt=et-tt;return{order_id:je.id,product_id:De.product_id,product_name:De.product_name,quantity:De.quantity,unit_price:De.unit_price,subtotal:tt,tax_rate:De.tax_rate,tax_amount:kt,total:et}}),{data:$e}=await A.from("order_items").insert(Ie).select();re(je.id),Bt(!0),await Nt($e,je.order_number),await Fe(k.filter(De=>!De.pendingCancellation),J,je.id),console.log("[POS] New order created and printed"),alert("✅ Ticket imprimé et envoyé en cuisine !")}}catch(x){console.error("[POS] Erreur impression ticket:",x),alert("Erreur lors de l'impression: "+x.message)}console.log("[POS] handlePrintTicket - End")},Cn=async()=>{if(k.length===0){alert("Le panier est vide");return}if(!D&&!ee&&!F){nn("hold"),ea(!0);return}try{const x=Qe();let J=`ORD-${Date.now()}`;if(D){const{data:xe}=await A.from("orders").select("order_number, order_items(product_id, quantity)").eq("id",D).single();J=xe.order_number;const je=k.filter(De=>De.pendingCancellation);if(je.length>0&&await Oe(je,J)){alert("✅ Ticket entièrement annulé !");return}const Se=xe.order_items.map(De=>De.product_id),Ie=k.filter(De=>!De.pendingCancellation&&!Se.includes(De.product_id));if(Ie.length>0){const De=Ie.map(tt=>{const kt=tt.unit_price*tt.quantity,un=kt/(1+tt.tax_rate/100),dn=kt-un;return{order_id:D,product_id:tt.product_id,product_name:tt.product_name,quantity:tt.quantity,unit_price:tt.unit_price,subtotal:un,tax_rate:tt.tax_rate,tax_amount:dn,total:kt}}),{data:et}=await A.from("order_items").insert(De).select();await Nt(et,J),await Fe(Ie,J,D)}const $e={subtotal:x.subtotal,tax_amount:x.taxAmount,total_amount:x.total,is_on_hold:!0,hold_time:new Date().toISOString()};ee&&($e.table_id=ee.id),F&&($e.client_id=F.id),await A.from("orders").update($e).eq("id",D)}else{const xe={order_number:J,sales_point_id:c.id,pos_session_id:f.id,employee_id:o.id,subtotal:x.subtotal,tax_amount:x.taxAmount,total_amount:x.total,status:"pending",payment_status:"pending",kitchen_status:"sent",sent_to_kitchen_at:new Date().toISOString(),is_on_hold:!0,hold_time:new Date().toISOString()};ee&&(xe.table_id=ee.id),F&&(xe.client_id=F.id);const{data:je,error:Se}=await A.from("orders").insert([xe]).select().single();if(Se)throw Se;ee&&await A.from("restaurant_tables").update({status:"occupied",current_order_id:je.id}).eq("id",ee.id);const Ie=k.filter(De=>!De.pendingCancellation).map(De=>{const et=De.unit_price*De.quantity,tt=et/(1+De.tax_rate/100),kt=et-tt;return{order_id:je.id,product_id:De.product_id,product_name:De.product_name,quantity:De.quantity,unit_price:De.unit_price,subtotal:tt,tax_rate:De.tax_rate,tax_amount:kt,total:et}}),{data:$e}=await A.from("order_items").insert(Ie).select();await Nt($e,je.order_number),Tt||await Fe(k.filter(De=>!De.pendingCancellation),J,je.id)}P([]),ne(null),_e(null),re(null),Bt(!1),jn(!1),await ve(),alert("✅ Commande envoyée et mise en attente !")}catch(x){console.error("Erreur envoi:",x),alert("Erreur lors de l'envoi: "+x.message)}},cn=async x=>{try{const{data:J,error:xe}=await A.from("orders").select("*, order_items(*), tables(*), clients(*)").eq("id",x).single();if(xe)throw xe;const je=J.order_items.map(Se=>({product_id:Se.product_id,product_name:Se.product_name,unit_price:Se.unit_price,unit_price_ht:Se.subtotal/Se.quantity,quantity:Se.quantity,tax_rate:Se.tax_rate}));P(je),re(J.id),J.tables?_e(J.tables):_e(null),J.clients?ne(J.clients):ne(null),await A.from("orders").update({is_on_hold:!1}).eq("id",x),await ve(),alert("Ticket rechargé !")}catch(J){console.error("Erreur chargement ticket:",J),alert("Erreur: "+J.message)}},Vi=async()=>{if(k.length!==0){if(!D&&!ee&&!F){nn("payment"),ea(!0);return}try{const x=Qe();if(D){const{data:J}=await A.from("orders").select("order_number, order_items(product_id, quantity)").eq("id",D).single(),xe=J.order_number,je=k.filter($e=>$e.pendingCancellation);if(je.length>0&&await Oe(je,xe)){alert("✅ Ticket entièrement annulé !");return}const Se=J.order_items.map($e=>$e.product_id),Ie=k.filter($e=>!$e.pendingCancellation&&!Se.includes($e.product_id));if(Ie.length>0){const $e=Ie.map(et=>{const tt=et.unit_price*et.quantity,kt=tt/(1+et.tax_rate/100),un=tt-kt;return{order_id:D,product_id:et.product_id,product_name:et.product_name,quantity:et.quantity,unit_price:et.unit_price,subtotal:kt,tax_rate:et.tax_rate,tax_amount:un,total:tt}}),{data:De}=await A.from("order_items").insert($e).select();await Nt(De,xe),await Fe(Ie,xe,D)}await A.from("orders").update({subtotal:x.subtotal,tax_amount:x.taxAmount,total_amount:x.total}).eq("id",D)}else{let J=`ORD-${Date.now()}`;const xe={order_number:J,sales_point_id:c.id,pos_session_id:f.id,employee_id:o.id,subtotal:x.subtotal,tax_amount:x.taxAmount,total_amount:x.total,status:"pending",payment_status:"pending",kitchen_status:"sent",sent_to_kitchen_at:new Date().toISOString(),print_count:0};ee&&(xe.table_id=ee.id),F&&(xe.client_id=F.id);const{data:je,error:Se}=await A.from("orders").insert([xe]).select().single();if(Se)throw Se;ee&&(await A.from("restaurant_tables").update({status:"occupied",current_order_id:je.id}).eq("id",ee.id),await Yt());const Ie=k.filter(De=>!De.pendingCancellation).map(De=>{const et=De.unit_price*De.quantity,tt=et/(1+De.tax_rate/100),kt=et-tt;return{order_id:je.id,product_id:De.product_id,product_name:De.product_name,quantity:De.quantity,unit_price:De.unit_price,subtotal:tt,tax_rate:De.tax_rate,tax_amount:kt,total:et}}),{data:$e}=await A.from("order_items").insert(Ie).select();re(je.id),await Nt($e,je.order_number),Tt||(await Fe(k.filter(De=>!De.pendingCancellation),J,je.id),Bt(!0))}V(!0)}catch(x){console.error("Erreur préparation paiement:",x),alert("Erreur: "+x.message)}}},Ys=async x=>{$n(x);try{const{data:J,error:xe}=await A.from("orders").select(`
          *,
          payments(payment_method, amount)
        `).eq("sales_point_id",c.id).eq("pos_session_id",f.id);if(xe)throw xe;const je={};let Se=0;J.forEach($e=>{$e.payment_status==="paid"&&(Se+=parseFloat($e.total_amount),$e.payments.forEach(De=>{const et=De.payment_method;je[et]=(je[et]||0)+parseFloat(De.amount)}))});const Ie=(f.opening_balance||0)+(je.cash||0);lt({totalOrders:J.filter($e=>$e.payment_status==="paid").length,totalSales:Se,paymentSummary:je,openingBalance:f.opening_balance||0,expectedCash:Ie,expectedAmounts:je}),qt(!0)}catch(J){console.error("Erreur génération rapport:",J),alert("Erreur: "+J.message)}},Gi=()=>{const x={};let J=!1,xe=0;Object.keys(Ue.expectedAmounts).forEach(je=>{const Se=Ue.expectedAmounts[je]||0,Ie=parseFloat(Dt[je]||0),$e=Ie-Se;Math.abs($e)>.01&&(x[je]={expected:Se,actual:Ie,difference:$e},J=!0,xe+=Math.abs($e))}),J?Vt({details:x,total:xe}):(Vt(null),Yi())},Yi=()=>{if(qt(!1),Le(on),Ne(!0),on==="Z"&&!window.confirm("Le rapport Z va clôturer définitivement la session. Continuer ?")){Ne(!1);return}},Qs=()=>{if(!en.trim()&&ln.total>1e3){alert("Une justification est requise pour un écart supérieur à 1000 FCFA");return}Yi()},So=async()=>{try{const{error:x}=await A.from("pos_sessions").update({closed_at:new Date().toISOString(),closing_balance:Ue.expectedCash,status:"closed"}).eq("id",f.id);if(x)throw x;alert("Session clôturée avec succès !"),Ne(!1),g(null),P([])}catch(x){console.error("Erreur clôture session:",x),alert("Erreur lors de la clôture: "+x.message)}},En=async()=>{if(console.log("cancelCurrentTicket appelé, currentOrderId:",D),!D){P([]),alert("Panier vidé !");return}if(window.confirm("Voulez-vous vraiment annuler ce ticket ? Le stock sera restauré."))try{console.log("Récupération de la commande:",D);const{data:x,error:J}=await A.from("orders").select("order_number").eq("id",D).single();if(J)throw J;console.log("Commande trouvée:",x);const{data:xe,error:je}=await A.from("order_items").select("*").eq("order_id",D);if(je)throw je;console.log("Articles trouvés:",xe),console.log("Restauration du stock..."),await ft(xe,x.order_number),console.log("Mise à jour du statut de la commande...");const{error:Se}=await A.from("orders").update({status:"voided",payment_status:"voided"}).eq("id",D);if(Se)throw Se;P([]),re(null),Bt(!1),jn(!1),await ve(),console.log("✅ Ticket annulé avec succès"),alert("✅ Ticket annulé et stock restauré !")}catch(x){console.error("Erreur annulation ticket:",x),alert("Erreur: "+x.message)}},Qi=C==="all"?_:_.filter(x=>x.category_id===C),an=Qe();return Y?n.jsx("div",{className:"loading",children:"Chargement..."}):c?f?n.jsxs("div",{className:"pos-container",children:[n.jsxs("div",{className:"orchestra-layout",children:[n.jsxs("div",{className:"pos-sidebar",children:[n.jsxs("div",{className:"pos-sidebar-header",children:[n.jsx("h3",{children:c.name}),n.jsx("span",{className:"session-badge-small",children:o?.username})]}),n.jsxs("div",{className:"sidebar-actions",children:[n.jsx("button",{onClick:()=>Ye(!Te),className:"sidebar-btn",children:"TICKETS"}),n.jsx("button",{onClick:()=>Ys("X"),className:"sidebar-btn",children:"RAPPORT X"}),n.jsx("button",{onClick:()=>Ys("Z"),className:"sidebar-btn",children:"RAPPORT Z"}),n.jsx("button",{onClick:()=>i("/dashboard"),className:"sidebar-btn",children:"RETOUR"})]})]}),n.jsxs("div",{className:"pos-main",children:[n.jsxs("div",{className:"pos-header-fullscreen",children:[n.jsxs("div",{className:"pos-header-left",children:[n.jsx("h3",{children:c.name}),n.jsx("span",{className:"user-badge",children:o?.username})]}),n.jsxs("div",{className:"pos-header-actions",children:[n.jsx("button",{onClick:()=>Ye(!Te),className:"header-btn",children:"TICKETS"}),n.jsx("button",{onClick:()=>Ys("X"),className:"header-btn",children:"RAPPORT X"}),n.jsx("button",{onClick:()=>Ys("Z"),className:"header-btn",children:"RAPPORT Z"}),n.jsx("button",{onClick:()=>i("/dashboard"),className:"header-btn header-btn-danger",children:"RETOUR"})]})]}),n.jsxs("div",{className:"ticket-section",children:[n.jsxs("div",{className:"ticket-header",children:[n.jsxs("div",{className:"ticket-info",children:[n.jsx("span",{className:"ticket-label",children:"TICKET"}),ee&&n.jsxs("span",{className:"table-indicator",children:["Table ",ee.table_number]}),F&&n.jsx("span",{className:"client-indicator",children:F.type==="company"?F.company_name:`${F.first_name||""} ${F.last_name||""}`.trim()||"Client"})]}),n.jsxs("div",{className:"ticket-total",children:[n.jsx("span",{className:"total-amount",children:an.total.toFixed(0)}),n.jsx("span",{className:"currency",children:"FCFA"})]})]}),n.jsx("div",{className:"ticket-items",children:k.length===0?n.jsx("div",{className:"ticket-empty",children:"Aucun article"}):k.map(x=>n.jsxs("div",{className:`ticket-item ${x.pendingCancellation?"pending-cancel":""}`,children:[n.jsx("div",{className:"ticket-item-qty",children:x.quantity}),n.jsx("div",{className:"ticket-item-name",children:x.product_name}),n.jsx("div",{className:"ticket-item-price",children:x.unit_price.toFixed(0)}),n.jsx("div",{className:"ticket-item-actions",children:D?n.jsx("button",{onClick:()=>pe(x),className:"ticket-item-void",disabled:x.pendingCancellation,children:"ANNULER"}):n.jsx("button",{onClick:()=>Re(x.product_id),className:"ticket-item-remove",children:"SUPPR"})})]},x.product_id))})]}),n.jsxs("div",{className:"products-section-new",children:[n.jsxs("div",{className:"categories-tabs-horizontal",children:[n.jsx("button",{className:C==="all"?"cat-tab active":"cat-tab",onClick:()=>N("all"),children:"Tous"}),m.map(x=>n.jsxs("button",{className:C===x.id?"cat-tab active":"cat-tab",onClick:()=>N(x.id),style:{borderColor:x.color||"#64748b",backgroundColor:C===x.id?x.color:"transparent",color:C===x.id?"white":"#1e293b"},children:[n.jsx("span",{className:"cat-icon",children:x.icon}),n.jsx("span",{children:x.name})]},x.id))]}),n.jsx("div",{className:"products-grid-new",children:Qi.map(x=>{const J=m.find(xe=>xe.id===x.category_id);return n.jsxs("button",{className:"product-card-new",onClick:()=>Ae(x),style:{borderColor:J?.color||"#e2e8f0"},children:[x.is_popular&&n.jsx("div",{className:"popular-badge",children:"⭐"}),x.icon&&n.jsx("div",{className:"product-icon",children:x.icon}),n.jsx("div",{className:"product-name",children:x.name}),n.jsx("div",{className:"product-price",children:x.selling_price.toFixed(0)})]},x.id)})})]})]}),n.jsx("div",{className:"pos-rightbar",children:n.jsxs("div",{className:"main-actions",children:[n.jsx("button",{onClick:ut,className:"action-btn action-assign",children:"TABLES"}),n.jsx("button",{onClick:xn,className:"action-btn action-assign",children:"CLIENTS"}),n.jsx("button",{onClick:_a,className:"action-btn action-ticket-print",disabled:k.length===0,children:"TICKET"}),n.jsx("button",{onClick:Cn,className:"action-btn action-send",disabled:k.length===0,children:"ENVOYER"}),n.jsx("button",{onClick:Vi,className:"action-btn action-payment",disabled:k.length===0,children:"PAIEMENT"}),n.jsxs("button",{onClick:En,className:"action-btn action-cancel",children:["ANNULER",n.jsx("br",{}),"TICKET"]})]})})]}),Te&&n.jsx("div",{className:"modal-overlay",onClick:()=>Ye(!1),children:n.jsxs("div",{className:"modal large tickets-modal",onClick:x=>x.stopPropagation(),children:[n.jsxs("div",{className:"modal-header",children:[n.jsx("h3",{children:"Gestion des Tickets"}),n.jsx("button",{onClick:()=>Ye(!1),className:"close-btn",children:"×"})]}),n.jsx("div",{className:"tickets-filter",children:n.jsxs("select",{value:Pe,onChange:x=>{dt(x.target.value),x.target.value!=="hold"&&Me()},children:[n.jsx("option",{value:"hold",children:"Tickets en attente"}),n.jsx("option",{value:"paid",children:"Tickets encaissés"}),n.jsx("option",{value:"voided",children:"Tickets annulés"})]})}),n.jsx("div",{className:"tickets-table-container",children:n.jsxs("table",{className:"tickets-table",children:[n.jsx("thead",{children:n.jsxs("tr",{children:[n.jsx("th",{children:"N° Ticket"}),n.jsx("th",{children:"Date/Heure"}),n.jsx("th",{children:"Table"}),n.jsx("th",{children:"Client"}),n.jsx("th",{children:"Articles"}),n.jsx("th",{children:"Montant"}),n.jsx("th",{children:"Statut"})]})}),n.jsxs("tbody",{children:[Pe==="hold"&&be.length===0&&n.jsx("tr",{children:n.jsx("td",{colSpan:"7",className:"no-tickets-row",children:"Aucun ticket en attente"})}),Pe==="hold"&&be.map(x=>n.jsxs("tr",{onClick:()=>{cn(x.id),Ye(!1)},className:"ticket-row clickable",children:[n.jsx("td",{className:"ticket-number",children:x.order_number}),n.jsx("td",{children:new Date(x.hold_time||x.created_at).toLocaleString()}),n.jsx("td",{children:x.restaurant_tables?`Table ${x.restaurant_tables.table_number}`:"-"}),n.jsx("td",{children:x.clients?x.clients.type==="company"?x.clients.company_name:`${x.clients.first_name||""} ${x.clients.last_name||""}`.trim():"-"}),n.jsxs("td",{children:[x.order_items?.length||0," article(s)"]}),n.jsxs("td",{className:"ticket-amount",children:[parseFloat(x.total_amount).toFixed(0)," FCFA"]}),n.jsx("td",{children:n.jsx("span",{className:"status-badge status-hold",children:"En attente"})})]},x.id)),Pe==="paid"&&ht.filter(x=>x.payment_status==="paid").length===0&&n.jsx("tr",{children:n.jsx("td",{colSpan:"7",className:"no-tickets-row",children:"Aucun ticket encaissé"})}),Pe==="paid"&&ht.filter(x=>x.payment_status==="paid").map(x=>n.jsxs("tr",{className:"ticket-row",children:[n.jsx("td",{className:"ticket-number",children:x.order_number}),n.jsx("td",{children:new Date(x.created_at).toLocaleString()}),n.jsx("td",{children:x.restaurant_tables?`Table ${x.restaurant_tables.table_number}`:"-"}),n.jsx("td",{children:x.clients?x.clients.type==="company"?x.clients.company_name:`${x.clients.first_name||""} ${x.clients.last_name||""}`.trim():"-"}),n.jsxs("td",{children:[x.order_items?.length||0," article(s)"]}),n.jsxs("td",{className:"ticket-amount",children:[parseFloat(x.total_amount).toFixed(0)," FCFA"]}),n.jsx("td",{children:n.jsx("span",{className:"status-badge status-paid",children:"Encaissé"})})]},x.id)),Pe==="voided"&&ht.filter(x=>x.status==="voided").length===0&&n.jsx("tr",{children:n.jsx("td",{colSpan:"7",className:"no-tickets-row",children:"Aucun ticket annulé"})}),Pe==="voided"&&ht.filter(x=>x.status==="voided").map(x=>n.jsxs("tr",{className:"ticket-row",children:[n.jsx("td",{className:"ticket-number",children:x.order_number}),n.jsx("td",{children:new Date(x.created_at).toLocaleString()}),n.jsx("td",{children:x.restaurant_tables?`Table ${x.restaurant_tables.table_number}`:"-"}),n.jsx("td",{children:x.clients?x.clients.type==="company"?x.clients.company_name:`${x.clients.first_name||""} ${x.clients.last_name||""}`.trim():"-"}),n.jsxs("td",{children:[x.order_items?.length||0," article(s)"]}),n.jsxs("td",{className:"ticket-amount",children:[parseFloat(x.total_amount).toFixed(0)," FCFA"]}),n.jsx("td",{children:n.jsx("span",{className:"status-badge status-voided",children:"Annulé"})})]},x.id))]})]})})]})}),E&&n.jsxs("div",{className:"payment-modal-new",children:[n.jsxs("div",{className:"payment-header",children:[n.jsxs("div",{className:"payment-title",children:[n.jsx("h2",{children:"Encaissement"}),n.jsxs("p",{className:"order-number",children:["Ticket N° ",D||"Nouveau"]})]}),n.jsx("button",{onClick:()=>V(!1),className:"close-btn-new",children:"×"})]}),n.jsxs("div",{className:"payment-body",children:[n.jsxs("div",{className:"payment-left",children:[n.jsxs("div",{className:"total-section",children:[n.jsx("div",{className:"total-label",children:"MONTANT TOTAL"}),n.jsx("div",{className:"total-amount",children:an.total.toFixed(0)}),n.jsx("div",{className:"total-currency",children:"FCFA"})]}),n.jsx("div",{className:"payment-tabs",children:[{key:"cash",label:"Espèces",icon:"💵"},{key:"orange_money",label:"Orange Money",icon:"🟠"},{key:"wave",label:"Wave",icon:"🌊"},{key:"card",label:"Carte Bleue",icon:"💳"},{key:"client_account",label:"Compte Client",icon:"👤"}].map(x=>n.jsxs("button",{className:`payment-tab ${O===x.key?"active":""}`,onClick:()=>{M(x.key),q(L[x.key]||"")},children:[n.jsx("span",{className:"tab-icon",children:x.icon}),n.jsx("span",{className:"tab-label",children:x.label}),L[x.key]>0&&n.jsx("span",{className:"tab-amount",children:parseFloat(L[x.key]).toFixed(0)})]},x.key))}),O==="client_account"?n.jsxs("div",{className:"client-selection-section",children:[n.jsx("label",{className:"input-label",children:"Rechercher un client"}),n.jsx("input",{type:"text",className:"client-search-input",placeholder:"Nom, prénom, entreprise, téléphone...",value:wn,onChange:x=>gs(x.target.value)}),n.jsxs("div",{className:"client-list",children:[ue.filter(x=>{if(!wn)return!0;const J=wn.toLowerCase(),xe=(x.first_name||"").toLowerCase(),je=(x.last_name||"").toLowerCase(),Se=(x.company_name||"").toLowerCase(),Ie=(x.phone||"").toLowerCase(),$e=(x.client_number||"").toLowerCase();return xe.includes(J)||je.includes(J)||Se.includes(J)||Ie.includes(J)||$e.includes(J)}).slice(0,8).map(x=>n.jsxs("div",{className:`client-item ${F?.id===x.id?"selected":""}`,onClick:()=>{ne(x),q(an.total.toString()),U({...L,client_account:an.total})},children:[n.jsx("div",{className:"client-item-name",children:x.type==="company"?x.company_name:`${x.first_name} ${x.last_name}`}),n.jsxs("div",{className:"client-item-details",children:[n.jsx("span",{children:x.phone}),n.jsxs("span",{className:x.current_balance<0?"text-danger":"text-success",children:[parseFloat(x.current_balance).toFixed(0)," FCFA"]})]})]},x.id)),ue.filter(x=>{if(!wn)return!0;const J=wn.toLowerCase(),xe=(x.first_name||"").toLowerCase(),je=(x.last_name||"").toLowerCase(),Se=(x.company_name||"").toLowerCase(),Ie=(x.phone||"").toLowerCase(),$e=(x.client_number||"").toLowerCase();return xe.includes(J)||je.includes(J)||Se.includes(J)||Ie.includes(J)||$e.includes(J)}).length===0&&n.jsx("div",{className:"no-results",children:"Aucun client trouvé"})]}),F&&n.jsxs("div",{className:"client-info-box",children:[n.jsxs("div",{className:"client-info-row",children:[n.jsx("span",{children:"Solde actuel:"}),n.jsxs("strong",{className:F.current_balance<0?"text-danger":"text-success",children:[F.current_balance.toFixed(0)," FCFA"]})]}),n.jsxs("div",{className:"client-info-row",children:[n.jsx("span",{children:"Plafond autorisé:"}),n.jsxs("strong",{children:[F.credit_limit.toFixed(0)," FCFA"]})]}),n.jsxs("div",{className:"client-info-row",children:[n.jsx("span",{children:"Après cette commande:"}),n.jsxs("strong",{className:F.current_balance-an.total<-F.credit_limit?"text-danger":"text-warning",children:[(F.current_balance-an.total).toFixed(0)," FCFA"]})]}),F.current_balance-an.total<-F.credit_limit&&n.jsx("div",{className:"client-warning",children:"⚠️ Dépassement du plafond autorisé ! Transaction bloquée."})]})]}):n.jsxs("div",{className:"payment-input-section",children:[n.jsx("label",{className:"input-label",children:O==="cash"?"Montant reçu":O==="orange_money"?"Montant Orange Money":O==="wave"?"Montant Wave":"Montant Carte Bleue"}),n.jsxs("div",{className:"payment-input-display",children:[n.jsx("input",{type:"text",className:"payment-input",value:G,readOnly:!0,placeholder:"0"}),n.jsx("span",{className:"input-currency",children:"FCFA"})]})]}),O==="cash"&&G&&parseFloat(G)>0&&n.jsxs("div",{className:"change-section",children:[n.jsxs("div",{className:"change-row",children:[n.jsx("span",{children:"Total payé:"}),n.jsxs("strong",{children:[Object.values(L).reduce((x,J)=>x+(parseFloat(J)||0),0).toFixed(0)," FCFA"]})]}),parseFloat(G)>=an.total&&n.jsxs("div",{className:"change-highlight",children:[n.jsx("span",{children:"RENDU MONNAIE:"}),n.jsxs("strong",{className:"change-amount",children:[(parseFloat(G)-an.total+Object.values(L).reduce((x,J)=>x+(parseFloat(J)||0),0)-(parseFloat(L[O])||0)).toFixed(0)," FCFA"]})]})]}),n.jsxs("div",{className:"payment-summary",children:[n.jsxs("div",{className:"summary-row",children:[n.jsx("span",{children:"Total à payer:"}),n.jsxs("strong",{children:[an.total.toFixed(0)," FCFA"]})]}),n.jsxs("div",{className:"summary-row",children:[n.jsx("span",{children:"Total saisi:"}),n.jsxs("strong",{className:Object.values(L).reduce((x,J)=>x+(parseFloat(J)||0),0)>=an.total?"text-success":"text-warning",children:[Object.values(L).reduce((x,J)=>x+(parseFloat(J)||0),0).toFixed(0)," FCFA"]})]}),Object.values(L).reduce((x,J)=>x+(parseFloat(J)||0),0)<an.total&&n.jsxs("div",{className:"summary-row",children:[n.jsx("span",{children:"Reste:"}),n.jsxs("strong",{className:"text-danger",children:[(an.total-Object.values(L).reduce((x,J)=>x+(parseFloat(J)||0),0)).toFixed(0)," FCFA"]})]})]})]}),n.jsx("div",{className:"payment-right",children:O!=="client_account"&&n.jsxs("div",{className:"numpad-payment",children:[n.jsx("div",{className:"numpad-grid",children:["7","8","9","4","5","6","1","2","3","0","00","000"].map(x=>n.jsx("button",{className:"numpad-key",onClick:()=>{const J=G+x;q(J),U({...L,[O]:J})},children:x},x))}),n.jsxs("div",{className:"numpad-actions",children:[n.jsx("button",{className:"numpad-action-btn btn-clear",onClick:()=>{q(""),U({...L,[O]:""})},children:"EFFACER"}),n.jsx("button",{className:"numpad-action-btn btn-backspace",onClick:()=>{const x=G.slice(0,-1);q(x),U({...L,[O]:x})},children:"⌫"}),n.jsx("button",{className:"numpad-action-btn btn-exact",onClick:()=>{const x=an.total-Object.values(L).reduce((J,xe)=>J+(parseFloat(xe)||0),0)+(parseFloat(L[O])||0);q(x.toString()),U({...L,[O]:x.toString()})},children:"EXACT"})]})]})})]}),n.jsxs("div",{className:"payment-footer",children:[n.jsx("button",{className:"btn-payment-action btn-split",onClick:()=>{if(k.length===0){alert("Le panier est vide. Ajoutez des articles avant de diviser la note.");return}V(!1),ge(!0)},children:"✂️ DIVISER LA NOTE"}),n.jsx("button",{className:"btn-payment-action btn-cancel",onClick:()=>V(!1),children:"ANNULER"}),n.jsx("button",{className:"btn-payment-action btn-validate",onClick:ot,disabled:Object.values(L).reduce((x,J)=>x+(parseFloat(J)||0),0)<an.total||O==="client_account"&&(!F||F.current_balance-an.total<-F.credit_limit),children:"✓ VALIDER PAIEMENT"})]})]}),K&&n.jsx("div",{className:"modal-overlay",children:n.jsxs("div",{className:"modal large",children:[n.jsx("h3",{children:"Gestion Client"}),n.jsx("input",{type:"text",placeholder:"Rechercher un client...",value:Ee,onChange:x=>R(x.target.value),className:"search-input"}),n.jsx("div",{className:"clients-list",children:ue.filter(x=>x.first_name?.toLowerCase().includes(Ee.toLowerCase())||x.last_name?.toLowerCase().includes(Ee.toLowerCase())||x.company_name?.toLowerCase().includes(Ee.toLowerCase())).map(x=>n.jsxs("div",{className:"client-item",onClick:()=>{ne(x),le(!1)},children:[n.jsx("p",{children:x.type==="company"?x.company_name:`${x.first_name||""} ${x.last_name||""}`.trim()||"Sans nom"}),n.jsx("p",{className:"client-phone",children:x.phone})]},x.id))}),n.jsx("div",{className:"modal-actions",children:n.jsx("button",{onClick:()=>le(!1),className:"cancel",children:"Fermer"})})]})}),mn&&n.jsx("div",{className:"modal-overlay",children:n.jsxs("div",{className:"modal",children:[n.jsx("h3",{children:"Annuler l'article"}),n.jsxs("p",{children:["Article: ",B?.product_name]}),n.jsx("textarea",{placeholder:"Raison de l'annulation (obligatoire)",value:ae,onChange:x=>S(x.target.value),rows:"3"}),n.jsxs("div",{className:"modal-actions",children:[n.jsx("button",{onClick:()=>tn(!1),className:"cancel",children:"Annuler"}),n.jsx("button",{onClick:ye,className:"confirm danger",children:"Confirmer"})]})]})}),We&&n.jsx("div",{className:"modal-overlay",children:n.jsxs("div",{className:"modal",children:[n.jsx("h3",{children:"Comptage des moyens de paiement"}),Object.keys(Ue.expectedAmounts).map(x=>n.jsxs("div",{className:"payment-counting",children:[n.jsxs("label",{children:[x==="cash"?"Espèces":x==="card"?"Carte":x==="mobile_money"?"Mobile Money":x==="cheque"?"Chèque":x,n.jsxs("span",{className:"expected",children:[" (Attendu: ",Ue.expectedAmounts[x].toFixed(0)," FCFA)"]})]}),n.jsx("input",{type:"number",value:Dt[x]||"",onChange:J=>yn({...Dt,[x]:J.target.value}),placeholder:"Montant réel"})]},x)),ln&&n.jsxs("div",{className:"variance-alert",children:[n.jsxs("h4",{children:["⚠️ Écart détecté: ",ln.total.toFixed(0)," FCFA"]}),n.jsx("textarea",{placeholder:"Justification (obligatoire si écart > 1000 FCFA)",value:en,onChange:x=>gt(x.target.value),rows:"3"}),n.jsx("button",{onClick:Qs,className:"confirm",children:"Confirmer avec écart"})]}),n.jsxs("div",{className:"modal-actions",children:[n.jsx("button",{onClick:()=>qt(!1),className:"cancel",children:"Annuler"}),n.jsx("button",{onClick:Gi,className:"confirm",children:"Valider"})]})]})}),we&&Ue&&n.jsx("div",{className:"modal-overlay",children:n.jsxs("div",{className:"modal report",children:[n.jsxs("h2",{children:["Rapport ",nt]}),n.jsxs("div",{className:"report-content",children:[n.jsxs("p",{children:[n.jsx("strong",{children:"Point de vente:"})," ",c.name]}),n.jsxs("p",{children:[n.jsx("strong",{children:"Caissier:"})," ",o?.username]}),n.jsxs("p",{children:[n.jsx("strong",{children:"Date:"})," ",new Date().toLocaleString()]}),n.jsx("hr",{}),n.jsxs("p",{children:[n.jsx("strong",{children:"Nombre de commandes:"})," ",Ue.totalOrders]}),n.jsxs("p",{children:[n.jsx("strong",{children:"Total des ventes:"})," ",Ue.totalSales.toFixed(0)," FCFA"]}),n.jsx("hr",{}),n.jsx("h4",{children:"Détail des paiements:"}),Object.entries(Ue.paymentSummary).map(([x,J])=>n.jsxs("p",{children:[x==="cash"?"Espèces":x==="card"?"Carte":x==="mobile_money"?"Mobile Money":x==="cheque"?"Chèque":x,": ",J.toFixed(0)," FCFA"]},x)),n.jsx("hr",{}),n.jsxs("p",{children:[n.jsx("strong",{children:"Fond de caisse ouverture:"})," ",Ue.openingBalance.toFixed(0)," FCFA"]}),n.jsxs("p",{children:[n.jsx("strong",{children:"Espèces attendues:"})," ",Ue.expectedCash.toFixed(0)," FCFA"]})]}),n.jsxs("div",{className:"modal-actions",children:[n.jsx("button",{onClick:()=>Ne(!1),className:"cancel",children:"Fermer"}),nt==="Z"&&n.jsx("button",{onClick:So,className:"confirm danger",children:"Clôturer session"})]})]})}),he&&n.jsx(Bj,{cart:k,onClose:()=>ge(!1),onSplit:x=>{console.log("Tickets divisés:",x),ge(!1)}}),Ii&&n.jsx("div",{className:"modal-overlay",onClick:()=>{ea(!1),nn(null)},children:n.jsxs("div",{className:"modal",onClick:x=>x.stopPropagation(),children:[n.jsxs("div",{className:"modal-header",children:[n.jsx("h3",{children:"Affecter le ticket"}),n.jsx("button",{onClick:()=>{ea(!1),nn(null)},className:"close-btn",children:"×"})]}),n.jsxs("div",{className:"modal-body",children:[n.jsx("p",{style:{marginBottom:"20px"},children:"Voulez-vous affecter ce ticket à une table ou un client ?"}),n.jsxs("div",{style:{display:"flex",gap:"10px",flexDirection:"column"},children:[n.jsx("button",{onClick:()=>ta(!0,!1),className:"btn-primary",style:{padding:"15px",fontSize:"16px"},children:"Affecter à une TABLE"}),n.jsx("button",{onClick:()=>ta(!1,!0),className:"btn-primary",style:{padding:"15px",fontSize:"16px"},children:"Affecter à un CLIENT"}),n.jsx("button",{onClick:()=>ta(!1,!1),className:"btn-secondary",style:{padding:"15px",fontSize:"16px"},children:"Continuer sans affecter"})]})]})]})}),vs&&n.jsx("div",{className:"modal-overlay",onClick:()=>Nn(!1),children:n.jsxs("div",{className:"modal large",onClick:x=>x.stopPropagation(),children:[n.jsxs("div",{className:"modal-header",children:[n.jsx("h3",{children:"Sélectionner une table"}),n.jsx("button",{onClick:()=>Nn(!1),className:"close-btn",children:"×"})]}),n.jsxs("div",{className:"modal-body",children:[n.jsxs("div",{style:{marginBottom:"15px",display:"flex",gap:"10px",alignItems:"center"},children:[n.jsx("input",{type:"text",placeholder:"Rechercher une table...",value:Pa,onChange:x=>ca(x.target.value),className:"input",style:{flex:1}}),n.jsx("button",{onClick:()=>{Nn(!1),i("/table-management",{state:{salesPointId:c.id}})},className:"btn-primary",style:{whiteSpace:"nowrap"},children:"Affichage graphique"})]}),n.jsx("div",{style:{maxHeight:"60vh",overflowY:"auto"},children:n.jsxs("table",{className:"data-table",children:[n.jsx("thead",{children:n.jsxs("tr",{children:[n.jsx("th",{children:"Numéro"}),n.jsx("th",{children:"Capacité"}),n.jsx("th",{children:"Statut"}),n.jsx("th",{children:"Action"})]})}),n.jsx("tbody",{children:ce.filter(x=>x.sales_point_id===c.id).filter(x=>{const J=Pa.toLowerCase();return!J||x.table_number.toLowerCase().includes(J)}).sort((x,J)=>{const xe=parseInt(x.table_number.replace(/\D/g,""))||0,je=parseInt(J.table_number.replace(/\D/g,""))||0;return xe-je}).map(x=>n.jsxs("tr",{children:[n.jsx("td",{children:x.table_number}),n.jsxs("td",{children:[x.capacity," pers."]}),n.jsx("td",{children:n.jsx("span",{className:`badge ${x.status==="available"?"badge-success":x.status==="occupied"?"badge-danger":"badge-warning"}`,children:x.status==="available"?"Libre":x.status==="occupied"?"Occupée":"Réservée"})}),n.jsx("td",{children:n.jsx("button",{onClick:()=>Fa(x),className:"btn-primary btn-sm",disabled:x.status==="occupied",children:"Sélectionner"})})]},x.id))})]})})]})]})}),K&&n.jsx("div",{className:"modal-overlay",onClick:()=>le(!1),children:n.jsxs("div",{className:"modal large",onClick:x=>x.stopPropagation(),children:[n.jsxs("div",{className:"modal-header",children:[n.jsx("h3",{children:"Sélectionner un client"}),n.jsx("button",{onClick:()=>le(!1),className:"close-btn",children:"×"})]}),n.jsxs("div",{className:"modal-body",children:[n.jsx("div",{style:{marginBottom:"15px"},children:n.jsx("input",{type:"text",placeholder:"Rechercher un client...",value:wn,onChange:x=>gs(x.target.value),className:"input",style:{width:"100%"}})}),n.jsx("div",{style:{maxHeight:"60vh",overflowY:"auto"},children:n.jsxs("table",{className:"data-table",children:[n.jsx("thead",{children:n.jsxs("tr",{children:[n.jsx("th",{children:"Nom"}),n.jsx("th",{children:"Téléphone"}),n.jsx("th",{children:"Type"}),n.jsx("th",{children:"Action"})]})}),n.jsx("tbody",{children:ue.filter(x=>{const J=wn.toLowerCase();return!J||x.first_name?.toLowerCase().includes(J)||x.last_name?.toLowerCase().includes(J)||x.company_name?.toLowerCase().includes(J)||x.phone?.includes(J)}).sort((x,J)=>{const xe=x.type==="company"?(x.company_name||"").toLowerCase():`${x.first_name||""} ${x.last_name||""}`.toLowerCase().trim(),je=J.type==="company"?(J.company_name||"").toLowerCase():`${J.first_name||""} ${J.last_name||""}`.toLowerCase().trim();return xe.localeCompare(je)}).map(x=>n.jsxs("tr",{children:[n.jsx("td",{children:x.type==="company"?x.company_name:`${x.first_name||""} ${x.last_name||""}`.trim()||"Sans nom"}),n.jsx("td",{children:x.phone||"-"}),n.jsx("td",{children:n.jsx("span",{className:`badge ${x.type==="company"?"badge-info":"badge-secondary"}`,children:x.type==="company"?"Entreprise":"Particulier"})}),n.jsx("td",{children:n.jsx("button",{onClick:()=>Gs(x),className:"btn-primary btn-sm",children:"Sélectionner"})})]},x.id))})]})})]})]})})]}):n.jsx("div",{className:"loading",children:"Initialisation de la session..."}):n.jsx("div",{className:"pos-container",children:n.jsxs("div",{className:"pos-selection",children:[n.jsx("h2",{children:"Sélectionner un point de vente"}),n.jsx("div",{className:"sales-points-grid",children:r.map(x=>n.jsxs("button",{className:"sales-point-card",onClick:()=>d(x),children:[n.jsx("h3",{children:x.name}),n.jsx("p",{children:x.type})]},x.id))})]})})}function Pj(){const{canCreate:o,canUpdate:i,canDelete:r}=Zr(),[l,c]=y.useState([]),[d,f]=y.useState(!0),[g,m]=y.useState(!1),[p,_]=y.useState(null),[j,C]=y.useState(""),[N,k]=y.useState("all"),[P,E]=y.useState("client_number"),[V,L]=y.useState("asc"),[U,O]=y.useState(!1),[M,G]=y.useState(null),[q,Y]=y.useState([]),[T,ce]=y.useState([]),[se,ee]=y.useState(!1),[_e,ue]=y.useState(""),[Ce,F]=y.useState("cash"),[ne,K]=y.useState(""),[le,Ee]=y.useState(""),[R,X]=y.useState("invoice_payment"),[fe,be]=y.useState([]),[$,D]=y.useState({}),[re,we]=y.useState([]),[Ne,nt]=y.useState(""),[Le,Ue]=y.useState({type:"individual",first_name:"",last_name:"",company_name:"",email:"",phone:"",phone_secondary:"",address:"",city:"Dakar",country:"Sénégal",tax_id:"",credit_limit:0,is_active:!0,notes:""});y.useEffect(()=>{We(),lt()},[]);const lt=async()=>{try{const{data:S,error:he}=await A.from("sales_points").select("*").eq("is_active",!0).order("name");if(he)throw he;we(S||[])}catch(S){console.error("Erreur chargement points de vente:",S)}},We=async()=>{try{const{data:S,error:he}=await A.from("clients").select("*").order("created_at",{ascending:!1});if(he)throw he;c(S||[])}catch(S){console.error("Erreur chargement clients:",S)}finally{f(!1)}},qt=async S=>{S.preventDefault();try{const he={...Le,credit_limit:parseFloat(Le.credit_limit)||0};if(p){const{error:ge}=await A.from("clients").update(he).eq("id",p.id);if(ge)throw ge}else{const{error:ge}=await A.from("clients").insert([he]);if(ge)throw ge}ln(),We()}catch(he){console.error("Erreur sauvegarde:",he),alert("Erreur: "+he.message)}},Dt=S=>{_(S),Ue({type:S.type,first_name:S.first_name||"",last_name:S.last_name||"",company_name:S.company_name||"",email:S.email||"",phone:S.phone,phone_secondary:S.phone_secondary||"",address:S.address||"",city:S.city||"Dakar",country:S.country||"Sénégal",tax_id:S.tax_id||"",credit_limit:S.credit_limit||0,is_active:S.is_active,notes:S.notes||""}),m(!0)},yn=async S=>{if(confirm("Supprimer ce client ?"))try{const{error:he}=await A.from("clients").delete().eq("id",S);if(he)throw he;We()}catch(he){console.error("Erreur suppression:",he),alert("Erreur: "+he.message)}},ln=()=>{Ue({type:"individual",first_name:"",last_name:"",company_name:"",email:"",phone:"",phone_secondary:"",address:"",city:"Dakar",country:"Sénégal",tax_id:"",credit_limit:0,is_active:!0,notes:""}),_(null),m(!1)},Vt=S=>S.type==="company"?S.company_name:`${S.first_name} ${S.last_name}`,en=async S=>{G(S),O(!0);try{const{data:he,error:ge}=await A.from("orders").select(`
          *,
          order_items(*, products(name)),
          payments(*)
        `).eq("client_id",S.id).order("created_at",{ascending:!1});if(ge)throw ge;Y(he||[]);const{data:Te,error:Ye}=await A.from("client_payments").select(`
          *,
          sales_points(name),
          payment_invoice_allocations(
            allocated_amount,
            orders(order_number, total_amount)
          )
        `).eq("client_id",S.id).order("created_at",{ascending:!1});if(Ye)throw Ye;ce(Te||[])}catch(he){console.error("Erreur chargement données client:",he)}},gt=async()=>{if(!_e||parseFloat(_e)<=0){alert("Veuillez saisir un montant valide");return}if(!Ne){alert("Veuillez sélectionner une caisse");return}if(R==="invoice_payment"&&fe.length===0){alert("Veuillez sélectionner au moins une facture à régler");return}try{const S=parseFloat(_e);let he=0;if(R==="invoice_payment"&&(he=Object.values($).reduce((Ut,Lt)=>Ut+parseFloat(Lt||0),0),he>S)){alert("Le total des montants alloués dépasse le montant du paiement");return}const Te=parseFloat(M.current_balance)+S,{error:Ye}=await A.from("clients").update({current_balance:Te}).eq("id",M.id);if(Ye)throw Ye;const{data:Pe,error:dt}=await A.from("client_payments").insert({client_id:M.id,amount:S,payment_method:Ce,reference:ne||null,notes:le||null,created_by:"admin",payment_type:R,allocated_amount:R==="invoice_payment"?he:0,remaining_amount:R==="invoice_payment"?S-he:S,sales_point_id:Ne}).select().single();if(dt)throw dt;const{error:ht}=await A.from("payments").insert({order_id:null,sales_point_id:Ne,payment_method:Ce,amount:S,reference:ne||null,notes:`Paiement client: ${M.type==="company"?M.company_name:`${M.first_name} ${M.last_name}`}${le?" - "+le:""}`,created_by:"admin"});if(ht)throw ht;if(R==="invoice_payment"&&fe.length>0){const Ut=fe.map(Et=>({payment_id:Pe.id,order_id:Et,allocated_amount:parseFloat($[Et]||0)})),{error:Lt}=await A.from("payment_invoice_allocations").insert(Ut);if(Lt)throw Lt;for(const Et of fe){const Tt=parseFloat($[Et]||0),Bt=q.find(Gt=>Gt.id===Et);if(Bt){const Gt=(parseFloat(Bt.paid_amount)||0)+Tt,jn=parseFloat(Bt.total_amount)-Gt,wn=jn<=0?"paid":"partial";await A.from("orders").update({paid_amount:Gt,remaining_amount:jn,payment_status:wn}).eq("id",Et)}}}if(ue(""),F("cash"),K(""),Ee(""),X("invoice_payment"),be([]),D({}),nt(""),ee(!1),We(),M){const Ut={...M,current_balance:Te};G(Ut),en(Ut)}alert("Paiement enregistré avec succès !")}catch(S){console.error("Erreur enregistrement paiement:",S),alert("Erreur: "+S.message)}},on=S=>parseFloat(S.credit_limit)+parseFloat(S.current_balance),$n=S=>on(S)<=0||!S.is_active,St=S=>{if(fe.includes(S)){be(fe.filter(ge=>ge!==S));const he={...$};delete he[S],D(he)}else{be([...fe,S]);const he=q.find(ge=>ge.id===S);he&&D({...$,[S]:he.remaining_amount||he.total_amount})}},Ht=(S,he)=>{D({...$,[S]:he})},mn=()=>Object.values($).reduce((S,he)=>S+parseFloat(he||0),0),tn=async S=>{if(confirm("Voulez-vous vraiment désallouer ce paiement ? Les factures reviendront à leur statut précédent."))try{const he=S.payment_invoice_allocations||[];for(const Ye of he){const{data:Pe,error:dt}=await A.from("orders").select("paid_amount, remaining_amount, total_amount").eq("id",Ye.order_id).single();if(dt)throw dt;const ht=(parseFloat(Pe.paid_amount)||0)-parseFloat(Ye.allocated_amount),Ut=parseFloat(Pe.total_amount)-ht,Lt=ht<=0?"pending":"partial",{error:Et}=await A.from("orders").update({paid_amount:ht,remaining_amount:Ut,payment_status:Lt}).eq("id",Ye.order_id);if(Et)throw Et}const{error:ge}=await A.from("payment_invoice_allocations").delete().eq("payment_id",S.id);if(ge)throw ge;const{error:Te}=await A.from("client_payments").update({payment_type:"deposit",allocated_amount:0,remaining_amount:S.amount}).eq("id",S.id);if(Te)throw Te;alert("Paiement désalloué avec succès. Il est maintenant considéré comme un dépôt libre."),en(M)}catch(he){console.error("Erreur lors de la désallocation:",he),alert("Erreur: "+he.message)}},B=()=>q.filter(S=>S.payment_status==="pending"||S.payment_status==="partial"),w=S=>{P===S?L(V==="asc"?"desc":"asc"):(E(S),L("asc"))},ae=l.filter(S=>{const he=Vt(S).toLowerCase().includes(j.toLowerCase())||S.client_number.toLowerCase().includes(j.toLowerCase())||S.email&&S.email.toLowerCase().includes(j.toLowerCase()),ge=N==="all"||S.type===N;return he&&ge}).sort((S,he)=>{let ge=S[P]||"",Te=he[P]||"";return P==="display_name"?(ge=Vt(S),Te=Vt(he)):(P==="balance"||P==="credit_limit")&&(ge=parseFloat(ge)||0,Te=parseFloat(Te)||0),typeof ge=="string"&&(ge=ge.toLowerCase(),Te=Te?.toLowerCase()||""),ge<Te?V==="asc"?-1:1:ge>Te?V==="asc"?1:-1:0});return d?n.jsx("div",{className:"loading",children:"Chargement..."}):n.jsxs("div",{className:"clients-container",children:[n.jsxs("div",{className:"page-header",children:[n.jsx("h2",{children:"Gestion des Clients"}),o("clients")&&n.jsx("button",{className:"btn-primary",onClick:()=>m(!0),children:"Nouveau Client"})]}),n.jsxs("div",{className:"filters-bar",children:[n.jsx("input",{type:"text",placeholder:"Rechercher par nom, numéro ou email...",value:j,onChange:S=>C(S.target.value),className:"search-input"}),n.jsxs("select",{value:N,onChange:S=>k(S.target.value),className:"filter-select",children:[n.jsx("option",{value:"all",children:"Tous les types"}),n.jsx("option",{value:"individual",children:"Particuliers"}),n.jsx("option",{value:"company",children:"Sociétés"})]})]}),n.jsx("div",{className:"clients-table-container",children:n.jsxs("table",{className:"clients-table",children:[n.jsx("thead",{children:n.jsxs("tr",{children:[n.jsxs("th",{onClick:()=>w("client_number"),style:{cursor:"pointer"},children:["N° Client ",P==="client_number"&&(V==="asc"?"↑":"↓")]}),n.jsxs("th",{onClick:()=>w("display_name"),style:{cursor:"pointer"},children:["Nom / Raison sociale ",P==="display_name"&&(V==="asc"?"↑":"↓")]}),n.jsxs("th",{onClick:()=>w("type"),style:{cursor:"pointer"},children:["Type ",P==="type"&&(V==="asc"?"↑":"↓")]}),n.jsxs("th",{onClick:()=>w("phone"),style:{cursor:"pointer"},children:["Contact ",P==="phone"&&(V==="asc"?"↑":"↓")]}),n.jsxs("th",{onClick:()=>w("city"),style:{cursor:"pointer"},children:["Ville ",P==="city"&&(V==="asc"?"↑":"↓")]}),n.jsxs("th",{onClick:()=>w("credit_limit"),style:{cursor:"pointer"},children:["Crédit autorisé ",P==="credit_limit"&&(V==="asc"?"↑":"↓")]}),n.jsxs("th",{onClick:()=>w("balance"),style:{cursor:"pointer"},children:["Solde ",P==="balance"&&(V==="asc"?"↑":"↓")]}),n.jsx("th",{children:"Crédit disponible"}),n.jsx("th",{children:"Statut"}),n.jsx("th",{children:"Actions"})]})}),n.jsx("tbody",{children:ae.map(S=>n.jsxs("tr",{className:S.is_active?"":"inactive-row",children:[n.jsx("td",{className:"client-number",children:S.client_number}),n.jsxs("td",{className:"client-name",children:[n.jsx("strong",{children:Vt(S)}),S.email&&n.jsx("div",{className:"client-email",children:S.email})]}),n.jsx("td",{children:n.jsx("span",{className:`type-badge ${S.type}`,children:S.type==="individual"?"Particulier":"Société"})}),n.jsxs("td",{children:[n.jsx("div",{children:S.phone}),S.phone_secondary&&n.jsx("div",{className:"secondary-phone",children:S.phone_secondary})]}),n.jsx("td",{children:S.city}),n.jsxs("td",{className:"amount",children:[parseInt(S.credit_limit).toLocaleString()," FCFA"]}),n.jsxs("td",{className:`amount ${parseFloat(S.current_balance)<0?"negative":"positive"}`,children:[parseInt(S.current_balance).toLocaleString()," FCFA"]}),n.jsxs("td",{className:`amount ${on(S)<=0?"negative":"positive"}`,children:[parseInt(on(S)).toLocaleString()," FCFA",$n(S)&&n.jsx("div",{className:"blocked-badge",children:"BLOQUÉ"})]}),n.jsx("td",{children:n.jsx("span",{className:`status-badge ${S.is_active?"active":"inactive"}`,children:S.is_active?"Actif":"Inactif"})}),n.jsxs("td",{className:"actions-cell",children:[n.jsx("button",{className:"btn-view",onClick:()=>en(S),children:"Détails"}),i("clients")&&n.jsx("button",{className:"btn-edit",onClick:()=>Dt(S),children:"Modifier"}),r("clients")&&n.jsx("button",{className:"btn-delete",onClick:()=>yn(S.id),children:"Supprimer"})]})]},S.id))})]})}),g&&n.jsx("div",{className:"modal-overlay",onClick:ln,children:n.jsxs("div",{className:"modal-content large",onClick:S=>S.stopPropagation(),children:[n.jsxs("div",{className:"modal-header",children:[n.jsxs("h3",{children:[p?"Modifier":"Nouveau"," Client"]}),n.jsx("button",{className:"close-btn",onClick:ln,children:"×"})]}),n.jsxs("form",{onSubmit:qt,children:[n.jsxs("div",{className:"form-group",children:[n.jsx("label",{children:"Type de client *"}),n.jsxs("div",{className:"radio-group",children:[n.jsxs("label",{className:"radio-label",children:[n.jsx("input",{type:"radio",name:"type",value:"individual",checked:Le.type==="individual",onChange:S=>Ue({...Le,type:S.target.value})}),n.jsx("span",{children:"Particulier"})]}),n.jsxs("label",{className:"radio-label",children:[n.jsx("input",{type:"radio",name:"type",value:"company",checked:Le.type==="company",onChange:S=>Ue({...Le,type:S.target.value})}),n.jsx("span",{children:"Société"})]})]})]}),Le.type==="individual"?n.jsxs("div",{className:"form-row",children:[n.jsxs("div",{className:"form-group",children:[n.jsx("label",{children:"Prénom *"}),n.jsx("input",{type:"text",value:Le.first_name,onChange:S=>Ue({...Le,first_name:S.target.value}),required:!0})]}),n.jsxs("div",{className:"form-group",children:[n.jsx("label",{children:"Nom *"}),n.jsx("input",{type:"text",value:Le.last_name,onChange:S=>Ue({...Le,last_name:S.target.value}),required:!0})]})]}):n.jsxs("div",{className:"form-group",children:[n.jsx("label",{children:"Raison sociale *"}),n.jsx("input",{type:"text",value:Le.company_name,onChange:S=>Ue({...Le,company_name:S.target.value}),required:!0})]}),n.jsxs("div",{className:"form-row",children:[n.jsxs("div",{className:"form-group",children:[n.jsx("label",{children:"Email"}),n.jsx("input",{type:"email",value:Le.email,onChange:S=>Ue({...Le,email:S.target.value})})]}),n.jsxs("div",{className:"form-group",children:[n.jsx("label",{children:"Téléphone principal *"}),n.jsx("input",{type:"tel",value:Le.phone,onChange:S=>Ue({...Le,phone:S.target.value}),placeholder:"+221 77 123 45 67",required:!0})]})]}),n.jsxs("div",{className:"form-row",children:[n.jsxs("div",{className:"form-group",children:[n.jsx("label",{children:"Téléphone secondaire"}),n.jsx("input",{type:"tel",value:Le.phone_secondary,onChange:S=>Ue({...Le,phone_secondary:S.target.value}),placeholder:"+221 33 821 00 00"})]}),n.jsxs("div",{className:"form-group",children:[n.jsx("label",{children:"NINEA / Numéro fiscal"}),n.jsx("input",{type:"text",value:Le.tax_id,onChange:S=>Ue({...Le,tax_id:S.target.value})})]})]}),n.jsxs("div",{className:"form-group",children:[n.jsx("label",{children:"Adresse"}),n.jsx("input",{type:"text",value:Le.address,onChange:S=>Ue({...Le,address:S.target.value})})]}),n.jsxs("div",{className:"form-row",children:[n.jsxs("div",{className:"form-group",children:[n.jsx("label",{children:"Ville"}),n.jsx("input",{type:"text",value:Le.city,onChange:S=>Ue({...Le,city:S.target.value})})]}),n.jsxs("div",{className:"form-group",children:[n.jsx("label",{children:"Pays"}),n.jsx("input",{type:"text",value:Le.country,onChange:S=>Ue({...Le,country:S.target.value})})]})]}),n.jsx("div",{className:"form-row",children:n.jsxs("div",{className:"form-group",children:[n.jsx("label",{children:"Plafond de crédit (FCFA)"}),n.jsx("input",{type:"number",step:"1000",value:Le.credit_limit,onChange:S=>Ue({...Le,credit_limit:S.target.value})}),n.jsx("small",{style:{color:"#6b7280",marginTop:"4px",display:"block"},children:"Montant maximum que le client peut acheter à crédit"})]})}),n.jsxs("div",{className:"form-group",children:[n.jsx("label",{children:"Notes internes"}),n.jsx("textarea",{value:Le.notes,onChange:S=>Ue({...Le,notes:S.target.value}),rows:"3"})]}),n.jsx("div",{className:"form-group",children:n.jsxs("label",{className:"checkbox-label",children:[n.jsx("input",{type:"checkbox",checked:Le.is_active,onChange:S=>Ue({...Le,is_active:S.target.checked})}),n.jsx("span",{children:"Client actif"})]})}),n.jsxs("div",{className:"modal-actions",children:[n.jsx("button",{type:"button",className:"btn-secondary",onClick:ln,children:"Annuler"}),n.jsx("button",{type:"submit",className:"btn-primary",children:p?"Modifier":"Créer"})]})]})]})}),U&&M&&n.jsx("div",{className:"modal-overlay",onClick:()=>O(!1),children:n.jsxs("div",{className:"modal-content large-modal",onClick:S=>S.stopPropagation(),children:[n.jsxs("div",{className:"modal-header",children:[n.jsxs("h3",{children:["Détails client - ",Vt(M)]}),n.jsx("button",{className:"close-btn",onClick:()=>O(!1),children:"×"})]}),n.jsxs("div",{className:"client-details-content",children:[n.jsxs("div",{className:"client-summary",children:[n.jsxs("div",{className:"summary-card",children:[n.jsx("div",{className:"summary-label",children:"Numéro client"}),n.jsx("div",{className:"summary-value",children:M.client_number})]}),n.jsxs("div",{className:"summary-card",children:[n.jsx("div",{className:"summary-label",children:"Crédit autorisé"}),n.jsxs("div",{className:"summary-value",children:[parseInt(M.credit_limit).toLocaleString()," FCFA"]})]}),n.jsxs("div",{className:`summary-card ${parseFloat(M.current_balance)<0?"negative":"positive"}`,children:[n.jsx("div",{className:"summary-label",children:parseFloat(M.current_balance)<0?"Dette actuelle":"Solde créditeur"}),n.jsxs("div",{className:"summary-value",children:[parseFloat(M.current_balance)<0?"-":"+",parseInt(Math.abs(M.current_balance)).toLocaleString()," FCFA"]})]}),n.jsxs("div",{className:`summary-card ${on(M)<=0?"negative":"positive"}`,children:[n.jsx("div",{className:"summary-label",children:"Crédit disponible"}),n.jsxs("div",{className:"summary-value",children:[parseInt(on(M)).toLocaleString()," FCFA"]})]})]}),$n(M)&&n.jsx("div",{className:"alert-warning",children:"⚠️ Client bloqué - Crédit insuffisant ou compte inactif"}),n.jsx("div",{className:"details-actions",children:n.jsx("button",{className:"btn-primary",onClick:()=>ee(!0),children:"Enregistrer un paiement"})}),n.jsx("h4",{children:"Factures en attente de paiement"}),n.jsx("div",{className:"orders-table-container",children:n.jsxs("table",{className:"orders-table",children:[n.jsx("thead",{children:n.jsxs("tr",{children:[n.jsx("th",{children:"N° Commande"}),n.jsx("th",{children:"Date"}),n.jsx("th",{children:"Articles"}),n.jsx("th",{children:"Montant"}),n.jsx("th",{children:"Statut paiement"})]})}),n.jsxs("tbody",{children:[q.filter(S=>S.payment_status==="pending").map(S=>n.jsxs("tr",{children:[n.jsx("td",{className:"order-number",children:S.order_number}),n.jsx("td",{children:new Date(S.created_at).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})}),n.jsx("td",{children:S.order_items.map((he,ge)=>n.jsxs("div",{className:"order-item-line",children:[he.quantity,"x ",he.products.name]},ge))}),n.jsxs("td",{className:"amount negative",children:[parseInt(S.total_amount).toLocaleString()," FCFA"]}),n.jsx("td",{children:n.jsx("span",{className:"status-badge pending",children:"En attente"})})]},S.id)),q.filter(S=>S.payment_status==="pending").length===0&&n.jsx("tr",{children:n.jsx("td",{colSpan:"5",style:{textAlign:"center",padding:"2rem",color:"#6b7280"},children:"Aucune facture en attente"})})]})]})}),n.jsx("h4",{children:"Historique des paiements"}),n.jsx("div",{className:"orders-table-container",children:n.jsxs("table",{className:"orders-table",children:[n.jsx("thead",{children:n.jsxs("tr",{children:[n.jsx("th",{children:"Date"}),n.jsx("th",{children:"Type"}),n.jsx("th",{children:"Caisse"}),n.jsx("th",{children:"Montant"}),n.jsx("th",{children:"Factures réglées"}),n.jsx("th",{children:"Mode de paiement"}),n.jsx("th",{children:"Référence"}),n.jsx("th",{children:"Actions"})]})}),n.jsxs("tbody",{children:[T.map(S=>n.jsxs("tr",{children:[n.jsx("td",{children:new Date(S.created_at).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})}),n.jsx("td",{children:n.jsx("span",{className:`status-badge ${S.payment_type==="deposit"?"pending":"active"}`,children:S.payment_type==="deposit"?"Arrhes":"Règlement"})}),n.jsx("td",{children:n.jsx("span",{className:"status-badge",style:{backgroundColor:"#3b82f6"},children:S.sales_points?.name||"Non spécifié"})}),n.jsxs("td",{className:"amount positive",children:["+",parseInt(S.amount).toLocaleString()," FCFA"]}),n.jsx("td",{children:S.payment_invoice_allocations&&S.payment_invoice_allocations.length>0?n.jsx("div",{children:S.payment_invoice_allocations.map((he,ge)=>n.jsxs("div",{style:{fontSize:"0.875rem"},children:[he.orders?.order_number,": ",parseInt(he.allocated_amount).toLocaleString()," FCFA"]},ge))}):n.jsx("span",{style:{color:"#6b7280"},children:"-"})}),n.jsx("td",{children:n.jsx("span",{className:"status-badge active",children:S.payment_method})}),n.jsx("td",{children:S.reference||"-"}),n.jsx("td",{children:S.payment_type==="invoice_payment"&&S.payment_invoice_allocations?.length>0&&n.jsx("button",{className:"btn-delete",onClick:()=>tn(S),style:{fontSize:"0.75rem",padding:"0.25rem 0.5rem"},children:"Désallouer"})})]},S.id)),T.length===0&&n.jsx("tr",{children:n.jsx("td",{colSpan:"8",style:{textAlign:"center",padding:"2rem",color:"#6b7280"},children:"Aucun paiement enregistré"})})]})]})}),n.jsx("h4",{children:"Historique des commandes"}),n.jsx("div",{className:"orders-table-container",children:n.jsxs("table",{className:"orders-table",children:[n.jsx("thead",{children:n.jsxs("tr",{children:[n.jsx("th",{children:"N° Commande"}),n.jsx("th",{children:"Date"}),n.jsx("th",{children:"Articles"}),n.jsx("th",{children:"Montant total"}),n.jsx("th",{children:"Payé"}),n.jsx("th",{children:"Reste"}),n.jsx("th",{children:"Statut"})]})}),n.jsx("tbody",{children:q.slice(0,10).map(S=>n.jsxs("tr",{children:[n.jsx("td",{className:"order-number",children:S.order_number}),n.jsx("td",{children:new Date(S.created_at).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})}),n.jsxs("td",{children:[S.order_items.slice(0,3).map((he,ge)=>n.jsxs("div",{className:"order-item-line",children:[he.quantity,"x ",he.products.name]},ge)),S.order_items.length>3&&n.jsxs("div",{className:"more-items",children:["+",S.order_items.length-3," autres"]})]}),n.jsxs("td",{className:"amount",children:[parseInt(S.total_amount).toLocaleString()," FCFA"]}),n.jsxs("td",{className:"amount positive",children:[parseInt(S.paid_amount||0).toLocaleString()," FCFA"]}),n.jsxs("td",{className:"amount negative",children:[parseInt(S.remaining_amount||S.total_amount).toLocaleString()," FCFA"]}),n.jsx("td",{children:n.jsx("span",{className:`status-badge ${S.payment_status==="paid"?"active":S.payment_status==="partial"?"warning":"pending"}`,children:S.payment_status==="paid"?"Payé":S.payment_status==="partial"?"Partiel":"En attente"})})]},S.id))})]})})]})]})}),se&&M&&n.jsx("div",{className:"modal-overlay",onClick:()=>ee(!1),children:n.jsxs("div",{className:"modal-content",onClick:S=>S.stopPropagation(),children:[n.jsxs("div",{className:"modal-header",children:[n.jsx("h3",{children:"Enregistrer un paiement"}),n.jsx("button",{className:"close-btn",onClick:()=>ee(!1),children:"×"})]}),n.jsxs("div",{style:{padding:"1.5rem"},children:[n.jsxs("div",{className:"payment-info",children:[n.jsxs("p",{children:[n.jsx("strong",{children:"Client:"})," ",Vt(M)]}),n.jsxs("p",{children:[n.jsx("strong",{children:"Dette actuelle:"})," ",n.jsxs("span",{className:"amount negative",children:[parseInt(Math.abs(M.current_balance)).toLocaleString()," FCFA"]})]})]}),n.jsxs("div",{className:"form-group",children:[n.jsx("label",{children:"Type de paiement *"}),n.jsxs("select",{value:R,onChange:S=>{X(S.target.value),be([]),D({})},children:[n.jsx("option",{value:"invoice_payment",children:"Règlement de facture(s)"}),n.jsx("option",{value:"deposit",children:"Dépôt libre (arrhes)"})]})]}),n.jsxs("div",{className:"form-group",children:[n.jsx("label",{children:"Montant du paiement (FCFA) *"}),n.jsx("input",{type:"number",step:"100",value:_e,onChange:S=>ue(S.target.value),placeholder:"Montant à encaisser",autoFocus:!0})]}),R==="invoice_payment"&&n.jsxs("div",{className:"form-group",children:[n.jsx("label",{children:"Sélectionner les factures à régler"}),n.jsx("div",{className:"invoice-selection",style:{maxHeight:"300px",overflowY:"auto",border:"1px solid #e5e7eb",borderRadius:"8px",padding:"1rem"},children:B().length===0?n.jsx("p",{style:{textAlign:"center",color:"#6b7280",padding:"1rem"},children:"Aucune facture en attente"}):B().map(S=>n.jsxs("div",{style:{marginBottom:"1rem",padding:"1rem",border:"1px solid #e5e7eb",borderRadius:"4px",backgroundColor:fe.includes(S.id)?"#f0f9ff":"white"},children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem",marginBottom:"0.5rem"},children:[n.jsx("input",{type:"checkbox",checked:fe.includes(S.id),onChange:()=>St(S.id)}),n.jsxs("div",{style:{flex:1},children:[n.jsx("div",{style:{fontWeight:"bold"},children:S.order_number}),n.jsx("div",{style:{fontSize:"0.875rem",color:"#6b7280"},children:new Date(S.created_at).toLocaleDateString("fr-FR")})]}),n.jsxs("div",{style:{textAlign:"right"},children:[n.jsxs("div",{style:{fontWeight:"bold"},children:[parseInt(S.total_amount).toLocaleString()," FCFA"]}),n.jsxs("div",{style:{fontSize:"0.875rem",color:"#ef4444"},children:["Reste: ",parseInt(S.remaining_amount||S.total_amount).toLocaleString()," FCFA"]})]})]}),fe.includes(S.id)&&n.jsxs("div",{style:{marginTop:"0.5rem"},children:[n.jsx("label",{style:{fontSize:"0.875rem",color:"#6b7280"},children:"Montant à allouer:"}),n.jsx("input",{type:"number",step:"100",value:$[S.id]||"",onChange:he=>Ht(S.id,he.target.value),placeholder:"0",style:{width:"100%",marginTop:"0.25rem"}})]})]},S.id))}),fe.length>0&&n.jsxs("div",{style:{marginTop:"1rem",padding:"1rem",backgroundColor:"#f3f4f6",borderRadius:"4px"},children:[n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontWeight:"bold"},children:[n.jsx("span",{children:"Total alloué:"}),n.jsxs("span",{children:[mn().toLocaleString()," FCFA"]})]}),_e&&mn()>parseFloat(_e)&&n.jsx("div",{style:{color:"#ef4444",fontSize:"0.875rem",marginTop:"0.5rem"},children:"⚠️ Le total alloué dépasse le montant du paiement"}),_e&&mn()<parseFloat(_e)&&mn()>0&&n.jsxs("div",{style:{color:"#f59e0b",fontSize:"0.875rem",marginTop:"0.5rem"},children:["ℹ️ Sous-paiement : ",(parseFloat(_e)-mn()).toLocaleString()," FCFA seront ajoutés au solde créditeur"]})]})]}),n.jsxs("div",{className:"form-group",children:[n.jsx("label",{children:"Caisse / Point de vente *"}),n.jsxs("select",{value:Ne,onChange:S=>nt(S.target.value),children:[n.jsx("option",{value:"",children:"-- Sélectionner une caisse --"}),re.map(S=>n.jsx("option",{value:S.id,children:S.name},S.id))]})]}),n.jsxs("div",{className:"form-group",children:[n.jsx("label",{children:"Mode de paiement *"}),n.jsxs("select",{value:Ce,onChange:S=>F(S.target.value),children:[n.jsx("option",{value:"cash",children:"Espèces"}),n.jsx("option",{value:"card",children:"Carte bancaire"}),n.jsx("option",{value:"orange_money",children:"Orange Money"}),n.jsx("option",{value:"wave",children:"Wave"})]})]}),n.jsxs("div",{className:"form-group",children:[n.jsx("label",{children:"Référence / N° de transaction"}),n.jsx("input",{type:"text",value:ne,onChange:S=>K(S.target.value),placeholder:"Ex: Reçu N°12345, Ref. virement..."})]}),n.jsxs("div",{className:"form-group",children:[n.jsx("label",{children:"Notes"}),n.jsx("textarea",{value:le,onChange:S=>Ee(S.target.value),placeholder:"Notes additionnelles...",rows:"2"})]}),n.jsxs("div",{className:"modal-actions",children:[n.jsx("button",{type:"button",className:"btn-secondary",onClick:()=>ee(!1),children:"Annuler"}),n.jsx("button",{type:"button",className:"btn-primary",onClick:gt,children:"Enregistrer le paiement"})]})]})]})})]})}function yg({salesPoint:o,onClose:i,onSelectTable:r,standalone:l=!1}){const c=Ba(),[d,f]=y.useState([]),[g,m]=y.useState("graphical"),[p,_]=y.useState(null),[j,C]=y.useState(!1),[N,k]=y.useState(null),[P,E]=y.useState(""),[V,L]=y.useState("all"),[U,O]=y.useState("all"),[M,G]=y.useState(!1),[q,Y]=y.useState([]),[T,ce]=y.useState(!1),[se,ee]=y.useState(null),[_e,ue]=y.useState([]),[Ce,F]=y.useState({}),[ne,K]=y.useState(!1),[le,Ee]=y.useState(null),[R,X]=y.useState({table_number:"",capacity:"",zone:"",position_x:"",position_y:""}),[fe,be]=y.useState(null),[$,D]=y.useState([]),[re,we]=y.useState("table_number"),[Ne,nt]=y.useState("asc");y.useEffect(()=>{l?Le():o&&Ue()},[o,l]),y.useEffect(()=>{fe&&Ue()},[fe]);const Le=async()=>{try{const{data:w,error:ae}=await A.from("sales_points").select("*").order("name");if(ae)throw ae;D(w||[]);const S=c.state?.salesPointId;S?be(S):w&&w.length>0&&be(w[0].id)}catch(w){console.error("Erreur chargement points de vente:",w)}},Ue=async()=>{try{const w=l?fe:o?.id;if(!w)return;const{data:ae,error:S}=await A.from("restaurant_tables").select("*").eq("sales_point_id",w).order("table_number");if(S)throw S;f(ae||[])}catch(w){console.error("Erreur chargement tables:",w)}},lt=w=>{switch(w){case"available":return"#10b981";case"occupied":return"#ef4444";case"reserved":return"#f59e0b";case"merged":return"#3b82f6";default:return"#6b7280"}},We=w=>{switch(w){case"available":return"Disponible";case"occupied":return"Occupée";case"reserved":return"Réservée";case"merged":return"Fusionnée";default:return w}},qt=w=>{_(w),w.status==="occupied"&&w.current_order_id&&r(w)},Dt=w=>{_(w),C(!0)},yn=async()=>{if(!N||!P.trim()){alert("Veuillez sélectionner une table de destination et fournir une raison");return}try{const{error:w}=await A.from("table_transfers").insert({from_table_id:p.id,to_table_id:N,order_id:p.current_order_id,reason:P});if(w)throw w;const{error:ae}=await A.from("restaurant_tables").update({status:"available",current_order_id:null}).eq("id",p.id);if(ae)throw ae;const{error:S}=await A.from("restaurant_tables").update({status:"occupied",current_order_id:p.current_order_id}).eq("id",N);if(S)throw S;const{error:he}=await A.from("orders").update({table_id:N}).eq("id",p.current_order_id);if(he)throw he;C(!1),k(null),E(""),Ue(),alert("Transfert effectué avec succès")}catch(w){console.error("Erreur transfert:",w),alert("Erreur lors du transfert: "+w.message)}},ln=async()=>{if(q.length<2){alert("Veuillez sélectionner au moins 2 tables à fusionner");return}try{const w=d.find(Pe=>Pe.id===q[0]),ae=q.slice(1),S=d.filter(Pe=>ae.includes(Pe.id));let he=w.current_guests||0;const ge=[];for(const Pe of S)if(he+=Pe.current_guests||0,Pe.status==="occupied"&&Pe.current_order_id){const{data:dt}=await A.from("order_items").select("*").eq("order_id",Pe.current_order_id);dt&&dt.length>0&&ge.push({orderId:Pe.current_order_id,items:dt,tableNumber:Pe.table_number})}let Te=w.current_order_id;if(ge.length>0){if(!Te&&w.status==="available"){const{data:Et,error:Tt}=await A.from("orders").insert({sales_point_id:o.id,table_id:w.id,order_type:"dine_in",guest_count:he,status:"pending",total_amount:0,tax_amount:0,subtotal:0}).select().single();if(Tt)throw Tt;Te=Et.id}for(const Et of ge){for(const Tt of Et.items)await A.from("order_items").update({order_id:Te}).eq("id",Tt.id);await A.from("orders").update({status:"merged"}).eq("id",Et.orderId)}const{data:Pe}=await A.from("order_items").select("*").eq("order_id",Te),dt=Pe.reduce((Et,Tt)=>Et+Tt.quantity*Tt.unit_price,0),ht=o.vat_rate||.1,Ut=dt*ht,Lt=dt+Ut;await A.from("orders").update({subtotal:dt,tax_amount:Ut,total_amount:Lt,guest_count:he}).eq("id",Te)}await A.from("restaurant_tables").update({status:ge.length>0||w.status==="occupied"?"occupied":"merged",merged_with:ae,current_order_id:Te,current_guests:he}).eq("id",w.id);for(const Pe of ae)await A.from("restaurant_tables").update({status:"merged",merged_with:[w.id],current_order_id:null,current_guests:0}).eq("id",Pe);G(!1),Y([]),Ue();const Ye=ge.length>0?`Tables fusionnées avec succès. ${ge.length} commande(s) transférée(s) vers la table ${w.table_number}.`:`Tables fusionnées avec succès. Table principale: ${w.table_number}`;alert(Ye)}catch(w){console.error("Erreur fusion:",w),alert("Erreur lors de la fusion: "+w.message)}},Vt=async w=>{if(ee(w),w.current_order_id){const{data:ae}=await A.from("order_items").select(`
          *,
          products (name)
        `).eq("order_id",w.current_order_id);ue(ae||[]);const S={};ae?.forEach(he=>{S[he.id]=w.id}),F(S)}ce(!0)},en=async()=>{if(se)try{const w=se.merged_with||[],ae=se.current_order_id&&_e.length>0,S=[se.id,...w],he={};if(S.forEach(ge=>{he[ge]=[]}),ae){_e.forEach(ge=>{const Te=Ce[ge.id];Te&&he[Te]&&he[Te].push(ge)});for(const[ge,Te]of Object.entries(he))if(Te.length!==0)if(ge===se.id){const Ye=Te.reduce((Ut,Lt)=>Ut+Lt.quantity*Lt.unit_price,0),Pe=o.vat_rate||.1,dt=Ye*Pe,ht=Ye+dt;await A.from("orders").update({subtotal:Ye,tax_amount:dt,total_amount:ht}).eq("id",se.current_order_id)}else{const{data:Ye,error:Pe}=await A.from("orders").insert({sales_point_id:o.id,table_id:ge,order_type:"dine_in",guest_count:0,status:"pending",total_amount:0,tax_amount:0,subtotal:0}).select().single();if(Pe)throw Pe;const dt=Te.map(Tt=>Tt.id);await A.from("order_items").update({order_id:Ye.id}).in("id",dt);const ht=Te.reduce((Tt,Bt)=>Tt+Bt.quantity*Bt.unit_price,0),Ut=o.vat_rate||.1,Lt=ht*Ut,Et=ht+Lt;await A.from("orders").update({subtotal:ht,tax_amount:Lt,total_amount:Et}).eq("id",Ye.id),await A.from("restaurant_tables").update({status:"occupied",current_order_id:Ye.id}).eq("id",ge)}}await A.from("restaurant_tables").update({status:ae?"occupied":"available",merged_with:null}).eq("id",se.id);for(const ge of w){const Te=ae&&he[ge]?.length>0;await A.from("restaurant_tables").update({status:Te?"occupied":"available",merged_with:null}).eq("id",ge)}ce(!1),ee(null),ue([]),F({}),Ue(),alert("Tables séparées avec succès")}catch(w){console.error("Erreur séparation:",w),alert("Erreur lors de la séparation: "+w.message)}},gt=w=>{q.includes(w)?Y(q.filter(ae=>ae!==w)):Y([...q,w])},on=w=>{Ee(w),X({table_number:w.table_number,capacity:w.capacity,zone:w.zone,position_x:w.position_x,position_y:w.position_y}),K(!0)},$n=async()=>{if(le){if(!R.table_number.trim()){alert("Le numéro de table est obligatoire");return}if(!R.capacity||R.capacity<1){alert("La capacité doit être au moins 1");return}try{const{error:w}=await A.from("restaurant_tables").update({table_number:R.table_number.trim(),capacity:parseInt(R.capacity),zone:R.zone.trim(),position_x:parseInt(R.position_x)||0,position_y:parseInt(R.position_y)||0}).eq("id",le.id);if(w)throw w;K(!1),Ee(null),X({table_number:"",capacity:"",zone:"",position_x:"",position_y:""}),Ue(),alert("Table modifiée avec succès")}catch(w){console.error("Erreur modification:",w),alert("Erreur lors de la modification: "+w.message)}}},St=[...new Set(d.map(w=>w.zone))],Ht=w=>{re===w?nt(Ne==="asc"?"desc":"asc"):(we(w),nt("asc"))},mn=d.filter(w=>!(V!=="all"&&w.zone!==V||U!=="all"&&w.status!==U)).sort((w,ae)=>{let S=w[re]||"",he=ae[re]||"";if(re==="table_number"){const ge=parseInt(S.replace(/\D/g,""))||0,Te=parseInt(he.replace(/\D/g,""))||0;return Ne==="asc"?ge-Te:Te-ge}else re==="capacity"?(S=parseInt(S)||0,he=parseInt(he)||0):typeof S=="string"&&(S=S.toLowerCase(),he=he.toLowerCase());return S<he?Ne==="asc"?-1:1:S>he?Ne==="asc"?1:-1:0}),tn=l?"table-management-standalone":"table-management-overlay",B=l?"table-management-content":"table-management-container";return n.jsxs("div",{className:tn,children:[n.jsxs("div",{className:B,children:[!l&&n.jsxs("div",{className:"table-management-header",children:[n.jsxs("h2",{children:["Gestion des Tables - ",o?.name]}),n.jsx("button",{className:"close-btn",onClick:i,children:"×"})]}),l&&n.jsxs("div",{className:"standalone-header",children:[n.jsx("h2",{children:"Gestion des Tables"}),n.jsx("div",{className:"sales-points-tabs",children:$.map(w=>n.jsx("button",{className:fe===w.id?"tab-active":"tab-inactive",onClick:()=>be(w.id),children:w.name},w.id))})]}),n.jsxs("div",{className:"table-controls",children:[n.jsxs("div",{className:"view-mode-toggle",children:[n.jsx("button",{className:g==="graphical"?"active":"",onClick:()=>m("graphical"),children:"Vue Graphique"}),n.jsx("button",{className:g==="list"?"active":"",onClick:()=>m("list"),children:"Vue Liste"})]}),n.jsx("div",{className:"table-actions",children:n.jsx("button",{className:"btn-merge",onClick:()=>G(!0),children:"🔗 Fusionner des tables"})}),n.jsxs("div",{className:"filters",children:[n.jsxs("select",{value:V,onChange:w=>L(w.target.value),children:[n.jsx("option",{value:"all",children:"Toutes les zones"}),St.map(w=>n.jsx("option",{value:w,children:w},w))]}),n.jsxs("select",{value:U,onChange:w=>O(w.target.value),children:[n.jsx("option",{value:"all",children:"Tous les statuts"}),n.jsx("option",{value:"available",children:"Disponible"}),n.jsx("option",{value:"occupied",children:"Occupée"}),n.jsx("option",{value:"reserved",children:"Réservée"})]})]}),n.jsxs("div",{className:"legend",children:[n.jsxs("div",{className:"legend-item",children:[n.jsx("span",{className:"legend-color",style:{background:"#10b981"}}),n.jsx("span",{children:"Disponible"})]}),n.jsxs("div",{className:"legend-item",children:[n.jsx("span",{className:"legend-color",style:{background:"#ef4444"}}),n.jsx("span",{children:"Occupée"})]}),n.jsxs("div",{className:"legend-item",children:[n.jsx("span",{className:"legend-color",style:{background:"#f59e0b"}}),n.jsx("span",{children:"Réservée"})]}),n.jsxs("div",{className:"legend-item",children:[n.jsx("span",{className:"legend-color",style:{background:"#3b82f6"}}),n.jsx("span",{children:"Fusionnée"})]})]})]}),n.jsx("div",{className:"table-content",children:g==="graphical"?n.jsx("div",{className:"graphical-view",children:mn.map(w=>n.jsxs("div",{className:"table-item",style:{left:`${w.position_x}px`,top:`${w.position_y}px`,background:lt(w.status)},onClick:()=>qt(w),children:[n.jsx("div",{className:"table-number",children:w.table_number}),n.jsxs("div",{className:"table-capacity",children:[w.capacity," pers."]}),w.status==="occupied"&&n.jsx("button",{className:"transfer-btn",onClick:ae=>{ae.stopPropagation(),Dt(w)},children:"⇄"})]},w.id))}):n.jsx("div",{className:"list-view",children:n.jsxs("table",{className:"tables-list",children:[n.jsx("thead",{children:n.jsxs("tr",{children:[n.jsxs("th",{onClick:()=>Ht("table_number"),style:{cursor:"pointer"},children:["Table ",re==="table_number"&&(Ne==="asc"?"↑":"↓")]}),n.jsxs("th",{onClick:()=>Ht("zone"),style:{cursor:"pointer"},children:["Zone ",re==="zone"&&(Ne==="asc"?"↑":"↓")]}),n.jsxs("th",{onClick:()=>Ht("capacity"),style:{cursor:"pointer"},children:["Capacité ",re==="capacity"&&(Ne==="asc"?"↑":"↓")]}),n.jsxs("th",{onClick:()=>Ht("status"),style:{cursor:"pointer"},children:["Statut ",re==="status"&&(Ne==="asc"?"↑":"↓")]}),n.jsx("th",{children:"Actions"})]})}),n.jsx("tbody",{children:mn.map(w=>n.jsxs("tr",{children:[n.jsx("td",{children:n.jsx("strong",{children:w.table_number})}),n.jsx("td",{children:w.zone}),n.jsxs("td",{children:[w.capacity," pers."]}),n.jsx("td",{children:n.jsx("span",{className:"status-badge",style:{background:lt(w.status)},children:We(w.status)})}),n.jsxs("td",{children:[w.status==="occupied"&&n.jsxs(n.Fragment,{children:[n.jsx("button",{className:"btn-small",onClick:()=>qt(w),children:"Voir commande"}),n.jsx("button",{className:"btn-small btn-transfer",onClick:()=>Dt(w),children:"Transférer"})]}),w.status==="available"&&n.jsx("button",{className:"btn-small btn-select",onClick:()=>r(w),children:"Sélectionner"}),w.status==="merged"&&n.jsx("button",{className:"btn-small btn-split",onClick:()=>Vt(w),children:"Séparer"}),w.status==="occupied"&&w.merged_with&&w.merged_with.length>0&&n.jsx("button",{className:"btn-small btn-split",onClick:()=>Vt(w),children:"Séparer"}),n.jsx("button",{className:"btn-small btn-edit",onClick:()=>on(w),children:"✏️ Modifier"})]})]},w.id))})]})})})]}),j&&n.jsx("div",{className:"modal-overlay",onClick:()=>C(!1),children:n.jsxs("div",{className:"modal-content",onClick:w=>w.stopPropagation(),children:[n.jsxs("div",{className:"modal-header",children:[n.jsxs("h3",{children:["Transférer la table ",p.table_number]}),n.jsx("button",{className:"close-btn",onClick:()=>C(!1),children:"×"})]}),n.jsxs("div",{className:"modal-body",children:[n.jsxs("div",{className:"form-group",children:[n.jsx("label",{children:"Table de destination *"}),n.jsxs("select",{value:N||"",onChange:w=>k(w.target.value),children:[n.jsx("option",{value:"",children:"Sélectionner une table"}),d.filter(w=>w.status==="available"&&w.id!==p.id).map(w=>n.jsxs("option",{value:w.id,children:[w.table_number," - ",w.zone," (",w.capacity," pers.)"]},w.id))]})]}),n.jsxs("div",{className:"form-group",children:[n.jsx("label",{children:"Raison du transfert *"}),n.jsx("textarea",{value:P,onChange:w=>E(w.target.value),placeholder:"Ex: Demande du client, table trop petite...",rows:3})]})]}),n.jsxs("div",{className:"modal-actions",children:[n.jsx("button",{className:"btn-secondary",onClick:()=>C(!1),children:"Annuler"}),n.jsx("button",{className:"btn-primary",onClick:yn,children:"Confirmer le transfert"})]})]})}),M&&n.jsx("div",{className:"modal-overlay",onClick:()=>G(!1),children:n.jsxs("div",{className:"modal-content",onClick:w=>w.stopPropagation(),children:[n.jsxs("div",{className:"modal-header",children:[n.jsx("h3",{children:"Fusionner des tables"}),n.jsx("button",{className:"close-btn",onClick:()=>G(!1),children:"×"})]}),n.jsxs("div",{className:"modal-body",children:[n.jsx("p",{style:{marginBottom:"16px",color:"#6b7280"},children:"Sélectionnez au moins 2 tables à fusionner. La première table sélectionnée sera la table principale. Les commandes seront fusionnées automatiquement."}),n.jsx("div",{className:"tables-selection",children:d.filter(w=>w.status==="available"||w.status==="occupied").map(w=>n.jsxs("div",{className:`table-checkbox ${q.includes(w.id)?"selected":""}`,onClick:()=>gt(w.id),children:[n.jsx("input",{type:"checkbox",checked:q.includes(w.id),onChange:()=>{}}),n.jsx("span",{children:w.table_number}),n.jsxs("span",{className:"table-details",children:[w.zone," - ",w.capacity," pers.",w.status==="occupied"&&n.jsx("span",{style:{marginLeft:"8px",color:"#ef4444",fontWeight:"bold"},children:"• Occupée"})]}),q[0]===w.id&&n.jsx("span",{className:"primary-badge",children:"Principale"})]},w.id))}),q.length>0&&n.jsx("div",{style:{marginTop:"16px",padding:"12px",background:"#f0f9ff",borderRadius:"8px"},children:n.jsxs("strong",{children:[q.length," table(s) sélectionnée(s)"]})})]}),n.jsxs("div",{className:"modal-actions",children:[n.jsx("button",{className:"btn-secondary",onClick:()=>{G(!1),Y([])},children:"Annuler"}),n.jsx("button",{className:"btn-primary",onClick:ln,disabled:q.length<2,children:"Fusionner les tables"})]})]})}),T&&se&&n.jsx("div",{className:"modal-overlay",onClick:()=>ce(!1),children:n.jsxs("div",{className:"modal-content split-modal-large",onClick:w=>w.stopPropagation(),children:[n.jsxs("div",{className:"modal-header",children:[n.jsx("h3",{children:"Séparer les tables fusionnées"}),n.jsx("button",{className:"close-btn",onClick:()=>ce(!1),children:"×"})]}),n.jsxs("div",{className:"modal-body",children:[n.jsxs("div",{style:{padding:"12px",background:"#f0f9ff",borderRadius:"8px",marginBottom:"16px"},children:[n.jsx("strong",{children:"Tables concernées :"}),n.jsxs("div",{style:{display:"flex",gap:"8px",marginTop:"8px",flexWrap:"wrap"},children:[n.jsxs("span",{style:{padding:"4px 12px",background:"#3b82f6",color:"white",borderRadius:"4px",fontWeight:"bold"},children:[se.table_number," (Principale)"]}),se.merged_with?.map(w=>{const ae=d.find(S=>S.id===w);return ae?n.jsx("span",{style:{padding:"4px 12px",background:"#6b7280",color:"white",borderRadius:"4px"},children:ae.table_number},w):null})]})]}),_e.length>0?n.jsxs(n.Fragment,{children:[n.jsx("p",{style:{marginBottom:"16px",color:"#6b7280"},children:"Assignez chaque article à une table. Les tables sans articles seront libérées."}),n.jsx("div",{className:"split-items-list",children:_e.map(w=>n.jsxs("div",{className:"split-item-row",children:[n.jsxs("div",{className:"split-item-info",children:[n.jsx("strong",{children:w.products?.name}),n.jsxs("span",{className:"split-item-details",children:["Qté: ",w.quantity," × ",w.unit_price.toLocaleString()," FCFA = ",(w.quantity*w.unit_price).toLocaleString()," FCFA"]})]}),n.jsxs("select",{className:"split-item-select",value:Ce[w.id]||se.id,onChange:ae=>F({...Ce,[w.id]:ae.target.value}),children:[n.jsx("option",{value:se.id,children:se.table_number}),se.merged_with?.map(ae=>{const S=d.find(he=>he.id===ae);return S?n.jsx("option",{value:ae,children:S.table_number},ae):null})]})]},w.id))}),n.jsxs("div",{style:{marginTop:"16px",padding:"12px",background:"#fef3c7",borderRadius:"8px"},children:[n.jsx("strong",{children:"Résumé par table :"}),n.jsx("div",{style:{marginTop:"8px",display:"flex",flexDirection:"column",gap:"4px"},children:[se.id,...se.merged_with||[]].map(w=>{const ae=d.find(ge=>ge.id===w),S=_e.filter(ge=>Ce[ge.id]===w),he=S.reduce((ge,Te)=>ge+Te.quantity*Te.unit_price,0);return n.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[n.jsxs("span",{children:[ae?.table_number," :"]}),n.jsxs("span",{children:[S.length," article(s) - ",he.toLocaleString()," FCFA"]})]},w)})})]})]}):n.jsx("p",{style:{color:"#6b7280",textAlign:"center",padding:"20px"},children:"Aucune commande en cours. Les tables seront simplement libérées."})]}),n.jsxs("div",{className:"modal-actions",children:[n.jsx("button",{className:"btn-secondary",onClick:()=>{ce(!1),ee(null),ue([]),F({})},children:"Annuler"}),n.jsx("button",{className:"btn-primary",onClick:en,children:"Confirmer la séparation"})]})]})}),ne&&le&&n.jsx("div",{className:"modal-overlay",onClick:()=>K(!1),children:n.jsxs("div",{className:"modal-content",onClick:w=>w.stopPropagation(),children:[n.jsxs("div",{className:"modal-header",children:[n.jsx("h3",{children:"Modifier la table"}),n.jsx("button",{className:"close-btn",onClick:()=>K(!1),children:"×"})]}),n.jsxs("div",{className:"modal-body",children:[n.jsxs("div",{className:"form-group",children:[n.jsx("label",{children:"Numéro de table *"}),n.jsx("input",{type:"text",value:R.table_number,onChange:w=>X({...R,table_number:w.target.value}),placeholder:"Ex: Table 1, T1, VIP1..."})]}),n.jsxs("div",{className:"form-group",children:[n.jsx("label",{children:"Capacité (nombre de couverts) *"}),n.jsx("input",{type:"number",min:"1",value:R.capacity,onChange:w=>X({...R,capacity:w.target.value}),placeholder:"Ex: 4"})]}),n.jsxs("div",{className:"form-group",children:[n.jsx("label",{children:"Zone / Section"}),n.jsx("input",{type:"text",value:R.zone,onChange:w=>X({...R,zone:w.target.value}),placeholder:"Ex: Terrasse, Intérieur, VIP..."})]}),n.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"12px"},children:[n.jsxs("div",{className:"form-group",children:[n.jsx("label",{children:"Position X (plan de salle)"}),n.jsx("input",{type:"number",value:R.position_x,onChange:w=>X({...R,position_x:w.target.value}),placeholder:"0"})]}),n.jsxs("div",{className:"form-group",children:[n.jsx("label",{children:"Position Y (plan de salle)"}),n.jsx("input",{type:"number",value:R.position_y,onChange:w=>X({...R,position_y:w.target.value}),placeholder:"0"})]})]}),n.jsx("p",{style:{fontSize:"13px",color:"#6b7280",marginTop:"8px"},children:"* Champs obligatoires"})]}),n.jsxs("div",{className:"modal-actions",children:[n.jsx("button",{className:"btn-secondary",onClick:()=>{K(!1),Ee(null)},children:"Annuler"}),n.jsx("button",{className:"btn-primary",onClick:$n,children:"Enregistrer les modifications"})]})]})})]})}function Fj(){const{canCreate:o,canUpdate:i,canDelete:r,hasPermission:l}=Zr(),[c,d]=y.useState([]),[f,g]=y.useState([]),[m,p]=y.useState([]),[_,j]=y.useState([]),[C,N]=y.useState([]),[k,P]=y.useState({}),[E,V]=y.useState({}),[L,U]=y.useState(!0),[O,M]=y.useState(!1),[G,q]=y.useState(!1),[Y,T]=y.useState(null),[ce,se]=y.useState(null),[ee,_e]=y.useState({login:"",password:"",full_name:"",email:"",role_id:"",phone:"",hourly_rate:"",personal_offer_limit:0,allowed_product_families:[],points_of_sale:[],is_active:!0});y.useEffect(()=>{ue()},[]);async function ue(){U(!0);try{const[$,D,re,we,Ne,nt,Le]=await Promise.all([A.from("employees").select("*, roles(name, level)").order("full_name"),A.from("roles").select("*").eq("is_active",!0).order("level"),A.from("sales_points").select("id, name, type").eq("is_active",!0),A.from("product_categories").select("id, name").is("parent_id",null),A.from("permissions").select("*").order("module",{ascending:!0}),A.from("role_permissions").select("role_id, permission_id"),A.from("employee_permissions").select("employee_id, permission_id, is_granted")]);if($.error)throw $.error;if(D.error)throw D.error;if(re.error)throw re.error;if(we.error)throw we.error;if(Ne.error)throw Ne.error;if(nt.error)throw nt.error;if(Le.error)throw Le.error;d($.data||[]),g(D.data||[]),p(re.data||[]),j(we.data||[]),N(Ne.data||[]);const Ue={};(nt.data||[]).forEach(We=>{Ue[We.role_id]||(Ue[We.role_id]=[]),Ue[We.role_id].push(We.permission_id)}),P(Ue);const lt={};(Le.data||[]).forEach(We=>{lt[We.employee_id]||(lt[We.employee_id]={}),lt[We.employee_id][We.permission_id]=We.is_granted}),V(lt)}catch($){console.error("Erreur lors du chargement:",$),alert("Erreur lors du chargement des données")}finally{U(!1)}}function Ce(){T(null),_e({login:"",password:"",full_name:"",email:"",role_id:"",phone:"",hourly_rate:"",personal_offer_limit:0,personal_offer_max_amount:0,allowed_product_families:[],points_of_sale:[],is_active:!0}),M(!0)}function F($){T($),_e({login:$.login||"",password:"",full_name:$.full_name||"",email:$.email||"",role_id:$.role_id||"",phone:$.phone||"",hourly_rate:$.hourly_rate||"",personal_offer_limit:$.personal_offer_limit||0,personal_offer_max_amount:$.personal_offer_max_amount||0,allowed_product_families:$.allowed_product_families||[],points_of_sale:$.points_of_sale||[],is_active:$.is_active!==!1}),M(!0)}async function ne($){if($.preventDefault(),!ee.login||!ee.full_name||!ee.role_id){alert("Veuillez remplir tous les champs obligatoires");return}if(!Y&&!ee.password){alert("Le mot de passe est obligatoire pour un nouvel utilisateur");return}try{const D={action:Y?"update":"create",data:{id:Y?.id,login:ee.login,password:ee.password||void 0,full_name:ee.full_name,email:ee.email||null,role_id:ee.role_id,phone:ee.phone||null,hourly_rate:ee.hourly_rate?parseFloat(ee.hourly_rate):null,personal_offer_limit:parseInt(ee.personal_offer_limit)||0,personal_offer_max_amount:parseFloat(ee.personal_offer_max_amount)||0,allowed_product_families:ee.allowed_product_families,points_of_sale:ee.points_of_sale,is_active:ee.is_active}},Ne=await(await fetch("https://lcknhxrksephkshpvfmp.supabase.co/functions/v1/manage-employee",{method:"POST",headers:{Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imxja25oeHJrc2VwaGtzaHB2Zm1wIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA2MjUxNTAsImV4cCI6MjA3NjIwMTE1MH0.4HAG-6vgyHxRfmakn9CgJiMMbVO1lBYbIYYq3ZDdjv0","Content-Type":"application/json"},body:JSON.stringify(D)})).json();if(!Ne.success)throw new Error(Ne.error||"Erreur lors de la sauvegarde");M(!1),ue()}catch(D){console.error("Erreur lors de la sauvegarde:",D),alert("Erreur: "+D.message)}}async function K($){if(confirm(`Êtes-vous sûr de vouloir supprimer l'utilisateur "${$.full_name}" ?`))try{const{error:D}=await A.from("employees").delete().eq("id",$.id);if(D)throw D;ue()}catch(D){console.error("Erreur lors de la suppression:",D),alert("Erreur: "+D.message)}}function le($){_e(D=>({...D,allowed_product_families:D.allowed_product_families.includes($)?D.allowed_product_families.filter(re=>re!==$):[...D.allowed_product_families,$]}))}function Ee($){_e(D=>({...D,points_of_sale:D.points_of_sale.includes($)?D.points_of_sale.filter(re=>re!==$):[...D.points_of_sale,$]}))}function R($){se($),q(!0)}function X($,D,re){const we=E[$]||{};return we[D]!==void 0?{state:we[D]?"granted":"revoked",custom:!0}:{state:k[re]?.includes(D)?"granted":"none",custom:!1}}async function fe($,D,re){const we=X($,D,re),Ne=k[re]?.includes(D);try{if(we.custom)await A.from("employee_permissions").delete().eq("employee_id",$).eq("permission_id",D);else{const nt=!Ne;await A.from("employee_permissions").upsert({employee_id:$,permission_id:D,is_granted:nt},{onConflict:"employee_id,permission_id"})}await ue()}catch(nt){console.error("Erreur:",nt),alert("Erreur lors de la modification de la permission")}}function be(){const $={};return C.forEach(D=>{$[D.module]||($[D.module]=[]),$[D.module].push(D)}),$}return L?n.jsx("div",{className:"users-page loading",children:"Chargement..."}):n.jsxs("div",{className:"users-page",children:[n.jsxs("div",{className:"users-header",children:[n.jsx("h1",{children:"Gestion des Utilisateurs"}),o("users")&&n.jsx("button",{className:"btn-primary",onClick:Ce,children:"Nouvel Utilisateur"})]}),n.jsx("div",{className:"users-table-container",children:n.jsxs("table",{className:"users-table",children:[n.jsx("thead",{children:n.jsxs("tr",{children:[n.jsx("th",{children:"Nom"}),n.jsx("th",{children:"Login"}),n.jsx("th",{children:"Rôle"}),n.jsx("th",{children:"Email"}),n.jsx("th",{children:"Téléphone"}),n.jsx("th",{children:"Offerts/jour"}),n.jsx("th",{children:"Statut"}),n.jsx("th",{children:"Actions"})]})}),n.jsx("tbody",{children:c.map($=>n.jsxs("tr",{className:$.is_active?"":"inactive",children:[n.jsx("td",{children:$.full_name}),n.jsx("td",{children:$.login}),n.jsx("td",{children:n.jsx("span",{className:`role-badge level-${$.roles?.level||3}`,children:$.roles?.name||$.role})}),n.jsx("td",{children:$.email||"-"}),n.jsx("td",{children:$.phone||"-"}),n.jsx("td",{children:$.personal_offer_limit||0}),n.jsx("td",{children:n.jsx("span",{className:`status-badge ${$.is_active?"active":"inactive"}`,children:$.is_active?"Actif":"Inactif"})}),n.jsx("td",{children:n.jsxs("div",{className:"actions",children:[i("users")&&n.jsx("button",{className:"btn-icon",onClick:()=>F($),title:"Modifier",children:"✏️"}),l("users","manage_permissions")&&n.jsx("button",{className:"btn-icon",onClick:()=>R($),title:"Permissions",children:"🔐"}),r("users")&&n.jsx("button",{className:"btn-icon delete",onClick:()=>K($),title:"Supprimer",children:"🗑️"})]})})]},$.id))})]})}),G&&ce&&n.jsx("div",{className:"modal-overlay",onClick:()=>q(!1),children:n.jsxs("div",{className:"modal-content large",onClick:$=>$.stopPropagation(),children:[n.jsxs("div",{className:"modal-header",children:[n.jsxs("div",{children:[n.jsxs("h2",{children:["Permissions de ",ce.full_name]}),n.jsxs("p",{className:"modal-subtitle",children:["Rôle de base : ",ce.roles?.name||ce.role]}),n.jsx("p",{className:"modal-info",children:"✓ = Accordée par le rôle | + = Accordée personnellement | - = Révoquée personnellement | ○ = Non accordée par le rôle"}),n.jsx("p",{className:"modal-info",children:"💡 Cliquez sur une permission pour basculer entre l'état hérité du rôle et un état personnalisé"})]}),n.jsx("button",{className:"close-btn",onClick:()=>q(!1),children:"×"})]}),n.jsx("div",{className:"permissions-modal-content",children:Object.entries(be()).map(([$,D])=>n.jsxs("div",{className:"permission-module-section",children:[n.jsx("h3",{className:"module-title",children:$}),n.jsx("div",{className:"permissions-list",children:D.map(re=>{const we=X(ce.id,re.id,ce.role_id);return n.jsxs("div",{className:`permission-item ${we.state} ${we.custom?"custom":""}`,onClick:()=>fe(ce.id,re.id,ce.role_id),children:[n.jsxs("div",{className:"permission-status",children:[we.custom&&we.state==="granted"&&n.jsx("span",{className:"icon",children:"+"}),we.custom&&we.state==="revoked"&&n.jsx("span",{className:"icon",children:"-"}),!we.custom&&we.state==="granted"&&n.jsx("span",{className:"icon",children:"✓"}),!we.custom&&we.state==="none"&&n.jsx("span",{className:"icon empty",children:"○"})]}),n.jsx("div",{className:"permission-label",children:re.display_name||re.action})]},re.id)})})]},$))}),n.jsx("div",{className:"modal-actions",children:n.jsx("button",{className:"btn-primary",onClick:()=>q(!1),children:"Fermer"})})]})}),O&&n.jsx("div",{className:"modal-overlay",onClick:()=>M(!1),children:n.jsxs("div",{className:"modal-content",onClick:$=>$.stopPropagation(),children:[n.jsxs("div",{className:"modal-header",children:[n.jsx("h2",{children:Y?"Modifier l'utilisateur":"Nouvel utilisateur"}),n.jsx("button",{className:"close-btn",onClick:()=>M(!1),children:"×"})]}),n.jsxs("form",{onSubmit:ne,children:[n.jsxs("div",{className:"form-grid",children:[n.jsxs("div",{className:"form-group",children:[n.jsx("label",{children:"Nom complet *"}),n.jsx("input",{type:"text",value:ee.full_name,onChange:$=>_e({...ee,full_name:$.target.value}),required:!0})]}),n.jsxs("div",{className:"form-group",children:[n.jsx("label",{children:"Login *"}),n.jsx("input",{type:"text",value:ee.login,onChange:$=>_e({...ee,login:$.target.value}),required:!0})]}),n.jsxs("div",{className:"form-group",children:[n.jsxs("label",{children:["Mot de passe ",!Y&&"*"]}),n.jsx("input",{type:"password",value:ee.password,onChange:$=>_e({...ee,password:$.target.value}),placeholder:Y?"Laisser vide pour ne pas modifier":"",required:!Y})]}),n.jsxs("div",{className:"form-group",children:[n.jsx("label",{children:"Rôle *"}),n.jsxs("select",{value:ee.role_id,onChange:$=>_e({...ee,role_id:$.target.value}),required:!0,children:[n.jsx("option",{value:"",children:"Sélectionner un rôle"}),f.map($=>n.jsxs("option",{value:$.id,children:[$.name," - ",$.description]},$.id))]})]}),n.jsxs("div",{className:"form-group",children:[n.jsx("label",{children:"Email"}),n.jsx("input",{type:"email",value:ee.email,onChange:$=>_e({...ee,email:$.target.value})})]}),n.jsxs("div",{className:"form-group",children:[n.jsx("label",{children:"Téléphone"}),n.jsx("input",{type:"tel",value:ee.phone,onChange:$=>_e({...ee,phone:$.target.value})})]}),n.jsxs("div",{className:"form-group",children:[n.jsx("label",{children:"Taux horaire (€)"}),n.jsx("input",{type:"number",step:"0.01",value:ee.hourly_rate,onChange:$=>_e({...ee,hourly_rate:$.target.value})})]}),n.jsxs("div",{className:"form-group",children:[n.jsx("label",{children:"Limite offerts/jour"}),n.jsx("input",{type:"number",value:ee.personal_offer_limit,onChange:$=>_e({...ee,personal_offer_limit:$.target.value})})]}),n.jsxs("div",{className:"form-group",children:[n.jsx("label",{children:"Montant max par offert (FCFA)"}),n.jsx("input",{type:"number",step:"0.01",value:ee.personal_offer_max_amount||0,onChange:$=>_e({...ee,personal_offer_max_amount:$.target.value})})]})]}),n.jsxs("div",{className:"form-section",children:[n.jsx("h3",{children:"Points de vente autorisés"}),n.jsx("div",{className:"checkbox-grid",children:m.map($=>n.jsxs("label",{className:"checkbox-label",children:[n.jsx("input",{type:"checkbox",checked:ee.points_of_sale.includes($.id),onChange:()=>Ee($.id)}),n.jsxs("span",{children:[$.name," (",$.type,")"]})]},$.id))})]}),n.jsxs("div",{className:"form-section",children:[n.jsx("h3",{children:"Familles de produits autorisées pour offerts"}),n.jsx("div",{className:"checkbox-grid",children:_.map($=>n.jsxs("label",{className:"checkbox-label",children:[n.jsx("input",{type:"checkbox",checked:ee.allowed_product_families.includes($.id),onChange:()=>le($.id)}),n.jsx("span",{children:$.name})]},$.id))})]}),n.jsx("div",{className:"form-group",children:n.jsxs("label",{className:"checkbox-label",children:[n.jsx("input",{type:"checkbox",checked:ee.is_active,onChange:$=>_e({...ee,is_active:$.target.checked})}),n.jsx("span",{children:"Utilisateur actif"})]})}),n.jsxs("div",{className:"modal-actions",children:[n.jsx("button",{type:"button",className:"btn-secondary",onClick:()=>M(!1),children:"Annuler"}),n.jsx("button",{type:"submit",className:"btn-primary",children:Y?"Enregistrer":"Créer"})]})]})]})})]})}function Hj(){const[o,i]=y.useState([]),[r,l]=y.useState(!0),[c,d]=y.useState({module:"",action_type:"",employee_id:"",date_from:"",date_to:""}),[f,g]=y.useState([]);y.useEffect(()=>{m(),p()},[]);async function m(){try{const{data:E,error:V}=await A.from("employees").select("id, full_name").eq("is_active",!0).order("full_name");if(V)throw V;g(E||[])}catch(E){console.error("Erreur lors du chargement des employés:",E)}}async function p(){l(!0);try{let E=A.from("user_action_logs").select("*, employees(full_name)").order("created_at",{ascending:!1}).limit(200);c.module&&(E=E.eq("module",c.module)),c.action_type&&(E=E.eq("action_type",c.action_type)),c.employee_id&&(E=E.eq("employee_id",c.employee_id)),c.date_from&&(E=E.gte("created_at",c.date_from)),c.date_to&&(E=E.lte("created_at",c.date_to+"T23:59:59"));const{data:V,error:L}=await E;if(L)throw L;i(V||[])}catch(E){console.error("Erreur lors du chargement des logs:",E),alert("Erreur lors du chargement des logs")}finally{l(!1)}}function _(E,V){d(L=>({...L,[E]:V}))}function j(){p()}function C(){d({module:"",action_type:"",employee_id:"",date_from:"",date_to:""}),setTimeout(()=>p(),0)}function N(E){return new Date(E).toLocaleString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})}function k(E){return{login:"Connexion",logout:"Déconnexion",create_order:"Création commande",modify_order:"Modification commande",void_order:"Annulation commande",apply_discount:"Application remise",apply_personal_offer:"Offert personnel",close_cash_register:"Clôture caisse",create_product:"Création produit",update_product:"Modification produit",delete_product:"Suppression produit",create_user:"Création utilisateur",update_user:"Modification utilisateur",delete_user:"Suppression utilisateur",validate_inventory:"Validation inventaire",stock_movement:"Mouvement stock",update_price:"Mise à jour prix",manage_credit:"Gestion crédit client"}[E]||E}function P(E){return{pos:"Point de vente",inventory:"Inventaire",products:"Produits",users:"Utilisateurs",reports:"Rapports",clients:"Clients",tables:"Tables",settings:"Paramètres",auth:"Authentification"}[E]||E}return r?n.jsx("div",{className:"action-logs-page loading",children:"Chargement..."}):n.jsxs("div",{className:"action-logs-page",children:[n.jsx("div",{className:"logs-header",children:n.jsx("h1",{children:"Historique des Actions"})}),n.jsxs("div",{className:"filters-section",children:[n.jsxs("div",{className:"filters-grid",children:[n.jsxs("div",{className:"filter-group",children:[n.jsx("label",{children:"Module"}),n.jsxs("select",{value:c.module,onChange:E=>_("module",E.target.value),children:[n.jsx("option",{value:"",children:"Tous"}),n.jsx("option",{value:"pos",children:"Point de vente"}),n.jsx("option",{value:"inventory",children:"Inventaire"}),n.jsx("option",{value:"products",children:"Produits"}),n.jsx("option",{value:"users",children:"Utilisateurs"}),n.jsx("option",{value:"clients",children:"Clients"}),n.jsx("option",{value:"auth",children:"Authentification"})]})]}),n.jsxs("div",{className:"filter-group",children:[n.jsx("label",{children:"Employé"}),n.jsxs("select",{value:c.employee_id,onChange:E=>_("employee_id",E.target.value),children:[n.jsx("option",{value:"",children:"Tous"}),f.map(E=>n.jsx("option",{value:E.id,children:E.full_name},E.id))]})]}),n.jsxs("div",{className:"filter-group",children:[n.jsx("label",{children:"Date début"}),n.jsx("input",{type:"date",value:c.date_from,onChange:E=>_("date_from",E.target.value)})]}),n.jsxs("div",{className:"filter-group",children:[n.jsx("label",{children:"Date fin"}),n.jsx("input",{type:"date",value:c.date_to,onChange:E=>_("date_to",E.target.value)})]})]}),n.jsxs("div",{className:"filter-actions",children:[n.jsx("button",{className:"btn-secondary",onClick:C,children:"Réinitialiser"}),n.jsx("button",{className:"btn-primary",onClick:j,children:"Rechercher"})]})]}),n.jsx("div",{className:"logs-table-container",children:n.jsxs("table",{className:"logs-table",children:[n.jsx("thead",{children:n.jsxs("tr",{children:[n.jsx("th",{children:"Date et heure"}),n.jsx("th",{children:"Employé"}),n.jsx("th",{children:"Module"}),n.jsx("th",{children:"Action"}),n.jsx("th",{children:"Détails"}),n.jsx("th",{children:"IP"})]})}),n.jsx("tbody",{children:o.length===0?n.jsx("tr",{children:n.jsx("td",{colSpan:"6",className:"no-data",children:"Aucun log trouvé"})}):o.map(E=>n.jsxs("tr",{children:[n.jsx("td",{children:N(E.created_at)}),n.jsx("td",{children:E.employees?.full_name||"Système"}),n.jsx("td",{children:n.jsx("span",{className:"module-badge",children:P(E.module)})}),n.jsx("td",{children:k(E.action_type)}),n.jsx("td",{className:"details-cell",children:E.details&&Object.keys(E.details).length>0?n.jsx("pre",{children:JSON.stringify(E.details,null,2)}):"-"}),n.jsx("td",{children:E.ip_address||"-"})]},E.id))})]})})]})}const $j=()=>{const[o,i]=y.useState([]),[r,l]=y.useState([]),[c,d]=y.useState({}),[f,g]=y.useState(!0),[m,p]=y.useState(null),[_,j]=y.useState(!1),[C,N]=y.useState("create"),[k,P]=y.useState({name:"",description:"",level:3,is_active:!0,personal_offer_limit:0,personal_offer_max_amount:0});y.useEffect(()=>{E()},[]);const E=async()=>{g(!0);try{const[Y,T,ce]=await Promise.all([A.from("roles").select("*").order("level",{ascending:!0}),A.from("permissions").select("*").order("module",{ascending:!0}),A.from("role_permissions").select("role_id, permission_id")]);if(Y.error)throw Y.error;if(T.error)throw T.error;if(ce.error)throw ce.error;i(Y.data||[]),l(T.data||[]);const se={};(ce.data||[]).forEach(ee=>{se[ee.role_id]||(se[ee.role_id]=[]),se[ee.role_id].push(ee.permission_id)}),d(se)}catch(Y){console.error("Erreur lors du chargement:",Y),alert("Erreur lors du chargement des données")}finally{g(!1)}},V=(Y,T=null)=>{N(Y),Y==="edit"&&T?(P({name:T.name,description:T.description||"",level:T.level,is_active:T.is_active,personal_offer_limit:T.personal_offer_limit||0,personal_offer_max_amount:T.personal_offer_max_amount||0}),p(T)):(P({name:"",description:"",level:3,is_active:!0,personal_offer_limit:0,personal_offer_max_amount:0}),p(null)),j(!0)},L=()=>{j(!1),p(null)},U=async Y=>{if(Y.preventDefault(),!k.name.trim()){alert("Le nom du rôle est requis");return}try{if(C==="create"){const{error:T}=await A.from("roles").insert([k]);if(T)throw T}else{const{error:T}=await A.from("roles").update(k).eq("id",m.id);if(T)throw T}await E(),L()}catch(T){console.error("Erreur:",T),alert("Erreur lors de l'enregistrement: "+T.message)}},O=async Y=>{if(confirm(`Êtes-vous sûr de vouloir supprimer le rôle "${Y.name}" ?`))try{const{error:T}=await A.from("roles").delete().eq("id",Y.id);if(T)throw T;await E()}catch(T){console.error("Erreur:",T),alert("Erreur lors de la suppression: "+T.message)}},M=async(Y,T)=>{const ce=c[Y]?.includes(T);try{if(ce){const{error:se}=await A.from("role_permissions").delete().eq("role_id",Y).eq("permission_id",T);if(se)throw se}else{const{error:se}=await A.from("role_permissions").insert([{role_id:Y,permission_id:T}]);if(se)throw se}await E()}catch(se){console.error("Erreur:",se),alert("Erreur lors de la modification de la permission")}},G=()=>{const Y={};return r.forEach(T=>{Y[T.module]||(Y[T.module]=[]),Y[T.module].push(T)}),Y};if(f)return n.jsx("div",{className:"loading",children:"Chargement..."});const q=G();return n.jsxs("div",{className:"roles-container",children:[n.jsxs("div",{className:"roles-header",children:[n.jsx("h2",{children:"Gestion des Rôles"}),n.jsx("button",{className:"btn-primary",onClick:()=>V("create"),children:"Nouveau Rôle"})]}),n.jsx("div",{className:"roles-list",children:o.map(Y=>n.jsxs("div",{className:"role-card",children:[n.jsxs("div",{className:"role-card-header",children:[n.jsxs("div",{children:[n.jsx("h3",{children:Y.name}),n.jsx("p",{className:"role-description",children:Y.description}),n.jsxs("div",{className:"role-badges",children:[n.jsxs("span",{className:`role-badge level-${Y.level}`,children:["Niveau ",Y.level]}),!Y.is_active&&n.jsx("span",{className:"role-badge inactive",children:"Inactif"})]}),(Y.personal_offer_limit>0||Y.personal_offer_max_amount>0)&&n.jsxs("p",{className:"role-offers",children:["🎁 Offerts: ",Y.personal_offer_limit||0,"/jour · Max ",Y.personal_offer_max_amount||0,"€"]})]}),n.jsxs("div",{className:"role-actions",children:[n.jsx("button",{className:"btn-icon edit",onClick:()=>V("edit",Y),title:"Modifier",children:"✏️"}),n.jsx("button",{className:"btn-icon delete",onClick:()=>O(Y),title:"Supprimer",children:"🗑️"})]})]}),n.jsxs("div",{className:"permissions-section",children:[n.jsx("h4",{children:"Permissions"}),n.jsx("div",{className:"permissions-grid",children:Object.keys(q).map(T=>n.jsxs("div",{className:"module-permissions",children:[n.jsx("div",{className:"module-name",children:T}),n.jsx("div",{className:"permission-checks",children:q[T].map(ce=>n.jsxs("label",{className:"permission-check",children:[n.jsx("input",{type:"checkbox",checked:c[Y.id]?.includes(ce.id)||!1,onChange:()=>M(Y.id,ce.id)}),n.jsx("span",{children:ce.display_name||ce.action})]},ce.id))})]},T))})]})]},Y.id))}),_&&n.jsx("div",{className:"modal-overlay",onClick:L,children:n.jsxs("div",{className:"modal-content",onClick:Y=>Y.stopPropagation(),children:[n.jsxs("div",{className:"modal-header",children:[n.jsx("h3",{children:C==="create"?"Nouveau Rôle":"Modifier le Rôle"}),n.jsx("button",{className:"modal-close",onClick:L,children:"✕"})]}),n.jsxs("form",{onSubmit:U,children:[n.jsxs("div",{className:"form-group",children:[n.jsx("label",{children:"Nom du rôle *"}),n.jsx("input",{type:"text",value:k.name,onChange:Y=>P({...k,name:Y.target.value}),required:!0})]}),n.jsxs("div",{className:"form-group",children:[n.jsx("label",{children:"Description"}),n.jsx("textarea",{value:k.description,onChange:Y=>P({...k,description:Y.target.value}),rows:"3"})]}),n.jsxs("div",{className:"form-group",children:[n.jsx("label",{children:"Niveau hiérarchique"}),n.jsxs("select",{value:k.level,onChange:Y=>P({...k,level:parseInt(Y.target.value)}),children:[n.jsx("option",{value:"1",children:"1 - Administrateur"}),n.jsx("option",{value:"2",children:"2 - Manager"}),n.jsx("option",{value:"3",children:"3 - Employé"})]})]}),n.jsxs("div",{className:"form-group",children:[n.jsx("label",{children:"Offerts personnels - Limite par jour"}),n.jsx("input",{type:"number",min:"0",value:k.personal_offer_limit,onChange:Y=>P({...k,personal_offer_limit:parseInt(Y.target.value)||0})}),n.jsx("small",{children:"Nombre d'offerts autorisés par jour (0 = aucun offert autorisé)"})]}),n.jsxs("div",{className:"form-group",children:[n.jsx("label",{children:"Offerts personnels - Montant maximum"}),n.jsx("input",{type:"number",min:"0",step:"0.01",value:k.personal_offer_max_amount,onChange:Y=>P({...k,personal_offer_max_amount:parseFloat(Y.target.value)||0})}),n.jsx("small",{children:"Montant maximum par offert en € (0 = pas de limite)"})]}),n.jsx("div",{className:"form-group",children:n.jsxs("label",{className:"checkbox-label",children:[n.jsx("input",{type:"checkbox",checked:k.is_active,onChange:Y=>P({...k,is_active:Y.target.checked})}),n.jsx("span",{children:"Rôle actif"})]})}),n.jsxs("div",{className:"modal-actions",children:[n.jsx("button",{type:"button",className:"btn-secondary",onClick:L,children:"Annuler"}),n.jsx("button",{type:"submit",className:"btn-primary",children:C==="create"?"Créer":"Enregistrer"})]})]})]})})]})};function Ij(){const{user:o}=$s(),[i,r]=y.useState([]),[l,c]=y.useState(!0),[d,f]=y.useState({voidType:"all",dateFrom:"",dateTo:"",salesPoint:"all"}),[g,m]=y.useState([]);y.useEffect(()=>{p(),_()},[d]);const p=async()=>{try{const{data:N,error:k}=await A.from("sales_points").select("id, name").eq("is_active",!0).order("name");if(k)throw k;m(N||[])}catch(N){console.error("Erreur chargement points de vente:",N)}},_=async()=>{try{c(!0);let N=A.from("void_logs").select(`
          *,
          employees!voided_by(full_name),
          sales_points(name)
        `).order("voided_at",{ascending:!1});d.voidType!=="all"&&(N=N.eq("void_type",d.voidType)),d.dateFrom&&(N=N.gte("voided_at",d.dateFrom+"T00:00:00")),d.dateTo&&(N=N.lte("voided_at",d.dateTo+"T23:59:59")),d.salesPoint!=="all"&&(N=N.eq("sales_point_id",d.salesPoint));const{data:k,error:P}=await N;if(P)throw P;r(k||[])}catch(N){console.error("Erreur chargement logs:",N),alert("Erreur lors du chargement des logs")}finally{c(!1)}},j=()=>i.reduce((N,k)=>N+parseFloat(k.amount_voided),0),C=N=>N?N.items?N.items.map(k=>`${k.product_name} (x${k.quantity})`).join(", "):`${N.product_name} (x${N.quantity})`:"N/A";return n.jsxs("div",{className:"void-logs-container",children:[n.jsx("div",{className:"page-header",children:n.jsx("h1",{children:"Historique des Annulations"})}),n.jsxs("div",{className:"filters-section",children:[n.jsxs("div",{className:"filter-group",children:[n.jsx("label",{children:"Type:"}),n.jsxs("select",{value:d.voidType,onChange:N=>f({...d,voidType:N.target.value}),children:[n.jsx("option",{value:"all",children:"Tous"}),n.jsx("option",{value:"line",children:"Lignes"}),n.jsx("option",{value:"ticket",children:"Tickets"})]})]}),n.jsxs("div",{className:"filter-group",children:[n.jsx("label",{children:"Du:"}),n.jsx("input",{type:"date",value:d.dateFrom,onChange:N=>f({...d,dateFrom:N.target.value})})]}),n.jsxs("div",{className:"filter-group",children:[n.jsx("label",{children:"Au:"}),n.jsx("input",{type:"date",value:d.dateTo,onChange:N=>f({...d,dateTo:N.target.value})})]}),n.jsxs("div",{className:"filter-group",children:[n.jsx("label",{children:"Point de vente:"}),n.jsxs("select",{value:d.salesPoint,onChange:N=>f({...d,salesPoint:N.target.value}),children:[n.jsx("option",{value:"all",children:"Tous"}),g.map(N=>n.jsx("option",{value:N.id,children:N.name},N.id))]})]}),n.jsx("button",{className:"btn-reset",onClick:()=>f({voidType:"all",dateFrom:"",dateTo:"",salesPoint:"all"}),children:"Réinitialiser"})]}),n.jsxs("div",{className:"stats-summary",children:[n.jsxs("div",{className:"stat-card",children:[n.jsx("div",{className:"stat-label",children:"Total annulations"}),n.jsx("div",{className:"stat-value",children:i.length})]}),n.jsxs("div",{className:"stat-card",children:[n.jsx("div",{className:"stat-label",children:"Lignes annulées"}),n.jsx("div",{className:"stat-value",children:i.filter(N=>N.void_type==="line").length})]}),n.jsxs("div",{className:"stat-card",children:[n.jsx("div",{className:"stat-label",children:"Tickets annulés"}),n.jsx("div",{className:"stat-value",children:i.filter(N=>N.void_type==="ticket").length})]}),n.jsxs("div",{className:"stat-card highlight",children:[n.jsx("div",{className:"stat-label",children:"Montant total annulé"}),n.jsxs("div",{className:"stat-value",children:[j().toFixed(0)," FCFA"]})]})]}),l?n.jsx("div",{className:"loading",children:"Chargement..."}):i.length===0?n.jsx("div",{className:"no-data",children:"Aucune annulation trouvée"}):n.jsx("div",{className:"logs-table-container",children:n.jsxs("table",{className:"logs-table",children:[n.jsx("thead",{children:n.jsxs("tr",{children:[n.jsx("th",{children:"Date/Heure"}),n.jsx("th",{children:"Type"}),n.jsx("th",{children:"Point de vente"}),n.jsx("th",{children:"Produits"}),n.jsx("th",{children:"Montant"}),n.jsx("th",{children:"Annulé par"}),n.jsx("th",{children:"Raison"})]})}),n.jsx("tbody",{children:i.map(N=>n.jsxs("tr",{children:[n.jsx("td",{children:new Date(N.voided_at).toLocaleString("fr-FR")}),n.jsx("td",{children:n.jsx("span",{className:`badge badge-${N.void_type}`,children:N.void_type==="line"?"Ligne":"Ticket"})}),n.jsx("td",{children:N.sales_points?.name||"N/A"}),n.jsx("td",{className:"products-cell",children:C(N.product_details)}),n.jsxs("td",{className:"amount-cell",children:[parseFloat(N.amount_voided).toFixed(0)," FCFA"]}),n.jsx("td",{children:N.employees?.full_name||"N/A"}),n.jsx("td",{className:"reason-cell",children:N.void_reason||"-"})]},N.id))})]})})]})}function xg(){const[o,i]=y.useState([]),[r,l]=y.useState(!1),[c,d]=y.useState(null),[f,g]=y.useState(!0),[m,p]=y.useState(""),[_,j]=y.useState({supplier_code:"",name:"",contact_person:"",email:"",phone:"",address:"",payment_terms:"30 jours fin de mois",notes:"",is_active:!0});y.useEffect(()=>{N()},[]);function C(O,M){if(!M||!O)return null;const G=new Date(O),q=M.toLowerCase();if(q.includes("fin de mois"))return parseInt(q.match(/\d+/)?.[0]||30),G.setMonth(G.getMonth()+1),new Date(G.getFullYear(),G.getMonth(),0);if(q.includes("jours")){const Y=parseInt(q.match(/\d+/)?.[0]||30);return G.setDate(G.getDate()+Y),G}return G.setDate(G.getDate()+30),G}async function N(){try{g(!0);const{data:O,error:M}=await A.from("suppliers").select("*").order("supplier_code",{ascending:!0});if(M)throw M;const{data:G,error:q}=await A.from("purchase_orders").select("id, supplier_id, total_with_vat, status").in("status",["sent","partially_received"]);if(q)throw q;const{data:Y,error:T}=await A.from("purchase_receptions").select("id, purchase_order_id, reception_date, status").eq("status","completed");if(T)throw T;const ce=O.map(se=>{const ee=G.filter(F=>F.supplier_id===se.id),_e=ee.reduce((F,ne)=>F+parseFloat(ne.total_with_vat||0),0),ue=new Date;ue.setHours(0,0,0,0);const Ce=ee.reduce((F,ne)=>{const K=Y.filter(le=>le.purchase_order_id===ne.id);if(K.length>0){const le=K.sort((R,X)=>new Date(X.reception_date)-new Date(R.reception_date))[0],Ee=C(le.reception_date,se.payment_terms);if(Ee&&(Ee.setHours(0,0,0,0),Ee<ue))return F+parseFloat(ne.total_with_vat||0)}return F},0);return{...se,total_due:_e,overdue_amount:Ce,pending_orders:ee.length}});i(ce||[])}catch(O){console.error("Erreur chargement fournisseurs:",O),alert("Erreur lors du chargement des fournisseurs")}finally{g(!1)}}function k(O){const{name:M,value:G,type:q,checked:Y}=O.target;j(T=>({...T,[M]:q==="checkbox"?Y:G}))}async function P(O){if(O.preventDefault(),!_.supplier_code.trim()||!_.name.trim()){alert("Le code fournisseur et le nom sont obligatoires");return}try{if(c){const{error:M}=await A.from("suppliers").update({..._,updated_at:new Date().toISOString()}).eq("id",c.id);if(M)throw M;alert("Fournisseur modifié avec succès")}else{const{error:M}=await A.from("suppliers").insert([_]);if(M)throw M;alert("Fournisseur créé avec succès")}L(),N()}catch(M){console.error("Erreur sauvegarde fournisseur:",M),alert("Erreur: "+M.message)}}function E(O){d(O),j({supplier_code:O.supplier_code,name:O.name,contact_person:O.contact_person||"",email:O.email||"",phone:O.phone||"",address:O.address||"",payment_terms:O.payment_terms||"30 jours fin de mois",notes:O.notes||"",is_active:O.is_active}),l(!0)}async function V(O){if(confirm("Êtes-vous sûr de vouloir supprimer ce fournisseur ?"))try{const{error:M}=await A.from("suppliers").delete().eq("id",O);if(M)throw M;alert("Fournisseur supprimé"),N()}catch(M){console.error("Erreur suppression:",M),alert("Impossible de supprimer ce fournisseur (commandes associées)")}}function L(){j({supplier_code:"",name:"",contact_person:"",email:"",phone:"",address:"",payment_terms:"30 jours fin de mois",notes:"",is_active:!0}),d(null),l(!1)}const U=o.filter(O=>O.name.toLowerCase().includes(m.toLowerCase())||O.supplier_code.toLowerCase().includes(m.toLowerCase())||(O.contact_person||"").toLowerCase().includes(m.toLowerCase()));return n.jsxs("div",{className:"suppliers-page",children:[n.jsxs("div",{className:"page-header",children:[n.jsx("h1",{children:"Gestion des Fournisseurs"}),n.jsx("button",{className:"btn-primary",onClick:()=>l(!r),children:r?"Annuler":"+ Nouveau Fournisseur"})]}),r&&n.jsxs("div",{className:"supplier-form-container",children:[n.jsx("h2",{children:c?"Modifier le fournisseur":"Nouveau fournisseur"}),n.jsxs("form",{onSubmit:P,className:"supplier-form",children:[n.jsxs("div",{className:"form-row",children:[n.jsxs("div",{className:"form-group",children:[n.jsx("label",{children:"Code Fournisseur *"}),n.jsx("input",{type:"text",name:"supplier_code",value:_.supplier_code,onChange:k,placeholder:"F001",required:!0,disabled:c})]}),n.jsxs("div",{className:"form-group",children:[n.jsx("label",{children:"Nom *"}),n.jsx("input",{type:"text",name:"name",value:_.name,onChange:k,placeholder:"Nom du fournisseur",required:!0})]})]}),n.jsxs("div",{className:"form-row",children:[n.jsxs("div",{className:"form-group",children:[n.jsx("label",{children:"Personne de contact"}),n.jsx("input",{type:"text",name:"contact_person",value:_.contact_person,onChange:k,placeholder:"Jean Dupont"})]}),n.jsxs("div",{className:"form-group",children:[n.jsx("label",{children:"Email"}),n.jsx("input",{type:"email",name:"email",value:_.email,onChange:k,placeholder:"contact@fournisseur.com"})]})]}),n.jsxs("div",{className:"form-row",children:[n.jsxs("div",{className:"form-group",children:[n.jsx("label",{children:"Téléphone"}),n.jsx("input",{type:"tel",name:"phone",value:_.phone,onChange:k,placeholder:"+33 1 23 45 67 89"})]}),n.jsxs("div",{className:"form-group",children:[n.jsx("label",{children:"Conditions de paiement"}),n.jsx("input",{type:"text",name:"payment_terms",value:_.payment_terms,onChange:k,placeholder:"30 jours fin de mois"})]})]}),n.jsxs("div",{className:"form-group",children:[n.jsx("label",{children:"Adresse"}),n.jsx("textarea",{name:"address",value:_.address,onChange:k,placeholder:"Adresse complète",rows:"2"})]}),n.jsxs("div",{className:"form-group",children:[n.jsx("label",{children:"Notes"}),n.jsx("textarea",{name:"notes",value:_.notes,onChange:k,placeholder:"Notes diverses",rows:"3"})]}),n.jsx("div",{className:"form-group-checkbox",children:n.jsxs("label",{children:[n.jsx("input",{type:"checkbox",name:"is_active",checked:_.is_active,onChange:k}),n.jsx("span",{children:"Fournisseur actif"})]})}),n.jsxs("div",{className:"form-actions",children:[n.jsx("button",{type:"button",onClick:L,className:"btn-secondary",children:"Annuler"}),n.jsx("button",{type:"submit",className:"btn-primary",children:c?"Modifier":"Créer"})]})]})]}),n.jsxs("div",{className:"suppliers-list-container",children:[n.jsxs("div",{className:"list-header",children:[n.jsx("input",{type:"text",placeholder:"Rechercher un fournisseur...",value:m,onChange:O=>p(O.target.value),className:"search-input"}),n.jsxs("div",{className:"summary-info",children:[n.jsxs("span",{className:"info-badge total",children:["Total dû: ",U.reduce((O,M)=>O+(M.total_due||0),0).toLocaleString()," FCFA"]}),n.jsxs("span",{className:"info-badge overdue",children:["Échu: ",U.reduce((O,M)=>O+(M.overdue_amount||0),0).toLocaleString()," FCFA"]}),n.jsxs("span",{className:"count-badge",children:[U.length," fournisseur(s)"]})]})]}),f?n.jsx("div",{className:"loading",children:"Chargement..."}):n.jsxs("div",{className:"suppliers-table-wrapper",children:[n.jsxs("table",{className:"suppliers-table",children:[n.jsx("thead",{children:n.jsxs("tr",{children:[n.jsx("th",{children:"Code"}),n.jsx("th",{children:"Nom"}),n.jsx("th",{children:"Contact"}),n.jsx("th",{children:"Téléphone"}),n.jsx("th",{children:"Email"}),n.jsx("th",{children:"Conditions paiement"}),n.jsx("th",{children:"Total dû"}),n.jsx("th",{children:"Échu"}),n.jsx("th",{children:"Statut"}),n.jsx("th",{children:"Actions"})]})}),n.jsx("tbody",{children:U.map(O=>n.jsxs("tr",{className:O.is_active?"":"inactive-row",children:[n.jsx("td",{className:"supplier-code",children:O.supplier_code}),n.jsx("td",{className:"supplier-name",children:O.name}),n.jsx("td",{children:O.contact_person||"-"}),n.jsx("td",{children:O.phone||"-"}),n.jsx("td",{className:"email-cell",children:O.email||"-"}),n.jsx("td",{className:"payment-terms",children:O.payment_terms}),n.jsxs("td",{className:"amount",children:[(O.total_due||0).toLocaleString()," FCFA"]}),n.jsx("td",{className:`amount ${O.overdue_amount>0?"overdue":""}`,children:O.overdue_amount>0?`${O.overdue_amount.toLocaleString()} FCFA`:"-"}),n.jsx("td",{children:n.jsx("span",{className:`status-badge ${O.is_active?"active":"inactive"}`,children:O.is_active?"Actif":"Inactif"})}),n.jsxs("td",{className:"actions-cell",children:[n.jsx("button",{className:"btn-edit",onClick:()=>E(O),children:"Modifier"}),n.jsx("button",{className:"btn-delete",onClick:()=>V(O.id),children:"Supprimer"})]})]},O.id))})]}),U.length===0&&n.jsx("div",{className:"empty-state",children:m?"Aucun fournisseur trouvé":"Aucun fournisseur créé"})]})]})]})}function bg(){const[o,i]=y.useState([]),[r,l]=y.useState([]),[c,d]=y.useState([]),[f,g]=y.useState([]),[m,p]=y.useState(!1),[_,j]=y.useState(null),[C,N]=y.useState(!0),[k,P]=y.useState(""),[E,V]=y.useState("all"),[L,U]=y.useState({supplier_id:"",order_date:new Date().toISOString().split("T")[0],expected_delivery_date:"",destination_location_id:"",notes:""}),[O,M]=y.useState([]),[G,q]=y.useState({product_id:"",quantity_ordered:"",unit_price:"",vat_rate:0,notes:""});y.useEffect(()=>{Y()},[]);async function Y(){N(!0),await Promise.all([T(),ce(),se(),ee()]),N(!1)}async function T(){try{const{data:D,error:re}=await A.from("purchase_orders").select(`
          *,
          supplier:suppliers(name),
          destination:storage_locations(name),
          lines:purchase_order_lines(
            id,
            product_id,
            product:products(name),
            quantity_ordered,
            quantity_received,
            unit_price,
            vat_rate,
            total_line
          )
        `).order("created_at",{ascending:!1});if(re)throw re;i(D||[])}catch(D){console.error("Erreur chargement commandes:",D)}}async function ce(){try{const{data:D,error:re}=await A.from("suppliers").select("*").eq("is_active",!0).order("name");if(re)throw re;l(D||[])}catch(D){console.error("Erreur chargement fournisseurs:",D)}}async function se(){try{const{data:D,error:re}=await A.from("products").select("id, name, unit").eq("is_active",!0).order("name");if(re)throw re;d(D||[])}catch(D){console.error("Erreur chargement produits:",D)}}async function ee(){try{const{data:D,error:re}=await A.from("storage_locations").select("*").eq("is_active",!0).order("name");if(re)throw re;g(D||[])}catch(D){console.error("Erreur chargement dépôts:",D)}}function _e(D){const{name:re,value:we}=D.target;U(Ne=>({...Ne,[re]:we}))}function ue(D){const{name:re,value:we}=D.target;q(Ne=>({...Ne,[re]:we}))}function Ce(){if(!G.product_id||!G.quantity_ordered||!G.unit_price){alert("Veuillez remplir tous les champs obligatoires");return}const D=c.find(we=>we.id===G.product_id),re=parseFloat(G.quantity_ordered)*parseFloat(G.unit_price);M(we=>[...we,{...G,product_name:D.name,total_line:re,temp_id:Date.now()}]),q({product_id:"",quantity_ordered:"",unit_price:"",vat_rate:0,notes:""})}function F(D){M(re=>re.filter(we=>we.temp_id!==D))}async function ne(D){if(D.preventDefault(),!L.supplier_id){alert("Veuillez sélectionner un fournisseur");return}if(O.length===0){alert("Veuillez ajouter au moins une ligne de commande");return}try{const re=O.reduce((Ne,nt)=>Ne+nt.total_line,0),we=O.reduce((Ne,nt)=>Ne+nt.total_line*nt.vat_rate/100,0);if(_){const{error:Ne}=await A.from("purchase_orders").update({...L,total_amount:re,vat_amount:we,total_with_vat:re+we,updated_at:new Date().toISOString()}).eq("id",_.id);if(Ne)throw Ne;await A.from("purchase_order_lines").delete().eq("purchase_order_id",_.id);const nt=O.map(Ue=>({purchase_order_id:_.id,product_id:Ue.product_id,quantity_ordered:parseFloat(Ue.quantity_ordered),unit_price:parseFloat(Ue.unit_price),vat_rate:parseFloat(Ue.vat_rate),notes:Ue.notes})),{error:Le}=await A.from("purchase_order_lines").insert(nt);if(Le)throw Le;alert("Commande modifiée avec succès")}else{const{data:Ne,error:nt}=await A.rpc("generate_next_purchase_order_number");if(nt)throw nt;const{data:Le,error:Ue}=await A.from("purchase_orders").insert([{order_number:Ne,...L,total_amount:re,vat_amount:we,total_with_vat:re+we}]).select().single();if(Ue)throw Ue;const lt=O.map(qt=>({purchase_order_id:Le.id,product_id:qt.product_id,quantity_ordered:parseFloat(qt.quantity_ordered),unit_price:parseFloat(qt.unit_price),vat_rate:parseFloat(qt.vat_rate),notes:qt.notes})),{error:We}=await A.from("purchase_order_lines").insert(lt);if(We)throw We;alert("Commande créée avec succès: "+Ne)}R(),T()}catch(re){console.error("Erreur sauvegarde commande:",re),alert("Erreur: "+re.message)}}async function K(D){j(D),U({supplier_id:D.supplier_id,order_date:D.order_date,expected_delivery_date:D.expected_delivery_date||"",destination_location_id:D.destination_location_id||"",notes:D.notes||""});const re=D.lines.map(we=>({product_id:we.product_id,product_name:we.product.name,quantity_ordered:we.quantity_ordered,unit_price:we.unit_price,vat_rate:we.vat_rate,total_line:we.total_line,notes:we.notes||"",temp_id:we.id}));M(re),p(!0)}async function le(D,re){if(confirm(`Changer le statut vers "${X(re)}" ?`))try{const{error:we}=await A.from("purchase_orders").update({status:re,updated_at:new Date().toISOString()}).eq("id",D);if(we)throw we;T()}catch(we){console.error("Erreur changement statut:",we),alert("Erreur: "+we.message)}}async function Ee(D){if(confirm("Êtes-vous sûr de vouloir supprimer cette commande ?"))try{const{error:re}=await A.from("purchase_orders").delete().eq("id",D);if(re)throw re;alert("Commande supprimée"),T()}catch(re){console.error("Erreur suppression:",re),alert("Impossible de supprimer cette commande")}}function R(){U({supplier_id:"",order_date:new Date().toISOString().split("T")[0],expected_delivery_date:"",destination_location_id:"",notes:""}),M([]),q({product_id:"",quantity_ordered:"",unit_price:"",vat_rate:0,notes:""}),j(null),p(!1)}function X(D){return{draft:"Brouillon",sent:"Envoyée",partially_received:"Partiellement reçue",received:"Reçue",cancelled:"Annulée"}[D]||D}function fe(D){return{draft:"draft",sent:"sent",partially_received:"partial",received:"received",cancelled:"cancelled"}[D]||""}const be=o.filter(D=>{const re=D.order_number.toLowerCase().includes(k.toLowerCase())||(D.supplier?.name||"").toLowerCase().includes(k.toLowerCase()),we=E==="all"||D.status===E;return re&&we}),$=be.reduce((D,re)=>D+(parseFloat(re.total_with_vat)||0),0);return n.jsxs("div",{className:"purchase-orders-page",children:[n.jsxs("div",{className:"page-header",children:[n.jsx("h1",{children:"Commandes Fournisseurs"}),n.jsx("button",{className:"btn-primary",onClick:()=>p(!m),children:m?"Annuler":"+ Nouvelle Commande"})]}),m&&n.jsxs("div",{className:"order-form-container",children:[n.jsx("h2",{children:_?"Modifier la commande":"Nouvelle commande"}),n.jsxs("form",{onSubmit:ne,className:"order-form",children:[n.jsxs("div",{className:"form-section",children:[n.jsx("h3",{children:"Informations générales"}),n.jsxs("div",{className:"form-row",children:[n.jsxs("div",{className:"form-group",children:[n.jsx("label",{children:"Fournisseur *"}),n.jsxs("select",{name:"supplier_id",value:L.supplier_id,onChange:_e,required:!0,children:[n.jsx("option",{value:"",children:"Sélectionner un fournisseur"}),r.map(D=>n.jsxs("option",{value:D.id,children:[D.supplier_code," - ",D.name]},D.id))]})]}),n.jsxs("div",{className:"form-group",children:[n.jsx("label",{children:"Date de commande *"}),n.jsx("input",{type:"date",name:"order_date",value:L.order_date,onChange:_e,required:!0})]}),n.jsxs("div",{className:"form-group",children:[n.jsx("label",{children:"Date de livraison prévue"}),n.jsx("input",{type:"date",name:"expected_delivery_date",value:L.expected_delivery_date,onChange:_e})]}),n.jsxs("div",{className:"form-group",children:[n.jsx("label",{children:"Dépôt de destination"}),n.jsxs("select",{name:"destination_location_id",value:L.destination_location_id,onChange:_e,children:[n.jsx("option",{value:"",children:"Sélectionner un dépôt"}),f.map(D=>n.jsx("option",{value:D.id,children:D.name},D.id))]})]})]}),n.jsxs("div",{className:"form-group",children:[n.jsx("label",{children:"Notes"}),n.jsx("textarea",{name:"notes",value:L.notes,onChange:_e,rows:"2",placeholder:"Notes sur la commande"})]})]}),n.jsxs("div",{className:"form-section",children:[n.jsx("h3",{children:"Lignes de commande"}),n.jsxs("div",{className:"add-line-form",children:[n.jsxs("select",{name:"product_id",value:G.product_id,onChange:ue,children:[n.jsx("option",{value:"",children:"Sélectionner un produit"}),c.map(D=>n.jsxs("option",{value:D.id,children:[D.name," (",D.unit,")"]},D.id))]}),n.jsx("input",{type:"number",name:"quantity_ordered",value:G.quantity_ordered,onChange:ue,placeholder:"Quantité",step:"0.001",min:"0"}),n.jsx("input",{type:"number",name:"unit_price",value:G.unit_price,onChange:ue,placeholder:"Prix unitaire HT",step:"0.01",min:"0"}),n.jsx("input",{type:"number",name:"vat_rate",value:G.vat_rate,onChange:ue,placeholder:"TVA %",step:"0.01",min:"0"}),n.jsx("button",{type:"button",onClick:Ce,className:"btn-add-line",children:"Ajouter"})]}),O.length>0&&n.jsx("div",{className:"order-lines-table",children:n.jsxs("table",{children:[n.jsx("thead",{children:n.jsxs("tr",{children:[n.jsx("th",{children:"Produit"}),n.jsx("th",{children:"Quantité"}),n.jsx("th",{children:"Prix Unit. HT"}),n.jsx("th",{children:"TVA %"}),n.jsx("th",{children:"Total HT"}),n.jsx("th",{})]})}),n.jsx("tbody",{children:O.map(D=>n.jsxs("tr",{children:[n.jsx("td",{children:D.product_name}),n.jsx("td",{children:D.quantity_ordered}),n.jsxs("td",{children:[parseFloat(D.unit_price).toFixed(2)," €"]}),n.jsxs("td",{children:[parseFloat(D.vat_rate).toFixed(2)," %"]}),n.jsxs("td",{children:[D.total_line.toFixed(2)," €"]}),n.jsx("td",{children:n.jsx("button",{type:"button",onClick:()=>F(D.temp_id),className:"btn-remove-line",children:"✕"})})]},D.temp_id))}),n.jsxs("tfoot",{children:[n.jsxs("tr",{children:[n.jsx("td",{colSpan:"4",className:"text-right",children:n.jsx("strong",{children:"Total HT:"})}),n.jsx("td",{children:n.jsxs("strong",{children:[O.reduce((D,re)=>D+re.total_line,0).toFixed(2)," €"]})}),n.jsx("td",{})]}),n.jsxs("tr",{children:[n.jsx("td",{colSpan:"4",className:"text-right",children:n.jsx("strong",{children:"Total TVA:"})}),n.jsx("td",{children:n.jsxs("strong",{children:[O.reduce((D,re)=>D+re.total_line*re.vat_rate/100,0).toFixed(2)," €"]})}),n.jsx("td",{})]}),n.jsxs("tr",{className:"total-row",children:[n.jsx("td",{colSpan:"4",className:"text-right",children:n.jsx("strong",{children:"Total TTC:"})}),n.jsx("td",{children:n.jsxs("strong",{children:[O.reduce((D,re)=>D+re.total_line+re.total_line*re.vat_rate/100,0).toFixed(2)," €"]})}),n.jsx("td",{})]})]})]})})]}),n.jsxs("div",{className:"form-actions",children:[n.jsx("button",{type:"button",onClick:R,className:"btn-secondary",children:"Annuler"}),n.jsx("button",{type:"submit",className:"btn-primary",children:_?"Modifier":"Créer"})]})]})]}),n.jsxs("div",{className:"orders-list-container",children:[n.jsxs("div",{className:"list-header",children:[n.jsx("input",{type:"text",placeholder:"Rechercher par numéro ou fournisseur...",value:k,onChange:D=>P(D.target.value),className:"search-input"}),n.jsxs("select",{value:E,onChange:D=>V(D.target.value),className:"filter-select",children:[n.jsx("option",{value:"all",children:"Tous les statuts"}),n.jsx("option",{value:"draft",children:"Brouillon"}),n.jsx("option",{value:"sent",children:"Envoyée"}),n.jsx("option",{value:"partially_received",children:"Partiellement reçue"}),n.jsx("option",{value:"received",children:"Reçue"}),n.jsx("option",{value:"cancelled",children:"Annulée"})]}),n.jsxs("span",{className:"count-badge",children:[be.length," commande(s) - ",$.toFixed(2)," € TTC"]})]}),C?n.jsx("div",{className:"loading",children:"Chargement..."}):n.jsxs("div",{className:"orders-grid",children:[be.map(D=>n.jsxs("div",{className:"order-card",children:[n.jsxs("div",{className:"card-header",children:[n.jsxs("div",{children:[n.jsx("div",{className:"order-number",children:D.order_number}),n.jsx("div",{className:"supplier-name",children:D.supplier?.name})]}),n.jsx("span",{className:`status-badge ${fe(D.status)}`,children:X(D.status)})]}),n.jsxs("div",{className:"card-body",children:[n.jsxs("div",{className:"info-row",children:[n.jsx("span",{className:"label",children:"Date:"}),n.jsx("span",{children:new Date(D.order_date).toLocaleDateString()})]}),D.expected_delivery_date&&n.jsxs("div",{className:"info-row",children:[n.jsx("span",{className:"label",children:"Livraison prévue:"}),n.jsx("span",{children:new Date(D.expected_delivery_date).toLocaleDateString()})]}),n.jsxs("div",{className:"info-row",children:[n.jsx("span",{className:"label",children:"Dépôt:"}),n.jsx("span",{children:D.destination?.name||"-"})]}),n.jsxs("div",{className:"info-row",children:[n.jsx("span",{className:"label",children:"Lignes:"}),n.jsxs("span",{children:[D.lines?.length||0," produit(s)"]})]}),n.jsxs("div",{className:"info-row total",children:[n.jsx("span",{className:"label",children:"Total TTC:"}),n.jsxs("span",{className:"amount",children:[parseFloat(D.total_with_vat).toFixed(2)," €"]})]})]}),n.jsxs("div",{className:"card-actions",children:[D.status==="draft"&&n.jsx("button",{onClick:()=>le(D.id,"sent"),className:"btn-action",children:"Envoyer"}),(D.status==="draft"||D.status==="sent")&&n.jsx("button",{onClick:()=>K(D),className:"btn-action",children:"Modifier"}),D.status==="draft"&&n.jsx("button",{onClick:()=>Ee(D.id),className:"btn-action delete",children:"Supprimer"})]})]},D.id)),be.length===0&&n.jsx("div",{className:"empty-state",children:k||E!=="all"?"Aucune commande trouvée":"Aucune commande créée"})]})]})]})}function jg(){const[o,i]=y.useState([]),[r,l]=y.useState([]),[c,d]=y.useState([]),[f,g]=y.useState(null),[m,p]=y.useState(!1),[_,j]=y.useState(!0),[C,N]=y.useState(""),[k,P]=y.useState(null),[E,V]=y.useState({purchase_order_id:"",reception_date:new Date().toISOString().split("T")[0],storage_location_id:"",notes:""}),[L,U]=y.useState([]);y.useEffect(()=>{M(),O()},[]);async function O(){try{const K=localStorage.getItem("user");if(K){const le=JSON.parse(K);g(le)}}catch(K){console.error("Erreur chargement utilisateur:",K)}}async function M(){j(!0),await Promise.all([G(),q(),Y()]),j(!1)}async function G(){try{const{data:K,error:le}=await A.from("purchase_receptions").select(`
          *,
          purchase_order:purchase_orders(
            order_number,
            supplier:suppliers(name)
          ),
          storage_location:storage_locations(name),
          employee:employees(full_name),
          lines:purchase_reception_lines(
            *,
            product:products(name)
          )
        `).order("created_at",{ascending:!1});if(le)throw le;i(K||[])}catch(K){console.error("Erreur chargement réceptions:",K)}}async function q(){try{const{data:K,error:le}=await A.from("purchase_orders").select(`
          *,
          supplier:suppliers(name),
          destination:storage_locations(name),
          lines:purchase_order_lines(
            *,
            product:products(name, unit)
          )
        `).in("status",["sent","partially_received"]).order("order_date",{ascending:!1});if(le)throw le;l(K||[])}catch(K){console.error("Erreur chargement commandes:",K)}}async function Y(){try{const{data:K,error:le}=await A.from("storage_locations").select("*").eq("is_active",!0).order("name");if(le)throw le;d(K||[])}catch(K){console.error("Erreur chargement dépôts:",K)}}function T(K){const le=K.target.value,Ee=r.find(X=>X.id===le);if(!Ee){P(null),U([]),V(X=>({...X,purchase_order_id:"",storage_location_id:""}));return}P(Ee),V(X=>({...X,purchase_order_id:le,storage_location_id:Ee.destination_location_id||""}));const R=Ee.lines.map((X,fe)=>({purchase_order_line_id:X.id,product_id:X.product_id,product_name:X.product.name,product_unit:X.product.unit,quantity_ordered:parseFloat(X.quantity_ordered),quantity_already_received:parseFloat(X.quantity_received),quantity_remaining:parseFloat(X.quantity_ordered)-parseFloat(X.quantity_received),quantity_received:"",quantity_accepted:"",quantity_rejected:"0",rejection_reason:"",expiry_date:"",batch_number:"",notes:"",temp_id:fe}));U(R)}function ce(K,le,Ee){U(R=>R.map(X=>{if(X.temp_id!==K)return X;const fe={...X,[le]:Ee};if(le==="quantity_received"){const be=parseFloat(Ee)||0;fe.quantity_accepted=be.toString(),fe.quantity_rejected="0"}if(le==="quantity_accepted"||le==="quantity_rejected"){const be=parseFloat(fe.quantity_accepted)||0,$=parseFloat(fe.quantity_rejected)||0;fe.quantity_received=(be+$).toString()}return fe}))}async function se(K){if(K.preventDefault(),!E.purchase_order_id||!E.storage_location_id){alert("Veuillez sélectionner une commande et un dépôt");return}if(!f){alert("Utilisateur non connecté");return}const le=L.filter(Ee=>parseFloat(Ee.quantity_received||0)>0);if(le.length===0){alert("Veuillez saisir au moins une quantité reçue");return}for(const Ee of le){const R=parseFloat(Ee.quantity_received),X=parseFloat(Ee.quantity_accepted),fe=parseFloat(Ee.quantity_rejected);if(R!==X+fe){alert(`Erreur ligne "${Ee.product_name}": Reçu doit égaler Accepté + Rejeté`);return}if(fe>0&&!Ee.rejection_reason.trim()){alert(`Veuillez indiquer la raison du rejet pour "${Ee.product_name}"`);return}}try{const{data:Ee,error:R}=await A.rpc("generate_next_reception_number");if(R)throw R;const{data:X,error:fe}=await A.from("purchase_receptions").insert([{reception_number:Ee,...E,received_by:f.id}]).select().single();if(fe)throw fe;const be=le.map(D=>({reception_id:X.id,purchase_order_line_id:D.purchase_order_line_id,product_id:D.product_id,quantity_received:parseFloat(D.quantity_received),quantity_accepted:parseFloat(D.quantity_accepted),quantity_rejected:parseFloat(D.quantity_rejected),rejection_reason:D.rejection_reason,expiry_date:D.expiry_date||null,batch_number:D.batch_number,notes:D.notes})),{error:$}=await A.from("purchase_reception_lines").insert(be);if($)throw $;alert("Réception créée avec succès: "+Ee),ue(),M()}catch(Ee){console.error("Erreur sauvegarde réception:",Ee),alert("Erreur: "+Ee.message)}}async function ee(K){if(confirm("Valider définitivement cette réception ?"))try{const{error:le}=await A.from("purchase_receptions").update({status:"validated",updated_at:new Date().toISOString()}).eq("id",K);if(le)throw le;alert("Réception validée"),M()}catch(le){console.error("Erreur validation:",le),alert("Erreur: "+le.message)}}async function _e(K){if(confirm("Annuler cette réception ?"))try{const{error:le}=await A.from("purchase_receptions").update({status:"cancelled",updated_at:new Date().toISOString()}).eq("id",K);if(le)throw le;alert("Réception annulée"),M()}catch(le){console.error("Erreur annulation:",le),alert("Erreur: "+le.message)}}function ue(){V({purchase_order_id:"",reception_date:new Date().toISOString().split("T")[0],storage_location_id:"",notes:""}),P(null),U([]),p(!1)}function Ce(K){return{pending:"En attente",validated:"Validée",cancelled:"Annulée"}[K]||K}function F(K){return{pending:"pending",validated:"validated",cancelled:"cancelled"}[K]||""}const ne=o.filter(K=>K.reception_number.toLowerCase().includes(C.toLowerCase())||(K.purchase_order?.order_number||"").toLowerCase().includes(C.toLowerCase())||(K.purchase_order?.supplier?.name||"").toLowerCase().includes(C.toLowerCase()));return n.jsxs("div",{className:"purchase-receptions-page",children:[n.jsxs("div",{className:"page-header",children:[n.jsx("h1",{children:"Réception de Commandes"}),n.jsx("button",{className:"btn-primary",onClick:()=>p(!m),children:m?"Annuler":"+ Nouvelle Réception"})]}),m&&n.jsxs("div",{className:"reception-form-container",children:[n.jsx("h2",{children:"Nouvelle réception"}),n.jsxs("form",{onSubmit:se,className:"reception-form",children:[n.jsxs("div",{className:"form-section",children:[n.jsx("h3",{children:"Informations générales"}),n.jsxs("div",{className:"form-row",children:[n.jsxs("div",{className:"form-group",children:[n.jsx("label",{children:"Commande à réceptionner *"}),n.jsxs("select",{value:E.purchase_order_id,onChange:T,required:!0,children:[n.jsx("option",{value:"",children:"Sélectionner une commande"}),r.map(K=>n.jsxs("option",{value:K.id,children:[K.order_number," - ",K.supplier?.name," (",K.status==="sent"?"Non reçue":"Partiellement reçue",")"]},K.id))]})]}),n.jsxs("div",{className:"form-group",children:[n.jsx("label",{children:"Date de réception *"}),n.jsx("input",{type:"date",value:E.reception_date,onChange:K=>V(le=>({...le,reception_date:K.target.value})),required:!0})]}),n.jsxs("div",{className:"form-group",children:[n.jsx("label",{children:"Dépôt de réception *"}),n.jsxs("select",{value:E.storage_location_id,onChange:K=>V(le=>({...le,storage_location_id:K.target.value})),required:!0,children:[n.jsx("option",{value:"",children:"Sélectionner un dépôt"}),c.map(K=>n.jsx("option",{value:K.id,children:K.name},K.id))]})]})]}),n.jsxs("div",{className:"form-group",children:[n.jsx("label",{children:"Notes"}),n.jsx("textarea",{value:E.notes,onChange:K=>V(le=>({...le,notes:K.target.value})),rows:"2",placeholder:"Notes sur la réception"})]})]}),k&&L.length>0&&n.jsxs("div",{className:"form-section",children:[n.jsx("h3",{children:"Produits à réceptionner"}),n.jsx("div",{className:"reception-lines-table",children:n.jsxs("table",{children:[n.jsx("thead",{children:n.jsxs("tr",{children:[n.jsx("th",{children:"Produit"}),n.jsx("th",{children:"Commandé"}),n.jsx("th",{children:"Déjà reçu"}),n.jsx("th",{children:"Restant"}),n.jsx("th",{children:"Reçu"}),n.jsx("th",{children:"Accepté"}),n.jsx("th",{children:"Rejeté"}),n.jsx("th",{children:"Motif rejet"}),n.jsx("th",{children:"N° Lot"}),n.jsx("th",{children:"Péremption"})]})}),n.jsx("tbody",{children:L.map(K=>n.jsxs("tr",{children:[n.jsxs("td",{className:"product-name",children:[K.product_name,n.jsxs("div",{className:"product-unit",children:["(",K.product_unit,")"]})]}),n.jsx("td",{className:"qty",children:K.quantity_ordered}),n.jsx("td",{className:"qty received",children:K.quantity_already_received}),n.jsx("td",{className:"qty remaining",children:K.quantity_remaining}),n.jsx("td",{children:n.jsx("input",{type:"number",value:K.quantity_received,onChange:le=>ce(K.temp_id,"quantity_received",le.target.value),step:"0.001",min:"0",max:K.quantity_remaining,placeholder:"0",className:"input-qty"})}),n.jsx("td",{children:n.jsx("input",{type:"number",value:K.quantity_accepted,onChange:le=>ce(K.temp_id,"quantity_accepted",le.target.value),step:"0.001",min:"0",placeholder:"0",className:"input-qty accepted"})}),n.jsx("td",{children:n.jsx("input",{type:"number",value:K.quantity_rejected,onChange:le=>ce(K.temp_id,"quantity_rejected",le.target.value),step:"0.001",min:"0",placeholder:"0",className:"input-qty rejected"})}),n.jsx("td",{children:n.jsx("input",{type:"text",value:K.rejection_reason,onChange:le=>ce(K.temp_id,"rejection_reason",le.target.value),placeholder:"Si rejet...",className:"input-text",disabled:parseFloat(K.quantity_rejected||0)===0})}),n.jsx("td",{children:n.jsx("input",{type:"text",value:K.batch_number,onChange:le=>ce(K.temp_id,"batch_number",le.target.value),placeholder:"Lot",className:"input-text"})}),n.jsx("td",{children:n.jsx("input",{type:"date",value:K.expiry_date,onChange:le=>ce(K.temp_id,"expiry_date",le.target.value),className:"input-date"})})]},K.temp_id))})]})})]}),n.jsxs("div",{className:"form-actions",children:[n.jsx("button",{type:"button",onClick:ue,className:"btn-secondary",children:"Annuler"}),n.jsx("button",{type:"submit",className:"btn-primary",disabled:!k||L.filter(K=>parseFloat(K.quantity_received||0)>0).length===0,children:"Créer la réception"})]})]})]}),n.jsxs("div",{className:"receptions-list-container",children:[n.jsxs("div",{className:"list-header",children:[n.jsx("input",{type:"text",placeholder:"Rechercher par numéro, commande ou fournisseur...",value:C,onChange:K=>N(K.target.value),className:"search-input"}),n.jsxs("span",{className:"count-badge",children:[ne.length," réception(s)"]})]}),_?n.jsx("div",{className:"loading",children:"Chargement..."}):n.jsxs("div",{className:"receptions-grid",children:[ne.map(K=>n.jsxs("div",{className:"reception-card",children:[n.jsxs("div",{className:"card-header",children:[n.jsxs("div",{children:[n.jsx("div",{className:"reception-number",children:K.reception_number}),n.jsxs("div",{className:"order-ref",children:["Commande: ",K.purchase_order?.order_number]}),n.jsx("div",{className:"supplier-name",children:K.purchase_order?.supplier?.name})]}),n.jsx("span",{className:`status-badge ${F(K.status)}`,children:Ce(K.status)})]}),n.jsxs("div",{className:"card-body",children:[n.jsxs("div",{className:"info-row",children:[n.jsx("span",{className:"label",children:"Date:"}),n.jsx("span",{children:new Date(K.reception_date).toLocaleDateString()})]}),n.jsxs("div",{className:"info-row",children:[n.jsx("span",{className:"label",children:"Dépôt:"}),n.jsx("span",{children:K.storage_location?.name})]}),n.jsxs("div",{className:"info-row",children:[n.jsx("span",{className:"label",children:"Réceptionné par:"}),n.jsx("span",{children:K.employee?.full_name||"-"})]}),n.jsxs("div",{className:"info-row",children:[n.jsx("span",{className:"label",children:"Produits:"}),n.jsxs("span",{children:[K.lines?.length||0," ligne(s)"]})]}),K.lines&&K.lines.some(le=>le.quantity_rejected>0)&&n.jsxs("div",{className:"info-row warning",children:[n.jsx("span",{className:"label",children:"⚠️ Rejets:"}),n.jsxs("span",{children:[K.lines.filter(le=>le.quantity_rejected>0).length," produit(s)"]})]})]}),n.jsx("div",{className:"card-actions",children:K.status==="pending"&&n.jsxs(n.Fragment,{children:[n.jsx("button",{onClick:()=>ee(K.id),className:"btn-action validate",children:"Valider"}),n.jsx("button",{onClick:()=>_e(K.id),className:"btn-action cancel",children:"Annuler"})]})})]},K.id)),ne.length===0&&n.jsx("div",{className:"empty-state",children:C?"Aucune réception trouvée":"Aucune réception créée"})]})]})]})}function Sg(){const[o,i]=y.useState([]),[r,l]=y.useState([]),[c,d]=y.useState(!0),[f,g]=y.useState(""),[m,p]=y.useState(""),[_,j]=y.useState("reception_date"),[C,N]=y.useState("desc"),[k,P]=y.useState(!1);y.useEffect(()=>{E()},[]),y.useEffect(()=>{f&&V()},[f]);const E=async()=>{try{const{data:T,error:ce}=await A.from("product_types").select("id").eq("name","Matières Premières").maybeSingle();if(ce)throw ce;const{data:se,error:ee}=await A.from("products").select("id, name, reference, unit, product_types(name)").eq("product_type_id",T?.id).order("name");if(ee)throw ee;i(se||[])}catch(T){console.error("Erreur chargement produits:",T),alert("Erreur lors du chargement des produits")}finally{d(!1)}},V=async()=>{try{d(!0);const{data:T,error:ce}=await A.from("purchase_reception_lines").select(`
          id,
          quantity_received,
          quantity_accepted,
          quantity_rejected,
          rejection_reason,
          batch_number,
          expiry_date,
          purchase_receptions(
            reception_number,
            reception_date,
            storage_locations(name),
            purchase_orders(
              order_number,
              order_date,
              suppliers(name, contact_person, phone)
            )
          ),
          products(name, reference, unit),
          purchase_order_lines(
            quantity_ordered,
            unit_price,
            vat_rate,
            total_line
          )
        `).eq("product_id",f).order("created_at",{ascending:!1});if(ce)throw ce;l(T||[])}catch(T){console.error("Erreur chargement historique:",T),alert("Erreur lors du chargement de l'historique")}finally{d(!1)}},L=T=>{_===T?N(C==="asc"?"desc":"asc"):(j(T),N("asc"))},U=o.filter(T=>T.name.toLowerCase().includes(m.toLowerCase())||T.reference&&T.reference.toLowerCase().includes(m.toLowerCase())).slice(0,10),O=T=>{g(T.id),p(T.name),P(!1)},M=T=>{p(T.target.value),P(!0),T.target.value===""&&g("")},G=[...r].sort((T,ce)=>{let se,ee;switch(_){case"reception_date":se=T.purchase_receptions?.reception_date||"",ee=ce.purchase_receptions?.reception_date||"";break;case"supplier":se=T.purchase_receptions?.purchase_orders?.suppliers?.name||"",ee=ce.purchase_receptions?.purchase_orders?.suppliers?.name||"";break;case"unit_price":se=T.purchase_order_lines?.unit_price||0,ee=ce.purchase_order_lines?.unit_price||0;break;case"quantity_accepted":se=T.quantity_accepted||0,ee=ce.quantity_accepted||0;break;default:return 0}return typeof se=="string"&&(se=se.toLowerCase(),ee=ee.toLowerCase()),se<ee?C==="asc"?-1:1:se>ee?C==="asc"?1:-1:0}),q=(T,ce)=>(T*(1+ce/100)).toFixed(2),Y=T=>T?new Date(T).toLocaleDateString("fr-FR"):"-";return c&&!f?n.jsx("div",{className:"loading",children:"Chargement..."}):n.jsxs("div",{className:"purchase-history-page",children:[n.jsx("div",{className:"page-header",children:n.jsx("h1",{children:"Historique des Achats par Produit"})}),n.jsx("div",{className:"product-selector",children:n.jsx("div",{className:"search-section",children:n.jsxs("div",{className:"search-autocomplete",children:[n.jsx("input",{type:"text",placeholder:"Tapez le nom d'un produit...",value:m,onChange:M,onFocus:()=>P(!0),className:"search-input",autoComplete:"off"}),k&&m&&U.length>0&&n.jsx("div",{className:"autocomplete-dropdown",children:U.map(T=>n.jsxs("div",{className:"autocomplete-item",onClick:()=>O(T),children:[n.jsx("div",{className:"product-name",children:T.name}),n.jsxs("div",{className:"product-meta",children:[T.reference&&n.jsx("span",{className:"product-ref",children:T.reference}),n.jsx("span",{className:"product-type",children:T.product_types?.name||"N/A"})]})]},T.id))}),k&&m&&U.length===0&&n.jsx("div",{className:"autocomplete-dropdown",children:n.jsx("div",{className:"autocomplete-item no-results",children:"Aucun produit trouvé"})})]})})}),f&&n.jsx("div",{className:"history-section",children:c?n.jsx("div",{className:"loading",children:"Chargement de l'historique..."}):G.length===0?n.jsxs("div",{className:"no-data",children:[n.jsx("p",{children:"Aucun historique d'achat pour ce produit"}),n.jsx("small",{children:"Les achats apparaîtront ici après validation des réceptions"})]}):n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"history-summary",children:[n.jsxs("div",{className:"summary-card",children:[n.jsx("h3",{children:"Nombre d'achats"}),n.jsx("p",{className:"summary-value",children:G.length})]}),n.jsxs("div",{className:"summary-card",children:[n.jsx("h3",{children:"Quantité totale reçue"}),n.jsxs("p",{className:"summary-value",children:[G.reduce((T,ce)=>T+(parseFloat(ce.quantity_accepted)||0),0).toFixed(2)," ",G[0]?.products?.unit]})]}),n.jsxs("div",{className:"summary-card",children:[n.jsx("h3",{children:"Prix moyen HT"}),n.jsxs("p",{className:"summary-value",children:[(G.reduce((T,ce)=>T+(parseFloat(ce.purchase_order_lines?.unit_price)||0),0)/G.length).toFixed(2)," F"]})]}),n.jsxs("div",{className:"summary-card",children:[n.jsx("h3",{children:"Nombre de fournisseurs"}),n.jsx("p",{className:"summary-value",children:new Set(G.map(T=>T.purchase_receptions?.purchase_orders?.suppliers?.name)).size})]})]}),n.jsx("div",{className:"history-table-container",children:n.jsxs("table",{className:"history-table",children:[n.jsx("thead",{children:n.jsxs("tr",{children:[n.jsxs("th",{onClick:()=>L("reception_date"),style:{cursor:"pointer"},children:["Date réception ",_==="reception_date"&&(C==="asc"?"↑":"↓")]}),n.jsx("th",{children:"N° Réception"}),n.jsx("th",{children:"N° Commande"}),n.jsxs("th",{onClick:()=>L("supplier"),style:{cursor:"pointer"},children:["Fournisseur ",_==="supplier"&&(C==="asc"?"↑":"↓")]}),n.jsxs("th",{onClick:()=>L("quantity_accepted"),style:{cursor:"pointer"},children:["Qté acceptée ",_==="quantity_accepted"&&(C==="asc"?"↑":"↓")]}),n.jsx("th",{children:"Qté rejetée"}),n.jsxs("th",{onClick:()=>L("unit_price"),style:{cursor:"pointer"},children:["Prix unitaire HT ",_==="unit_price"&&(C==="asc"?"↑":"↓")]}),n.jsx("th",{children:"Prix unitaire TTC"}),n.jsx("th",{children:"TVA"}),n.jsx("th",{children:"N° Lot"}),n.jsx("th",{children:"Date expiration"}),n.jsx("th",{children:"Dépôt"})]})}),n.jsx("tbody",{children:G.map(T=>{const ce=T.purchase_order_lines?.unit_price||0,se=T.purchase_order_lines?.vat_rate||0,ee=q(ce,se);return n.jsxs("tr",{children:[n.jsx("td",{children:Y(T.purchase_receptions?.reception_date)}),n.jsx("td",{children:T.purchase_receptions?.reception_number||"-"}),n.jsx("td",{children:T.purchase_receptions?.purchase_orders?.order_number||"-"}),n.jsx("td",{children:n.jsxs("div",{className:"supplier-info",children:[n.jsx("strong",{children:T.purchase_receptions?.purchase_orders?.suppliers?.name||"-"}),T.purchase_receptions?.purchase_orders?.suppliers?.contact_person&&n.jsx("small",{children:T.purchase_receptions?.purchase_orders?.suppliers?.contact_person})]})}),n.jsx("td",{children:n.jsxs("span",{className:"quantity-badge",children:[T.quantity_accepted," ",T.products?.unit]})}),n.jsx("td",{children:T.quantity_rejected>0?n.jsxs("span",{className:"quantity-rejected",children:[T.quantity_rejected," ",T.products?.unit]}):"-"}),n.jsxs("td",{className:"price-cell",children:[ce.toFixed(2)," F"]}),n.jsxs("td",{className:"price-cell-ttc",children:[ee," F"]}),n.jsxs("td",{children:[se,"%"]}),n.jsx("td",{children:T.batch_number||"-"}),n.jsx("td",{children:Y(T.expiry_date)}),n.jsx("td",{children:T.purchase_receptions?.storage_locations?.name||"-"})]},T.id)})})]})})]})})]})}const Vj=()=>{const[o,i]=y.useState([]),[r,l]=y.useState([]),[c,d]=y.useState([]),[f,g]=y.useState(!0),[m,p]=y.useState(!1),[_,j]=y.useState(null),[C,N]=y.useState({}),[k,P]=y.useState(""),[E,V]=y.useState(!1),[L,U]=y.useState({name:"",sales_point_id:"",description:"",is_active:!0,physical_printer:""});y.useEffect(()=>{T(),O(),M()},[]);const O=async()=>{try{console.log("🖨️ Détection des imprimantes via le service local...");const F=await fetch("https://lcknhxrksephkshpvfmp.supabase.co/functions/v1/printer-proxy?action=printers",{headers:{"X-Printer-Service-URL":"https://unsatiably-unforbidding-rosella.ngrok-free.dev"}});if(!F.ok)throw new Error(`Erreur HTTP ${F.status}`);const ne=await F.json();if(ne.printers){console.log(`✅ ${ne.printers.length} imprimante(s) détectée(s):`),ne.printers.forEach((le,Ee)=>{console.log(`   ${Ee+1}. ${le.name} ${le.status?`(${le.status})`:""}`)});const K=ne.printers.map(le=>le.name);d(K)}else console.warn("⚠️ Aucune imprimante retournée par le service"),d([])}catch(ue){console.error("❌ Erreur connexion au service d'impression local:",ue.message),console.error(""),console.error("🔧 Vérifiez que le service d'impression est démarré:"),console.error("   1. Ouvrir un terminal"),console.error("   2. cd printer-service"),console.error("   3. npm start"),console.error(""),console.error("Le service doit tourner sur http://localhost:3001");const Ce=localStorage.getItem("custom_printers");if(Ce){const F=JSON.parse(Ce);console.log("📂 Chargement des imprimantes personnalisées en fallback:",F),d(F)}else d([])}},M=async()=>{try{const F=await fetch("https://lcknhxrksephkshpvfmp.supabase.co/functions/v1/printer-proxy?action=mapping",{headers:{"X-Printer-Service-URL":"https://unsatiably-unforbidding-rosella.ngrok-free.dev"}});if(!F.ok)throw new Error(`Erreur HTTP ${F.status}`);const ne=await F.json();ne&&typeof ne=="object"&&(console.log("📋 Mappings chargés depuis le service:",ne),N(ne))}catch(ue){console.error("❌ Erreur chargement mappings depuis le service:",ue),console.log("📂 Fallback: tentative de chargement depuis localStorage");const Ce=localStorage.getItem("printer_physical_mappings");Ce&&N(JSON.parse(Ce))}},G=async()=>{console.log("🔄 Actualisation de la liste des imprimantes..."),await O()},q=()=>{if(!k.trim()){alert("Veuillez entrer un nom d'imprimante");return}const ue=[...c];ue.includes(k.trim())||(ue.push(k.trim()),d(ue),localStorage.setItem("custom_printers",JSON.stringify(ue)),console.log("Imprimante ajoutée:",k.trim())),P(""),V(!1),alert("Imprimante ajoutée avec succès !")},Y=async(ue,Ce)=>{try{if(!Ce){console.warn("⚠️ Pas d'imprimante physique à sauvegarder");return}const F=await fetch("http://localhost:3001/mapping",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({logicalPrinterId:ue,physicalPrinterName:Ce})});if(!F.ok)throw new Error(`Erreur HTTP ${F.status}`);const ne=await F.json();ne.success&&ne.mapping&&(console.log("✅ Mapping sauvegardé dans le service:",ue,"→",Ce),N(ne.mapping),localStorage.setItem("printer_physical_mappings",JSON.stringify(ne.mapping)))}catch(F){console.error("❌ Erreur sauvegarde mapping dans le service:",F),console.log("📂 Fallback: sauvegarde dans localStorage");const ne={...C};Ce?ne[ue]=Ce:delete ne[ue],localStorage.setItem("printer_physical_mappings",JSON.stringify(ne)),N(ne)}},T=async()=>{try{g(!0);const[ue,Ce]=await Promise.all([A.from("printer_definitions").select(`
            *,
            sales_points (name)
          `).order("created_at",{ascending:!1}),A.from("sales_points").select("id, name").order("name")]);ue.data&&i(ue.data),Ce.data&&l(Ce.data)}catch(ue){console.error("Erreur chargement:",ue),alert("Erreur lors du chargement des données")}finally{g(!1)}},ce=async ue=>{if(ue.preventDefault(),!L.name||!L.sales_point_id){alert("Veuillez remplir tous les champs obligatoires");return}try{const Ce={name:L.name,sales_point_id:L.sales_point_id,description:L.description||null,is_active:L.is_active};let F;if(_){const{error:ne}=await A.from("printer_definitions").update(Ce).eq("id",_.id);if(ne)throw ne;F=_.id,alert("Imprimante modifiée avec succès")}else{const{data:ne,error:K}=await A.from("printer_definitions").insert([Ce]).select().single();if(K)throw K;F=ne.id,alert("Imprimante créée avec succès")}L.physical_printer&&Y(F,L.physical_printer),p(!1),j(null),_e(),T()}catch(Ce){console.error("Erreur sauvegarde:",Ce),alert("Erreur lors de la sauvegarde: "+Ce.message)}},se=ue=>{j(ue),U({name:ue.name,sales_point_id:ue.sales_point_id,description:ue.description||"",is_active:ue.is_active,physical_printer:C[ue.id]||""}),p(!0)},ee=async ue=>{if(confirm(`Êtes-vous sûr de vouloir supprimer cette imprimante ?
Les modèles d'impression associés seront également supprimés.`))try{const{error:Ce}=await A.from("printer_definitions").delete().eq("id",ue);if(Ce)throw Ce;alert("Imprimante supprimée"),T()}catch(Ce){console.error("Erreur suppression:",Ce),alert("Erreur lors de la suppression: "+Ce.message)}},_e=()=>{U({name:"",sales_point_id:"",description:"",is_active:!0,physical_printer:""})};return f?n.jsx("div",{className:"loading",children:"Chargement..."}):n.jsxs("div",{className:"printer-definitions-container",children:[n.jsxs("div",{className:"page-header",children:[n.jsxs("div",{className:"header-content",children:[n.jsx("h2",{children:"Gestion des Imprimantes Logiques"}),n.jsx("p",{className:"header-subtitle",children:"Définissez les imprimantes logiques pour chaque point de vente. Le mapping vers les imprimantes physiques se fera localement sur chaque POS."})]}),n.jsxs("div",{style:{display:"flex",gap:"10px"},children:[n.jsx("button",{className:"btn-secondary",onClick:async()=>{await M(),await T(),alert("Mappings rechargés !")},children:"🔄 Recharger les mappings"}),n.jsx("button",{className:"btn-primary",onClick:()=>{j(null),_e(),p(!0)},children:"+ Nouvelle imprimante"})]})]}),n.jsx("div",{className:"printers-list",children:o.length===0?n.jsxs("div",{className:"no-data",children:[n.jsx("p",{children:"Aucune imprimante définie"}),n.jsx("button",{className:"btn-primary",onClick:()=>p(!0),children:"Créer la première imprimante"})]}):n.jsxs("table",{className:"printers-table",children:[n.jsx("thead",{children:n.jsxs("tr",{children:[n.jsx("th",{children:"Nom"}),n.jsx("th",{children:"Point de vente"}),n.jsx("th",{children:"Imprimante physique"}),n.jsx("th",{children:"Description"}),n.jsx("th",{children:"Statut"}),n.jsx("th",{children:"Actions"})]})}),n.jsx("tbody",{children:o.map(ue=>n.jsxs("tr",{className:ue.is_active?"":"inactive-row",children:[n.jsx("td",{className:"printer-name",children:n.jsx("strong",{children:ue.name})}),n.jsx("td",{children:ue.sales_points?ue.sales_points.name:"-"}),n.jsx("td",{className:"printer-physical",children:C[ue.id]?n.jsx("span",{className:"physical-mapped",children:C[ue.id]}):n.jsx("span",{className:"no-mapping",children:"Non configurée"})}),n.jsx("td",{className:"printer-description",children:ue.description||"-"}),n.jsx("td",{children:n.jsx("span",{className:`status-badge ${ue.is_active?"active":"inactive"}`,children:ue.is_active?"Active":"Inactive"})}),n.jsx("td",{children:n.jsxs("div",{className:"action-buttons",children:[n.jsx("button",{className:"btn-edit",onClick:()=>se(ue),title:"Modifier",children:"✏️"}),n.jsx("button",{className:"btn-delete",onClick:()=>ee(ue.id),title:"Supprimer",children:"🗑️"})]})})]},ue.id))})]})}),m&&n.jsx("div",{className:"modal-overlay",onClick:()=>p(!1),children:n.jsxs("div",{className:"modal-content",onClick:ue=>ue.stopPropagation(),children:[n.jsxs("div",{className:"modal-header",children:[n.jsx("h3",{children:_?"Modifier l'imprimante":"Nouvelle imprimante"}),n.jsx("button",{className:"modal-close",onClick:()=>p(!1),children:"×"})]}),n.jsxs("form",{onSubmit:ce,children:[n.jsxs("div",{className:"form-group",children:[n.jsx("label",{children:"Nom de l'imprimante *"}),n.jsx("input",{type:"text",value:L.name,onChange:ue=>U({...L,name:ue.target.value}),required:!0,placeholder:"Ex: Cuisine Chaud Seven Seven"}),n.jsx("small",{children:"Le nom doit être descriptif et unique"})]}),n.jsxs("div",{className:"form-group",children:[n.jsx("label",{children:"Point de vente *"}),n.jsxs("select",{value:L.sales_point_id,onChange:ue=>U({...L,sales_point_id:ue.target.value}),required:!0,children:[n.jsx("option",{value:"",children:"Sélectionnez un point de vente"}),r.map(ue=>n.jsx("option",{value:ue.id,children:ue.name},ue.id))]})]}),n.jsxs("div",{className:"form-group",children:[n.jsx("label",{children:"Imprimante physique *"}),n.jsxs("div",{className:"printer-actions-row",children:[n.jsx("button",{type:"button",className:"btn-usb-access",onClick:G,children:"🔄 Actualiser la liste"}),n.jsx("button",{type:"button",className:"btn-manual-add",onClick:()=>V(!E),children:"✏️ Ajouter manuellement"})]}),E&&n.jsxs("div",{className:"manual-printer-input",children:[n.jsx("input",{type:"text",value:k,onChange:ue=>P(ue.target.value),placeholder:"Nom exact de l'imprimante (ex: EPSON TM-T20III)",onKeyPress:ue=>ue.key==="Enter"&&(ue.preventDefault(),q())}),n.jsx("button",{type:"button",onClick:q,className:"btn-add-printer",children:"➕ Ajouter"})]}),n.jsxs("select",{value:L.physical_printer,onChange:ue=>U({...L,physical_printer:ue.target.value}),required:!0,children:[n.jsx("option",{value:"",children:"Sélectionnez une imprimante physique"}),c.length===0&&n.jsx("option",{disabled:!0,children:"Aucune imprimante détectée - Ajoutez-en manuellement"}),c.map(ue=>n.jsx("option",{value:ue,children:ue},ue))]}),n.jsx("small",{children:"💡 Le service d'impression local doit être démarré (cd printer-service && npm start)"})]}),n.jsxs("div",{className:"form-group",children:[n.jsx("label",{children:"Description"}),n.jsx("textarea",{value:L.description,onChange:ue=>U({...L,description:ue.target.value}),placeholder:"Description optionnelle de l'imprimante",rows:"3"})]}),n.jsx("div",{className:"form-group-checkbox",children:n.jsxs("label",{children:[n.jsx("input",{type:"checkbox",checked:L.is_active,onChange:ue=>U({...L,is_active:ue.target.checked})}),"Imprimante active"]})}),n.jsxs("div",{className:"modal-actions",children:[n.jsx("button",{type:"button",className:"btn-secondary",onClick:()=>p(!1),children:"Annuler"}),n.jsx("button",{type:"submit",className:"btn-primary",children:_?"Modifier":"Créer"})]})]})]})})]})},Gj=()=>{const[o,i]=y.useState([]),[r,l]=y.useState([]),[c,d]=y.useState([]),[f,g]=y.useState(!0),[m,p]=y.useState(!1),[_,j]=y.useState(null),[C,N]=y.useState([]),[k,P]=y.useState(null),[E,V]=y.useState({name:"",template_type:"fabrication",printer_definition_id:"",is_active:!0});y.useEffect(()=>{L()},[]);const L=async()=>{try{g(!0);const[se,ee,_e]=await Promise.all([A.from("print_templates").select(`
            *,
            printer_definitions (name, sales_point_id, sales_points(name)),
            print_template_categories (
              category_id,
              product_categories (id, name, icon)
            )
          `).order("created_at",{ascending:!1}),A.from("printer_definitions").select("id, name, sales_point_id, is_active, sales_points(name)").eq("is_active",!0).order("name"),A.from("product_categories").select("id, name, icon, description").order("name")]);se.data&&i(se.data),ee.data&&l(ee.data),_e.data&&d(_e.data)}catch(se){console.error("Erreur chargement:",se),alert("Erreur lors du chargement des données")}finally{g(!1)}},U=async se=>{if(se.preventDefault(),!E.name||!E.printer_definition_id||!E.sales_point_id){alert("Veuillez remplir tous les champs obligatoires");return}if(E.template_type==="fabrication"&&C.length===0){alert("Veuillez sélectionner au moins une catégorie pour un modèle de fabrication");return}try{const ee={name:E.name,template_type:E.template_type,printer_definition_id:E.printer_definition_id,is_active:E.is_active};let _e;if(_){const{error:ue}=await A.from("print_templates").update(ee).eq("id",_.id);if(ue)throw ue;_e=_.id,await A.from("print_template_categories").delete().eq("print_template_id",_e)}else{const{data:ue,error:Ce}=await A.from("print_templates").insert([ee]).select().single();if(Ce)throw Ce;_e=ue.id}if(C.length>0){const ue=C.map(F=>({print_template_id:_e,category_id:F})),{error:Ce}=await A.from("print_template_categories").insert(ue);if(Ce)throw Ce}alert(_?"Modèle modifié avec succès":"Modèle créé avec succès"),p(!1),j(null),q(),L()}catch(ee){console.error("Erreur sauvegarde:",ee),alert("Erreur lors de la sauvegarde: "+ee.message)}},O=se=>{j(se),V({name:se.name,template_type:se.template_type,printer_definition_id:se.printer_definition_id,is_active:se.is_active});const ee=se.print_template_categories.map(_e=>_e.category_id).filter(_e=>_e);if(N(ee),se.printer_definitions){const _e=se.printer_definitions.sales_points?.name;P(_e)}p(!0)},M=async se=>{if(confirm("Êtes-vous sûr de vouloir supprimer ce modèle d'impression ?"))try{const{error:ee}=await A.from("print_templates").delete().eq("id",se);if(ee)throw ee;alert("Modèle supprimé"),L()}catch(ee){console.error("Erreur suppression:",ee),alert("Erreur lors de la suppression: "+ee.message)}},G=se=>{N(ee=>ee.includes(se)?ee.filter(_e=>_e!==se):[...ee,se])},q=()=>{V({name:"",template_type:"fabrication",printer_definition_id:"",is_active:!0}),N([]),P(null)},Y=se=>se==="caisse"?"Ticket de Caisse":"Fabrication",T=se=>se==="caisse"?"🧾":"📋",ce=se=>{V({...E,printer_definition_id:se});const ee=r.find(_e=>_e.id===se);P(ee&&ee.sales_points?.name||null)};return f?n.jsx("div",{className:"loading",children:"Chargement..."}):n.jsxs("div",{className:"print-templates-container",children:[n.jsxs("div",{className:"page-header",children:[n.jsxs("div",{className:"header-content",children:[n.jsx("h2",{children:"Gestion des Fonctions d'Impressions"}),n.jsx("p",{className:"header-subtitle",children:"Créez des modèles d'impression et associez-les à des catégories de produits. Les tickets de caisse impriment tous les produits, les tickets de fabrication impriment uniquement les produits des catégories sélectionnées."})]}),n.jsx("button",{className:"btn-primary",onClick:()=>{j(null),q(),p(!0)},children:"+ Nouveau modèle"})]}),n.jsx("div",{className:"templates-grid",children:o.length===0?n.jsxs("div",{className:"no-data",children:[n.jsx("p",{children:"Aucun modèle d'impression défini"}),n.jsx("button",{className:"btn-primary",onClick:()=>p(!0),children:"Créer le premier modèle"})]}):o.map(se=>n.jsxs("div",{className:`template-card ${se.is_active?"":"inactive"}`,children:[n.jsxs("div",{className:"template-header",children:[n.jsx("div",{className:"template-icon",children:T(se.template_type)}),n.jsxs("div",{className:"template-info",children:[n.jsx("h3",{children:se.name}),n.jsx("span",{className:"template-type",children:Y(se.template_type)})]})]}),n.jsxs("div",{className:"template-details",children:[n.jsxs("div",{className:"detail-item",children:[n.jsx("strong",{children:"Imprimante:"}),n.jsx("span",{children:se.printer_definitions?.name||"-"})]}),n.jsxs("div",{className:"detail-item",children:[n.jsx("strong",{children:"Point de vente:"}),n.jsx("span",{children:se.printer_definitions?.sales_points?.name||"-"})]}),n.jsxs("div",{className:"detail-item",children:[n.jsx("strong",{children:"Statut:"}),n.jsx("span",{className:`status-badge ${se.is_active?"active":"inactive"}`,children:se.is_active?"Actif":"Inactif"})]})]}),se.template_type==="fabrication"&&n.jsxs("div",{className:"template-categories",children:[n.jsx("strong",{children:"Catégories associées:"}),n.jsx("div",{className:"categories-list",children:se.print_template_categories?.length>0?se.print_template_categories.map(ee=>ee.product_categories&&n.jsxs("span",{className:"category-badge",children:[ee.product_categories.icon," ",ee.product_categories.name]},ee.category_id)):n.jsx("span",{className:"no-categories",children:"Aucune catégorie"})})]}),n.jsxs("div",{className:"template-actions",children:[n.jsx("button",{className:"btn-edit",onClick:()=>O(se),children:"✏️ Modifier"}),n.jsx("button",{className:"btn-delete",onClick:()=>M(se.id),children:"🗑️ Supprimer"})]})]},se.id))}),m&&n.jsx("div",{className:"modal-overlay",onClick:()=>p(!1),children:n.jsxs("div",{className:"modal-content large",onClick:se=>se.stopPropagation(),children:[n.jsxs("div",{className:"modal-header",children:[n.jsx("h3",{children:_?"Modifier le modèle":"Nouveau modèle d'impression"}),n.jsx("button",{className:"modal-close",onClick:()=>p(!1),children:"×"})]}),n.jsxs("form",{onSubmit:U,children:[n.jsxs("div",{className:"form-row",children:[n.jsxs("div",{className:"form-group",children:[n.jsx("label",{children:"Nom du modèle *"}),n.jsx("input",{type:"text",value:E.name,onChange:se=>V({...E,name:se.target.value}),required:!0,placeholder:"Ex: Fabrication Bar Seven Seven"})]}),n.jsxs("div",{className:"form-group",children:[n.jsx("label",{children:"Type de modèle *"}),n.jsxs("select",{value:E.template_type,onChange:se=>V({...E,template_type:se.target.value}),required:!0,children:[n.jsx("option",{value:"fabrication",children:"Fabrication"}),n.jsx("option",{value:"caisse",children:"Ticket de Caisse"})]})]})]}),n.jsxs("div",{className:"form-group",children:[n.jsx("label",{children:"Imprimante logique *"}),n.jsxs("select",{value:E.printer_definition_id,onChange:se=>ce(se.target.value),required:!0,children:[n.jsx("option",{value:"",children:"Sélectionnez une imprimante"}),r.map(se=>n.jsxs("option",{value:se.id,children:[se.name," (",se.sales_points?.name||"Aucun POS",")"]},se.id))]}),k&&n.jsxs("small",{className:"info-text",children:["✅ Point de vente: ",n.jsx("strong",{children:k})]})]}),E.template_type==="fabrication"&&n.jsxs("div",{className:"form-group",children:[n.jsx("label",{children:"Catégories de produits *"}),n.jsx("div",{className:"categories-selector",children:c.map(se=>n.jsxs("label",{className:"category-checkbox",children:[n.jsx("input",{type:"checkbox",checked:C.includes(se.id),onChange:()=>G(se.id)}),n.jsxs("span",{className:"category-label",children:[se.icon," ",se.name]})]},se.id))}),n.jsx("small",{children:"Sélectionnez les catégories qui doivent imprimer sur cette imprimante"})]}),E.template_type==="caisse"&&n.jsx("div",{className:"info-box",children:"ℹ️ Les tickets de caisse impriment automatiquement TOUS les produits de la commande"}),n.jsx("div",{className:"form-group-checkbox",children:n.jsxs("label",{children:[n.jsx("input",{type:"checkbox",checked:E.is_active,onChange:se=>V({...E,is_active:se.target.checked})}),"Modèle actif"]})}),n.jsxs("div",{className:"modal-actions",children:[n.jsx("button",{type:"button",className:"btn-secondary",onClick:()=>p(!1),children:"Annuler"}),n.jsx("button",{type:"submit",className:"btn-primary",children:_?"Modifier":"Créer"})]})]})]})})]})},Yj=()=>{const{user:o,signOut:i}=$s(),r=Qr(),{hasPermission:l,hasActionablePermissions:c,loading:d}=Zr(),[f,g]=y.useState("dashboard"),[m,p]=y.useState(!1),[_,j]=y.useState({todaySales:0,salesPointsCount:0,reservations:0});y.useEffect(()=>{f==="dashboard"&&C()},[f]);const C=async()=>{try{const E=new Date().toISOString().split("T")[0],{data:V}=await A.from("orders").select("total_amount").eq("payment_status","paid").gte("created_at",`${E}T00:00:00`).lte("created_at",`${E}T23:59:59`),L=V?.reduce((O,M)=>O+parseFloat(M.total_amount||0),0)||0,{count:U}=await A.from("sales_points").select("*",{count:"exact",head:!0});j({todaySales:L,salesPointsCount:U||0,reservations:0})}catch(E){console.error("Erreur chargement stats:",E)}},N=async()=>{try{await i(),r("/login")}catch(E){console.error("Erreur de déconnexion:",E)}},k=[{id:"dashboard",name:"Tableau de bord",icon:"📊",requiredPermission:null},{id:"cashregister",name:"Caisse",icon:"💰",requiredPermission:{module:"pos",action:"view"}},{id:"pos",name:"Points de vente",icon:"💳",requiredPermission:{module:"settings",action:"manage_sales_points"}},{id:"tables",name:"Tables",icon:"🪑",requiredPermission:{module:"tables",action:"view"},requiresActions:!0},{id:"products",name:"Produits",icon:"📦",requiredPermission:{module:"products",action:"view"},requiresActions:!0},{id:"categories",name:"Catégories",icon:"🏷️",requiredPermission:{module:"products",action:"view"},requiresActions:!0},{id:"product-types",name:"Types de produits",icon:"🔖",requiredPermission:{module:"products",action:"view"},requiresActions:!0},{id:"storage",name:"Dépôts",icon:"🏪",requiredPermission:{module:"settings",action:"view"},requiresActions:!0},{id:"inventory",name:"Stock",icon:"📋",requiredPermission:{module:"inventory",action:"view"}},{id:"suppliers",name:"Fournisseurs",icon:"🚚",requiredPermission:{module:"inventory",action:"view"}},{id:"purchase-orders",name:"Commandes Fournisseurs",icon:"📋",requiredPermission:{module:"inventory",action:"view"}},{id:"purchase-receptions",name:"Réceptions",icon:"📥",requiredPermission:{module:"inventory",action:"view"}},{id:"purchase-history",name:"Historique Achats",icon:"📊",requiredPermission:{module:"inventory",action:"view"}},{id:"clients",name:"Clients",icon:"👤",requiredPermission:{module:"clients",action:"view"}},{id:"printer-definitions",name:"Imprimantes Logiques",icon:"🖨️",requiredPermission:{module:"settings",action:"view"}},{id:"print-templates",name:"Fonctions Impression",icon:"📄",requiredPermission:{module:"settings",action:"view"}},{id:"void-logs",name:"Annulations",icon:"🚫",requiredPermission:{module:"pos",action:"view"}},{id:"employees",name:"Personnel",icon:"👥",requiredPermission:{module:"users",action:"view"},requiresActions:!0},{id:"roles",name:"Rôles",icon:"🔐",requiredPermission:{module:"users",action:"manage_permissions"}},{id:"action-logs",name:"Historique",icon:"📜",requiredPermission:{module:"users",action:"view"}},{id:"reports",name:"Rapports",icon:"📈",requiredPermission:{module:"reports"}}],P=y.useMemo(()=>d?[k[0]]:k.filter(E=>E.requiredPermission?(E.requiredPermission.action?l(E.requiredPermission.module,E.requiredPermission.action):c(E.requiredPermission.module))?E.requiresActions?c(E.requiredPermission.module):!0:!1:!0),[d,l,c]);return n.jsxs("div",{className:"dashboard-container",children:[n.jsxs("aside",{className:`sidebar ${m?"open":""}`,children:[n.jsx("div",{className:"sidebar-header",children:n.jsx("h1",{children:"ERP Casino"})}),n.jsx("nav",{className:"sidebar-nav",children:P.map(E=>n.jsxs("button",{className:`nav-item ${f===E.id?"active":""}`,onClick:()=>{E.id==="cashregister"?r("/pos"):(g(E.id),p(!1))},children:[n.jsx("span",{className:"nav-icon",children:E.icon}),n.jsx("span",{className:"nav-text",children:E.name})]},E.id))}),n.jsxs("div",{className:"sidebar-footer",children:[n.jsxs("div",{className:"user-info",children:[n.jsx("div",{className:"user-name",children:o?.full_name}),n.jsx("div",{className:"user-role",children:o?.role})]}),n.jsx("button",{className:"logout-btn",onClick:N,children:"Déconnexion"})]})]}),n.jsxs("main",{className:"main-content",children:[n.jsxs("header",{className:"content-header",children:[n.jsx("button",{className:"mobile-menu-btn",onClick:()=>p(!m),children:"☰"}),n.jsx("h2",{children:P.find(E=>E.id===f)?.name})]}),n.jsxs("div",{className:"content-body",children:[f==="dashboard"&&n.jsxs("div",{className:"welcome-card",children:[n.jsx("h3",{children:"Bienvenue dans votre ERP"}),n.jsx("p",{children:"Système de gestion pour complexe hôtel-casino-restauration"}),n.jsxs("div",{className:"stats-grid",children:[n.jsxs("div",{className:"stat-card",children:[n.jsx("div",{className:"stat-value",children:"43"}),n.jsx("div",{className:"stat-label",children:"Chambres"})]}),n.jsxs("div",{className:"stat-card",children:[n.jsx("div",{className:"stat-value",children:_.salesPointsCount}),n.jsx("div",{className:"stat-label",children:"Points de vente"})]}),n.jsxs("div",{className:"stat-card",children:[n.jsxs("div",{className:"stat-value",children:[_.todaySales.toFixed(0)," FCFA"]}),n.jsx("div",{className:"stat-label",children:"CA du jour"})]}),n.jsxs("div",{className:"stat-card",children:[n.jsx("div",{className:"stat-value",children:_.reservations}),n.jsx("div",{className:"stat-label",children:"Réservations"})]})]})]}),f==="products"&&n.jsx(Rj,{}),f==="categories"&&n.jsx(Dj,{}),f==="product-types"&&n.jsx(Mj,{}),f==="storage"&&n.jsx(qj,{}),f==="pos"&&n.jsx(zj,{}),f==="inventory"&&n.jsx(Lj,{}),f==="suppliers"&&n.jsx(xg,{}),f==="purchase-orders"&&n.jsx(bg,{}),f==="purchase-receptions"&&n.jsx(jg,{}),f==="purchase-history"&&n.jsx(Sg,{}),f==="cashregister"&&n.jsx(_g,{}),f==="printer-definitions"&&n.jsx(Vj,{}),f==="print-templates"&&n.jsx(Gj,{}),f==="clients"&&n.jsx(Pj,{}),f==="void-logs"&&n.jsx(Ij,{}),f==="tables"&&n.jsx(yg,{standalone:!0}),f==="employees"&&n.jsx(Fj,{}),f==="roles"&&n.jsx($j,{}),f==="action-logs"&&n.jsx(Hj,{}),!["dashboard","products","categories","product-types","storage","pos","inventory","suppliers","purchase-orders","purchase-receptions","purchase-history","cashregister","clients","void-logs","tables","employees","roles","action-logs","printer-definitions","print-templates"].includes(f)&&n.jsxs("div",{className:"welcome-card",children:[n.jsx("h3",{children:"Module en cours de développement"}),n.jsx("p",{children:"Ce module sera disponible prochainement."})]})]})]})]})},Ls=({children:o})=>{const{user:i,loading:r}=$s();return console.log("[ProtectedRoute] user:",i?"exists":"null","loading:",r),r?(console.log("[ProtectedRoute] Still loading, showing spinner"),n.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh"},children:n.jsx("div",{children:"Chargement..."})})):i?(console.log("[ProtectedRoute] User authenticated, rendering children"),o):(console.log("[ProtectedRoute] No user, redirecting to /login"),n.jsx(Ip,{to:"/login",replace:!0}))};function Qj(){const{user:o,loading:i}=$s();if(console.log("[RootRedirect] user:",o?"exists":"null","loading:",i),i)return console.log("[RootRedirect] Still loading, showing spinner"),n.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh"},children:n.jsx("div",{children:"Chargement..."})});const r=o?"/dashboard":"/login";return console.log("[RootRedirect] Redirecting to:",r),n.jsx(Ip,{to:r,replace:!0})}function Kj(){return n.jsx(kj,{children:n.jsx(Jy,{children:n.jsx(Aj,{children:n.jsxs(Ey,{children:[n.jsx(pa,{path:"/login",element:n.jsx(Oj,{})}),n.jsx(pa,{path:"/dashboard",element:n.jsx(Ls,{children:n.jsx(Yj,{})})}),n.jsx(pa,{path:"/pos",element:n.jsx(Ls,{children:n.jsx(_g,{})})}),n.jsx(pa,{path:"/suppliers",element:n.jsx(Ls,{children:n.jsx(xg,{})})}),n.jsx(pa,{path:"/purchase-orders",element:n.jsx(Ls,{children:n.jsx(bg,{})})}),n.jsx(pa,{path:"/purchase-receptions",element:n.jsx(Ls,{children:n.jsx(jg,{})})}),n.jsx(pa,{path:"/purchase-history",element:n.jsx(Ls,{children:n.jsx(Sg,{})})}),n.jsx(pa,{path:"/table-management",element:n.jsx(Ls,{children:n.jsx(yg,{standalone:!0})})}),n.jsx(pa,{path:"/",element:n.jsx(Qj,{})})]})})})})}L_.createRoot(document.getElementById("root")).render(n.jsx(Dp.StrictMode,{children:n.jsx(Kj,{})}));
